<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”€å”®ç®¡ç†å‰åç«¯å­—æ®µåŒ¹é…æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #007bff;
        }
        .success {
            color: #28a745;
            font-weight: bold;
        }
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        .info {
            color: #17a2b8;
        }
        .test-button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .json-display {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .field-check {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .field-check .status {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        .field-check .pass {
            background: #28a745;
        }
        .field-check .fail {
            background: #dc3545;
        }
        .field-check .pending {
            background: #6c757d;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ é”€å”®ç®¡ç†å‰åç«¯å­—æ®µåŒ¹é…æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“‹ ä¿®å¤å†…å®¹éªŒè¯</h2>
        <p>æœ¬æµ‹è¯•ç”¨äºéªŒè¯é”€å”®ç®¡ç†æ¨¡å—å‰åç«¯å­—æ®µåŒ¹é…ä¿®å¤æ˜¯å¦æˆåŠŸã€‚</p>
        
        <h3>ä¿®å¤çš„å…³é”®å­—æ®µï¼š</h3>
        <ul>
            <li><code>customerPhone</code> - å®¢æˆ·ç”µè¯ï¼ˆæ–°å¢ï¼‰</li>
            <li><code>staffName</code> - é”€å”®äººå‘˜å§“åï¼ˆä¿®å¤å­—æ®µåï¼‰</li>
            <li><code>customerName</code> - å®¢æˆ·å§“åï¼ˆéªŒè¯å…³è”æŸ¥è¯¢ï¼‰</li>
            <li><code>productName</code> - äº§å“åç§°ï¼ˆéªŒè¯å…³è”æŸ¥è¯¢ï¼‰</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>ğŸ§ª APIæ¥å£æµ‹è¯•</h2>
        
        <button class="test-button" onclick="testSalesRecordsAPI()">
            æµ‹è¯•é”€å”®è®°å½•åˆ—è¡¨API
        </button>
        
        <button class="test-button" onclick="testSalesStatsAPI()">
            æµ‹è¯•é”€å”®ç»Ÿè®¡API
        </button>
        
        <button class="test-button" onclick="testAllAPIs()">
            æµ‹è¯•æ‰€æœ‰API
        </button>
        
        <div id="test-results"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ“Š å­—æ®µåŒ¹é…éªŒè¯</h2>
        <div id="field-validation">
            <p class="info">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
        </div>
    </div>

    <div class="test-section">
        <h2>ğŸ“ APIå“åº”æ•°æ®</h2>
        <div id="api-response">
            <p class="info">APIå“åº”æ•°æ®å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api/sales';
        
        // å‰ç«¯æœŸæœ›çš„å­—æ®µåˆ—è¡¨
        const EXPECTED_FIELDS = [
            'id',
            'orderNumber',
            'customerName',
            'customerPhone',  // æ–°å¢å­—æ®µ
            'productName',
            'staffName',      // ä¿®å¤çš„å­—æ®µå
            'quantity',
            'unitPrice',
            'salesAmount',
            'discountAmount',
            'status',
            'paymentStatus',
            'paymentMethod',
            'orderDate',
            'deliveryDate'
        ];

        async function testSalesRecordsAPI() {
            updateTestResults('å¼€å§‹æµ‹è¯•é”€å”®è®°å½•åˆ—è¡¨API...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/records?page=1&pageSize=10`);
                const data = await response.json();
                
                if (response.ok) {
                    updateTestResults('âœ… é”€å”®è®°å½•APIè°ƒç”¨æˆåŠŸ', 'success');
                    displayAPIResponse('é”€å”®è®°å½•APIå“åº”', data);
                    validateFields(data.data?.list || [], 'sales-records');
                } else {
                    updateTestResults(`âŒ é”€å”®è®°å½•APIè°ƒç”¨å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                updateTestResults(`âŒ é”€å”®è®°å½•APIè°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testSalesStatsAPI() {
            updateTestResults('å¼€å§‹æµ‹è¯•é”€å”®ç»Ÿè®¡API...', 'info');
            
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                const data = await response.json();
                
                if (response.ok) {
                    updateTestResults('âœ… é”€å”®ç»Ÿè®¡APIè°ƒç”¨æˆåŠŸ', 'success');
                    displayAPIResponse('é”€å”®ç»Ÿè®¡APIå“åº”', data);
                    validateStatsFields(data.data || {});
                } else {
                    updateTestResults(`âŒ é”€å”®ç»Ÿè®¡APIè°ƒç”¨å¤±è´¥: ${data.message}`, 'error');
                }
            } catch (error) {
                updateTestResults(`âŒ é”€å”®ç»Ÿè®¡APIè°ƒç”¨å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        async function testAllAPIs() {
            updateTestResults('å¼€å§‹æµ‹è¯•æ‰€æœ‰API...', 'info');
            await testSalesRecordsAPI();
            await new Promise(resolve => setTimeout(resolve, 1000)); // å»¶è¿Ÿ1ç§’
            await testSalesStatsAPI();
            updateTestResults('ğŸ‰ æ‰€æœ‰APIæµ‹è¯•å®Œæˆ', 'success');
        }

        function validateFields(records, type) {
            const validationDiv = document.getElementById('field-validation');
            let html = '<h3>å­—æ®µéªŒè¯ç»“æœï¼š</h3>';
            
            if (!records || records.length === 0) {
                html += '<p class="info">âš ï¸ æ²¡æœ‰æ•°æ®è®°å½•ï¼Œæ— æ³•éªŒè¯å­—æ®µ</p>';
                validationDiv.innerHTML = html;
                return;
            }

            const firstRecord = records[0];
            const missingFields = [];
            const presentFields = [];

            EXPECTED_FIELDS.forEach(field => {
                const hasField = firstRecord.hasOwnProperty(field);
                const value = firstRecord[field];
                
                if (hasField) {
                    presentFields.push({
                        field,
                        value,
                        status: 'pass'
                    });
                } else {
                    missingFields.push({
                        field,
                        status: 'fail'
                    });
                }
            });

            // æ˜¾ç¤ºéªŒè¯ç»“æœ
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">';
            
            // æˆåŠŸçš„å­—æ®µ
            html += '<div><h4 class="success">âœ… å­˜åœ¨çš„å­—æ®µ (' + presentFields.length + ')</h4>';
            presentFields.forEach(item => {
                html += `<div class="field-check">
                    <div class="status pass">âœ“</div>
                    <div>
                        <strong>${item.field}</strong>: 
                        <span style="color: #666;">${JSON.stringify(item.value)}</span>
                    </div>
                </div>`;
            });
            html += '</div>';

            // ç¼ºå¤±çš„å­—æ®µ
            html += '<div><h4 class="error">âŒ ç¼ºå¤±çš„å­—æ®µ (' + missingFields.length + ')</h4>';
            if (missingFields.length === 0) {
                html += '<p class="success">ğŸ‰ æ‰€æœ‰æœŸæœ›å­—æ®µéƒ½å­˜åœ¨ï¼</p>';
            } else {
                missingFields.forEach(item => {
                    html += `<div class="field-check">
                        <div class="status fail">âœ—</div>
                        <div><strong>${item.field}</strong></div>
                    </div>`;
                });
            }
            html += '</div>';
            
            html += '</div>';

            // ç‰¹åˆ«æ£€æŸ¥ä¿®å¤çš„å­—æ®µ
            html += '<h4>ğŸ” å…³é”®ä¿®å¤å­—æ®µæ£€æŸ¥ï¼š</h4>';
            const keyFields = ['customerPhone', 'staffName', 'customerName', 'productName'];
            keyFields.forEach(field => {
                const hasField = firstRecord.hasOwnProperty(field);
                const value = firstRecord[field];
                const status = hasField ? 'success' : 'error';
                const icon = hasField ? 'âœ…' : 'âŒ';
                
                html += `<div class="field-check">
                    <div class="status ${hasField ? 'pass' : 'fail'}">${hasField ? 'âœ“' : 'âœ—'}</div>
                    <div>
                        <strong>${field}</strong>: 
                        <span class="${status}">${hasField ? JSON.stringify(value) : 'å­—æ®µç¼ºå¤±'}</span>
                    </div>
                </div>`;
            });

            validationDiv.innerHTML = html;
        }

        function validateStatsFields(stats) {
            const expectedStatsFields = [
                'totalSalesAmount',
                'totalOrders', 
                'newCustomers',
                'avgOrderAmount',
                'growthRate'
            ];

            let html = '<h3>ç»Ÿè®¡å­—æ®µéªŒè¯ç»“æœï¼š</h3>';
            
            expectedStatsFields.forEach(field => {
                const hasField = stats.hasOwnProperty(field);
                const value = stats[field];
                const status = hasField ? 'pass' : 'fail';
                const icon = hasField ? 'âœ“' : 'âœ—';
                
                html += `<div class="field-check">
                    <div class="status ${status}">${icon}</div>
                    <div>
                        <strong>${field}</strong>: 
                        <span>${hasField ? JSON.stringify(value) : 'å­—æ®µç¼ºå¤±'}</span>
                    </div>
                </div>`;
            });

            document.getElementById('field-validation').innerHTML += html;
        }

        function updateTestResults(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            
            resultsDiv.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        function displayAPIResponse(title, data) {
            const responseDiv = document.getElementById('api-response');
            const jsonString = JSON.stringify(data, null, 2);
            
            responseDiv.innerHTML = `
                <h3>${title}</h3>
                <div class="json-display">${jsonString}</div>
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateTestResults('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡å¼€å§‹æµ‹è¯•', 'info');
            updateTestResults('ğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ (http://localhost:8080)', 'info');
        });
    </script>
</body>
</html>