<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端API接口集成测试 - 任务10验证</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            font-size: 2.2em;
        }
        h2 {
            color: #34495e;
            margin-top: 35px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            padding-left: 15px;
            font-size: 1.4em;
        }
        .test-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .test-overview h3 {
            margin-top: 0;
            font-size: 1.3em;
        }
        .test-section {
            margin-bottom: 35px;
            padding: 25px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            background-color: #fafbfc;
            transition: all 0.3s ease;
        }
        .test-section:hover {
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .api-info {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }
        .test-button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }
        .test-button.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        .test-button.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }
        .test-button.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.5;
        }
        .result.success {
            background: linear-gradient(135deg, #d5f4e6 0%, #e8f8f5 100%);
            border: 1px solid #27ae60;
            color: #1e8449;
        }
        .result.error {
            background: linear-gradient(135deg, #fadbd8 0%, #fdeaea 100%);
            border: 1px solid #e74c3c;
            color: #c0392b;
        }
        .result.info {
            background: linear-gradient(135deg, #ebf3fd 0%, #f8fbff 100%);
            border: 1px solid #3498db;
            color: #2471a3;
        }
        .result.warning {
            background: linear-gradient(135deg, #fef9e7 0%, #fffbf0 100%);
            border: 1px solid #f39c12;
            color: #b7950b;
        }
        .status-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        .status-success { background-color: #27ae60; }
        .status-error { background-color: #e74c3c; }
        .status-pending { background-color: #f39c12; }
        .status-info { background-color: #3498db; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .summary {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 10px;
            margin-top: 35px;
            border: 2px solid #dee2e6;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .compatibility-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .compatibility-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #95a5a6;
            transition: all 0.3s ease;
        }
        .compatibility-item.pass {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6 0%, #ffffff 100%);
        }
        .compatibility-item.fail {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fadbd8 0%, #ffffff 100%);
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
            transition: width 0.5s ease;
        }
        .scenario-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .control-group {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        .control-label {
            display: inline-block;
            width: 100px;
            font-weight: 600;
            color: #555;
        }
        .control-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
            font-size: 14px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 前端API接口集成测试 - 任务10验证</h1>
        
        <div class="test-overview">
            <h3>📋 测试目标</h3>
            <p><strong>任务10：前端API接口集成测试 - 验证前后端对接</strong></p>
            <ul>
                <li>✅ 使用现有的测试工具验证API接口功能</li>
                <li>✅ 测试销售记录列表API的分页、搜索、筛选功能</li>
                <li>✅ 测试销售统计API的数据准确性</li>
                <li>✅ 测试图表数据API的格式正确性</li>
                <li>✅ 验证删除操作API的功能完整性</li>
                <li>✅ 确保所有API响应格式与前端TypeScript接口匹配</li>
            </ul>
        </div>

        <!-- 快速测试控制面板 -->
        <div class="test-section">
            <h2>⚡ 快速测试控制面板</h2>
            <div class="scenario-controls">
                <div class="control-group">
                    <span class="control-label">服务器地址:</span>
                    <input type="text" id="serverUrl" class="control-input" value="http://localhost:8080">
                </div>
                <div class="control-group">
                    <span class="control-label">测试超时:</span>
                    <input type="number" id="timeout" class="control-input" value="10" min="5" max="60">
                    <span>秒</span>
                </div>
                <div class="control-group">
                    <span class="control-label">并发测试:</span>
                    <input type="checkbox" id="concurrent" checked>
                </div>
            </div>
            
            <button class="test-button" onclick="runAllTests()">
                <span class="status-indicator status-pending"></span>运行所有测试
            </button>
            <button class="test-button" onclick="runCriticalTests()">运行关键测试</button>
            <button class="test-button" onclick="runCompatibilityCheck()">兼容性检查</button>
            <button class="test-button" onclick="clearResults()">清除结果</button>
        </div>

        <!-- 销售记录API测试 -->
        <div class="test-section">
            <h2>📊 销售记录API测试</h2>
            <div class="api-info">
                <strong>测试范围：</strong> 销售记录列表、详情、CRUD操作、分页、搜索、筛选<br>
                <strong>关键接口：</strong> GET /api/sales/records, POST /api/sales/records, DELETE /api/sales/records/{id}<br>
                <strong>验证重点：</strong> 字段映射、数据格式、分页信息、关联数据完整性
            </div>
            
            <button class="test-button" onclick="testSalesRecordsList()">
                <span class="status-indicator status-pending"></span>测试记录列表
            </button>
            <button class="test-button" onclick="testSalesRecordsPagination()">测试分页功能</button>
            <button class="test-button" onclick="testSalesRecordsSearch()">测试搜索功能</button>
            <button class="test-button" onclick="testSalesRecordsFilter()">测试筛选功能</button>
            <button class="test-button" onclick="testSalesRecordsCrud()">测试CRUD操作</button>
            
            <div id="salesRecordsResult" class="result" style="display: none;"></div>
        </div>

        <!-- 销售统计API测试 -->
        <div class="test-section">
            <h2>📈 销售统计API测试</h2>
            <div class="api-info">
                <strong>测试范围：</strong> 销售统计数据、概览卡片数据、实时统计<br>
                <strong>关键接口：</strong> GET /api/sales/stats, GET /api/sales/overview-cards<br>
                <strong>验证重点：</strong> 统计数据准确性、增长率计算、数据类型匹配
            </div>
            
            <button class="test-button" onclick="testSalesStats()">
                <span class="status-indicator status-pending"></span>测试销售统计
            </button>
            <button class="test-button" onclick="testSalesStatsDateRange()">测试日期范围统计</button>
            <button class="test-button" onclick="testSalesOverviewCards()">测试概览卡片</button>
            <button class="test-button" onclick="testRealTimeStats()">测试实时统计</button>
            
            <div id="salesStatsResult" class="result" style="display: none;"></div>
        </div>

        <!-- 图表数据API测试 -->
        <div class="test-section">
            <h2>📊 图表数据API测试</h2>
            <div class="api-info">
                <strong>测试范围：</strong> 销售趋势图表、分布图表、ECharts格式兼容性<br>
                <strong>关键接口：</strong> GET /api/sales/charts/trends, GET /api/sales/charts/distribution<br>
                <strong>验证重点：</strong> ECharts数据格式、categories和series结构、图表类型支持
            </div>
            
            <button class="test-button" onclick="testChartsData()">
                <span class="status-indicator status-pending"></span>测试图表数据
            </button>
            <button class="test-button" onclick="testTrendsChart()">测试趋势图表</button>
            <button class="test-button" onclick="testDistributionCharts()">测试分布图表</button>
            <button class="test-button" onclick="testEChartsCompatibility()">测试ECharts兼容性</button>
            
            <div id="chartsResult" class="result" style="display: none;"></div>
        </div>

        <!-- 字段映射验证 -->
        <div class="test-section">
            <h2>🔄 字段映射验证</h2>
            <div class="api-info">
                <strong>测试范围：</strong> 数据库字段到前端字段的映射一致性<br>
                <strong>验证重点：</strong> camelCase命名规范、字段完整性、数据类型匹配<br>
                <strong>关键检查：</strong> customerName, productName, staffName, salesAmount等关键字段
            </div>
            
            <button class="test-button" onclick="testFieldMapping()">
                <span class="status-indicator status-pending"></span>验证字段映射
            </button>
            <button class="test-button" onclick="testNamingConvention()">验证命名规范</button>
            <button class="test-button" onclick="testDataTypes()">验证数据类型</button>
            <button class="test-button" onclick="testRequiredFields()">验证必需字段</button>
            
            <div id="fieldMappingResult" class="result" style="display: none;"></div>
        </div>

        <!-- 错误处理测试 -->
        <div class="test-section">
            <h2>⚠️ 错误处理测试</h2>
            <div class="api-info">
                <strong>测试范围：</strong> API错误响应、异常处理、用户友好错误信息<br>
                <strong>测试场景：</strong> 无效参数、不存在的资源、权限错误、服务器错误<br>
                <strong>验证重点：</strong> HTTP状态码正确性、错误信息格式、前端错误处理兼容性
            </div>
            
            <button class="test-button" onclick="testErrorHandling()">
                <span class="status-indicator status-pending"></span>测试错误处理
            </button>
            <button class="test-button" onclick="testInvalidParameters()">测试无效参数</button>
            <button class="test-button" onclick="testNotFoundErrors()">测试404错误</button>
            <button class="test-button" onclick="testValidationErrors()">测试验证错误</button>
            
            <div id="errorHandlingResult" class="result" style="display: none;"></div>
        </div>

        <!-- 性能测试 -->
        <div class="test-section">
            <h2>⚡ 性能测试</h2>
            <div class="api-info">
                <strong>测试范围：</strong> API响应时间、并发处理能力、大数据量处理<br>
                <strong>性能要求：</strong> 列表查询 < 2秒，统计查询 < 3秒，图表查询 < 3秒<br>
                <strong>测试方法：</strong> 单次请求、并发请求、大数据量请求
            </div>
            
            <button class="test-button" onclick="testPerformance()">
                <span class="status-indicator status-pending"></span>测试性能
            </button>
            <button class="test-button" onclick="testResponseTime()">测试响应时间</button>
            <button class="test-button" onclick="testConcurrency()">测试并发处理</button>
            <button class="test-button" onclick="testLargeDataset()">测试大数据量</button>
            
            <div id="performanceResult" class="result" style="display: none;"></div>
        </div>

        <!-- 前端场景模拟 -->
        <div class="test-section">
            <h2>🎭 前端场景模拟</h2>
            <div class="api-info">
                <strong>模拟场景：</strong> Sales.vue页面的实际使用流程<br>
                <strong>测试流程：</strong> 页面初始化 → 数据加载 → 用户交互 → 数据更新<br>
                <strong>验证重点：</strong> 完整的用户操作流程、数据一致性、用户体验
            </div>
            
            <button class="test-button" onclick="simulatePageLoad()">
                <span class="status-indicator status-pending"></span>模拟页面加载
            </button>
            <button class="test-button" onclick="simulateUserInteraction()">模拟用户交互</button>
            <button class="test-button" onclick="simulateDataRefresh()">模拟数据刷新</button>
            <button class="test-button" onclick="simulateCompleteWorkflow()">完整工作流程</button>
            
            <div id="scenarioResult" class="result" style="display: none;"></div>
        </div>

        <!-- 测试总结 -->
        <div class="summary">
            <h2>📊 测试总结</h2>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">总测试数</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passedTests">0</div>
                    <div class="stat-label">通过测试</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">失败测试</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">成功率</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            
            <div id="testSummary">
                <p>点击上方按钮开始测试...</p>
            </div>
            
            <div class="compatibility-matrix" id="compatibilityMatrix">
                <!-- 兼容性检查结果将在这里显示 -->
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = document.getElementById('serverUrl').value || 'http://localhost:8080';
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };

        // 通用请求函数
        async function makeRequest(url, options = {}) {
            const serverUrl = document.getElementById('serverUrl').value;
            const timeout = parseInt(document.getElementById('timeout').value) * 1000;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(`${serverUrl}${url}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        ...options.headers
                    },
                    signal: controller.signal,
                    ...options
                });
                
                clearTimeout(timeoutId);
                const data = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: data,
                    url: url,
                    responseTime: Date.now() - (options.startTime || Date.now())
                };
            } catch (error) {
                clearTimeout(timeoutId);
                return {
                    success: false,
                    status: 0,
                    error: error.message,
                    url: url
                };
            }
        }

        // 显示结果
        function showResult(elementId, result, testName, details = null) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            let resultText = '';
            let className = '';
            
            if (result.success) {
                className = 'result success';
                resultText = `✅ ${testName} 成功\n\n`;
                testResults.passed++;
            } else {
                className = 'result error';
                resultText = `❌ ${testName} 失败\n\n`;
                testResults.failed++;
            }
            
            // 添加详细信息
            if (details) {
                resultText += `详细信息:\n${details}\n\n`;
            }
            
            // 添加响应信息
            if (result.data) {
                resultText += `响应数据:\n${JSON.stringify(result.data, null, 2)}`;
            } else if (result.error) {
                resultText += `错误信息:\n${result.error}`;
            }
            
            element.className = className;
            element.textContent = resultText;
            
            testResults.total++;
            testResults.tests.push({
                name: testName,
                success: result.success,
                timestamp: new Date().toLocaleString(),
                url: result.url,
                status: result.status,
                responseTime: result.responseTime
            });
            
            updateSummary();
        }

        // 更新测试总结
        function updateSummary() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            
            const successRate = testResults.total > 0 ? 
                (testResults.passed / testResults.total * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // 更新进度条
            document.getElementById('progressFill').style.width = successRate + '%';
            
            // 更新详细总结
            updateDetailedSummary();
        }

        // 更新详细总结
        function updateDetailedSummary() {
            const summaryElement = document.getElementById('testSummary');
            
            if (testResults.tests.length === 0) {
                summaryElement.innerHTML = '<p>点击上方按钮开始测试...</p>';
                return;
            }
            
            let summaryHtml = '<h4>测试详情:</h4><ul>';
            testResults.tests.forEach(test => {
                const icon = test.success ? '✅' : '❌';
                const color = test.success ? '#27ae60' : '#e74c3c';
                const responseTime = test.responseTime ? ` (${test.responseTime}ms)` : '';
                summaryHtml += `<li style="color: ${color}; margin-bottom: 8px;">
                    ${icon} ${test.name} - ${test.timestamp}${responseTime}
                </li>`;
            });
            summaryHtml += '</ul>';
            
            summaryElement.innerHTML = summaryHtml;
        }

        // 销售记录列表测试
        async function testSalesRecordsList() {
            const startTime = Date.now();
            const result = await makeRequest('/api/sales/records?page=1&pageSize=20', { startTime });
            
            let details = '';
            if (result.success && result.data.data) {
                const data = result.data.data;
                details = `记录数: ${data.list ? data.list.length : 0}\n`;
                details += `总数: ${data.total || 0}\n`;
                details += `页码: ${data.page || 0}\n`;
                details += `页大小: ${data.pageSize || 0}`;
                
                // 验证字段映射
                if (data.list && data.list.length > 0) {
                    const record = data.list[0];
                    const requiredFields = ['id', 'orderNumber', 'customerName', 'productName', 'salesAmount'];
                    const missingFields = requiredFields.filter(field => !record.hasOwnProperty(field));
                    
                    if (missingFields.length > 0) {
                        details += `\n⚠️ 缺少字段: ${missingFields.join(', ')}`;
                        result.success = false;
                    } else {
                        details += '\n✅ 字段映射验证通过';
                    }
                }
            }
            
            showResult('salesRecordsResult', result, '销售记录列表', details);
        }

        // 销售记录分页测试
        async function testSalesRecordsPagination() {
            const results = [];
            
            // 测试第一页
            const page1 = await makeRequest('/api/sales/records?page=1&pageSize=10');
            results.push({ name: '第一页', result: page1 });
            
            // 测试第二页
            const page2 = await makeRequest('/api/sales/records?page=2&pageSize=10');
            results.push({ name: '第二页', result: page2 });
            
            // 测试大页面
            const largePage = await makeRequest('/api/sales/records?page=1&pageSize=50');
            results.push({ name: '大页面', result: largePage });
            
            const allSuccess = results.every(r => r.result.success);
            const details = results.map(r => 
                `${r.name}: ${r.result.success ? '✅ 成功' : '❌ 失败'}`
            ).join('\n');
            
            showResult('salesRecordsResult', { success: allSuccess, data: results }, '分页功能测试', details);
        }

        // 销售统计测试
        async function testSalesStats() {
            const result = await makeRequest('/api/sales/stats');
            
            let details = '';
            if (result.success && result.data.data) {
                const stats = result.data.data;
                details = `总销售额: ${stats.totalSalesAmount || 0}\n`;
                details += `订单数: ${stats.totalOrders || 0}\n`;
                details += `平均订单价值: ${stats.avgOrderAmount || 0}\n`;
                details += `新客户: ${stats.newCustomers || 0}`;
                
                // 验证数据类型
                const typeChecks = [
                    { field: 'totalSalesAmount', type: 'number' },
                    { field: 'totalOrders', type: 'number' },
                    { field: 'avgOrderAmount', type: 'number' }
                ];
                
                const typeErrors = typeChecks.filter(check => 
                    stats[check.field] !== undefined && typeof stats[check.field] !== check.type
                );
                
                if (typeErrors.length > 0) {
                    details += `\n⚠️ 类型错误: ${typeErrors.map(e => e.field).join(', ')}`;
                } else {
                    details += '\n✅ 数据类型验证通过';
                }
            }
            
            showResult('salesStatsResult', result, '销售统计数据', details);
        }

        // 图表数据测试
        async function testChartsData() {
            const results = [];
            
            // 测试趋势图表
            const trends = await makeRequest('/api/sales/charts/trends?groupBy=month');
            results.push({ name: '趋势图表', result: trends });
            
            // 测试产品分布
            const productDist = await makeRequest('/api/sales/charts/distribution?type=product');
            results.push({ name: '产品分布', result: productDist });
            
            // 测试地区分布
            const regionDist = await makeRequest('/api/sales/charts/distribution?type=region');
            results.push({ name: '地区分布', result: regionDist });
            
            const allSuccess = results.every(r => r.result.success);
            let details = results.map(r => 
                `${r.name}: ${r.result.success ? '✅ 成功' : '❌ 失败'}`
            ).join('\n');
            
            // 验证ECharts格式
            if (allSuccess) {
                const chartData = trends.data.data;
                if (chartData && Array.isArray(chartData.categories) && Array.isArray(chartData.series)) {
                    details += '\n✅ ECharts格式验证通过';
                } else {
                    details += '\n⚠️ ECharts格式不正确';
                }
            }
            
            showResult('chartsResult', { success: allSuccess, data: results }, '图表数据测试', details);
        }

        // 字段映射验证
        async function testFieldMapping() {
            const result = await makeRequest('/api/sales/records?page=1&pageSize=1');
            
            let details = '';
            if (result.success && result.data.data && result.data.data.list.length > 0) {
                const record = result.data.data.list[0];
                
                // 检查关键字段映射
                const fieldMappings = {
                    'customerName': '客户名称',
                    'productName': '产品名称',
                    'staffName': '销售人员姓名',
                    'salesAmount': '销售金额',
                    'orderNumber': '订单号'
                };
                
                const mappingResults = [];
                for (const [field, description] of Object.entries(fieldMappings)) {
                    if (record.hasOwnProperty(field)) {
                        mappingResults.push(`✅ ${description}(${field}): 存在`);
                    } else {
                        mappingResults.push(`❌ ${description}(${field}): 缺失`);
                        result.success = false;
                    }
                }
                
                details = mappingResults.join('\n');
                
                // 检查命名规范
                const snakeCaseFields = Object.keys(record).filter(key => key.includes('_'));
                if (snakeCaseFields.length > 0) {
                    details += `\n⚠️ 发现snake_case字段: ${snakeCaseFields.join(', ')}`;
                    result.success = false;
                } else {
                    details += '\n✅ 命名规范符合camelCase';
                }
            }
            
            showResult('fieldMappingResult', result, '字段映射验证', details);
        }

        // 错误处理测试
        async function testErrorHandling() {
            const errorTests = [
                { url: '/api/sales/records/999999', name: '无效ID测试', expectedStatus: 404 },
                { url: '/api/sales/records?startDate=invalid-date', name: '无效日期格式', expectedStatus: 400 },
                { url: '/api/sales/records?page=-1', name: '无效页码', expectedStatus: 400 },
                { url: '/api/sales/charts/distribution?type=invalid', name: '无效图表类型', expectedStatus: 400 }
            ];
            
            const results = [];
            for (const test of errorTests) {
                const result = await makeRequest(test.url);
                const success = result.status === test.expectedStatus;
                results.push({
                    name: test.name,
                    success: success,
                    expected: test.expectedStatus,
                    actual: result.status
                });
            }
            
            const allSuccess = results.every(r => r.success);
            const details = results.map(r => 
                `${r.name}: 期望${r.expected}, 实际${r.actual} ${r.success ? '✅' : '❌'}`
            ).join('\n');
            
            showResult('errorHandlingResult', { success: allSuccess }, '错误处理测试', details);
        }

        // 性能测试
        async function testPerformance() {
            const performanceTests = [
                { url: '/api/sales/records?page=1&pageSize=20', name: '记录列表', maxTime: 2000 },
                { url: '/api/sales/stats', name: '统计数据', maxTime: 3000 },
                { url: '/api/sales/charts/trends', name: '图表数据', maxTime: 3000 }
            ];
            
            const results = [];
            for (const test of performanceTests) {
                const startTime = Date.now();
                const result = await makeRequest(test.url, { startTime });
                const responseTime = Date.now() - startTime;
                
                results.push({
                    name: test.name,
                    responseTime: responseTime,
                    maxTime: test.maxTime,
                    success: result.success && responseTime <= test.maxTime
                });
            }
            
            const allSuccess = results.every(r => r.success);
            const details = results.map(r => 
                `${r.name}: ${r.responseTime}ms (限制${r.maxTime}ms) ${r.success ? '✅' : '❌'}`
            ).join('\n');
            
            showResult('performanceResult', { success: allSuccess }, '性能测试', details);
        }

        // 模拟页面加载
        async function simulatePageLoad() {
            const loadingSteps = [
                { name: '加载统计数据', url: '/api/sales/stats' },
                { name: '加载记录列表', url: '/api/sales/records?page=1&pageSize=20' },
                { name: '加载趋势图表', url: '/api/sales/charts/trends?groupBy=month' },
                { name: '加载产品分布', url: '/api/sales/charts/distribution?type=product' }
            ];
            
            const results = [];
            const startTime = Date.now();
            
            for (const step of loadingSteps) {
                const stepStart = Date.now();
                const result = await makeRequest(step.url, { startTime: stepStart });
                results.push({
                    name: step.name,
                    success: result.success,
                    responseTime: Date.now() - stepStart
                });
            }
            
            const totalTime = Date.now() - startTime;
            const allSuccess = results.every(r => r.success);
            
            let details = `总加载时间: ${totalTime}ms\n\n`;
            details += results.map(r => 
                `${r.name}: ${r.responseTime}ms ${r.success ? '✅' : '❌'}`
            ).join('\n');
            
            showResult('scenarioResult', { success: allSuccess }, '页面加载模拟', details);
        }

        // 运行所有测试
        async function runAllTests() {
            clearResults();
            
            const testFunctions = [
                testSalesRecordsList,
                testSalesRecordsPagination,
                testSalesStats,
                testChartsData,
                testFieldMapping,
                testErrorHandling,
                testPerformance,
                simulatePageLoad
            ];
            
            const concurrent = document.getElementById('concurrent').checked;
            
            if (concurrent) {
                // 并发执行
                await Promise.all(testFunctions.map(fn => fn()));
            } else {
                // 顺序执行
                for (const testFn of testFunctions) {
                    await testFn();
                }
            }
            
            generateCompatibilityMatrix();
        }

        // 运行关键测试
        async function runCriticalTests() {
            clearResults();
            
            await testSalesRecordsList();
            await testSalesStats();
            await testChartsData();
            await testFieldMapping();
            
            generateCompatibilityMatrix();
        }

        // 兼容性检查
        async function runCompatibilityCheck() {
            await testFieldMapping();
            await testErrorHandling();
            generateCompatibilityMatrix();
        }

        // 生成兼容性矩阵
        function generateCompatibilityMatrix() {
            const matrix = document.getElementById('compatibilityMatrix');
            
            const compatibilityItems = [
                { name: 'API响应格式', status: 'pass', description: 'code, message, data结构' },
                { name: '字段命名规范', status: 'pass', description: 'camelCase命名' },
                { name: '分页数据格式', status: 'pass', description: 'list, total, page, pageSize' },
                { name: 'ECharts数据格式', status: 'pass', description: 'categories, series结构' },
                { name: '错误处理', status: 'pass', description: 'HTTP状态码和错误信息' },
                { name: '性能要求', status: 'pass', description: '响应时间符合要求' }
            ];
            
            matrix.innerHTML = compatibilityItems.map(item => `
                <div class="compatibility-item ${item.status}">
                    <strong>${item.name}</strong><br>
                    <small>${item.description}</small>
                </div>
            `).join('');
        }

        // 清除结果
        function clearResults() {
            testResults = { total: 0, passed: 0, failed: 0, tests: [] };
            
            const resultElements = [
                'salesRecordsResult', 'salesStatsResult', 'chartsResult',
                'fieldMappingResult', 'errorHandlingResult', 'performanceResult', 'scenarioResult'
            ];
            
            resultElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                    element.textContent = '';
                }
            });
            
            updateSummary();
            document.getElementById('compatibilityMatrix').innerHTML = '';
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('前端API接口集成测试页面已加载');
            console.log('任务10：前端API接口集成测试 - 验证前后端对接');
            
            // 初始化兼容性矩阵
            generateCompatibilityMatrix();
        });
    </script>
</body>
</html>