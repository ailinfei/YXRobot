<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯APIæ¥å£é›†æˆæµ‹è¯• - ä»»åŠ¡10éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            font-size: 2.2em;
        }
        h2 {
            color: #34495e;
            margin-top: 35px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
            padding-left: 15px;
            font-size: 1.4em;
        }
        .test-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        .test-overview h3 {
            margin-top: 0;
            font-size: 1.3em;
        }
        .test-section {
            margin-bottom: 35px;
            padding: 25px;
            border: 1px solid #e1e8ed;
            border-radius: 10px;
            background-color: #fafbfc;
            transition: all 0.3s ease;
        }
        .test-section:hover {
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        .api-info {
            background: linear-gradient(135deg, #e8f4fd 0%, #f0f8ff 100%);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid #3498db;
        }
        .test-button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin-right: 12px;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
        }
        .test-button.success {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            box-shadow: 0 2px 8px rgba(39, 174, 96, 0.3);
        }
        .test-button.error {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
        }
        .test-button.warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            box-shadow: 0 2px 8px rgba(243, 156, 18, 0.3);
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            line-height: 1.5;
        }
        .result.success {
            background: linear-gradient(135deg, #d5f4e6 0%, #e8f8f5 100%);
            border: 1px solid #27ae60;
            color: #1e8449;
        }
        .result.error {
            background: linear-gradient(135deg, #fadbd8 0%, #fdeaea 100%);
            border: 1px solid #e74c3c;
            color: #c0392b;
        }
        .result.info {
            background: linear-gradient(135deg, #ebf3fd 0%, #f8fbff 100%);
            border: 1px solid #3498db;
            color: #2471a3;
        }
        .result.warning {
            background: linear-gradient(135deg, #fef9e7 0%, #fffbf0 100%);
            border: 1px solid #f39c12;
            color: #b7950b;
        }
        .status-indicator {
            display: inline-block;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        .status-success { background-color: #27ae60; }
        .status-error { background-color: #e74c3c; }
        .status-pending { background-color: #f39c12; }
        .status-info { background-color: #3498db; }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .summary {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            padding: 25px;
            border-radius: 10px;
            margin-top: 35px;
            border: 2px solid #dee2e6;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .compatibility-matrix {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .compatibility-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #95a5a6;
            transition: all 0.3s ease;
        }
        .compatibility-item.pass {
            border-left-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6 0%, #ffffff 100%);
        }
        .compatibility-item.fail {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fadbd8 0%, #ffffff 100%);
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db 0%, #2ecc71 100%);
            transition: width 0.5s ease;
        }
        .scenario-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        .control-group {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        .control-label {
            display: inline-block;
            width: 100px;
            font-weight: 600;
            color: #555;
        }
        .control-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 150px;
            font-size: 14px;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ å‰ç«¯APIæ¥å£é›†æˆæµ‹è¯• - ä»»åŠ¡10éªŒè¯</h1>
        
        <div class="test-overview">
            <h3>ğŸ“‹ æµ‹è¯•ç›®æ ‡</h3>
            <p><strong>ä»»åŠ¡10ï¼šå‰ç«¯APIæ¥å£é›†æˆæµ‹è¯• - éªŒè¯å‰åç«¯å¯¹æ¥</strong></p>
            <ul>
                <li>âœ… ä½¿ç”¨ç°æœ‰çš„æµ‹è¯•å·¥å…·éªŒè¯APIæ¥å£åŠŸèƒ½</li>
                <li>âœ… æµ‹è¯•é”€å”®è®°å½•åˆ—è¡¨APIçš„åˆ†é¡µã€æœç´¢ã€ç­›é€‰åŠŸèƒ½</li>
                <li>âœ… æµ‹è¯•é”€å”®ç»Ÿè®¡APIçš„æ•°æ®å‡†ç¡®æ€§</li>
                <li>âœ… æµ‹è¯•å›¾è¡¨æ•°æ®APIçš„æ ¼å¼æ­£ç¡®æ€§</li>
                <li>âœ… éªŒè¯åˆ é™¤æ“ä½œAPIçš„åŠŸèƒ½å®Œæ•´æ€§</li>
                <li>âœ… ç¡®ä¿æ‰€æœ‰APIå“åº”æ ¼å¼ä¸å‰ç«¯TypeScriptæ¥å£åŒ¹é…</li>
            </ul>
        </div>

        <!-- å¿«é€Ÿæµ‹è¯•æ§åˆ¶é¢æ¿ -->
        <div class="test-section">
            <h2>âš¡ å¿«é€Ÿæµ‹è¯•æ§åˆ¶é¢æ¿</h2>
            <div class="scenario-controls">
                <div class="control-group">
                    <span class="control-label">æœåŠ¡å™¨åœ°å€:</span>
                    <input type="text" id="serverUrl" class="control-input" value="http://localhost:8080">
                </div>
                <div class="control-group">
                    <span class="control-label">æµ‹è¯•è¶…æ—¶:</span>
                    <input type="number" id="timeout" class="control-input" value="10" min="5" max="60">
                    <span>ç§’</span>
                </div>
                <div class="control-group">
                    <span class="control-label">å¹¶å‘æµ‹è¯•:</span>
                    <input type="checkbox" id="concurrent" checked>
                </div>
            </div>
            
            <button class="test-button" onclick="runAllTests()">
                <span class="status-indicator status-pending"></span>è¿è¡Œæ‰€æœ‰æµ‹è¯•
            </button>
            <button class="test-button" onclick="runCriticalTests()">è¿è¡Œå…³é”®æµ‹è¯•</button>
            <button class="test-button" onclick="runCompatibilityCheck()">å…¼å®¹æ€§æ£€æŸ¥</button>
            <button class="test-button" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>

        <!-- é”€å”®è®°å½•APIæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“Š é”€å”®è®°å½•APIæµ‹è¯•</h2>
            <div class="api-info">
                <strong>æµ‹è¯•èŒƒå›´ï¼š</strong> é”€å”®è®°å½•åˆ—è¡¨ã€è¯¦æƒ…ã€CRUDæ“ä½œã€åˆ†é¡µã€æœç´¢ã€ç­›é€‰<br>
                <strong>å…³é”®æ¥å£ï¼š</strong> GET /api/sales/records, POST /api/sales/records, DELETE /api/sales/records/{id}<br>
                <strong>éªŒè¯é‡ç‚¹ï¼š</strong> å­—æ®µæ˜ å°„ã€æ•°æ®æ ¼å¼ã€åˆ†é¡µä¿¡æ¯ã€å…³è”æ•°æ®å®Œæ•´æ€§
            </div>
            
            <button class="test-button" onclick="testSalesRecordsList()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•è®°å½•åˆ—è¡¨
            </button>
            <button class="test-button" onclick="testSalesRecordsPagination()">æµ‹è¯•åˆ†é¡µåŠŸèƒ½</button>
            <button class="test-button" onclick="testSalesRecordsSearch()">æµ‹è¯•æœç´¢åŠŸèƒ½</button>
            <button class="test-button" onclick="testSalesRecordsFilter()">æµ‹è¯•ç­›é€‰åŠŸèƒ½</button>
            <button class="test-button" onclick="testSalesRecordsCrud()">æµ‹è¯•CRUDæ“ä½œ</button>
            
            <div id="salesRecordsResult" class="result" style="display: none;"></div>
        </div>

        <!-- é”€å”®ç»Ÿè®¡APIæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“ˆ é”€å”®ç»Ÿè®¡APIæµ‹è¯•</h2>
            <div class="api-info">
                <strong>æµ‹è¯•èŒƒå›´ï¼š</strong> é”€å”®ç»Ÿè®¡æ•°æ®ã€æ¦‚è§ˆå¡ç‰‡æ•°æ®ã€å®æ—¶ç»Ÿè®¡<br>
                <strong>å…³é”®æ¥å£ï¼š</strong> GET /api/sales/stats, GET /api/sales/overview-cards<br>
                <strong>éªŒè¯é‡ç‚¹ï¼š</strong> ç»Ÿè®¡æ•°æ®å‡†ç¡®æ€§ã€å¢é•¿ç‡è®¡ç®—ã€æ•°æ®ç±»å‹åŒ¹é…
            </div>
            
            <button class="test-button" onclick="testSalesStats()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•é”€å”®ç»Ÿè®¡
            </button>
            <button class="test-button" onclick="testSalesStatsDateRange()">æµ‹è¯•æ—¥æœŸèŒƒå›´ç»Ÿè®¡</button>
            <button class="test-button" onclick="testSalesOverviewCards()">æµ‹è¯•æ¦‚è§ˆå¡ç‰‡</button>
            <button class="test-button" onclick="testRealTimeStats()">æµ‹è¯•å®æ—¶ç»Ÿè®¡</button>
            
            <div id="salesStatsResult" class="result" style="display: none;"></div>
        </div>

        <!-- å›¾è¡¨æ•°æ®APIæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“Š å›¾è¡¨æ•°æ®APIæµ‹è¯•</h2>
            <div class="api-info">
                <strong>æµ‹è¯•èŒƒå›´ï¼š</strong> é”€å”®è¶‹åŠ¿å›¾è¡¨ã€åˆ†å¸ƒå›¾è¡¨ã€EChartsæ ¼å¼å…¼å®¹æ€§<br>
                <strong>å…³é”®æ¥å£ï¼š</strong> GET /api/sales/charts/trends, GET /api/sales/charts/distribution<br>
                <strong>éªŒè¯é‡ç‚¹ï¼š</strong> EChartsæ•°æ®æ ¼å¼ã€categorieså’Œseriesç»“æ„ã€å›¾è¡¨ç±»å‹æ”¯æŒ
            </div>
            
            <button class="test-button" onclick="testChartsData()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•å›¾è¡¨æ•°æ®
            </button>
            <button class="test-button" onclick="testTrendsChart()">æµ‹è¯•è¶‹åŠ¿å›¾è¡¨</button>
            <button class="test-button" onclick="testDistributionCharts()">æµ‹è¯•åˆ†å¸ƒå›¾è¡¨</button>
            <button class="test-button" onclick="testEChartsCompatibility()">æµ‹è¯•EChartså…¼å®¹æ€§</button>
            
            <div id="chartsResult" class="result" style="display: none;"></div>
        </div>

        <!-- å­—æ®µæ˜ å°„éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ”„ å­—æ®µæ˜ å°„éªŒè¯</h2>
            <div class="api-info">
                <strong>æµ‹è¯•èŒƒå›´ï¼š</strong> æ•°æ®åº“å­—æ®µåˆ°å‰ç«¯å­—æ®µçš„æ˜ å°„ä¸€è‡´æ€§<br>
                <strong>éªŒè¯é‡ç‚¹ï¼š</strong> camelCaseå‘½åè§„èŒƒã€å­—æ®µå®Œæ•´æ€§ã€æ•°æ®ç±»å‹åŒ¹é…<br>
                <strong>å…³é”®æ£€æŸ¥ï¼š</strong> customerName, productName, staffName, salesAmountç­‰å…³é”®å­—æ®µ
            </div>
            
            <button class="test-button" onclick="testFieldMapping()">
                <span class="status-indicator status-pending"></span>éªŒè¯å­—æ®µæ˜ å°„
            </button>
            <button class="test-button" onclick="testNamingConvention()">éªŒè¯å‘½åè§„èŒƒ</button>
            <button class="test-button" onclick="testDataTypes()">éªŒè¯æ•°æ®ç±»å‹</button>
            <button class="test-button" onclick="testRequiredFields()">éªŒè¯å¿…éœ€å­—æ®µ</button>
            
            <div id="fieldMappingResult" class="result" style="display: none;"></div>
        </div>

        <!-- é”™è¯¯å¤„ç†æµ‹è¯• -->
        <div class="test-section">
            <h2>âš ï¸ é”™è¯¯å¤„ç†æµ‹è¯•</h2>
            <div class="api-info">
                <strong>æµ‹è¯•èŒƒå›´ï¼š</strong> APIé”™è¯¯å“åº”ã€å¼‚å¸¸å¤„ç†ã€ç”¨æˆ·å‹å¥½é”™è¯¯ä¿¡æ¯<br>
                <strong>æµ‹è¯•åœºæ™¯ï¼š</strong> æ— æ•ˆå‚æ•°ã€ä¸å­˜åœ¨çš„èµ„æºã€æƒé™é”™è¯¯ã€æœåŠ¡å™¨é”™è¯¯<br>
                <strong>éªŒè¯é‡ç‚¹ï¼š</strong> HTTPçŠ¶æ€ç æ­£ç¡®æ€§ã€é”™è¯¯ä¿¡æ¯æ ¼å¼ã€å‰ç«¯é”™è¯¯å¤„ç†å…¼å®¹æ€§
            </div>
            
            <button class="test-button" onclick="testErrorHandling()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•é”™è¯¯å¤„ç†
            </button>
            <button class="test-button" onclick="testInvalidParameters()">æµ‹è¯•æ— æ•ˆå‚æ•°</button>
            <button class="test-button" onclick="testNotFoundErrors()">æµ‹è¯•404é”™è¯¯</button>
            <button class="test-button" onclick="testValidationErrors()">æµ‹è¯•éªŒè¯é”™è¯¯</button>
            
            <div id="errorHandlingResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>âš¡ æ€§èƒ½æµ‹è¯•</h2>
            <div class="api-info">
                <strong>æµ‹è¯•èŒƒå›´ï¼š</strong> APIå“åº”æ—¶é—´ã€å¹¶å‘å¤„ç†èƒ½åŠ›ã€å¤§æ•°æ®é‡å¤„ç†<br>
                <strong>æ€§èƒ½è¦æ±‚ï¼š</strong> åˆ—è¡¨æŸ¥è¯¢ < 2ç§’ï¼Œç»Ÿè®¡æŸ¥è¯¢ < 3ç§’ï¼Œå›¾è¡¨æŸ¥è¯¢ < 3ç§’<br>
                <strong>æµ‹è¯•æ–¹æ³•ï¼š</strong> å•æ¬¡è¯·æ±‚ã€å¹¶å‘è¯·æ±‚ã€å¤§æ•°æ®é‡è¯·æ±‚
            </div>
            
            <button class="test-button" onclick="testPerformance()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•æ€§èƒ½
            </button>
            <button class="test-button" onclick="testResponseTime()">æµ‹è¯•å“åº”æ—¶é—´</button>
            <button class="test-button" onclick="testConcurrency()">æµ‹è¯•å¹¶å‘å¤„ç†</button>
            <button class="test-button" onclick="testLargeDataset()">æµ‹è¯•å¤§æ•°æ®é‡</button>
            
            <div id="performanceResult" class="result" style="display: none;"></div>
        </div>

        <!-- å‰ç«¯åœºæ™¯æ¨¡æ‹Ÿ -->
        <div class="test-section">
            <h2>ğŸ­ å‰ç«¯åœºæ™¯æ¨¡æ‹Ÿ</h2>
            <div class="api-info">
                <strong>æ¨¡æ‹Ÿåœºæ™¯ï¼š</strong> Sales.vueé¡µé¢çš„å®é™…ä½¿ç”¨æµç¨‹<br>
                <strong>æµ‹è¯•æµç¨‹ï¼š</strong> é¡µé¢åˆå§‹åŒ– â†’ æ•°æ®åŠ è½½ â†’ ç”¨æˆ·äº¤äº’ â†’ æ•°æ®æ›´æ–°<br>
                <strong>éªŒè¯é‡ç‚¹ï¼š</strong> å®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹ã€æ•°æ®ä¸€è‡´æ€§ã€ç”¨æˆ·ä½“éªŒ
            </div>
            
            <button class="test-button" onclick="simulatePageLoad()">
                <span class="status-indicator status-pending"></span>æ¨¡æ‹Ÿé¡µé¢åŠ è½½
            </button>
            <button class="test-button" onclick="simulateUserInteraction()">æ¨¡æ‹Ÿç”¨æˆ·äº¤äº’</button>
            <button class="test-button" onclick="simulateDataRefresh()">æ¨¡æ‹Ÿæ•°æ®åˆ·æ–°</button>
            <button class="test-button" onclick="simulateCompleteWorkflow()">å®Œæ•´å·¥ä½œæµç¨‹</button>
            
            <div id="scenarioResult" class="result" style="display: none;"></div>
        </div>

        <!-- æµ‹è¯•æ€»ç»“ -->
        <div class="summary">
            <h2>ğŸ“Š æµ‹è¯•æ€»ç»“</h2>
            <div class="summary-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalTests">0</div>
                    <div class="stat-label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="passedTests">0</div>
                    <div class="stat-label">é€šè¿‡æµ‹è¯•</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="failedTests">0</div>
                    <div class="stat-label">å¤±è´¥æµ‹è¯•</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">æˆåŠŸç‡</div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%;"></div>
            </div>
            
            <div id="testSummary">
                <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
            
            <div class="compatibility-matrix" id="compatibilityMatrix">
                <!-- å…¼å®¹æ€§æ£€æŸ¥ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = document.getElementById('serverUrl').value || 'http://localhost:8080';
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };

        // é€šç”¨è¯·æ±‚å‡½æ•°
        async function makeRequest(url, options = {}) {
            const serverUrl = document.getElementById('serverUrl').value;
            const timeout = parseInt(document.getElementById('timeout').value) * 1000;
            
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), timeout);
            
            try {
                const response = await fetch(`${serverUrl}${url}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                        ...options.headers
                    },
                    signal: controller.signal,
                    ...options
                });
                
                clearTimeout(timeoutId);
                const data = await response.json();
                
                return {
                    success: response.ok,
                    status: response.status,
                    data: data,
                    url: url,
                    responseTime: Date.now() - (options.startTime || Date.now())
                };
            } catch (error) {
                clearTimeout(timeoutId);
                return {
                    success: false,
                    status: 0,
                    error: error.message,
                    url: url
                };
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, result, testName, details = null) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            let resultText = '';
            let className = '';
            
            if (result.success) {
                className = 'result success';
                resultText = `âœ… ${testName} æˆåŠŸ\n\n`;
                testResults.passed++;
            } else {
                className = 'result error';
                resultText = `âŒ ${testName} å¤±è´¥\n\n`;
                testResults.failed++;
            }
            
            // æ·»åŠ è¯¦ç»†ä¿¡æ¯
            if (details) {
                resultText += `è¯¦ç»†ä¿¡æ¯:\n${details}\n\n`;
            }
            
            // æ·»åŠ å“åº”ä¿¡æ¯
            if (result.data) {
                resultText += `å“åº”æ•°æ®:\n${JSON.stringify(result.data, null, 2)}`;
            } else if (result.error) {
                resultText += `é”™è¯¯ä¿¡æ¯:\n${result.error}`;
            }
            
            element.className = className;
            element.textContent = resultText;
            
            testResults.total++;
            testResults.tests.push({
                name: testName,
                success: result.success,
                timestamp: new Date().toLocaleString(),
                url: result.url,
                status: result.status,
                responseTime: result.responseTime
            });
            
            updateSummary();
        }

        // æ›´æ–°æµ‹è¯•æ€»ç»“
        function updateSummary() {
            document.getElementById('totalTests').textContent = testResults.total;
            document.getElementById('passedTests').textContent = testResults.passed;
            document.getElementById('failedTests').textContent = testResults.failed;
            
            const successRate = testResults.total > 0 ? 
                (testResults.passed / testResults.total * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = successRate + '%';
            
            // æ›´æ–°è¿›åº¦æ¡
            document.getElementById('progressFill').style.width = successRate + '%';
            
            // æ›´æ–°è¯¦ç»†æ€»ç»“
            updateDetailedSummary();
        }

        // æ›´æ–°è¯¦ç»†æ€»ç»“
        function updateDetailedSummary() {
            const summaryElement = document.getElementById('testSummary');
            
            if (testResults.tests.length === 0) {
                summaryElement.innerHTML = '<p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>';
                return;
            }
            
            let summaryHtml = '<h4>æµ‹è¯•è¯¦æƒ…:</h4><ul>';
            testResults.tests.forEach(test => {
                const icon = test.success ? 'âœ…' : 'âŒ';
                const color = test.success ? '#27ae60' : '#e74c3c';
                const responseTime = test.responseTime ? ` (${test.responseTime}ms)` : '';
                summaryHtml += `<li style="color: ${color}; margin-bottom: 8px;">
                    ${icon} ${test.name} - ${test.timestamp}${responseTime}
                </li>`;
            });
            summaryHtml += '</ul>';
            
            summaryElement.innerHTML = summaryHtml;
        }

        // é”€å”®è®°å½•åˆ—è¡¨æµ‹è¯•
        async function testSalesRecordsList() {
            const startTime = Date.now();
            const result = await makeRequest('/api/sales/records?page=1&pageSize=20', { startTime });
            
            let details = '';
            if (result.success && result.data.data) {
                const data = result.data.data;
                details = `è®°å½•æ•°: ${data.list ? data.list.length : 0}\n`;
                details += `æ€»æ•°: ${data.total || 0}\n`;
                details += `é¡µç : ${data.page || 0}\n`;
                details += `é¡µå¤§å°: ${data.pageSize || 0}`;
                
                // éªŒè¯å­—æ®µæ˜ å°„
                if (data.list && data.list.length > 0) {
                    const record = data.list[0];
                    const requiredFields = ['id', 'orderNumber', 'customerName', 'productName', 'salesAmount'];
                    const missingFields = requiredFields.filter(field => !record.hasOwnProperty(field));
                    
                    if (missingFields.length > 0) {
                        details += `\nâš ï¸ ç¼ºå°‘å­—æ®µ: ${missingFields.join(', ')}`;
                        result.success = false;
                    } else {
                        details += '\nâœ… å­—æ®µæ˜ å°„éªŒè¯é€šè¿‡';
                    }
                }
            }
            
            showResult('salesRecordsResult', result, 'é”€å”®è®°å½•åˆ—è¡¨', details);
        }

        // é”€å”®è®°å½•åˆ†é¡µæµ‹è¯•
        async function testSalesRecordsPagination() {
            const results = [];
            
            // æµ‹è¯•ç¬¬ä¸€é¡µ
            const page1 = await makeRequest('/api/sales/records?page=1&pageSize=10');
            results.push({ name: 'ç¬¬ä¸€é¡µ', result: page1 });
            
            // æµ‹è¯•ç¬¬äºŒé¡µ
            const page2 = await makeRequest('/api/sales/records?page=2&pageSize=10');
            results.push({ name: 'ç¬¬äºŒé¡µ', result: page2 });
            
            // æµ‹è¯•å¤§é¡µé¢
            const largePage = await makeRequest('/api/sales/records?page=1&pageSize=50');
            results.push({ name: 'å¤§é¡µé¢', result: largePage });
            
            const allSuccess = results.every(r => r.result.success);
            const details = results.map(r => 
                `${r.name}: ${r.result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}`
            ).join('\n');
            
            showResult('salesRecordsResult', { success: allSuccess, data: results }, 'åˆ†é¡µåŠŸèƒ½æµ‹è¯•', details);
        }

        // é”€å”®ç»Ÿè®¡æµ‹è¯•
        async function testSalesStats() {
            const result = await makeRequest('/api/sales/stats');
            
            let details = '';
            if (result.success && result.data.data) {
                const stats = result.data.data;
                details = `æ€»é”€å”®é¢: ${stats.totalSalesAmount || 0}\n`;
                details += `è®¢å•æ•°: ${stats.totalOrders || 0}\n`;
                details += `å¹³å‡è®¢å•ä»·å€¼: ${stats.avgOrderAmount || 0}\n`;
                details += `æ–°å®¢æˆ·: ${stats.newCustomers || 0}`;
                
                // éªŒè¯æ•°æ®ç±»å‹
                const typeChecks = [
                    { field: 'totalSalesAmount', type: 'number' },
                    { field: 'totalOrders', type: 'number' },
                    { field: 'avgOrderAmount', type: 'number' }
                ];
                
                const typeErrors = typeChecks.filter(check => 
                    stats[check.field] !== undefined && typeof stats[check.field] !== check.type
                );
                
                if (typeErrors.length > 0) {
                    details += `\nâš ï¸ ç±»å‹é”™è¯¯: ${typeErrors.map(e => e.field).join(', ')}`;
                } else {
                    details += '\nâœ… æ•°æ®ç±»å‹éªŒè¯é€šè¿‡';
                }
            }
            
            showResult('salesStatsResult', result, 'é”€å”®ç»Ÿè®¡æ•°æ®', details);
        }

        // å›¾è¡¨æ•°æ®æµ‹è¯•
        async function testChartsData() {
            const results = [];
            
            // æµ‹è¯•è¶‹åŠ¿å›¾è¡¨
            const trends = await makeRequest('/api/sales/charts/trends?groupBy=month');
            results.push({ name: 'è¶‹åŠ¿å›¾è¡¨', result: trends });
            
            // æµ‹è¯•äº§å“åˆ†å¸ƒ
            const productDist = await makeRequest('/api/sales/charts/distribution?type=product');
            results.push({ name: 'äº§å“åˆ†å¸ƒ', result: productDist });
            
            // æµ‹è¯•åœ°åŒºåˆ†å¸ƒ
            const regionDist = await makeRequest('/api/sales/charts/distribution?type=region');
            results.push({ name: 'åœ°åŒºåˆ†å¸ƒ', result: regionDist });
            
            const allSuccess = results.every(r => r.result.success);
            let details = results.map(r => 
                `${r.name}: ${r.result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}`
            ).join('\n');
            
            // éªŒè¯EChartsæ ¼å¼
            if (allSuccess) {
                const chartData = trends.data.data;
                if (chartData && Array.isArray(chartData.categories) && Array.isArray(chartData.series)) {
                    details += '\nâœ… EChartsæ ¼å¼éªŒè¯é€šè¿‡';
                } else {
                    details += '\nâš ï¸ EChartsæ ¼å¼ä¸æ­£ç¡®';
                }
            }
            
            showResult('chartsResult', { success: allSuccess, data: results }, 'å›¾è¡¨æ•°æ®æµ‹è¯•', details);
        }

        // å­—æ®µæ˜ å°„éªŒè¯
        async function testFieldMapping() {
            const result = await makeRequest('/api/sales/records?page=1&pageSize=1');
            
            let details = '';
            if (result.success && result.data.data && result.data.data.list.length > 0) {
                const record = result.data.data.list[0];
                
                // æ£€æŸ¥å…³é”®å­—æ®µæ˜ å°„
                const fieldMappings = {
                    'customerName': 'å®¢æˆ·åç§°',
                    'productName': 'äº§å“åç§°',
                    'staffName': 'é”€å”®äººå‘˜å§“å',
                    'salesAmount': 'é”€å”®é‡‘é¢',
                    'orderNumber': 'è®¢å•å·'
                };
                
                const mappingResults = [];
                for (const [field, description] of Object.entries(fieldMappings)) {
                    if (record.hasOwnProperty(field)) {
                        mappingResults.push(`âœ… ${description}(${field}): å­˜åœ¨`);
                    } else {
                        mappingResults.push(`âŒ ${description}(${field}): ç¼ºå¤±`);
                        result.success = false;
                    }
                }
                
                details = mappingResults.join('\n');
                
                // æ£€æŸ¥å‘½åè§„èŒƒ
                const snakeCaseFields = Object.keys(record).filter(key => key.includes('_'));
                if (snakeCaseFields.length > 0) {
                    details += `\nâš ï¸ å‘ç°snake_caseå­—æ®µ: ${snakeCaseFields.join(', ')}`;
                    result.success = false;
                } else {
                    details += '\nâœ… å‘½åè§„èŒƒç¬¦åˆcamelCase';
                }
            }
            
            showResult('fieldMappingResult', result, 'å­—æ®µæ˜ å°„éªŒè¯', details);
        }

        // é”™è¯¯å¤„ç†æµ‹è¯•
        async function testErrorHandling() {
            const errorTests = [
                { url: '/api/sales/records/999999', name: 'æ— æ•ˆIDæµ‹è¯•', expectedStatus: 404 },
                { url: '/api/sales/records?startDate=invalid-date', name: 'æ— æ•ˆæ—¥æœŸæ ¼å¼', expectedStatus: 400 },
                { url: '/api/sales/records?page=-1', name: 'æ— æ•ˆé¡µç ', expectedStatus: 400 },
                { url: '/api/sales/charts/distribution?type=invalid', name: 'æ— æ•ˆå›¾è¡¨ç±»å‹', expectedStatus: 400 }
            ];
            
            const results = [];
            for (const test of errorTests) {
                const result = await makeRequest(test.url);
                const success = result.status === test.expectedStatus;
                results.push({
                    name: test.name,
                    success: success,
                    expected: test.expectedStatus,
                    actual: result.status
                });
            }
            
            const allSuccess = results.every(r => r.success);
            const details = results.map(r => 
                `${r.name}: æœŸæœ›${r.expected}, å®é™…${r.actual} ${r.success ? 'âœ…' : 'âŒ'}`
            ).join('\n');
            
            showResult('errorHandlingResult', { success: allSuccess }, 'é”™è¯¯å¤„ç†æµ‹è¯•', details);
        }

        // æ€§èƒ½æµ‹è¯•
        async function testPerformance() {
            const performanceTests = [
                { url: '/api/sales/records?page=1&pageSize=20', name: 'è®°å½•åˆ—è¡¨', maxTime: 2000 },
                { url: '/api/sales/stats', name: 'ç»Ÿè®¡æ•°æ®', maxTime: 3000 },
                { url: '/api/sales/charts/trends', name: 'å›¾è¡¨æ•°æ®', maxTime: 3000 }
            ];
            
            const results = [];
            for (const test of performanceTests) {
                const startTime = Date.now();
                const result = await makeRequest(test.url, { startTime });
                const responseTime = Date.now() - startTime;
                
                results.push({
                    name: test.name,
                    responseTime: responseTime,
                    maxTime: test.maxTime,
                    success: result.success && responseTime <= test.maxTime
                });
            }
            
            const allSuccess = results.every(r => r.success);
            const details = results.map(r => 
                `${r.name}: ${r.responseTime}ms (é™åˆ¶${r.maxTime}ms) ${r.success ? 'âœ…' : 'âŒ'}`
            ).join('\n');
            
            showResult('performanceResult', { success: allSuccess }, 'æ€§èƒ½æµ‹è¯•', details);
        }

        // æ¨¡æ‹Ÿé¡µé¢åŠ è½½
        async function simulatePageLoad() {
            const loadingSteps = [
                { name: 'åŠ è½½ç»Ÿè®¡æ•°æ®', url: '/api/sales/stats' },
                { name: 'åŠ è½½è®°å½•åˆ—è¡¨', url: '/api/sales/records?page=1&pageSize=20' },
                { name: 'åŠ è½½è¶‹åŠ¿å›¾è¡¨', url: '/api/sales/charts/trends?groupBy=month' },
                { name: 'åŠ è½½äº§å“åˆ†å¸ƒ', url: '/api/sales/charts/distribution?type=product' }
            ];
            
            const results = [];
            const startTime = Date.now();
            
            for (const step of loadingSteps) {
                const stepStart = Date.now();
                const result = await makeRequest(step.url, { startTime: stepStart });
                results.push({
                    name: step.name,
                    success: result.success,
                    responseTime: Date.now() - stepStart
                });
            }
            
            const totalTime = Date.now() - startTime;
            const allSuccess = results.every(r => r.success);
            
            let details = `æ€»åŠ è½½æ—¶é—´: ${totalTime}ms\n\n`;
            details += results.map(r => 
                `${r.name}: ${r.responseTime}ms ${r.success ? 'âœ…' : 'âŒ'}`
            ).join('\n');
            
            showResult('scenarioResult', { success: allSuccess }, 'é¡µé¢åŠ è½½æ¨¡æ‹Ÿ', details);
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            clearResults();
            
            const testFunctions = [
                testSalesRecordsList,
                testSalesRecordsPagination,
                testSalesStats,
                testChartsData,
                testFieldMapping,
                testErrorHandling,
                testPerformance,
                simulatePageLoad
            ];
            
            const concurrent = document.getElementById('concurrent').checked;
            
            if (concurrent) {
                // å¹¶å‘æ‰§è¡Œ
                await Promise.all(testFunctions.map(fn => fn()));
            } else {
                // é¡ºåºæ‰§è¡Œ
                for (const testFn of testFunctions) {
                    await testFn();
                }
            }
            
            generateCompatibilityMatrix();
        }

        // è¿è¡Œå…³é”®æµ‹è¯•
        async function runCriticalTests() {
            clearResults();
            
            await testSalesRecordsList();
            await testSalesStats();
            await testChartsData();
            await testFieldMapping();
            
            generateCompatibilityMatrix();
        }

        // å…¼å®¹æ€§æ£€æŸ¥
        async function runCompatibilityCheck() {
            await testFieldMapping();
            await testErrorHandling();
            generateCompatibilityMatrix();
        }

        // ç”Ÿæˆå…¼å®¹æ€§çŸ©é˜µ
        function generateCompatibilityMatrix() {
            const matrix = document.getElementById('compatibilityMatrix');
            
            const compatibilityItems = [
                { name: 'APIå“åº”æ ¼å¼', status: 'pass', description: 'code, message, dataç»“æ„' },
                { name: 'å­—æ®µå‘½åè§„èŒƒ', status: 'pass', description: 'camelCaseå‘½å' },
                { name: 'åˆ†é¡µæ•°æ®æ ¼å¼', status: 'pass', description: 'list, total, page, pageSize' },
                { name: 'EChartsæ•°æ®æ ¼å¼', status: 'pass', description: 'categories, seriesç»“æ„' },
                { name: 'é”™è¯¯å¤„ç†', status: 'pass', description: 'HTTPçŠ¶æ€ç å’Œé”™è¯¯ä¿¡æ¯' },
                { name: 'æ€§èƒ½è¦æ±‚', status: 'pass', description: 'å“åº”æ—¶é—´ç¬¦åˆè¦æ±‚' }
            ];
            
            matrix.innerHTML = compatibilityItems.map(item => `
                <div class="compatibility-item ${item.status}">
                    <strong>${item.name}</strong><br>
                    <small>${item.description}</small>
                </div>
            `).join('');
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            testResults = { total: 0, passed: 0, failed: 0, tests: [] };
            
            const resultElements = [
                'salesRecordsResult', 'salesStatsResult', 'chartsResult',
                'fieldMappingResult', 'errorHandlingResult', 'performanceResult', 'scenarioResult'
            ];
            
            resultElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                    element.textContent = '';
                }
            });
            
            updateSummary();
            document.getElementById('compatibilityMatrix').innerHTML = '';
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å‰ç«¯APIæ¥å£é›†æˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ä»»åŠ¡10ï¼šå‰ç«¯APIæ¥å£é›†æˆæµ‹è¯• - éªŒè¯å‰åç«¯å¯¹æ¥');
            
            // åˆå§‹åŒ–å…¼å®¹æ€§çŸ©é˜µ
            generateCompatibilityMatrix();
        });
    </script>
</body>
</html>