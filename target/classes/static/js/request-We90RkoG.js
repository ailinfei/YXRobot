var S=Object.defineProperty;var E=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var I=(r,e,t)=>e in r?S(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,l=(r,e)=>{for(var t in e||(e={}))C.call(e,t)&&I(r,t,e[t]);if(E)for(var t of E(e))D.call(e,t)&&I(r,t,e[t]);return r};var x=(r,e)=>{var t={};for(var n in r)C.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&E)for(var n of E(r))e.indexOf(n)<0&&D.call(r,n)&&(t[n]=r[n]);return t};var m=(r,e,t)=>new Promise((n,s)=>{var o=a=>{try{c(t.next(a))}catch(u){s(u)}},i=a=>{try{c(t.throw(a))}catch(u){s(u)}},c=a=>a.done?n(a.value):Promise.resolve(a.value).then(o,i);c((t=t.apply(r,e)).next())});import{a as $}from"./utils-T70AYnHr.js";import{E as M,b as j}from"./element-plus-B_LAMX2W.js";import"./vue-C2NPAEWw.js";const w=new Map,P=new Map,A=()=>{const r=$.create({baseURL:"/",timeout:1e4,headers:{"Content-Type":"application/json"}});return r.interceptors.request.use(e=>{const t=localStorage.getItem("token");t&&(e.headers=e.headers||{},e.headers.Authorization=`Bearer ${t}`);const n=R(e);return e.metadata={requestId:n},e},e=>Promise.reject(e)),r.interceptors.response.use(e=>{const{data:t}=e;if(t.code!==200&&t.code!==0){const n=new Error(t.message||"请求失败");return n.code=t.code,Promise.reject(n)}return e},e=>(L(e),Promise.reject(e))),r},F=A();function R(r){const{method:e,url:t,params:n,data:s}=r;return`${e}_${t}_${JSON.stringify(n)}_${JSON.stringify(s)}`}function L(r){const{response:e,message:t}=r;let n="请求失败";if(e){const{status:s,data:o}=e;switch(s){case 400:n="请求参数错误";break;case 401:n="未授权，请重新登录",localStorage.removeItem("token"),localStorage.removeItem("userInfo"),window.location.href="/admin/login";break;case 403:n="权限不足";break;case 404:n="请求的资源不存在";break;case 500:n="服务器内部错误";break;case 502:n="网关错误";break;case 503:n="服务不可用";break;default:n=(o==null?void 0:o.message)||`请求失败 (${s})`}}else t.includes("timeout")?n="请求超时":t.includes("Network Error")&&(n="网络连接失败");return console.error("API Error:",n,r),n}function O(r){const e=w.get(r);return e?Date.now()>e.expiry?(w.delete(r),null):e.data:null}function v(r,e,t){const n=Date.now();w.set(r,{data:e,timestamp:n,expiry:n+t})}function N(r){if(r){const e=new RegExp(r);for(const[t]of w)e.test(t)&&w.delete(t)}else w.clear()}function f(r){return m(this,null,function*(){var T;const k=r,{showLoading:e=!1,showError:t=!0,cache:n=!1,cacheTime:s=300*1e3,retry:o=0,retryDelay:i=1e3}=k,c=x(k,["showLoading","showError","cache","cacheTime","retry","retryDelay"]),a=R(c);if(n&&((T=c.method)==null?void 0:T.toLowerCase())==="get"){const d=O(a);if(d)return d}if(P.has(a))return P.get(a);let u=null;e&&(u=M.service({text:"加载中...",background:"rgba(0, 0, 0, 0.7)"}));const p=m(null,null,function*(){var q;let d;for(let y=0;y<=o;y++)try{const h=(yield F(c)).data;return n&&((q=c.method)==null?void 0:q.toLowerCase())==="get"&&v(a,h,s),h}catch(b){if(d=b,y<o){yield new Promise(h=>setTimeout(h,i*(y+1)));continue}if(t){const h=L(b);j.error(h)}throw b}throw d});P.set(a,p);try{return yield p}finally{P.delete(a),u&&u.close()}})}function _(r,e,t){return f(l({method:"GET",url:r,params:e,cache:!0},t))}function H(r,e,t){return f(l({method:"POST",url:r,data:e},t))}function J(r,e,t){return f(l({method:"PUT",url:r,data:e},t))}function U(r,e){return f(l({method:"DELETE",url:r},e))}function z(r,e,t){return f(l({method:"PATCH",url:r,data:e},t))}function B(r,e,t){const n=e instanceof FormData?e:new FormData;return e instanceof File&&n.append("file",e),f(l({method:"POST",url:r,data:n,headers:{"Content-Type":"multipart/form-data"},showLoading:!0},t))}function G(t){return m(this,arguments,function*(r,e={}){const{concurrent:n=5,failFast:s=!1}=e,o=[];for(let i=0;i<r.length;i+=n){const a=r.slice(i,i+n).map(g=>m(null,null,function*(){try{return yield f(g)}catch(p){if(s)throw p;return p}})),u=yield Promise.all(a);if(o.push(...u),s&&u.some(g=>g instanceof Error))break}return o})}function K(r,e=3,t=1e3){return((...n)=>m(null,null,function*(){let s;for(let o=0;o<=e;o++)try{return yield r(...n)}catch(i){if(s=i,o<e){yield new Promise(c=>setTimeout(c,t*(o+1)));continue}}throw s}))}function Q(r,e=300){let t=null,n=null;return((...s)=>(t&&clearTimeout(t),n||(n=new Promise((o,i)=>{t=setTimeout(()=>m(null,null,function*(){try{const c=yield r(...s);o(c)}catch(c){i(c)}finally{n=null,t=null}}),e)}),n)))}const Z={get:_,post:H,put:J,delete:U,patch:z,upload:B,batchRequest:G,clearCache:N,withRetry:K,debounceRequest:Q};export{F as axiosInstance,G as batchRequest,N as clearCache,Q as debounceRequest,Z as default,U as del,_ as get,z as patch,H as post,J as put,B as upload,K as withRetry};
