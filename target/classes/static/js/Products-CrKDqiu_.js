const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/request-gBXlrDct.js","js/utils-T70AYnHr.js","js/element-plus-B_LAMX2W.js","js/vue-C2NPAEWw.js"])))=>i.map(i=>d[i]);
var p=(o,r,b)=>new Promise((v,_)=>{var C=V=>{try{h(b.next(V))}catch(k){_(k)}},x=V=>{try{h(b.throw(V))}catch(k){_(k)}},h=V=>V.done?v(V.value):Promise.resolve(V.value).then(C,x);h((b=b.apply(o,r)).next())});import{_ as G}from"./index-CKddbhgT.js";import{b as f,q as ze,v as Ee,w as Ae,n as J,x as Ie,y as Re,c as Le,z as Oe}from"./element-plus-B_LAMX2W.js";/* empty css                                                                     *//* empty css                                                                         */import{C as ge}from"./CommonDialog-C29ZBC5-.js";import{D as je}from"./DataTable-DvK2rlgw.js";import{S as We}from"./StatusTag-CbYDBx1u.js";import{x as Ve,r as $,c as he,j as Me,h as Fe,al as B,H as A,z as y,I as s,B as Pe,y as U,K as I,D as Y,M as F,O as S,Q as l,a5 as qe,A as c,u as D,P as we,a6 as be,X as Ne}from"./vue-C2NPAEWw.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./charts-4xgvsrqt.js";/* empty css                                                                       */import{put as Q,post as X,del as ye,get as te}from"./request-gBXlrDct.js";/* empty css                                                                  *//* empty css                                                                  */import"./utils-T70AYnHr.js";const He=Ve({__name:"FormValidator",props:{modelValue:{default:()=>({})},rules:{default:()=>({})},labelWidth:{default:"120px"},labelPosition:{default:"right"},inline:{type:Boolean,default:!1},size:{default:"default"},disabled:{type:Boolean,default:!1},validateOnRuleChange:{type:Boolean,default:!0},hideRequiredAsterisk:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!0},inlineMessage:{type:Boolean,default:!1},statusIcon:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},showSubmit:{type:Boolean,default:!0},showReset:{type:Boolean,default:!0},submitText:{default:"提交"},resetText:{default:"重置"},loading:{type:Boolean,default:!1},formClass:{default:""},actionsClass:{default:""},autoValidate:{type:Boolean,default:!1},validateOnMount:{type:Boolean,default:!1}},emits:["update:modelValue","submit","reset","validate","field-change"],setup(o,{expose:r,emit:b}){const v=o,_=b,C=$(),x=he({get:()=>v.modelValue,set:n=>_("update:modelValue",n)}),h=he(()=>v.rules),V=()=>p(null,null,function*(){if(!C.value)return!1;try{return yield C.value.validate(),!0}catch(n){return console.warn("表单验证失败:",n),!1}}),k=n=>p(null,null,function*(){if(!C.value)return!1;try{return yield C.value.validateField(n),!0}catch(d){return console.warn(`字段 ${n} 验证失败:`,d),!1}}),j=()=>{C.value&&C.value.resetFields(),_("reset")},N=n=>{C.value&&C.value.clearValidate(n)},R=n=>{C.value&&C.value.scrollToField(n)},L=()=>p(null,null,function*(){(yield V())?_("submit",x.value):f.warning("请检查表单填写是否正确")}),H=(n,d,z)=>{_("validate",{prop:n,isValid:d,message:z})};return Me(()=>v.modelValue,(n,d)=>{d&&Object.keys(n).forEach(z=>{n[z]!==d[z]&&(_("field-change",{field:z,value:n[z],oldValue:d[z]}),v.autoValidate&&k(z))})},{deep:!0}),Fe(()=>{v.validateOnMount&&V()}),r({validate:V,validateField:k,resetFields:j,clearValidate:N,scrollToField:R,getFormRef:()=>C.value}),(n,d)=>{const z=B("el-button"),O=B("el-form");return y(),A(O,{ref_key:"formRef",ref:C,model:x.value,rules:h.value,"label-width":n.labelWidth,"label-position":n.labelPosition,inline:n.inline,size:n.size,disabled:n.disabled,"validate-on-rule-change":n.validateOnRuleChange,"hide-required-asterisk":n.hideRequiredAsterisk,"show-message":n.showMessage,"inline-message":n.inlineMessage,"status-icon":n.statusIcon,onValidate:H,class:Y(["form-validator",n.formClass])},{default:s(()=>[Pe(n.$slots,"default",{form:x.value,rules:h.value},void 0,!0),n.showActions?(y(),U("div",{key:0,class:Y(["form-actions",n.actionsClass])},[Pe(n.$slots,"actions",{form:x.value,validate:V,reset:j},()=>[n.showReset?(y(),A(z,{key:0,size:n.size,onClick:j,disabled:n.disabled||n.loading},{default:s(()=>[F(S(n.resetText),1)]),_:1},8,["size","disabled"])):I("",!0),n.showSubmit?(y(),A(z,{key:1,type:"primary",size:n.size,loading:n.loading,onClick:L,disabled:n.disabled},{default:s(()=>[F(S(n.submitText),1)]),_:1},8,["size","loading","disabled"])):I("",!0)],!0)],2)):I("",!0)]),_:3},8,["model","rules","label-width","label-position","inline","size","disabled","validate-on-rule-change","hide-required-asterisk","show-message","inline-message","status-icon","class"])}}}),Ke=Ce(He,[["__scopeId","data-v-956005f3"]]),Ge={class:"file-upload"},Qe={key:0,class:"upload-card-trigger"},Xe={class:"upload-text"},Je={key:1,class:"upload-drag-area"},Ye={class:"upload-text"},Ze={class:"upload-hint"},ea={class:"upload-tip"},aa={class:"tip-content"},ta={key:0},la={key:1},oa={key:2},sa={key:0,class:"custom-file-list"},ia={class:"file-list-header"},ra={class:"file-list-content"},na={class:"file-icon"},da={class:"file-info"},ua=["title"],ca={class:"file-meta"},pa={class:"file-size"},ma={class:"file-actions"},va={class:"preview-container"},fa=Ve({__name:"FileUpload",props:{modelValue:{default:()=>[]},action:{default:"/api/v1/upload/temp"},headers:{default:()=>({})},data:{default:()=>({})},name:{default:"file"},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},accept:{default:""},limit:{default:0},maxSize:{default:10},autoUpload:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},showCustomList:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0},listType:{default:"text"},buttonType:{default:"primary"},uploadText:{default:"选择文件"},uploadHint:{default:"将文件拖到此处，或点击上传"}},emits:["update:modelValue","success","error","progress","remove","exceed","preview"],setup(o,{expose:r,emit:b}){const v=o,_=b,C=$(),x=$(!1),h=$([...v.modelValue]),V=$(!1),k=$(""),j=he(()=>({"upload-disabled":v.disabled,"upload-drag":v.drag,"upload-picture-card":v.listType==="picture-card"})),N=a=>{var g;return["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(((g=a.raw)==null?void 0:g.type)||"")||/\.(jpg|jpeg|png|gif|webp)$/i.test(a.name||"")},R=a=>{var g;return["video/mp4","video/avi","video/mov","video/wmv"].includes(((g=a.raw)==null?void 0:g.type)||"")||/\.(mp4|avi|mov|wmv)$/i.test(a.name||"")},L=a=>{var g;return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(((g=a.raw)==null?void 0:g.type)||"")||/\.(pdf|doc|docx)$/i.test(a.name||"")},H=a=>a.split(",").map(u=>u.trim()).join(", "),n=a=>`${a}MB`,d=a=>{if(!a)return"0B";const u=["B","KB","MB","GB"];let g=0,M=a;for(;M>=1024&&g<u.length-1;)M/=1024,g++;return`${M.toFixed(1)}${u[g]}`},z=a=>({ready:"准备上传",uploading:"上传中",success:"上传成功",fail:"上传失败"})[a||""]||"未知状态",O=a=>v.maxSize&&a.size/1024/1024>v.maxSize?(f.error(`文件大小不能超过 ${v.maxSize}MB`),!1):v.accept&&!v.accept.split(",").map(M=>M.trim()).some(M=>M.startsWith(".")?a.name.toLowerCase().endsWith(M.toLowerCase()):a.type.includes(M.replace("*","")))?(f.error(`文件格式不支持，请选择 ${H(v.accept)} 格式的文件`),!1):(x.value=!0,!0),le=(a,u)=>{_("progress",a,u)},oe=(a,u,g)=>{x.value=!1,h.value=[...g],_("update:modelValue",h.value),_("success",a,u,g),f.success("文件上传成功")},se=(a,u,g)=>{x.value=!1,_("error",a,u,g),f.error("文件上传失败")},W=a=>p(null,null,function*(){try{yield J.confirm("确定要删除这个文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const u=h.value.findIndex(g=>g.uid===a.uid);u>-1&&(h.value.splice(u,1),_("update:modelValue",h.value),_("remove",a))}catch(u){}}),ie=(a,u)=>{f.warning(`最多只能上传 ${v.limit} 个文件`),_("exceed",a,u)},Z=a=>{N(a)&&a.url?(k.value=a.url,V.value=!0):a.url&&window.open(a.url,"_blank"),_("preview",a)},re=a=>{if(a.url){const u=document.createElement("a");u.href=a.url,u.download=a.name||"download",u.click()}},ne=()=>p(null,null,function*(){var a;try{yield J.confirm("确定要清空所有文件吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),h.value=[],_("update:modelValue",h.value),(a=C.value)==null||a.clearFiles()}catch(u){}}),de=()=>{V.value=!1,k.value=""};return Me(()=>v.modelValue,a=>{h.value=[...a]},{deep:!0}),r({clearFiles:()=>{var a;return(a=C.value)==null?void 0:a.clearFiles()},abort:()=>{var a;return(a=C.value)==null?void 0:a.abort()},submit:()=>{var a;return(a=C.value)==null?void 0:a.submit()}}),(a,u)=>{const g=B("el-icon"),M=B("el-button"),ue=B("el-upload"),ce=B("el-progress"),pe=B("el-image"),me=B("el-dialog");return y(),U("div",Ge,[l(ue,{ref_key:"uploadRef",ref:C,class:Y(j.value),action:a.action,headers:a.headers,data:a.data,name:a.name,multiple:a.multiple,drag:a.drag,accept:a.accept,"file-list":h.value,"auto-upload":a.autoUpload,disabled:a.disabled,limit:a.limit,"show-file-list":a.showFileList,"list-type":a.listType,"before-upload":O,"on-progress":le,"on-success":oe,"on-error":se,"on-remove":W,"on-exceed":ie,"on-preview":Z},qe({default:s(()=>[a.listType==="picture-card"?(y(),U("div",Qe,[l(g,null,{default:s(()=>[l(D(ze))]),_:1}),c("div",Xe,S(a.uploadText),1)])):a.drag?(y(),U("div",Je,[l(g,{class:"upload-icon"},{default:s(()=>[l(D(Ee))]),_:1}),c("div",Ye,S(a.uploadText),1),c("div",Ze,S(a.uploadHint),1)])):(y(),A(M,{key:2,type:a.buttonType,icon:D(Ae),loading:x.value},{default:s(()=>[F(S(a.uploadText),1)]),_:1},8,["type","icon","loading"]))]),_:2},[a.showTip?{name:"tip",fn:s(()=>[c("div",ea,[c("div",aa,[a.accept?(y(),U("span",ta,"支持格式: "+S(H(a.accept)),1)):I("",!0),a.maxSize?(y(),U("span",la,"单个文件不超过 "+S(n(a.maxSize)),1)):I("",!0),a.limit?(y(),U("span",oa,"最多上传 "+S(a.limit)+" 个文件",1)):I("",!0)])])]),key:"0"}:void 0]),1032,["class","action","headers","data","name","multiple","drag","accept","file-list","auto-upload","disabled","limit","show-file-list","list-type"]),a.showCustomList&&h.value.length>0?(y(),U("div",sa,[c("div",ia,[c("span",null,"已上传文件 ("+S(h.value.length)+")",1),a.multiple?(y(),A(M,{key:0,type:"danger",size:"small",text:"",onClick:ne},{default:s(()=>u[1]||(u[1]=[F(" 清空全部 ",-1)])),_:1,__:[1]})):I("",!0)]),c("div",ra,[(y(!0),U(we,null,be(h.value,(T,ve)=>(y(),U("div",{key:T.uid||ve,class:Y(["file-item",{"is-uploading":T.status==="uploading"}])},[c("div",na,[N(T)?(y(),A(g,{key:0},{default:s(()=>[l(D(Ie))]),_:1})):R(T)?(y(),A(g,{key:1},{default:s(()=>[l(D(Re))]),_:1})):L(T)?(y(),A(g,{key:2},{default:s(()=>[l(D(Le))]),_:1})):(y(),A(g,{key:3},{default:s(()=>[l(D(Oe))]),_:1}))]),c("div",da,[c("div",{class:"file-name",title:T.name},S(T.name),9,ua),c("div",ca,[c("span",pa,S(d(T.size)),1),c("span",{class:Y(["file-status",T.status])},S(z(T.status)),3)]),T.status==="uploading"?(y(),A(ce,{key:0,percentage:T.percentage||0,"stroke-width":2,"show-text":!1},null,8,["percentage"])):I("",!0)]),c("div",ma,[T.status==="success"?(y(),A(M,{key:0,type:"primary",size:"small",text:"",onClick:ee=>Z(T)},{default:s(()=>u[2]||(u[2]=[F(" 预览 ",-1)])),_:2,__:[2]},1032,["onClick"])):I("",!0),T.url?(y(),A(M,{key:1,type:"primary",size:"small",text:"",onClick:ee=>re(T)},{default:s(()=>u[3]||(u[3]=[F(" 下载 ",-1)])),_:2,__:[3]},1032,["onClick"])):I("",!0),l(M,{type:"danger",size:"small",text:"",onClick:ee=>W(T)},{default:s(()=>u[4]||(u[4]=[F(" 删除 ",-1)])),_:2,__:[4]},1032,["onClick"])])],2))),128))])])):I("",!0),l(me,{modelValue:V.value,"onUpdate:modelValue":u[0]||(u[0]=T=>V.value=T),title:"图片预览",width:"60%","before-close":de},{default:s(()=>[c("div",va,[l(pe,{src:k.value,fit:"contain",class:"preview-image","preview-src-list":[k.value]},null,8,["src","preview-src-list"])])]),_:1},8,["modelValue"])])}}}),Be=Ce(fa,[["__scopeId","data-v-65019d6d"]]),q={getProducts(o){return p(this,null,function*(){console.log("🔗 API调用: /api/admin/products",o);const r=yield te("/api/admin/products",o);return console.log("🔗 API响应:",r),r})},getProduct(o){return p(this,null,function*(){return te(`/api/admin/products/${o}`)})},createProduct(o){return p(this,null,function*(){return X("/api/admin/products",o,{headers:{"Content-Type":"application/json"}})})},createProductWithFiles(o){return p(this,null,function*(){const r=new FormData;return r.append("name",o.name),r.append("model",o.model),r.append("price",o.price.toString()),r.append("status",o.status),o.description!==void 0&&r.append("description",o.description),o.cover_files&&o.cover_files.length>0&&o.cover_files.forEach(b=>{r.append("coverFiles",b)}),X("/api/admin/products",r,{headers:{"Content-Type":"multipart/form-data"}})})},updateProduct(o,r){return p(this,null,function*(){return Q(`/api/admin/products/${o}`,r,{headers:{"Content-Type":"application/json"}})})},updateProductWithFiles(o,r,b=!0){return p(this,null,function*(){const v=new FormData;return r.name!==void 0&&v.append("name",r.name),r.model!==void 0&&v.append("model",r.model),r.price!==void 0&&v.append("price",r.price.toString()),r.status!==void 0&&v.append("status",r.status),v.append("keepExistingCover",b.toString()),r.description!==void 0&&v.append("description",r.description),r.cover_files&&r.cover_files.length>0&&r.cover_files.forEach(_=>{v.append("coverFiles",_)}),Q(`/api/admin/products/${o}`,v,{headers:{"Content-Type":"multipart/form-data"}})})},deleteProduct(o){return p(this,null,function*(){return ye(`/api/admin/products/${o}`)})},uploadProductImage(o,r){return p(this,null,function*(){const b=new FormData;return b.append("file",r),b.append("productId",o),X("/api/admin/products/upload-image",b,{headers:{"Content-Type":"multipart/form-data"}})})},updateImageOrder(o,r){return p(this,null,function*(){return Q(`/api/admin/products/${o}/image-order`,{imageOrders:r})})},setMainImage(o,r){return p(this,null,function*(){return Q(`/api/admin/products/${o}/main-image`,{imageId:r})})},deleteProductImage(o,r){return p(this,null,function*(){return ye(`/api/admin/products/${o}/images/${r}`)})},publishProduct(o){return p(this,null,function*(){return X(`/api/admin/products/${o}/publish`)})},previewProduct(o){return p(this,null,function*(){return te(`/api/admin/products/${o}/preview`)})},getProductMedia(o){return p(this,null,function*(){return te(`/api/admin/products/${o}/media`)})},uploadProductMedia(o,r,b,v){return p(this,null,function*(){const _=new FormData;return _.append("mediaType",r),_.append("sortOrder",b.toString()),_.append("mediaFile",v),X(`/api/admin/products/${o}/media`,_,{headers:{"Content-Type":"multipart/form-data"}})})},updateProductMedia(o,r){return p(this,null,function*(){return Q(`/api/admin/products/media/${o}`,{sortOrder:r})})},deleteProductMedia(o){return p(this,null,function*(){return ye(`/api/admin/products/media/${o}`)})},createProductWithUrls(o){return p(this,null,function*(){return X("/api/admin/products/with-urls",o,{headers:{"Content-Type":"application/json"}})})},updateProductWithUrls(o,r){return p(this,null,function*(){return Q(`/api/admin/products/${o}/with-urls`,r,{headers:{"Content-Type":"application/json"}})})}},_a={class:"products-management"},ga={class:"page-header"},ya={class:"header-right"},ha={key:1,class:"no-image"},wa={class:"price-text"},ba={class:"media-management"},Va={class:"media-tabs"},Ca={class:"media-section"},$a={class:"section-header"},Ta={class:"media-grid"},ka={class:"media-actions"},Pa={class:"media-sort"},Ba={class:"media-section"},za={class:"section-header"},Ma={class:"media-grid"},Fa=["src"],Sa={class:"media-actions"},Ua={class:"media-sort"},Da={class:"media-upload-form"},xa=Ve({__name:"Products",setup(o){const r=$(!1),b=$(!1),v=$(!1),_=$(!1),C=$(!1),x=$(!1),h=$("add"),V=$(null),k=$("image"),j=$("images"),N=$(),R=$([]),L=$({page:1,size:20,total:0}),H=$([{id:1,product_id:1,media_type:"image",media_url:"https://via.placeholder.com/300x200",sort_order:1},{id:2,product_id:1,media_type:"image",media_url:"https://via.placeholder.com/300x200",sort_order:2}]),n=$([{id:3,product_id:1,media_type:"video",media_url:"https://www.w3schools.com/html/mov_bbb.mp4",sort_order:1}]),d=$({name:"",model:"",description:"",price:0,status:"draft",cover_files:[]}),z=Ne({sort_order:1}),O=$([]),le={name:[{required:!0,message:"请输入产品名称",trigger:"blur"}],model:[{required:!0,message:"请输入产品型号",trigger:"blur"}],price:[{required:!0,message:"请输入产品价格",trigger:"blur"}],status:[{required:!0,message:"请选择产品状态",trigger:"change"}]},oe=[{prop:"id",label:"ID",width:80},{prop:"cover_image_url",label:"封面图片",width:100},{prop:"name",label:"产品名称",minWidth:150},{prop:"model",label:"产品型号",width:120},{prop:"price",label:"价格",width:100},{prop:"status",label:"状态",width:100},{prop:"createdAt",label:"创建时间",width:160,type:"date"},{prop:"updatedAt",label:"更新时间",width:160,type:"date"}],se=t=>t.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),W=()=>p(null,null,function*(){console.log("🚀 开始加载产品列表..."),r.value=!0;try{console.log("📡 调用API:",{page:L.value.page,size:L.value.size});const t=yield q.getProducts({page:L.value.page,size:L.value.size});console.log("📥 API响应:",t),t.code===200?(R.value=t.data.list||[],L.value.total=t.data.total||0,console.log("✅ 产品列表加载成功:",{count:R.value.length,total:L.value.total,firstProduct:R.value[0],timeFields:R.value.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,created_at:e.created_at,updated_at:e.updated_at}))})):(console.error("❌ API返回错误:",t),f.error(t.message||"获取产品列表失败"))}catch(t){console.error("💥 获取产品列表失败:",t),f.error("获取产品列表失败，请稍后重试"),R.value=[]}finally{r.value=!1}}),ie=()=>{h.value="add",T(),b.value=!0},Z=t=>{h.value="edit",V.value=t,Object.assign(d.value,{name:t.name,model:t.model,description:t.description,price:t.price,status:t.status,cover_files:[]}),b.value=!0},re=t=>p(null,null,function*(){try{yield J.confirm("确定要删除这个产品吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),console.log("🗑️ 开始删除产品:",t.id,t.name);const e=yield q.deleteProduct(t.id.toString());if(console.log("🗑️ 删除API响应:",e),e.code===200){f.success("产品删除成功"),console.log("🔄 删除成功，清除缓存并重新加载产品列表...");const{clearCache:m}=yield G(()=>p(null,null,function*(){const{clearCache:P}=yield import("./request-gBXlrDct.js");return{clearCache:P}}),__vite__mapDeps([0,1,2,3]));m("/admin/products"),W()}else f.error(e.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除产品失败:",e),f.error("删除产品失败，请稍后重试"))}}),ne=t=>p(null,null,function*(){try{yield J.confirm(`确定要删除选中的 ${t.length} 个产品吗？`,"批量删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),f.success("产品批量删除成功");const{clearCache:e}=yield G(()=>p(null,null,function*(){const{clearCache:m}=yield import("./request-gBXlrDct.js");return{clearCache:m}}),__vite__mapDeps([0,1,2,3]));e("/admin/products"),W()}catch(e){}}),de=t=>{V.value=t,v.value=!0,a(t.id)},a=t=>p(null,null,function*(){console.log("加载产品媒体:",t);try{const e=yield q.getProductMedia(t.toString());if(e.code===200){const m=e.data.filter(w=>w.media_type==="image"),P=e.data.filter(w=>w.media_type==="video");H.value=m,n.value=P,console.log("成功加载产品媒体 - 图片:",m.length,"视频:",P.length)}else f.error(e.message||"获取产品媒体失败")}catch(e){console.error("获取产品媒体失败:",e),f.error("获取产品媒体失败，请稍后重试")}}),u=t=>{k.value=t,z.sort_order=1,O.value=[],_.value=!0},g=t=>p(null,null,function*(){var e;try{const{value:m}=yield J.prompt("请输入新的排序值","编辑媒体",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:t.sort_order.toString(),inputPattern:/^\d+$/,inputErrorMessage:"请输入有效的数字"}),P=parseInt(m),w=yield q.updateProductMedia(t.id.toString(),P);if(w.code===200){f.success("媒体信息更新成功");const{clearCache:E}=yield G(()=>p(null,null,function*(){const{clearCache:K}=yield import("./request-gBXlrDct.js");return{clearCache:K}}),__vite__mapDeps([0,1,2,3]));E("/admin/products"),a((e=V.value)==null?void 0:e.id)}else f.error(w.message||"更新失败")}catch(m){m!=="cancel"&&(console.error("更新媒体信息失败:",m),f.error("更新媒体信息失败，请稍后重试"))}}),M=t=>p(null,null,function*(){var e;try{yield J.confirm("确定要删除这个媒体文件吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const m=yield q.deleteProductMedia(t.id.toString());if(m.code===200){f.success("媒体文件删除成功");const{clearCache:P}=yield G(()=>p(null,null,function*(){const{clearCache:w}=yield import("./request-gBXlrDct.js");return{clearCache:w}}),__vite__mapDeps([0,1,2,3]));P("/admin/products"),a((e=V.value)==null?void 0:e.id)}else f.error(m.message||"删除失败")}catch(m){m!=="cancel"&&(console.error("删除媒体文件失败:",m),f.error("删除媒体文件失败，请稍后重试"))}}),ue=()=>p(null,null,function*(){var e;if(yield(e=N.value)==null?void 0:e.validate()){C.value=!0;try{let m,P=null;if(d.value.cover_files&&d.value.cover_files.length>0){const w=d.value.cover_files[0];w.response&&w.response.code===200?P=w.response.data.url:w.url&&(P=w.url)}if(h.value==="add"){const w={name:d.value.name,model:d.value.model,description:d.value.description,price:d.value.price,status:d.value.status,cover_image_url:P};m=yield q.createProductWithUrls(w)}else{const w={name:d.value.name,model:d.value.model,description:d.value.description,price:d.value.price,status:d.value.status,cover_image_url:P};m=yield q.updateProductWithUrls(V.value.id.toString(),w)}if(m.code===200){f.success(`产品${h.value==="add"?"创建":"更新"}成功`),b.value=!1;const{clearCache:w}=yield G(()=>p(null,null,function*(){const{clearCache:E}=yield import("./request-gBXlrDct.js");return{clearCache:E}}),__vite__mapDeps([0,1,2,3]));w("/admin/products"),W()}else f.error(m.message||`${h.value==="add"?"创建":"更新"}失败`)}catch(m){console.error("保存产品失败:",m),f.error(`产品${h.value==="add"?"创建":"更新"}失败，请稍后重试`)}finally{C.value=!1}}}),ce=()=>{b.value=!1,T()},pe=()=>p(null,null,function*(){var t;if(O.value.length===0){f.warning("请选择要上传的文件");return}x.value=!0;try{const e=O.value[0];let m=null;if(e.response&&e.response.code===200)m=e.response.data.url;else if(e.url)m=e.url;else{f.error("文件上传未完成，请等待上传完成后再保存");return}const P=yield q.uploadProductMedia(V.value.id.toString(),k.value,z.sort_order,e.raw);if(P.code===200){f.success("媒体文件保存成功"),_.value=!1;const{clearCache:w}=yield G(()=>p(null,null,function*(){const{clearCache:E}=yield import("./request-gBXlrDct.js");return{clearCache:E}}),__vite__mapDeps([0,1,2,3]));w("/admin/products"),a((t=V.value)==null?void 0:t.id)}else f.error(P.message||"保存失败")}catch(e){console.error("保存媒体文件失败:",e),f.error("保存媒体文件失败，请稍后重试")}finally{x.value=!1}}),me=()=>{_.value=!1,O.value=[]},T=()=>{Object.assign(d.value,{name:"",model:"",description:"",price:0,status:"draft",cover_files:[]})},ve=(t,e)=>{console.log("封面上传成功:",t),t.code===200?(f.success("封面上传成功"),e.url=t.data.url,e.response=t):f.error(t.message||"封面上传失败")},ee=(t,e)=>{console.error("封面上传失败:",t),f.error("封面上传失败，请稍后重试")},Se=(t,e)=>{console.log("媒体上传成功:",t),t.code===200?(f.success("媒体文件上传成功"),e.url=t.data.url,e.response=t):f.error(t.message||"媒体上传失败")},Ue=(t,e)=>{console.error("媒体上传失败:",t),f.error("媒体文件上传失败，请稍后重试")};return Fe(()=>{W()}),(t,e)=>{const m=B("el-button"),P=B("el-image"),w=B("el-input"),E=B("el-form-item"),K=B("el-col"),$e=B("el-row"),Te=B("el-input-number"),fe=B("el-option"),De=B("el-select"),ke=B("el-tab-pane"),xe=B("el-tabs");return y(),U("div",_a,[c("div",ga,[e[16]||(e[16]=c("div",{class:"header-left"},[c("h2",null,"产品管理"),c("p",{class:"header-subtitle"},"222管理官网展示的产品信息、媒体文件和状态")],-1)),c("div",ya,[l(m,{type:"primary",icon:D(ze),onClick:ie},{default:s(()=>e[15]||(e[15]=[F(" 新增产品 ",-1)])),_:1,__:[15]},8,["icon"])])]),l(D(je),{data:R.value,columns:oe,loading:r.value,"show-selection":"","show-edit":!1,"show-delete":!1,onBatchDelete:ne,onRefresh:W},{cover_image_url:s(({row:i})=>[i.cover_image_url?(y(),A(P,{key:0,src:i.cover_image_url,"preview-src-list":[i.cover_image_url],fit:"cover",class:"product-cover"},null,8,["src","preview-src-list"])):(y(),U("span",ha,"暂无图片"))]),status:s(({row:i})=>[l(D(We),{status:i.status},null,8,["status"])]),price:s(({row:i})=>[c("span",wa,"¥"+S(se(i.price)),1)]),actions:s(({row:i})=>[l(m,{type:"primary",size:"small",text:"",onClick:ae=>Z(i)},{default:s(()=>e[17]||(e[17]=[F(" 编辑 ",-1)])),_:2,__:[17]},1032,["onClick"]),l(m,{type:"info",size:"small",text:"",onClick:ae=>de(i)},{default:s(()=>e[18]||(e[18]=[F(" 媒体管理 ",-1)])),_:2,__:[18]},1032,["onClick"]),l(m,{type:"danger",size:"small",text:"",onClick:ae=>re(i)},{default:s(()=>e[19]||(e[19]=[F(" 删除 ",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1},8,["data","loading"]),l(D(ge),{modelValue:b.value,"onUpdate:modelValue":e[7]||(e[7]=i=>b.value=i),title:h.value==="add"?"新增产品":"编辑产品",width:"800px",onConfirm:ue,onCancel:ce,"confirm-loading":C.value},{default:s(()=>[l(D(Ke),{ref_key:"productFormRef",ref:N,modelValue:d.value,"onUpdate:modelValue":e[6]||(e[6]=i=>d.value=i),rules:le,"label-width":"100px","show-actions":!1},{default:s(()=>[l($e,{gutter:20},{default:s(()=>[l(K,{span:12},{default:s(()=>[l(E,{label:"产品名称",prop:"name"},{default:s(()=>[l(w,{modelValue:d.value.name,"onUpdate:modelValue":e[0]||(e[0]=i=>d.value.name=i),placeholder:"请输入产品名称"},null,8,["modelValue"])]),_:1})]),_:1}),l(K,{span:12},{default:s(()=>[l(E,{label:"产品型号",prop:"model"},{default:s(()=>[l(w,{modelValue:d.value.model,"onUpdate:modelValue":e[1]||(e[1]=i=>d.value.model=i),placeholder:"请输入产品型号"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l($e,{gutter:20},{default:s(()=>[l(K,{span:12},{default:s(()=>[l(E,{label:"产品价格",prop:"price"},{default:s(()=>[l(Te,{modelValue:d.value.price,"onUpdate:modelValue":e[2]||(e[2]=i=>d.value.price=i),min:0,precision:2,placeholder:"请输入产品价格",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(K,{span:12},{default:s(()=>[l(E,{label:"产品状态",prop:"status"},{default:s(()=>[l(De,{modelValue:d.value.status,"onUpdate:modelValue":e[3]||(e[3]=i=>d.value.status=i),placeholder:"请选择产品状态"},{default:s(()=>[l(fe,{label:"草稿",value:"draft"}),l(fe,{label:"已发布",value:"published"}),l(fe,{label:"已归档",value:"archived"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(E,{label:"产品描述",prop:"description"},{default:s(()=>[l(w,{modelValue:d.value.description,"onUpdate:modelValue":e[4]||(e[4]=i=>d.value.description=i),type:"textarea",rows:4,placeholder:"请输入产品描述"},null,8,["modelValue"])]),_:1}),l(E,{label:"产品封面"},{default:s(()=>[l(D(Be),{modelValue:d.value.cover_files,"onUpdate:modelValue":e[5]||(e[5]=i=>d.value.cover_files=i),limit:1,accept:"image/*","list-type":"picture-card","max-size":5,"upload-text":"上传封面",action:"/api/v1/upload/product/cover","auto-upload":!0,onSuccess:ve,onError:ee},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title","confirm-loading"]),l(D(ge),{modelValue:v.value,"onUpdate:modelValue":e[11]||(e[11]=i=>v.value=i),title:"产品媒体管理",width:"1000px","show-footer":!1},{default:s(()=>[c("div",ba,[c("div",Va,[l(xe,{modelValue:j.value,"onUpdate:modelValue":e[10]||(e[10]=i=>j.value=i)},{default:s(()=>[l(ke,{label:"产品图片",name:"images"},{default:s(()=>[c("div",Ca,[c("div",$a,[e[21]||(e[21]=c("h4",null,"产品图片",-1)),l(m,{type:"primary",size:"small",onClick:e[8]||(e[8]=i=>u("image"))},{default:s(()=>e[20]||(e[20]=[F(" 添加图片 ",-1)])),_:1,__:[20]})]),c("div",Ta,[(y(!0),U(we,null,be(H.value,(i,ae)=>(y(),U("div",{key:i.id,class:"media-item"},[l(P,{src:i.media_url,fit:"cover",class:"media-preview","preview-src-list":[i.media_url]},null,8,["src","preview-src-list"]),c("div",ka,[l(m,{size:"small",type:"primary",text:"",onClick:_e=>g(i)},{default:s(()=>e[22]||(e[22]=[F(" 编辑 ",-1)])),_:2,__:[22]},1032,["onClick"]),l(m,{size:"small",type:"danger",text:"",onClick:_e=>M(i)},{default:s(()=>e[23]||(e[23]=[F(" 删除 ",-1)])),_:2,__:[23]},1032,["onClick"])]),c("div",Pa,[c("span",null,"排序: "+S(i.sort_order),1)])]))),128))])])]),_:1}),l(ke,{label:"产品视频",name:"videos"},{default:s(()=>[c("div",Ba,[c("div",za,[e[25]||(e[25]=c("h4",null,"产品视频",-1)),l(m,{type:"primary",size:"small",onClick:e[9]||(e[9]=i=>u("video"))},{default:s(()=>e[24]||(e[24]=[F(" 添加视频 ",-1)])),_:1,__:[24]})]),c("div",Ma,[(y(!0),U(we,null,be(n.value,(i,ae)=>(y(),U("div",{key:i.id,class:"media-item video-item"},[c("video",{src:i.media_url,controls:"",class:"media-preview"},null,8,Fa),c("div",Sa,[l(m,{size:"small",type:"primary",text:"",onClick:_e=>g(i)},{default:s(()=>e[26]||(e[26]=[F(" 编辑 ",-1)])),_:2,__:[26]},1032,["onClick"]),l(m,{size:"small",type:"danger",text:"",onClick:_e=>M(i)},{default:s(()=>e[27]||(e[27]=[F(" 删除 ",-1)])),_:2,__:[27]},1032,["onClick"])]),c("div",Ua,[c("span",null,"排序: "+S(i.sort_order),1)])]))),128))])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"]),l(D(ge),{modelValue:_.value,"onUpdate:modelValue":e[14]||(e[14]=i=>_.value=i),title:`上传${k.value==="image"?"图片":"视频"}`,width:"600px",onConfirm:pe,onCancel:me,"confirm-loading":x.value},{default:s(()=>[c("div",Da,[l(E,{label:"媒体文件"},{default:s(()=>[l(D(Be),{modelValue:O.value,"onUpdate:modelValue":e[12]||(e[12]=i=>O.value=i),limit:1,accept:k.value==="image"?"image/*":"video/*","list-type":k.value==="image"?"picture-card":"text","max-size":k.value==="image"?10:100,"upload-text":`选择${k.value==="image"?"图片":"视频"}`,action:"/api/v1/upload/product/media",data:{mediaType:k.value},"auto-upload":!0,onSuccess:Se,onError:Ue},null,8,["modelValue","accept","list-type","max-size","upload-text","data"])]),_:1}),l(E,{label:"排序"},{default:s(()=>[l(Te,{modelValue:z.sort_order,"onUpdate:modelValue":e[13]||(e[13]=i=>z.sort_order=i),min:0,placeholder:"请输入排序值",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),_:1},8,["modelValue","title","confirm-loading"])])}}}),Ya=Ce(xa,[["__scopeId","data-v-05e82768"]]);export{Ya as default};
