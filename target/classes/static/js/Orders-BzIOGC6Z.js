var q=(I,x,_)=>new Promise((h,D)=>{var T=u=>{try{b(_.next(u))}catch(f){D(f)}},L=u=>{try{b(_.throw(u))}catch(f){D(f)}},b=u=>u.done?h(u.value):Promise.resolve(u.value).then(T,L);b((_=_.apply(I,x)).next())});import{x as ge,r as d,c as ye,h as he,al as i,ar as be,y as k,z as p,A as l,Q as t,I as s,M as r,u as E,O as o,a4 as we,J as Se,H as C,K as O,P as ke,a6 as Ce}from"./vue-C2NPAEWw.js";import{q as Oe,s as Ve,A as xe,F as De,a8 as Te,b as y,n as j}from"./element-plus-B_LAMX2W.js";import{a as V}from"./order-DgpU5ivT.js";import{O as ze,a as Ae,b as Ee,P as Ue}from"./OrderDetailDialog-GG31NPc3.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ne={class:"orders-page"},Pe={class:"page-header"},Re={class:"header-right"},Fe={class:"stats-cards"},Le={class:"stat-card"},Me={class:"stat-icon total"},Ke={class:"stat-content"},qe={class:"stat-value"},Ie={class:"stat-card"},Xe={class:"stat-icon revenue"},$e={class:"stat-content"},je={class:"stat-value"},He={class:"stat-card"},Je={class:"stat-icon processing"},Qe={class:"stat-content"},Ye={class:"stat-value"},Ge={class:"stat-card"},We={class:"stat-icon completed"},Ze={class:"stat-content"},et={class:"stat-value"},tt={class:"search-section"},at={class:"table-section"},lt={class:"customer-info"},st={class:"customer-name"},nt={class:"customer-contact"},ot={class:"order-items"},dt={class:"item-name"},rt={class:"item-quantity"},it={key:0,class:"more-items"},ut={class:"amount-display"},ct={class:"amount"},pt={class:"currency"},_t={key:0,class:"rental-info"},mt={class:"rental-period"},vt={class:"rental-dates"},ft={key:1,class:"not-applicable"},gt={class:"pagination-wrapper"},yt=ge({__name:"Orders",setup(I){d(!1);const x=d(!1);d(!1);const _=d(1),h=d(10),D=d(0),T=d([]),L=d([]),b=d(null),u=d({total:0,pending:0,processing:0,completed:0,cancelled:0,totalRevenue:0,averageOrderValue:0,salesOrders:0,rentalOrders:0}),f=d(""),U=d(""),B=d(""),N=d(null),P=d(!1),R=d(!1),F=d(null),H=ye(()=>T.value.some(n=>n.type==="rental")),J=()=>{f.value="",U.value="",B.value="",N.value=null,_.value=1,c()},Q=n=>{h.value=n,_.value=1,c()},Y=n=>{_.value=n,c()},G=n=>{L.value=n},c=()=>q(null,null,function*(){x.value=!0;try{const n=yield V.getOrders({page:_.value,pageSize:h.value,keyword:f.value,type:U.value,status:B.value,dateRange:N.value||void 0});T.value=n.data.list,D.value=n.data.total,u.value=n.data.stats}catch(n){console.error("加载订单数据失败:",n),y.error("加载订单数据失败")}finally{x.value=!1}}),W=n=>{b.value=n,P.value=!0},X=n=>{F.value=n,R.value=!0},Z=n=>{P.value=!1,X(n)},ee=()=>{F.value=null,R.value=!0},te=()=>{c(),F.value=null},ae=(n,e)=>q(null,null,function*(){try{switch(n){case"confirm":yield V.updateOrderStatus(e.id,"confirmed"),y.success("订单已确认");break;case"ship":yield V.updateOrderStatus(e.id,"shipped"),y.success("订单已发货");break;case"complete":yield V.updateOrderStatus(e.id,"completed"),y.success("订单已完成");break;case"cancel":yield j.confirm("确定要取消这个订单吗？","确认取消",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield V.updateOrderStatus(e.id,"cancelled"),y.success("订单已取消");break;case"delete":yield j.confirm("确定要删除这个订单吗？此操作不可恢复。","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield V.deleteOrder(e.id),y.success("订单已删除");break}c()}catch(v){v!=="cancel"&&(console.error("订单操作失败:",v),y.error("操作失败"))}}),le=()=>{c()},se=n=>({pending:"warning",confirmed:"primary",processing:"primary",shipped:"info",delivered:"success",completed:"success",cancelled:"danger"})[n]||"info",ne=n=>Ee[n]||n,oe=n=>({pending:"warning",paid:"success",failed:"danger",refunded:"info"})[n||""]||"info",de=n=>Ue[n]||n||"未知",M=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return he(()=>{c()}),(n,e)=>{const v=i("el-icon"),w=i("el-button"),re=i("el-input"),z=i("el-form-item"),S=i("el-option"),$=i("el-select"),ie=i("el-date-picker"),ue=i("el-form"),m=i("el-table-column"),K=i("el-tag"),ce=i("ArrowDown"),A=i("el-dropdown-item"),pe=i("el-dropdown-menu"),_e=i("el-dropdown"),me=i("el-table"),ve=i("el-pagination"),fe=be("loading");return p(),k("div",Ne,[l("div",Pe,[e[9]||(e[9]=l("div",{class:"header-left"},[l("h2",null,"订单管理"),l("p",{class:"header-subtitle"},"销售和租赁订单管理 · 练字机器人管理系统")],-1)),l("div",Re,[t(w,{type:"primary",onClick:ee},{default:s(()=>[t(v,null,{default:s(()=>[t(E(Oe))]),_:1}),e[8]||(e[8]=r(" 新建订单 ",-1))]),_:1,__:[8]})])]),l("div",Fe,[l("div",Le,[l("div",Me,[t(v,null,{default:s(()=>[t(E(Ve))]),_:1})]),l("div",Ke,[l("div",qe,o(u.value.total),1),e[10]||(e[10]=l("div",{class:"stat-label"},"订单总数",-1))])]),l("div",Ie,[l("div",Xe,[t(v,null,{default:s(()=>[t(E(xe))]),_:1})]),l("div",$e,[l("div",je,"¥"+o(u.value.totalRevenue.toLocaleString()),1),e[11]||(e[11]=l("div",{class:"stat-label"},"总收入",-1))])]),l("div",He,[l("div",Je,[t(v,null,{default:s(()=>[t(E(De))]),_:1})]),l("div",Qe,[l("div",Ye,o(u.value.processing),1),e[12]||(e[12]=l("div",{class:"stat-label"},"处理中",-1))])]),l("div",Ge,[l("div",We,[t(v,null,{default:s(()=>[t(E(Te))]),_:1})]),l("div",Ze,[l("div",et,o(u.value.completed),1),e[13]||(e[13]=l("div",{class:"stat-label"},"已完成",-1))])])]),l("div",tt,[t(ue,{inline:!0,class:"search-form"},{default:s(()=>[t(z,{label:"搜索"},{default:s(()=>[t(re,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:"搜索订单号、客户名称",clearable:"",onClear:c,onKeyup:we(c,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(z,{label:"订单类型"},{default:s(()=>[t($,{modelValue:U.value,"onUpdate:modelValue":e[1]||(e[1]=a=>U.value=a),placeholder:"全部类型",clearable:"",onChange:c,style:{width:"120px"}},{default:s(()=>[t(S,{label:"销售订单",value:"sales"}),t(S,{label:"租赁订单",value:"rental"})]),_:1},8,["modelValue"])]),_:1}),t(z,{label:"订单状态"},{default:s(()=>[t($,{modelValue:B.value,"onUpdate:modelValue":e[2]||(e[2]=a=>B.value=a),placeholder:"全部状态",clearable:"",onChange:c,style:{width:"120px"}},{default:s(()=>[t(S,{label:"待处理",value:"pending"}),t(S,{label:"处理中",value:"processing"}),t(S,{label:"已完成",value:"completed"}),t(S,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),t(z,{label:"日期范围"},{default:s(()=>[t(ie,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=a=>N.value=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:c,style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(z,null,{default:s(()=>[t(w,{type:"primary",onClick:c},{default:s(()=>e[14]||(e[14]=[r("搜索",-1)])),_:1,__:[14]}),t(w,{onClick:J},{default:s(()=>e[15]||(e[15]=[r("重置",-1)])),_:1,__:[15]})]),_:1})]),_:1})]),l("div",at,[Se((p(),C(me,{data:T.value,stripe:"",onSelectionChange:G},{default:s(()=>[t(m,{type:"selection",width:"55"}),t(m,{prop:"orderNumber",label:"订单号",width:"150"}),t(m,{prop:"type",label:"订单类型",width:"100"},{default:s(({row:a})=>[t(K,{type:a.type==="sales"?"success":"primary",size:"small"},{default:s(()=>[r(o(a.type==="sales"?"销售":"租赁"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"客户信息",width:"180"},{default:s(({row:a})=>[l("div",lt,[l("div",st,o(a.customerName),1),l("div",nt,o(a.customerPhone),1)])]),_:1}),t(m,{label:"订单商品",width:"200"},{default:s(({row:a})=>[l("div",ot,[(p(!0),k(ke,null,Ce(a.items.slice(0,2),g=>(p(),k("div",{key:g.id,class:"item-info"},[l("span",dt,o(g.productName),1),l("span",rt,"x"+o(g.quantity),1)]))),128)),a.items.length>2?(p(),k("div",it," +"+o(a.items.length-2)+"个商品 ",1)):O("",!0)])]),_:1}),t(m,{prop:"totalAmount",label:"订单金额",width:"120"},{default:s(({row:a})=>[l("div",ut,[l("span",ct,"¥"+o(a.totalAmount.toLocaleString()),1),l("span",pt,o(a.currency),1)])]),_:1}),t(m,{prop:"status",label:"订单状态",width:"100"},{default:s(({row:a})=>[t(K,{type:se(a.status),size:"small"},{default:s(()=>[r(o(ne(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"paymentStatus",label:"支付状态",width:"100"},{default:s(({row:a})=>[t(K,{type:oe(a.paymentStatus),size:"small"},{default:s(()=>[r(o(de(a.paymentStatus)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"createdAt",label:"创建时间",width:"150"},{default:s(({row:a})=>[r(o(M(a.createdAt)),1)]),_:1}),H.value?(p(),C(m,{key:0,label:"租赁信息",width:"150"},{default:s(({row:a})=>[a.type==="rental"?(p(),k("div",_t,[l("div",mt,o(a.rentalDays)+"天",1),l("div",vt,[r(o(M(a.rentalStartDate))+" 至",1),e[16]||(e[16]=l("br",null,null,-1)),r(" "+o(M(a.rentalEndDate)),1)])])):(p(),k("span",ft,"-"))]),_:1})):O("",!0),t(m,{label:"操作",width:"200",fixed:"right"},{default:s(({row:a})=>[t(w,{text:"",type:"primary",size:"small",onClick:g=>W(a)},{default:s(()=>e[17]||(e[17]=[r(" 查看详情 ",-1)])),_:2,__:[17]},1032,["onClick"]),t(w,{text:"",type:"primary",size:"small",onClick:g=>X(a)},{default:s(()=>e[18]||(e[18]=[r(" 编辑 ",-1)])),_:2,__:[18]},1032,["onClick"]),t(_e,{onCommand:g=>ae(g,a),trigger:"click"},{dropdown:s(()=>[t(pe,null,{default:s(()=>[a.status==="pending"?(p(),C(A,{key:0,command:"confirm"},{default:s(()=>e[20]||(e[20]=[r(" 确认订单 ",-1)])),_:1,__:[20]})):O("",!0),a.status==="confirmed"?(p(),C(A,{key:1,command:"ship"},{default:s(()=>e[21]||(e[21]=[r(" 发货 ",-1)])),_:1,__:[21]})):O("",!0),a.status==="delivered"?(p(),C(A,{key:2,command:"complete"},{default:s(()=>e[22]||(e[22]=[r(" 完成订单 ",-1)])),_:1,__:[22]})):O("",!0),["pending","confirmed"].includes(a.status)?(p(),C(A,{key:3,command:"cancel"},{default:s(()=>e[23]||(e[23]=[r(" 取消订单 ",-1)])),_:1,__:[23]})):O("",!0),t(A,{command:"delete",divided:""},{default:s(()=>e[24]||(e[24]=[r(" 删除订单 ",-1)])),_:1,__:[24]})]),_:2},1024)]),default:s(()=>[t(w,{text:"",type:"primary",size:"small"},{default:s(()=>[e[19]||(e[19]=r(" 更多",-1)),t(v,{class:"el-icon--right"},{default:s(()=>[t(ce)]),_:1})]),_:1,__:[19]})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[fe,x.value]]),l("div",gt,[t(ve,{"current-page":_.value,"onUpdate:currentPage":e[4]||(e[4]=a=>_.value=a),"page-size":h.value,"onUpdate:pageSize":e[5]||(e[5]=a=>h.value=a),"page-sizes":[10,20,50,100],total:D.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Q,onCurrentChange:Y},null,8,["current-page","page-size","total"])])]),t(ze,{modelValue:R.value,"onUpdate:modelValue":e[6]||(e[6]=a=>R.value=a),order:F.value,onSuccess:te},null,8,["modelValue","order"]),t(Ae,{modelValue:P.value,"onUpdate:modelValue":e[7]||(e[7]=a=>P.value=a),order:b.value,onEdit:Z,onStatusChange:le},null,8,["modelValue","order"])])}}}),Ot=Be(yt,[["__scopeId","data-v-b9ed2f1c"]]);export{Ot as default};
