<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº§å“åª’ä½“ä¸Šä¼ æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-button {
            background-color: #409EFF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background-color: #337ecc;
        }
        .success-button {
            background-color: #67c23a;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #409EFF;
        }
        .error {
            border-left-color: #f56c6c;
            background-color: #fef0f0;
        }
        .success {
            border-left-color: #67c23a;
            background-color: #f0f9ff;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 300px;
            overflow-y: auto;
        }
        .file-info {
            margin: 10px 0;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¬ äº§å“åª’ä½“ä¸Šä¼ æµ‹è¯•</h1>
        <p>æµ‹è¯•æ–°æ·»åŠ çš„äº§å“åª’ä½“ä¸Šä¼ APIç«¯ç‚¹</p>

        <!-- ç«¯ç‚¹æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“¡ APIç«¯ç‚¹éªŒè¯</h3>
            <p>éªŒè¯ <code>POST /api/v1/upload/product/media</code> ç«¯ç‚¹æ˜¯å¦å¯ç”¨</p>
            <button class="test-button" onclick="testEndpoint()">æµ‹è¯•ç«¯ç‚¹å¯ç”¨æ€§</button>
            <div id="endpointResult" class="result" style="display: none;">
                <h4>ç«¯ç‚¹æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="endpointContent"></pre>
            </div>
        </div>

        <!-- å›¾ç‰‡ä¸Šä¼ æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ–¼ï¸ å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¸Šä¼ äº§å“å›¾ç‰‡åª’ä½“æ–‡ä»¶</p>
            <input type="file" id="imageFile" accept="image/*">
            <div id="imageFileInfo" class="file-info" style="display: none;"></div>
            <br><br>
            <button class="test-button" onclick="uploadImage()">ä¸Šä¼ å›¾ç‰‡</button>
            <div id="imageResult" class="result" style="display: none;">
                <h4>å›¾ç‰‡ä¸Šä¼ ç»“æœï¼š</h4>
                <pre id="imageContent"></pre>
            </div>
        </div>

        <!-- è§†é¢‘ä¸Šä¼ æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ¥ è§†é¢‘ä¸Šä¼ æµ‹è¯•</h3>
            <p>æµ‹è¯•ä¸Šä¼ äº§å“è§†é¢‘åª’ä½“æ–‡ä»¶</p>
            <input type="file" id="videoFile" accept="video/*">
            <div id="videoFileInfo" class="file-info" style="display: none;"></div>
            <br><br>
            <button class="test-button" onclick="uploadVideo()">ä¸Šä¼ è§†é¢‘</button>
            <div id="videoResult" class="result" style="display: none;">
                <h4>è§†é¢‘ä¸Šä¼ ç»“æœï¼š</h4>
                <pre id="videoContent"></pre>
            </div>
        </div>

        <!-- æ‰¹é‡æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸš€ æ‰¹é‡æµ‹è¯•</h3>
            <p>æ‰§è¡Œæ‰€æœ‰ä¸Šä¼ æµ‹è¯•</p>
            <button class="test-button success-button" onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <div id="allTestsResult" class="result" style="display: none;">
                <h4>æ‰¹é‡æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="allTestsContent"></pre>
            </div>
        </div>
    </div>

    <script>
        // ç›‘å¬æ–‡ä»¶é€‰æ‹©å˜åŒ–
        document.getElementById('imageFile').addEventListener('change', function(e) {
            showFileInfo(e.target.files[0], 'imageFileInfo');
        });

        document.getElementById('videoFile').addEventListener('change', function(e) {
            showFileInfo(e.target.files[0], 'videoFileInfo');
        });

        function showFileInfo(file, elementId) {
            const fileInfoDiv = document.getElementById(elementId);
            if (file) {
                fileInfoDiv.style.display = 'block';
                fileInfoDiv.innerHTML = `
                    <strong>é€‰æ‹©çš„æ–‡ä»¶:</strong><br>
                    æ–‡ä»¶å: ${file.name}<br>
                    æ–‡ä»¶å¤§å°: ${(file.size / 1024 / 1024).toFixed(2)} MB<br>
                    æ–‡ä»¶ç±»å‹: ${file.type}
                `;
            } else {
                fileInfoDiv.style.display = 'none';
            }
        }

        // æµ‹è¯•ç«¯ç‚¹å¯ç”¨æ€§
        async function testEndpoint() {
            showLoading('endpointResult', 'endpointContent', 'æµ‹è¯•ç«¯ç‚¹å¯ç”¨æ€§');
            
            try {
                // å‘é€ç©ºè¯·æ±‚æ¥æµ‹è¯•ç«¯ç‚¹æ˜¯å¦å­˜åœ¨
                const response = await fetch('/api/v1/upload/product/media', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                let message = '';
                if (response.status === 400 && data.message && data.message.includes('æ–‡ä»¶ä¸èƒ½ä¸ºç©º')) {
                    message = 'âœ… ç«¯ç‚¹å­˜åœ¨ä¸”æ­£å¸¸å·¥ä½œï¼\n';
                    message += `HTTPçŠ¶æ€: ${response.status}\n`;
                    message += `å“åº”æ¶ˆæ¯: ${data.message}\n`;
                    message += 'è¿™ä¸ªé”™è¯¯æ˜¯é¢„æœŸçš„ï¼Œå› ä¸ºæˆ‘ä»¬æ²¡æœ‰å‘é€æ–‡ä»¶ã€‚';
                    showResult('endpointResult', 'endpointContent', message, 'success');
                } else {
                    message = `âŒ ç«¯ç‚¹å“åº”å¼‚å¸¸\n`;
                    message += `HTTPçŠ¶æ€: ${response.status}\n`;
                    message += `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`;
                    showResult('endpointResult', 'endpointContent', message, 'error');
                }
            } catch (error) {
                let message = `âŒ ç«¯ç‚¹æµ‹è¯•å¤±è´¥\n`;
                message += `é”™è¯¯ä¿¡æ¯: ${error.message}`;
                showResult('endpointResult', 'endpointContent', message, 'error');
            }
        }

        // ä¸Šä¼ å›¾ç‰‡
        async function uploadImage() {
            const fileInput = document.getElementById('imageFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶');
                return;
            }
            
            showLoading('imageResult', 'imageContent', 'ä¸Šä¼ å›¾ç‰‡ä¸­');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('mediaType', 'image');
                
                const response = await fetch('/api/v1/upload/product/media', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                let message = `å›¾ç‰‡ä¸Šä¼ æµ‹è¯•ç»“æœï¼š\n`;
                message += `HTTPçŠ¶æ€: ${response.status}\n`;
                message += `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`;
                
                if (data.code === 200) {
                    showResult('imageResult', 'imageContent', message, 'success');
                } else {
                    showResult('imageResult', 'imageContent', message, 'error');
                }
            } catch (error) {
                let message = `å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼š\n${error.message}`;
                showResult('imageResult', 'imageContent', message, 'error');
            }
        }

        // ä¸Šä¼ è§†é¢‘
        async function uploadVideo() {
            const fileInput = document.getElementById('videoFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè§†é¢‘æ–‡ä»¶');
                return;
            }
            
            showLoading('videoResult', 'videoContent', 'ä¸Šä¼ è§†é¢‘ä¸­');
            
            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('mediaType', 'video');
                
                const response = await fetch('/api/v1/upload/product/media', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                let message = `è§†é¢‘ä¸Šä¼ æµ‹è¯•ç»“æœï¼š\n`;
                message += `HTTPçŠ¶æ€: ${response.status}\n`;
                message += `å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`;
                
                if (data.code === 200) {
                    showResult('videoResult', 'videoContent', message, 'success');
                } else {
                    showResult('videoResult', 'videoContent', message, 'error');
                }
            } catch (error) {
                let message = `è§†é¢‘ä¸Šä¼ å¤±è´¥ï¼š\n${error.message}`;
                showResult('videoResult', 'videoContent', message, 'error');
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            showLoading('allTestsResult', 'allTestsContent', 'æ‰§è¡Œæ‰¹é‡æµ‹è¯•');
            
            let results = 'ğŸ§ª æ‰¹é‡æµ‹è¯•æ‰§è¡Œç»“æœï¼š\n\n';
            
            // 1. æµ‹è¯•ç«¯ç‚¹
            results += '1. ç«¯ç‚¹å¯ç”¨æ€§æµ‹è¯•:\n';
            try {
                const response = await fetch('/api/v1/upload/product/media', {
                    method: 'POST'
                });
                const data = await response.json();
                if (response.status === 400 && data.message.includes('æ–‡ä»¶ä¸èƒ½ä¸ºç©º')) {
                    results += '   âœ… ç«¯ç‚¹æ­£å¸¸\n';
                } else {
                    results += '   âŒ ç«¯ç‚¹å“åº”å¼‚å¸¸\n';
                }
            } catch (error) {
                results += '   âŒ ç«¯ç‚¹è¿æ¥å¤±è´¥\n';
            }
            
            results += '\n2. æ— æ•ˆè¯·æ±‚æµ‹è¯•:\n';
            try {
                const formData = new FormData();
                formData.append('mediaType', 'image');
                // ä¸æ·»åŠ æ–‡ä»¶
                
                const response = await fetch('/api/v1/upload/product/media', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.code === 400 && data.message.includes('æ–‡ä»¶ä¸èƒ½ä¸ºç©º')) {
                    results += '   âœ… æ­£ç¡®éªŒè¯äº†ç©ºæ–‡ä»¶\n';
                } else {
                    results += '   âŒ æ–‡ä»¶éªŒè¯å¼‚å¸¸\n';
                }
            } catch (error) {
                results += '   âŒ æ— æ•ˆè¯·æ±‚æµ‹è¯•å¤±è´¥\n';
            }
            
            results += '\n3. é”™è¯¯åª’ä½“ç±»å‹æµ‹è¯•:\n';
            try {
                const formData = new FormData();
                formData.append('file', new Blob(['test'], {type: 'text/plain'}), 'test.txt');
                formData.append('mediaType', 'invalid');
                
                const response = await fetch('/api/v1/upload/product/media', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (data.code === 400 && data.message.includes('ä¸æ”¯æŒçš„åª’ä½“ç±»å‹')) {
                    results += '   âœ… æ­£ç¡®éªŒè¯äº†åª’ä½“ç±»å‹\n';
                } else {
                    results += '   âŒ åª’ä½“ç±»å‹éªŒè¯å¼‚å¸¸\n';
                }
            } catch (error) {
                results += '   âŒ åª’ä½“ç±»å‹æµ‹è¯•å¤±è´¥\n';
            }
            
            results += '\nğŸ“‹ æ€»ç»“:\n';
            results += 'æ–°æ·»åŠ çš„ /api/v1/upload/product/media ç«¯ç‚¹å·²æˆåŠŸä¿®å¤ï¼\n';
            results += 'å¯ä»¥å¤„ç†å›¾ç‰‡å’Œè§†é¢‘æ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ…å«å®Œæ•´çš„å‚æ•°éªŒè¯ã€‚';
            
            showResult('allTestsResult', 'allTestsContent', results, 'success');
        }

        function showLoading(resultId, contentId, message) {
            const resultDiv = document.getElementById(resultId);
            const resultContent = document.getElementById(contentId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultContent.textContent = `æ­£åœ¨${message}...`;
        }

        function showResult(resultId, contentId, message, type) {
            const resultDiv = document.getElementById(resultId);
            const resultContent = document.getElementById(contentId);
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + type;
            resultContent.textContent = message;
        }
    </script>
</body>
</html>