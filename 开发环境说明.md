# YXRobot 开发环境配置说明

## 🚀 快速启动

### 1. 一体化开发环境（推荐）
```bash
# 双击运行或在命令行执行
dev-full.bat
```
- **新版本**：前端和后端一体化打包模式
- 前端构建后集成到Spring Boot静态资源
- 统一访问地址：http://localhost:8081
- 支持后端代码热重启（DevTools）

### 2. 前端快速重建
```bash
# 双击运行或在命令行执行
rebuild-frontend.bat
```
- 仅重新构建前端资源
- 适用于前端代码修改后快速更新
- 无需重启整个应用

### 3. 快速启动（仅后端）
```bash
# 双击运行或在命令行执行
quick-start.bat
```
- 智能检测是否需要重新构建
- 首次启动：完整构建
- 后续启动：跳过前端构建，快速启动

## 🔧 开发模式说明

### 一体化模式（推荐）
- **前端集成**：前端构建后打包到Spring Boot静态资源
- **统一端口**：前后端使用同一端口（8081）
- **后端热重启**：修改Java文件后自动重启应用
- **前端更新**：修改前端代码后运行 `rebuild-frontend.bat`

### 分离模式（传统）
- **前端热重载**：修改Vue文件后自动刷新页面
- **前端开发服务器**：`5173`
- **后端应用服务器**：`8081`
- **API代理配置**：`/api/*` → `http://localhost:8081/api/*`

### 开发端口
- **一体化模式**：`8081`（前端+后端）
- **分离模式**：`5173`（前端）+ `8081`（后端）
- LiveReload端口：`35729`

## 📁 开发工作流

### 一体化开发（推荐）
1. 启动 `dev-full.bat`（首次启动或大改动）
2. 访问 `http://localhost:8081`
3. **后端修改**：在 `src/main/java/` 目录，自动重启生效
4. **前端修改**：在 `src/frontend/` 目录，运行 `rebuild-frontend.bat` 更新

### 前后端分离开发
1. 启动 `dev-full.bat`（传统模式）
2. 前端：`http://localhost:5173`（热重载）
3. 后端：`http://localhost:8081`（自动重启）
4. 修改后自动生效，无需手动重启

### 仅后端开发
1. 启动 `quick-start.bat`
2. 访问 `http://localhost:8081`
3. 使用已构建的前端静态文件

## ⚡ 性能优化

### JVM优化参数
```
-Xmx1024m                    # 最大堆内存
-XX:TieredStopAtLevel=1      # 快速启动，禁用C2编译器
-XX:+UseParallelGC          # 使用并行GC
```

### Spring Boot DevTools
- 自动重启：监控classpath变化
- LiveReload：浏览器自动刷新
- 属性默认值：开发环境优化配置

## 🛠️ 故障排除

### 端口占用问题
脚本会自动检测并停止占用端口的进程

### 手动停止服务
```bash
# 停止所有Java进程
taskkill /F /IM java.exe

# 停止特定端口进程
netstat -ano | findstr :8081
taskkill /PID [PID] /F
```

### 清理构建缓存
```bash
# 清理Maven缓存
mvn clean

# 清理前端缓存
cd src/frontend
npm run clean
rm -rf node_modules
npm install
```

## 📝 开发建议

### 一体化模式（推荐）
1. **首次启动**：使用 `dev-full.bat` 完整构建
2. **后端开发**：修改Java代码后自动重启
3. **前端开发**：修改Vue代码后运行 `rebuild-frontend.bat`
4. **调试模式**：在IDE中直接运行 `YXRobotApplication.main()`

### 分离模式
1. **日常开发**：使用 `quick-start.bat` 快速启动
2. **前端开发**：单独使用前端开发服务器
3. **API调试**：使用浏览器开发者工具或Postman

### 性能建议
- **一体化模式**：适合生产环境测试和部署验证
- **分离模式**：适合快速开发和调试
- **混合使用**：根据开发阶段选择合适的模式

## 🔍 监控和调试

### 应用监控
- 健康检查：http://localhost:8081/actuator/health
- 应用信息：http://localhost:8081/actuator/info
- 环境信息：http://localhost:8081/actuator/env

### 日志文件
- 开发日志：`logs/yxrobot-dev.log`
- 控制台输出：实时显示DEBUG级别日志

## 🏗️ 一体化构建详解

### 构建流程
1. **清理环境**：删除旧的构建文件
2. **Java编译**：编译后端Java代码
3. **Node.js安装**：自动安装Node.js和npm（如需要）
4. **前端依赖**：安装前端npm依赖
5. **前端构建**：执行 `npm run build` 构建前端
6. **资源复制**：将前端构建结果复制到 `src/main/resources/static/`
7. **应用启动**：启动集成了前端资源的Spring Boot应用

### 目录结构
```
src/
├── main/
│   ├── java/                 # 后端Java代码
│   └── resources/
│       └── static/           # 前端构建输出（自动生成）
│           ├── index.html
│           ├── js/
│           ├── css/
│           └── assets/
└── frontend/                 # 前端源码
    ├── src/
    ├── dist/                 # 前端构建临时目录
    └── package.json
```

### SPA路由支持
- 配置了 `WebConfig.java` 支持Vue Router的History模式
- 所有非API请求都会返回 `index.html`
- API请求（`/api/*`）正常处理

### 优势
- ✅ 生产环境一致性
- ✅ 部署简单（单个JAR/WAR文件）
- ✅ 无跨域问题
- ✅ 统一的错误处理和日志

### 注意事项
- 前端修改需要重新构建（使用 `rebuild-frontend.bat`）
- 构建时间较长（首次启动）
- 适合生产环境验证和部署测试

---

💡 **提示**：建议将这些脚本添加到IDE的外部工具中，方便快速启动！