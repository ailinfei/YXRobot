# Admin Business - 销售数据分析模块需求文档

## 🚨 核心需求要求（强制执行）

### ⚠️ 基于现有前端页面的后端API适配规范

**本需求文档基于现有的 Sales.vue 前端页面（位于 `/src/frontend/src/views/admin/business/Sales.vue`），要求后端API完全适配前端页面的数据需求和交互逻辑：**

#### 🔥 前端页面分析结果

现有前端页面包含以下核心功能模块：
1. **销售数据分析页面头部**：包含页面标题、描述、日期范围选择器、刷新按钮
2. **销售概览卡片**：总销售额、订单总数、新增客户、平均订单价值（带增长率显示）
3. **图表分析区域**：销售趋势图、产品销售分布、销售地区分布、销售渠道分析
4. **销售记录列表**：包含搜索、筛选、分页、CRUD操作
5. **销售记录详情对话框**：显示完整的销售记录信息

#### 🔥 前端数据绑定要求

1. **API数据源要求**：
   - ✅ **必须提供**：与前端页面完全匹配的后端API接口
   - ✅ **必须支持**：前端页面所有的数据查询和操作需求
   - ❌ **严禁修改**：现有前端页面的数据结构和字段名称
   - ❌ **严禁要求**：前端页面适配后端数据格式

2. **字段映射适配要求**：
   - 后端API响应必须完全匹配前端TypeScript接口定义
   - 数据库字段通过MyBatis映射转换为前端期望的camelCase格式
   - 所有枚举值必须与前端页面的显示逻辑一致
   - 日期格式必须符合前端页面的处理逻辑

#### 🚨 前端页面字段映射分析（强制遵循）

基于现有Sales.vue页面分析，后端必须提供以下字段：

**销售记录核心字段**：
- `orderNumber` - 订单号（前端用于链接显示）
- `customerName` - 客户名称（前端显示在客户信息区域）
- `customerPhone` - 客户电话（前端显示在客户信息区域）
- `productName` - 产品名称（前端显示在产品信息区域）
- `staffName` - 销售人员姓名（前端显示销售人员）
- `quantity` - 数量（前端显示在产品信息区域）
- `unitPrice` - 单价（前端显示在金额信息区域）
- `salesAmount` - 销售总额（前端显示在金额信息区域）
- `discountAmount` - 折扣金额（前端详情页显示）
- `status` - 订单状态（前端用于状态标签显示）
- `paymentStatus` - 付款状态（前端用于付款状态标签显示）
- `paymentMethod` - 付款方式（前端详情页显示）
- `orderDate` - 订单日期（前端表格显示）
- `notes` - 备注信息（前端详情页显示）

## 介绍

销售数据分析模块是 YXRobot 管理后台的核心业务分析功能，基于现有的 Sales.vue 前端页面提供销售数据的全面分析和管理。该模块需要开发完整的后端API支持，确保前端页面的所有功能正常工作，访问地址为 http://localhost:8081/admin/business/sales。

**基于现有前端页面的技术实现要求:**

1. **前端页面功能支持**: 
   - 后端API必须完全支持现有Sales.vue页面的所有功能
   - 包括销售概览卡片、图表分析、销售记录列表、详情查看等
   - 支持日期范围筛选、关键词搜索、状态筛选、分页等交互功能

2. **API接口适配**: 
   - 提供与前端页面完全匹配的RESTful API接口
   - 支持前端页面的所有数据查询和操作需求
   - API响应格式必须与前端TypeScript接口定义完全一致

3. **数据库查询优化**: 
   - 后端API从MySQL数据库实时查询数据
   - 支持复杂的关联查询（销售记录、客户、产品、销售人员）
   - 优化查询性能，支持大数据量的分页和筛选

4. **图表数据支持**: 
   - 提供销售趋势分析数据（支持ECharts格式）
   - 提供产品销售分布数据（饼图格式）
   - 提供销售地区分布数据（柱状图格式）
   - 提供销售渠道分析数据（折线图格式）

5. **统计数据计算**: 
   - 实时计算销售统计指标（总销售额、订单数、新增客户、平均订单价值）
   - 支持增长率计算和趋势分析
   - 支持按日期范围的动态统计

6. **空数据状态处理**: 
   - 当数据库中没有数据时，API返回空数组而非错误
   - 前端页面已实现空状态显示，后端只需正确返回空数据
   - 支持数据为空时的统计指标显示（显示为0）

**技术架构要求:**
- 后端Spring Boot提供RESTful API接口
- 使用MyBatis进行数据库操作和复杂查询
- 数据传输格式严格遵循前端TypeScript接口定义
- **关键**：后端适配前端，而非前端适配后端
- 确保现有前端页面无需修改即可正常工作

**字段映射实施标准：**
```sql
-- 数据库表字段 (snake_case)
CREATE TABLE sales_records (
  id BIGINT PRIMARY KEY,
  sales_amount DECIMAL(10,2),
  order_date DATE,
  customer_id BIGINT
);
```

```java
// Java实体类属性 (camelCase)
public class SalesRecord {
  private Long id;
  private BigDecimal salesAmount;
  private LocalDate orderDate;
  private Long customerId;
}
```

```xml
<!-- MyBatis映射配置 -->
<result column="sales_amount" property="salesAmount"/>
<result column="order_date" property="orderDate"/>
<result column="customer_id" property="customerId"/>
```

```typescript
// 前端TypeScript接口 (camelCase)
interface SalesRecord {
  id: number;
  salesAmount: number;
  orderDate: string;
  customerId: number;
}
```

## 需求

### 需求 1 ✅ 已完成 - 销售数据分析页面头部功能

**用户故事:** 作为销售管理员，我希望能够查看销售数据分析页面的头部区域，包括页面标题、描述、日期范围选择器和刷新按钮，以便控制数据查询范围和刷新数据。

#### 验收标准

1. WHEN 用户访问销售数据分析页面 THEN 系统 SHALL 显示"销售数据分析"页面标题
2. WHEN 显示页面描述 THEN 系统 SHALL 显示"查看和分析销售数据、订单信息和业绩统计"副标题
3. WHEN 页面加载 THEN 系统 SHALL 在页面右上角显示日期范围选择器（默认最近30天）
4. WHEN 页面加载 THEN 系统 SHALL 在页面右上角显示"刷新数据"按钮
5. WHEN 用户选择日期范围 THEN 系统 SHALL 根据选择的日期范围重新加载所有数据（统计、图表、列表）
6. WHEN 用户点击刷新按钮 THEN 系统 SHALL 重新加载当前日期范围内的所有数据

#### 实施状态
- ✅ **前端页面已实现** - Sales.vue页面头部功能完整
- ✅ **数据库表结构已创建** - 支持日期范围查询
- ✅ **字段映射已修复** - 数据库字段与前端完全匹配

### 需求 2 - 销售概览卡片统计功能

**用户故事:** 作为销售管理员，我希望能够在页面顶部看到销售概览卡片，显示总销售额、订单总数、新增客户、平均订单价值等关键指标，并显示增长率趋势，以便快速了解销售业绩概况。

#### 验收标准

1. WHEN 页面加载 THEN 系统 SHALL 显示4个销售概览卡片：总销售额、订单总数、新增客户、平均订单价值
2. WHEN 显示总销售额卡片 THEN 系统 SHALL 显示货币格式的总销售金额和增长率（带颜色指示）
3. WHEN 显示订单总数卡片 THEN 系统 SHALL 显示订单数量和增长率趋势
4. WHEN 显示新增客户卡片 THEN 系统 SHALL 显示新增客户数量和增长率
5. WHEN 显示平均订单价值卡片 THEN 系统 SHALL 显示平均订单金额和增长率
6. WHEN 用户选择不同日期范围 THEN 系统 SHALL 重新计算并更新所有统计卡片数据
7. WHEN 数据为空 THEN 系统 SHALL 显示0值而不是错误信息

### 需求 3 - 图表分析区域功能

**用户故事:** 作为销售管理员，我希望能够查看多种图表分析，包括销售趋势分析、产品销售分布、销售地区分布、销售渠道分析，以便直观了解销售数据的各个维度。

#### 验收标准

1. WHEN 页面加载 THEN 系统 SHALL 显示4个图表容器：销售趋势分析、产品销售分布、销售地区分布、销售渠道分析
2. WHEN 显示销售趋势图 THEN 系统 SHALL 使用ECharts显示销售额和订单数的双轴图表（折线图+柱状图）
3. WHEN 显示产品销售分布 THEN 系统 SHALL 使用饼图显示各产品的销售占比
4. WHEN 显示销售地区分布 THEN 系统 SHALL 使用柱状图显示各地区的销售表现
5. WHEN 显示销售渠道分析 THEN 系统 SHALL 使用折线图显示线上和线下销售的对比
6. WHEN 用户选择不同日期范围 THEN 系统 SHALL 重新加载所有图表数据
7. WHEN 图表数据为空 THEN 系统 SHALL 显示空图表而不是错误信息
8. WHEN 用户点击图表刷新按钮 THEN 系统 SHALL 重新加载图表数据

### 需求 4 - 销售记录列表功能

**用户故事:** 作为销售管理员，我希望能够查看销售记录列表，包含完整的销售信息、客户信息、产品信息、金额信息和状态信息，并支持搜索、筛选、分页等功能，以便高效管理销售数据。

#### 验收标准

1. WHEN 页面加载 THEN 系统 SHALL 显示销售记录数据表格，包含订单号、客户信息、产品信息、金额信息、状态信息、操作按钮
2. WHEN 显示客户信息 THEN 系统 SHALL 显示客户名称和客户电话（分两行显示）
3. WHEN 显示产品信息 THEN 系统 SHALL 显示产品名称和数量信息（分两行显示）
4. WHEN 显示金额信息 THEN 系统 SHALL 显示销售总额和单价（分两行显示，货币格式化）
5. WHEN 显示订单状态 THEN 系统 SHALL 使用不同颜色的标签显示：待确认、已确认、已交付、已完成、已取消
6. WHEN 显示付款状态 THEN 系统 SHALL 使用不同颜色的标签显示：未付款、部分付款、已付款、已退款
7. WHEN 用户输入搜索关键词 THEN 系统 SHALL 搜索订单号或客户名称并实时更新列表
8. WHEN 用户选择订单状态筛选 THEN 系统 SHALL 按状态筛选销售记录
9. WHEN 数据为空 THEN 系统 SHALL 显示空状态页面，包含"创建第一条销售记录"按钮

### 需求 5 - 销售记录操作功能

**用户故事:** 作为销售管理员，我希望能够对销售记录进行查看、编辑、删除等操作，并能够创建新的销售记录，以便灵活管理销售数据。

#### 验收标准

1. WHEN 用户点击订单号链接 THEN 系统 SHALL 打开销售记录详情对话框
2. WHEN 用户点击"查看"按钮 THEN 系统 SHALL 打开销售记录详情对话框
3. WHEN 用户点击"编辑"按钮 THEN 系统 SHALL 提示编辑功能（当前为开发中状态）
4. WHEN 用户点击"删除"按钮 THEN 系统 SHALL 显示确认对话框，确认后执行删除操作
5. WHEN 用户点击"新增销售记录"按钮 THEN 系统 SHALL 提示新增功能（当前为开发中状态）
6. WHEN 删除操作成功 THEN 系统 SHALL 显示成功消息并刷新销售记录列表
7. WHEN 删除操作失败 THEN 系统 SHALL 显示错误消息

### 需求 6 - 销售记录详情对话框功能

**用户故事:** 作为销售管理员，我希望能够查看销售记录的完整详细信息，包括基本信息、金额信息、状态信息和备注信息，以便全面了解销售记录的详细情况。

#### 验收标准

1. WHEN 用户打开销售记录详情 THEN 系统 SHALL 显示详情对话框，标题包含订单号
2. WHEN 显示基本信息 THEN 系统 SHALL 显示订单号、客户名称、产品名称、销售人员姓名
3. WHEN 显示金额信息 THEN 系统 SHALL 显示数量、单价、折扣金额、销售总额（高亮显示）
4. WHEN 显示状态信息 THEN 系统 SHALL 显示订单状态、付款状态、付款方式（使用标签样式）
5. WHEN 有备注信息 THEN 系统 SHALL 显示备注信息区域
6. WHEN 没有备注信息 THEN 系统 SHALL 隐藏备注信息区域
7. WHEN 用户关闭对话框 THEN 系统 SHALL 关闭详情对话框并返回列表页面

### 需求 7 - 分页和数据加载功能

**用户故事:** 作为销售管理员，我希望销售记录列表支持分页功能，能够处理大量销售数据并提供灵活的分页控制，以便高效浏览和管理销售记录。

#### 验收标准

1. WHEN 显示销售记录列表 THEN 系统 SHALL 支持分页显示，默认每页20条记录
2. WHEN 用户切换页码 THEN 系统 SHALL 加载对应页面的销售数据
3. WHEN 分页信息显示 THEN 系统 SHALL 显示总记录数、当前页码、总页数等信息
4. WHEN 筛选条件变更 THEN 系统 SHALL 重置分页到第一页
5. WHEN 数据加载中 THEN 系统 SHALL 显示加载状态指示器
6. WHEN 数据加载完成 THEN 系统 SHALL 隐藏加载状态并显示数据

### 需求 8 - 响应式设计和用户体验

**用户故事:** 作为销售管理员，我希望系统具有良好的用户体验，包括响应式设计、加载状态、错误处理等，以便在不同设备上都能正常使用。

#### 验收标准

1. WHEN 页面在移动设备显示 THEN 系统 SHALL 自动适配屏幕尺寸并调整布局
2. WHEN 数据加载中 THEN 系统 SHALL 显示加载动画和状态提示
3. WHEN 操作执行中 THEN 系统 SHALL 显示相应的处理状态和进度提示
4. WHEN 操作成功 THEN 系统 SHALL 显示成功提示信息并自动刷新相关数据
5. WHEN 操作失败 THEN 系统 SHALL 显示友好的错误提示信息
6. WHEN 网络请求失败 THEN 系统 SHALL 在控制台记录错误但不影响用户体验

### 需求 9 - 后端API接口完整性

**用户故事:** 作为前端开发者，我希望后端提供完整的API接口支持，确保前端页面的所有功能都能正常工作，包括数据查询、统计计算、图表数据等。

#### 验收标准

1. WHEN 前端调用销售统计API THEN 后端 SHALL 返回总销售额、订单数、新增客户、平均订单价值等统计数据
2. WHEN 前端调用销售记录列表API THEN 后端 SHALL 支持分页、搜索、筛选等查询参数
3. WHEN 前端调用图表数据API THEN 后端 SHALL 返回ECharts格式的图表数据
4. WHEN 前端调用销售记录删除API THEN 后端 SHALL 执行软删除并返回操作结果
5. WHEN 前端调用任何API THEN 后端 SHALL 返回统一格式的响应（包含code、data、message字段）
6. WHEN API查询无数据 THEN 后端 SHALL 返回空数组而不是错误信息

### 需求 10 - 数据格式和字段映射

**用户故事:** 作为系统集成者，我希望确保前后端数据格式完全匹配，字段映射正确，数据类型一致，以便前端页面能够正确显示和处理数据。

#### 验收标准

1. WHEN 后端返回销售记录数据 THEN 字段名称 SHALL 使用camelCase格式（如customerName、orderNumber）
2. WHEN 后端返回日期数据 THEN 格式 SHALL 为YYYY-MM-DD字符串格式
3. WHEN 后端返回金额数据 THEN 类型 SHALL 为数字类型，支持小数点后两位
4. WHEN 后端返回枚举数据 THEN 值 SHALL 与前端页面的枚举值完全匹配
5. WHEN 后端返回分页数据 THEN 结构 SHALL 包含list、total、page、pageSize字段
6. WHEN 后端返回图表数据 THEN 格式 SHALL 符合ECharts的数据结构要求

### 需求 11 - 性能和稳定性

**用户故事:** 作为销售管理员，我希望系统具有良好的性能和稳定性，能够快速响应查询请求，稳定处理大量数据，以便高效完成日常工作。

#### 验收标准

1. WHEN 用户加载销售记录列表 THEN 系统 SHALL 在2秒内返回响应
2. WHEN 用户切换日期范围 THEN 系统 SHALL 在3秒内更新所有数据（统计、图表、列表）
3. WHEN 系统处理大量销售记录 THEN 分页查询 SHALL 保持良好性能
4. WHEN 多个用户同时访问 THEN 系统 SHALL 保持稳定响应
5. WHEN 数据库连接异常 THEN 系统 SHALL 优雅处理错误并提供友好提示
6. WHEN API请求失败 THEN 前端 SHALL 在控制台记录错误但不影响用户界面