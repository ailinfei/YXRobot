<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring Bootåº”ç”¨çŠ¶æ€æ£€æŸ¥</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status-card {
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }
        .status-running {
            background: #f0f9ff;
            border-left-color: #67c23a;
        }
        .status-stopped {
            background: #fef0f0;
            border-left-color: #f56c6c;
        }
        .status-checking {
            background: #fdf6ec;
            border-left-color: #e6a23c;
        }
        .action-button {
            background-color: #409EFF;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 10px 10px 0;
        }
        .action-button:hover {
            background-color: #337ecc;
        }
        .success-button {
            background-color: #67c23a;
        }
        .warning-button {
            background-color: #e6a23c;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” Spring Bootåº”ç”¨çŠ¶æ€æ£€æŸ¥</h1>
        
        <div id="app-status" class="status-card status-checking">
            <h3>åº”ç”¨çŠ¶æ€: <span id="status-text">æ£€æŸ¥ä¸­...</span></h3>
            <p id="status-details">æ­£åœ¨æ£€æŸ¥Spring Bootåº”ç”¨æ˜¯å¦è¿è¡Œåœ¨ç«¯å£8081...</p>
        </div>

        <div class="status-card">
            <h3>ğŸš€ åº”ç”¨ç®¡ç†æ“ä½œ</h3>
            <button class="action-button" onclick="checkApplicationStatus()">æ£€æŸ¥åº”ç”¨çŠ¶æ€</button>
            <button class="action-button success-button" onclick="startApplication()">å¯åŠ¨åº”ç”¨</button>
            <button class="action-button warning-button" onclick="testSalesAPI()">æµ‹è¯•é”€å”®API</button>
        </div>

        <div id="api-test-results" class="status-card" style="display: none;">
            <h3>ğŸ“Š APIæµ‹è¯•ç»“æœ</h3>
            <pre id="api-results"></pre>
        </div>

        <div class="status-card">
            <h3>ğŸ“ å¯åŠ¨åº”ç”¨æŒ‡ä»¤</h3>
            <p>å¦‚æœåº”ç”¨æœªè¿è¡Œï¼Œè¯·åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p>
            <pre>cd "E:\YXRobot\workspace\projects\YXRobot"
mvn -f "E:\YXRobot\workspace\projects\YXRobot\pom.xml" spring-boot:run "-Dspring-boot.run.profiles=dev"</pre>
            <p><strong>æˆ–è€…ä½¿ç”¨é¡¹ç›®å¯åŠ¨è„šæœ¬ï¼š</strong></p>
            <pre>cd "E:\YXRobot\workspace\projects\YXRobot"
dev-start.bat</pre>
        </div>

        <div class="status-card">
            <h3>ğŸ”— ç›¸å…³é“¾æ¥</h3>
            <p>
                <a href="http://localhost:8081" target="_blank">åº”ç”¨é¦–é¡µ</a> |
                <a href="http://localhost:8081/admin/business/sales" target="_blank">é”€å”®æ•°æ®é¡µé¢</a> |
                <a href="file:///e:/YXRobot/workspace/projects/YXRobot/fix-sales-data-problem.html" target="_blank">æ•°æ®ä¿®å¤å·¥å…·</a>
            </p>
        </div>
    </div>

    <script>
        let statusCheckInterval;

        // æ£€æŸ¥åº”ç”¨çŠ¶æ€
        async function checkApplicationStatus() {
            updateStatus('checking', 'æ£€æŸ¥ä¸­...', 'æ­£åœ¨æ£€æŸ¥Spring Bootåº”ç”¨çŠ¶æ€...');
            
            try {
                // å°è¯•è®¿é—®åº”ç”¨æ ¹è·¯å¾„
                const response = await fetch('http://localhost:8081/', {
                    method: 'GET',
                    timeout: 5000,
                    headers: {
                        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'
                    }
                });
                
                if (response.status === 200 || response.status === 404) {
                    // 200è¡¨ç¤ºæ­£å¸¸ï¼Œ404è¡¨ç¤ºåº”ç”¨è¿è¡Œä½†è·¯å¾„ä¸å­˜åœ¨ï¼ˆä¹Ÿæ˜¯æ­£å¸¸çš„ï¼‰
                    updateStatus('running', 'è¿è¡Œä¸­ âœ…', 
                        `Spring Bootåº”ç”¨æ­£åœ¨ç«¯å£8081ä¸Šè¿è¡Œ\n` +
                        `å“åº”çŠ¶æ€: ${response.status}\n` +
                        `åº”ç”¨åœ°å€: http://localhost:8081\n` +
                        `é”€å”®é¡µé¢: http://localhost:8081/admin/business/sales`);
                    
                    // è‡ªåŠ¨æµ‹è¯•é”€å”®API
                    setTimeout(testSalesAPI, 1000);
                    
                    return true;
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                updateStatus('stopped', 'æœªè¿è¡Œ âŒ', 
                    `Spring Bootåº”ç”¨æœªè¿è¡Œæˆ–æ— æ³•è®¿é—®\n` +
                    `é”™è¯¯ä¿¡æ¯: ${error.message}\n` +
                    `è¯·ä½¿ç”¨ä¸‹æ–¹çš„å¯åŠ¨å‘½ä»¤å¯åŠ¨åº”ç”¨`);
                return false;
            }
        }

        // å¯åŠ¨åº”ç”¨ï¼ˆæç¤ºç”¨æˆ·ï¼‰
        function startApplication() {
            updateStatus('checking', 'å‡†å¤‡å¯åŠ¨...', 
                'è¯·åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œå¯åŠ¨å‘½ä»¤\n' +
                'å¯åŠ¨å®Œæˆåç‚¹å‡»"æ£€æŸ¥åº”ç”¨çŠ¶æ€"æŒ‰é’®éªŒè¯');
            
            // 30ç§’åè‡ªåŠ¨æ£€æŸ¥
            setTimeout(() => {
                checkApplicationStatus();
            }, 30000);
        }

        // æµ‹è¯•é”€å”®API
        async function testSalesAPI() {
            const resultsDiv = document.getElementById('api-test-results');
            const resultsContent = document.getElementById('api-results');
            
            resultsDiv.style.display = 'block';
            resultsContent.textContent = 'æ­£åœ¨æµ‹è¯•é”€å”®API...';
            
            let results = 'ğŸ“Š é”€å”®APIæµ‹è¯•ç»“æœ:\n\n';
            
            // æµ‹è¯•é”€å”®ç»Ÿè®¡API
            try {
                const statsResponse = await fetch('http://localhost:8081/api/sales/stats?startDate=2025-07-30&endDate=2025-08-29');
                const statsData = await statsResponse.json();
                
                if (statsResponse.ok) {
                    results += 'âœ… é”€å”®ç»Ÿè®¡API: æ­£å¸¸\n';
                    results += `   æ€»é”€å”®é¢: Â¥${statsData.data.totalSalesAmount}\n`;
                    results += `   è®¢å•æ€»æ•°: ${statsData.data.totalOrders}\n`;
                } else {
                    results += 'âŒ é”€å”®ç»Ÿè®¡API: å¤±è´¥\n';
                    results += `   é”™è¯¯: ${statsData.message || 'æœªçŸ¥é”™è¯¯'}\n`;
                }
            } catch (error) {
                results += 'âŒ é”€å”®ç»Ÿè®¡API: è¿æ¥å¤±è´¥\n';
                results += `   é”™è¯¯: ${error.message}\n`;
            }
            
            results += '\n';
            
            // æµ‹è¯•é”€å”®è®°å½•API
            try {
                const recordsResponse = await fetch('http://localhost:8081/api/sales/records?page=1&pageSize=5');
                const recordsData = await recordsResponse.json();
                
                if (recordsResponse.ok) {
                    results += 'âœ… é”€å”®è®°å½•API: æ­£å¸¸\n';
                    results += `   è®°å½•æ€»æ•°: ${recordsData.data.total}\n`;
                } else {
                    results += 'âŒ é”€å”®è®°å½•API: å¤±è´¥\n';
                    results += `   é”™è¯¯: ${recordsData.message || 'æœªçŸ¥é”™è¯¯'}\n`;
                }
            } catch (error) {
                results += 'âŒ é”€å”®è®°å½•API: è¿æ¥å¤±è´¥\n';
                results += `   é”™è¯¯: ${error.message}\n`;
            }
            
            results += '\n';
            
            // æµ‹è¯•å›¾è¡¨API
            try {
                const chartsResponse = await fetch('http://localhost:8081/api/sales/charts/trends?groupBy=day');
                const chartsData = await chartsResponse.json();
                
                if (chartsResponse.ok) {
                    results += 'âœ… å›¾è¡¨æ•°æ®API: æ­£å¸¸\n';
                    results += `   æ•°æ®ç±»åˆ«æ•°: ${chartsData.data.categories?.length || 0}\n`;
                } else {
                    results += 'âŒ å›¾è¡¨æ•°æ®API: å¤±è´¥\n';
                    results += `   é”™è¯¯: ${chartsData.message || 'æœªçŸ¥é”™è¯¯'}\n`;
                }
            } catch (error) {
                results += 'âŒ å›¾è¡¨æ•°æ®API: è¿æ¥å¤±è´¥\n';
                results += `   é”™è¯¯: ${error.message}\n`;
            }
            
            results += '\nğŸ’¡ å¦‚æœAPIæµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®åº“æ˜¯å¦åŒ…å«é”€å”®æ•°æ®\n';
            results += 'ğŸ”§ å¯ä»¥ä½¿ç”¨æ•°æ®ä¿®å¤å·¥å…·åˆ›å»ºæµ‹è¯•æ•°æ®';
            
            resultsContent.textContent = results;
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(status, statusText, details) {
            const statusCard = document.getElementById('app-status');
            const statusTextElement = document.getElementById('status-text');
            const statusDetailsElement = document.getElementById('status-details');
            
            // ç§»é™¤æ‰€æœ‰çŠ¶æ€ç±»
            statusCard.classList.remove('status-running', 'status-stopped', 'status-checking');
            
            // æ·»åŠ å½“å‰çŠ¶æ€ç±»
            statusCard.classList.add(`status-${status}`);
            
            statusTextElement.textContent = statusText;
            statusDetailsElement.textContent = details;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.onload = function() {
            setTimeout(checkApplicationStatus, 1000);
            
            // æ¯30ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
            statusCheckInterval = setInterval(checkApplicationStatus, 30000);
        };

        // é¡µé¢å…³é—­æ—¶æ¸…ç†å®šæ—¶å™¨
        window.onbeforeunload = function() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
        };
    </script>
</body>
</html>