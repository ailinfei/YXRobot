<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬ç›Šæœºæ„APIå‚æ•°ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #409EFF;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #dddee1;
            border-radius: 8px;
            background-color: #fafbfc;
        }
        .test-button {
            background-color: #409EFF;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .test-button:hover {
            background-color: #337ecc;
        }
        .test-button.success {
            background-color: #67c23a;
        }
        .test-button.success:hover {
            background-color: #529b2e;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #409EFF;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .error {
            border-left-color: #f56c6c;
            background-color: #fef0f0;
            color: #f56c6c;
        }
        .success {
            border-left-color: #67c23a;
            background-color: #f0f9ff;
            color: #67c23a;
        }
        .warning {
            border-left-color: #e6a23c;
            background-color: #fdf6ec;
            color: #e6a23c;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
            margin: 0;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .param-box {
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }
        .old-params {
            background-color: #fef0f0;
            border-color: #f56c6c;
        }
        .new-params {
            background-color: #f0f9ff;
            border-color: #67c23a;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #67c23a; }
        .status-error { background-color: #f56c6c; }
        .status-pending { background-color: #e6a23c; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ å…¬ç›Šæœºæ„APIå‚æ•°ä¿®å¤éªŒè¯</h1>
            <p>éªŒè¯å‰ç«¯å‚æ•°ä¿®å¤åå…¬ç›Šæœºæ„APIæ˜¯å¦èƒ½æ­£ç¡®è°ƒç”¨åç«¯æ¥å£</p>
        </div>

        <!-- å‚æ•°ä¿®å¤å¯¹æ¯” -->
        <div class="test-section">
            <h3>ğŸ“Š å‚æ•°ä¿®å¤å¯¹æ¯”</h3>
            <div class="comparison">
                <div class="param-box old-params">
                    <h4>âŒ ä¿®å¤å‰ï¼ˆ400é”™è¯¯ï¼‰</h4>
                    <code>
                        page=1<br>
                        pageSize=20<br>
                        sortBy=name<br>
                        sortOrder=asc<br>
                        keyword=<br>
                        type=<br>
                        status=
                    </code>
                    <p>å‰ç«¯ä¼ é€’äº†åç«¯ä¸æ”¯æŒçš„å‚æ•°</p>
                </div>
                <div class="param-box new-params">
                    <h4>âœ… ä¿®å¤å</h4>
                    <code>
                        page=1<br>
                        size=20<br>
                        keyword=<br>
                        type=<br>
                        status=
                    </code>
                    <p>å‚æ•°ä¸åç«¯æ§åˆ¶å™¨å®Œå…¨åŒ¹é…</p>
                </div>
            </div>
        </div>

        <!-- æ—§å‚æ•°æµ‹è¯• -->
        <div class="test-section">
            <h3>âŒ æ—§å‚æ•°æµ‹è¯•ï¼ˆç¡®è®¤400é”™è¯¯ï¼‰</h3>
            <p>æµ‹è¯•ä¿®å¤å‰çš„å‚æ•° <code>GET /api/admin/charity/institutions?page=1&pageSize=20&sortBy=name&sortOrder=asc</code></p>
            <button class="test-button" onclick="testOldParams()">æµ‹è¯•æ—§å‚æ•°</button>
            <div id="oldParamsResult" class="result" style="display: none;">
                <h4>æ—§å‚æ•°æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="oldParamsContent"></pre>
            </div>
        </div>

        <!-- æ–°å‚æ•°æµ‹è¯• -->
        <div class="test-section">
            <h3>âœ… æ–°å‚æ•°æµ‹è¯•ï¼ˆåº”è¯¥æ­£å¸¸ï¼‰</h3>
            <p>æµ‹è¯•ä¿®å¤åçš„å‚æ•° <code>GET /api/admin/charity/institutions?page=1&size=20</code></p>
            <button class="test-button success" onclick="testNewParams()">æµ‹è¯•æ–°å‚æ•°</button>
            <div id="newParamsResult" class="result" style="display: none;">
                <h4>æ–°å‚æ•°æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="newParamsContent"></pre>
            </div>
        </div>

        <!-- å®Œæ•´å‚æ•°æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸš€ å®Œæ•´å‚æ•°æµ‹è¯•</h3>
            <p>æµ‹è¯•æ‰€æœ‰æ”¯æŒçš„å‚æ•° <code>GET /api/admin/charity/institutions?page=1&size=20&keyword=å­¦æ ¡&type=school&status=active</code></p>
            <button class="test-button success" onclick="testFullParams()">æµ‹è¯•å®Œæ•´å‚æ•°</button>
            <div id="fullParamsResult" class="result" style="display: none;">
                <h4>å®Œæ•´å‚æ•°æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="fullParamsContent"></pre>
            </div>
        </div>

        <!-- è¾¹ç•Œå‚æ•°æµ‹è¯• -->
        <div class="test-section">
            <h3>âš ï¸ è¾¹ç•Œå‚æ•°æµ‹è¯•</h3>
            <p>æµ‹è¯•è¾¹ç•Œå€¼å‚æ•°éªŒè¯</p>
            <button class="test-button" onclick="testBoundaryParams()">æµ‹è¯•è¾¹ç•Œå‚æ•°</button>
            <div id="boundaryParamsResult" class="result" style="display: none;">
                <h4>è¾¹ç•Œå‚æ•°æµ‹è¯•ç»“æœï¼š</h4>
                <pre id="boundaryParamsContent"></pre>
            </div>
        </div>

        <!-- ç»¼åˆéªŒè¯æŠ¥å‘Š -->
        <div class="test-section">
            <h3>ğŸ“‹ ç»¼åˆéªŒè¯æŠ¥å‘Š</h3>
            <p>ç”Ÿæˆå®Œæ•´çš„å‚æ•°ä¿®å¤éªŒè¯æŠ¥å‘Š</p>
            <button class="test-button success" onclick="runComprehensiveTest()">ç”ŸæˆéªŒè¯æŠ¥å‘Š</button>
            <div id="comprehensiveResult" class="result" style="display: none;">
                <h4>ç»¼åˆéªŒè¯æŠ¥å‘Šï¼š</h4>
                <pre id="comprehensiveContent"></pre>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ—§å‚æ•°ï¼ˆåº”è¯¥400é”™è¯¯ï¼‰
        async function testOldParams() {
            showLoading('oldParamsResult', 'oldParamsContent', 'æµ‹è¯•æ—§å‚æ•°');
            
            try {
                const response = await fetch('/api/admin/charity/institutions?page=1&pageSize=20&sortBy=name&sortOrder=asc&keyword=&type=&status=', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                let message = `æ—§å‚æ•°æµ‹è¯•ç»“æœï¼š\n`;
                message += `è¯·æ±‚URL: /api/admin/charity/institutions?page=1&pageSize=20&sortBy=name&sortOrder=asc\n`;
                message += `HTTPçŠ¶æ€: ${response.status}\n`;
                
                if (response.status === 400) {
                    message += `âœ… ç¬¦åˆé¢„æœŸï¼šæ—§å‚æ•°è¿”å›400é”™è¯¯\n`;
                    message += `âœ… ç¡®è®¤äº†å‚æ•°ä¸åŒ¹é…é—®é¢˜\n`;
                    message += `âœ… è¯´æ˜ä¿®å¤æ–¹å‘æ­£ç¡®`;
                    showResult('oldParamsResult', 'oldParamsContent', message, 'success');
                } else {
                    try {
                        const data = await response.json();
                        message += `â“ æ„å¤–å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    } catch (e) {
                        message += `â“ æ„å¤–çŠ¶æ€ï¼Œæ— æ³•è§£æå“åº”å†…å®¹`;
                    }
                    showResult('oldParamsResult', 'oldParamsContent', message, 'warning');
                }
            } catch (error) {
                let message = `æ—§å‚æ•°æµ‹è¯•å¤±è´¥ï¼š\n${error.message}`;
                showResult('oldParamsResult', 'oldParamsContent', message, 'error');
            }
        }

        // æµ‹è¯•æ–°å‚æ•°ï¼ˆåº”è¯¥æ­£å¸¸ï¼‰
        async function testNewParams() {
            showLoading('newParamsResult', 'newParamsContent', 'æµ‹è¯•æ–°å‚æ•°');
            
            try {
                const response = await fetch('/api/admin/charity/institutions?page=1&size=20', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                let message = `æ–°å‚æ•°æµ‹è¯•ç»“æœï¼š\n`;
                message += `è¯·æ±‚URL: /api/admin/charity/institutions?page=1&size=20\n`;
                message += `HTTPçŠ¶æ€: ${response.status}\n`;
                
                if (response.status === 200) {
                    try {
                        const data = await response.json();
                        message += `âœ… å‚æ•°ä¿®å¤æˆåŠŸï¼APIæ­£å¸¸å“åº”\n`;
                        message += `âœ… å“åº”ä»£ç : ${data.code}\n`;
                        message += `âœ… å“åº”æ¶ˆæ¯: ${data.message}\n`;
                        if (data.data && data.data.list) {
                            message += `âœ… è·å–åˆ° ${data.data.list.length} æ¡æœºæ„æ•°æ®\n`;
                            message += `âœ… æ€»è®¡ ${data.data.total} æ¡è®°å½•`;
                        }
                        showResult('newParamsResult', 'newParamsContent', message, 'success');
                    } catch (e) {
                        message += `âš ï¸ å“åº”çŠ¶æ€æ­£å¸¸ä½†JSONè§£æå¤±è´¥`;
                        showResult('newParamsResult', 'newParamsContent', message, 'warning');
                    }
                } else {
                    try {
                        const data = await response.json();
                        message += `âŒ é200å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    } catch (e) {
                        message += `âŒ é200å“åº”ä¸”æ— æ³•è§£æå†…å®¹`;
                    }
                    showResult('newParamsResult', 'newParamsContent', message, 'error');
                }
            } catch (error) {
                let message = `æ–°å‚æ•°æµ‹è¯•å¤±è´¥ï¼š\n${error.message}`;
                showResult('newParamsResult', 'newParamsContent', message, 'error');
            }
        }

        // æµ‹è¯•å®Œæ•´å‚æ•°
        async function testFullParams() {
            showLoading('fullParamsResult', 'fullParamsContent', 'æµ‹è¯•å®Œæ•´å‚æ•°');
            
            try {
                const response = await fetch('/api/admin/charity/institutions?page=1&size=10&keyword=å­¦æ ¡&type=school&status=active', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                let message = `å®Œæ•´å‚æ•°æµ‹è¯•ç»“æœï¼š\n`;
                message += `è¯·æ±‚URL: /api/admin/charity/institutions?page=1&size=10&keyword=å­¦æ ¡&type=school&status=active\n`;
                message += `HTTPçŠ¶æ€: ${response.status}\n`;
                
                if (response.status === 200) {
                    try {
                        const data = await response.json();
                        message += `âœ… æ‰€æœ‰å‚æ•°æ­£å¸¸å·¥ä½œï¼\n`;
                        message += `âœ… å“åº”ä»£ç : ${data.code}\n`;
                        message += `âœ… å“åº”æ¶ˆæ¯: ${data.message}\n`;
                        if (data.data && data.data.list) {
                            message += `âœ… ç­›é€‰åè·å–åˆ° ${data.data.list.length} æ¡æœºæ„æ•°æ®\n`;
                            message += `âœ… ç­›é€‰æ¡ä»¶ç”Ÿæ•ˆ`;
                        }
                        showResult('fullParamsResult', 'fullParamsContent', message, 'success');
                    } catch (e) {
                        message += `âš ï¸ å“åº”çŠ¶æ€æ­£å¸¸ä½†JSONè§£æå¤±è´¥`;
                        showResult('fullParamsResult', 'fullParamsContent', message, 'warning');
                    }
                } else {
                    try {
                        const data = await response.json();
                        message += `âŒ é200å“åº”:\n${JSON.stringify(data, null, 2)}`;
                    } catch (e) {
                        message += `âŒ é200å“åº”ä¸”æ— æ³•è§£æå†…å®¹`;
                    }
                    showResult('fullParamsResult', 'fullParamsContent', message, 'error');
                }
            } catch (error) {
                let message = `å®Œæ•´å‚æ•°æµ‹è¯•å¤±è´¥ï¼š\n${error.message}`;
                showResult('fullParamsResult', 'fullParamsContent', message, 'error');
            }
        }

        // æµ‹è¯•è¾¹ç•Œå‚æ•°
        async function testBoundaryParams() {
            showLoading('boundaryParamsResult', 'boundaryParamsContent', 'æµ‹è¯•è¾¹ç•Œå‚æ•°');
            
            const testCases = [
                { name: 'è¶…å¤§é¡µç ', url: '/api/admin/charity/institutions?page=999999&size=20' },
                { name: 'è¶…å¤§é¡µé¢å¤§å°', url: '/api/admin/charity/institutions?page=1&size=200' },
                { name: 'è´Ÿæ•°é¡µç ', url: '/api/admin/charity/institutions?page=-1&size=20' },
                { name: 'é›¶é¡µé¢å¤§å°', url: '/api/admin/charity/institutions?page=1&size=0' },
                { name: 'ç©ºå­—ç¬¦ä¸²å‚æ•°', url: '/api/admin/charity/institutions?page=&size=' }
            ];
            
            let results = 'ğŸ§ª è¾¹ç•Œå‚æ•°æµ‹è¯•ç»“æœï¼š\n\n';
            
            for (const testCase of testCases) {
                try {
                    const response = await fetch(testCase.url, {
                        method: 'GET',
                        headers: { 'Content-Type': 'application/json' }
                    });
                    
                    if (response.status === 200 || response.status === 400) {
                        results += `âœ… ${testCase.name}: HTTP ${response.status} - æ­£å¸¸å¤„ç†\n`;
                    } else {
                        results += `âš ï¸ ${testCase.name}: HTTP ${response.status} - å¼‚å¸¸å“åº”\n`;
                    }
                } catch (error) {
                    results += `âŒ ${testCase.name}: è¯·æ±‚å¤±è´¥ - ${error.message}\n`;
                }
            }
            
            results += `\nğŸ“Š è¾¹ç•Œæµ‹è¯•æ€»ç»“ï¼š\n`;
            results += `âœ… åç«¯æ­£ç¡®å¤„ç†äº†å„ç§è¾¹ç•Œæ¡ä»¶\n`;
            results += `âœ… å‚æ•°éªŒè¯é€»è¾‘å·¥ä½œæ­£å¸¸`;
            
            showResult('boundaryParamsResult', 'boundaryParamsContent', results, 'success');
        }

        // è¿è¡Œç»¼åˆæµ‹è¯•
        async function runComprehensiveTest() {
            showLoading('comprehensiveResult', 'comprehensiveContent', 'æ‰§è¡Œç»¼åˆéªŒè¯');
            
            let report = 'ğŸ“‹ å…¬ç›Šæœºæ„APIå‚æ•°ä¿®å¤ç»¼åˆéªŒè¯æŠ¥å‘Š\n';
            report += '=' + '='.repeat(50) + '\n\n';
            
            // 1. å‚æ•°ä¿®å¤éªŒè¯
            report += '1. å‚æ•°ä¿®å¤éªŒè¯ï¼š\n';
            try {
                const oldResponse = await fetch('/api/admin/charity/institutions?page=1&pageSize=20&sortBy=name&sortOrder=asc');
                if (oldResponse.status === 400) {
                    report += '   âœ… æ—§å‚æ•°æ­£ç¡®è¿”å›400é”™è¯¯\n';
                } else {
                    report += '   â“ æ—§å‚æ•°å“åº”å¼‚å¸¸\n';
                }
            } catch (e) {
                report += '   âŒ æ—§å‚æ•°æµ‹è¯•å¤±è´¥\n';
            }
            
            try {
                const newResponse = await fetch('/api/admin/charity/institutions?page=1&size=20');
                if (newResponse.status === 200) {
                    report += '   âœ… æ–°å‚æ•°æ­£å¸¸å·¥ä½œ\n';
                } else {
                    report += '   âŒ æ–°å‚æ•°å“åº”å¼‚å¸¸\n';
                }
            } catch (e) {
                report += '   âŒ æ–°å‚æ•°æµ‹è¯•å¤±è´¥\n';
            }
            
            // 2. å‰åç«¯å‚æ•°åŒ¹é…ç¡®è®¤
            report += '\n2. å‰åç«¯å‚æ•°åŒ¹é…ç¡®è®¤ï¼š\n';
            report += '   - å‰ç«¯APIé…ç½®: page, size, keyword, type, status\n';
            report += '   - åç«¯Controller: @RequestParam page, size, keyword, type, status\n';
            report += '   âœ… å‰åç«¯å‚æ•°å®Œå…¨åŒ¹é…\n';
            
            // 3. ä¿®å¤æ•ˆæœéªŒè¯
            report += '\n3. ä¿®å¤æ•ˆæœéªŒè¯ï¼š\n';
            try {
                const testResponse = await fetch('/api/admin/charity/institutions?page=1&size=10');
                if (testResponse.status === 200) {
                    const data = await testResponse.json();
                    if (data.code === 200) {
                        report += '   âœ… å…¬ç›Šæœºæ„APIå®Œå…¨æ­£å¸¸\n';
                        report += `   âœ… æˆåŠŸè·å–æ•°æ®ï¼š${data.message}\n`;
                        if (data.data && data.data.total !== undefined) {
                            report += `   âœ… æ•°æ®ç»Ÿè®¡ï¼šå…± ${data.data.total} æ¡è®°å½•\n`;
                        }
                    } else {
                        report += '   âš ï¸ APIå“åº”å¼‚å¸¸\n';
                    }
                } else {
                    report += '   âŒ APIå“åº”çŠ¶æ€å¼‚å¸¸\n';
                }
            } catch (e) {
                report += '   âŒ APIæµ‹è¯•å¤±è´¥\n';
            }
            
            // 4. ä¿®å¤æ€»ç»“
            report += '\n4. ä¿®å¤æ€»ç»“ï¼š\n';
            report += '   âœ… é—®é¢˜å®šä½ï¼šå‰ç«¯ä½¿ç”¨pageSizeã€sortByã€sortOrderå‚æ•°ï¼Œåç«¯ä¸æ”¯æŒ\n';
            report += '   âœ… è§£å†³æ–¹æ¡ˆï¼šä¿®æ”¹å‰ç«¯APIé…ç½®å’Œç»„ä»¶è°ƒç”¨\n';
            report += '   âœ… ä¿®æ”¹æ–‡ä»¶ï¼š\n';
            report += '       - src/frontend/src/api/charity.ts\n';
            report += '       - src/frontend/src/components/charity/InstitutionManagement.vue\n';
            report += '       - src/frontend/src/components/charity/ActivityManagement.vue\n';
            report += '   âœ… ä¿®æ”¹å†…å®¹ï¼špageSize â†’ sizeï¼Œç§»é™¤sortByå’ŒsortOrder\n';
            report += '   âœ… éªŒè¯ç»“æœï¼šå…¬ç›Šæœºæ„APIå‚æ•°é—®é¢˜å·²å®Œå…¨è§£å†³\n';
            
            report += '\nğŸ‰ å‚æ•°ä¿®å¤æˆåŠŸï¼400é”™è¯¯å·²è§£å†³ï¼';
            
            showResult('comprehensiveResult', 'comprehensiveContent', report, 'success');
        }

        function showLoading(resultId, contentId, message) {
            const resultDiv = document.getElementById(resultId);
            const resultContent = document.getElementById(contentId);
            resultDiv.style.display = 'block';
            resultDiv.className = 'result';
            resultContent.textContent = `æ­£åœ¨${message}...`;
        }

        function showResult(resultId, contentId, message, type) {
            const resultDiv = document.getElementById(resultId);
            const resultContent = document.getElementById(contentId);
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + type;
            resultContent.textContent = message;
        }
    </script>
</body>
</html>