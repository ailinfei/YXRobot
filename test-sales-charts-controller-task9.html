<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é”€å”®å›¾è¡¨æ•°æ®æ§åˆ¶å™¨æµ‹è¯• - ä»»åŠ¡9éªŒè¯</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            padding-left: 10px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .api-info {
            background-color: #e8f4fd;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        .test-button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }
        .test-button:hover {
            background-color: #2980b9;
        }
        .test-button.success {
            background-color: #27ae60;
        }
        .test-button.error {
            background-color: #e74c3c;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.success {
            background-color: #d5f4e6;
            border: 1px solid #27ae60;
            color: #1e8449;
        }
        .result.error {
            background-color: #fadbd8;
            border: 1px solid #e74c3c;
            color: #c0392b;
        }
        .result.info {
            background-color: #ebf3fd;
            border: 1px solid #3498db;
            color: #2471a3;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success { background-color: #27ae60; }
        .status-error { background-color: #e74c3c; }
        .status-pending { background-color: #f39c12; }
        .summary {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            border: 2px solid #dee2e6;
        }
        .chart-preview {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            min-height: 100px;
        }
        .param-input {
            margin: 5px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .param-group {
            margin-bottom: 15px;
        }
        .param-label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ é”€å”®å›¾è¡¨æ•°æ®æ§åˆ¶å™¨æµ‹è¯• - ä»»åŠ¡9éªŒè¯</h1>
        
        <div class="api-info">
            <h3>ğŸ“‹ æµ‹è¯•ç›®æ ‡</h3>
            <p><strong>ä»»åŠ¡9ï¼šå®ç°å›¾è¡¨æ•°æ®æ§åˆ¶å™¨ - é€‚é…å‰ç«¯å›¾è¡¨åŠŸèƒ½</strong></p>
            <ul>
                <li>âœ… å®ç°GET /api/sales/charts/trendsæ¥å£ï¼Œè¿”å›é”€å”®è¶‹åŠ¿å›¾è¡¨æ•°æ®</li>
                <li>âœ… å®ç°GET /api/sales/charts/distributionæ¥å£ï¼Œè¿”å›åˆ†å¸ƒå›¾è¡¨æ•°æ®</li>
                <li>âœ… æ”¯æŒtypeå‚æ•°ï¼ˆproductã€regionã€channelã€staffï¼‰çš„ä¸åŒåˆ†å¸ƒç±»å‹</li>
                <li>âœ… ç¡®ä¿è¿”å›æ•°æ®æ ¼å¼é€‚é…EChartsï¼ˆcategories + seriesç»“æ„ï¼‰</li>
                <li>âœ… æ·»åŠ å›¾è¡¨æ•°æ®ç¼“å­˜å’Œæ€§èƒ½ä¼˜åŒ–</li>
            </ul>
        </div>

        <!-- é”€å”®è¶‹åŠ¿å›¾è¡¨æ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“ˆ é”€å”®è¶‹åŠ¿å›¾è¡¨æ•°æ®æµ‹è¯•</h2>
            <div class="api-info">
                <strong>æ¥å£ï¼š</strong> GET /api/sales/charts/trends<br>
                <strong>åŠŸèƒ½ï¼š</strong> è·å–é”€å”®è¶‹åŠ¿å›¾è¡¨æ•°æ®ï¼Œé€‚é…EChartsæ ¼å¼<br>
                <strong>è¿”å›æ ¼å¼ï¼š</strong> {categories: [], series: [{name, type, data}]}
            </div>
            
            <div class="param-group">
                <span class="param-label">å¼€å§‹æ—¥æœŸï¼š</span>
                <input type="date" id="trendsStartDate" class="param-input" value="2024-01-01">
                <span class="param-label">ç»“æŸæ—¥æœŸï¼š</span>
                <input type="date" id="trendsEndDate" class="param-input" value="2024-12-31">
                <span class="param-label">åˆ†ç»„æ–¹å¼ï¼š</span>
                <select id="trendsGroupBy" class="param-input">
                    <option value="day">æŒ‰å¤©</option>
                    <option value="week">æŒ‰å‘¨</option>
                    <option value="month" selected>æŒ‰æœˆ</option>
                </select>
            </div>
            
            <button class="test-button" onclick="testTrendChartData()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•é”€å”®è¶‹åŠ¿å›¾è¡¨
            </button>
            <button class="test-button" onclick="testTrendChartDataEmpty()">æµ‹è¯•ç©ºæ•°æ®çŠ¶æ€</button>
            <button class="test-button" onclick="testTrendChartDataInvalidParams()">æµ‹è¯•å‚æ•°éªŒè¯</button>
            
            <div id="trendsResult" class="result" style="display: none;"></div>
            <div id="trendsChartPreview" class="chart-preview" style="display: none;">
                <h4>ğŸ“Š å›¾è¡¨æ•°æ®é¢„è§ˆ</h4>
                <div id="trendsChartData"></div>
            </div>
        </div>

        <!-- é”€å”®åˆ†å¸ƒå›¾è¡¨æ•°æ®æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ¥§ é”€å”®åˆ†å¸ƒå›¾è¡¨æ•°æ®æµ‹è¯•</h2>
            <div class="api-info">
                <strong>æ¥å£ï¼š</strong> GET /api/sales/charts/distribution<br>
                <strong>åŠŸèƒ½ï¼š</strong> è·å–é”€å”®åˆ†å¸ƒå›¾è¡¨æ•°æ®ï¼Œæ”¯æŒå¤šç§åˆ†å¸ƒç±»å‹<br>
                <strong>æ”¯æŒç±»å‹ï¼š</strong> productï¼ˆäº§å“ï¼‰ã€regionï¼ˆåœ°åŒºï¼‰ã€channelï¼ˆæ¸ é“ï¼‰ã€staffï¼ˆäººå‘˜ï¼‰
            </div>
            
            <div class="param-group">
                <span class="param-label">åˆ†å¸ƒç±»å‹ï¼š</span>
                <select id="distributionType" class="param-input">
                    <option value="product" selected>äº§å“åˆ†å¸ƒ</option>
                    <option value="region">åœ°åŒºåˆ†å¸ƒ</option>
                    <option value="channel">æ¸ é“åˆ†å¸ƒ</option>
                    <option value="staff">äººå‘˜åˆ†å¸ƒ</option>
                </select>
                <span class="param-label">å¼€å§‹æ—¥æœŸï¼š</span>
                <input type="date" id="distributionStartDate" class="param-input" value="2024-01-01">
                <span class="param-label">ç»“æŸæ—¥æœŸï¼š</span>
                <input type="date" id="distributionEndDate" class="param-input" value="2024-12-31">
            </div>
            
            <button class="test-button" onclick="testDistributionChartData()">
                <span class="status-indicator status-pending"></span>æµ‹è¯•åˆ†å¸ƒå›¾è¡¨
            </button>
            <button class="test-button" onclick="testAllDistributionTypes()">æµ‹è¯•æ‰€æœ‰åˆ†å¸ƒç±»å‹</button>
            <button class="test-button" onclick="testDistributionInvalidType()">æµ‹è¯•æ— æ•ˆç±»å‹</button>
            
            <div id="distributionResult" class="result" style="display: none;"></div>
            <div id="distributionChartPreview" class="chart-preview" style="display: none;">
                <h4>ğŸ“Š åˆ†å¸ƒå›¾è¡¨æ•°æ®é¢„è§ˆ</h4>
                <div id="distributionChartData"></div>
            </div>
        </div>

        <!-- ä¸“ç”¨æ¥å£æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ¯ ä¸“ç”¨å›¾è¡¨æ¥å£æµ‹è¯•</h2>
            <div class="api-info">
                <strong>ä¸“ç”¨æ¥å£ï¼š</strong> äº§å“åˆ†å¸ƒã€åœ°åŒºåˆ†å¸ƒã€æ¸ é“åˆ†æã€äººå‘˜ä¸šç»©<br>
                <strong>åŠŸèƒ½ï¼š</strong> æä¾›ç‰¹å®šç±»å‹çš„å›¾è¡¨æ•°æ®ï¼Œç®€åŒ–å‰ç«¯è°ƒç”¨
            </div>
            
            <button class="test-button" onclick="testProductDistribution()">äº§å“åˆ†å¸ƒå›¾è¡¨</button>
            <button class="test-button" onclick="testRegionDistribution()">åœ°åŒºåˆ†å¸ƒå›¾è¡¨</button>
            <button class="test-button" onclick="testChannelAnalysis()">æ¸ é“åˆ†æå›¾è¡¨</button>
            <button class="test-button" onclick="testStaffPerformance()">äººå‘˜ä¸šç»©å›¾è¡¨</button>
            
            <div id="specialResult" class="result" style="display: none;"></div>
        </div>

        <!-- ç¼“å­˜å’Œæ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>âš¡ ç¼“å­˜å’Œæ€§èƒ½æµ‹è¯•</h2>
            <div class="api-info">
                <strong>åŠŸèƒ½ï¼š</strong> æµ‹è¯•å›¾è¡¨æ•°æ®ç¼“å­˜çŠ¶æ€å’Œæ€§èƒ½ä¼˜åŒ–<br>
                <strong>æ¥å£ï¼š</strong> /cache-status, /clear-cache
            </div>
            
            <button class="test-button" onclick="testCacheStatus()">æŸ¥çœ‹ç¼“å­˜çŠ¶æ€</button>
            <button class="test-button" onclick="testClearCache()">æ¸…é™¤ç¼“å­˜</button>
            <button class="test-button" onclick="testPerformance()">æ€§èƒ½æµ‹è¯•</button>
            
            <div id="cacheResult" class="result" style="display: none;"></div>
        </div>

        <!-- æµ‹è¯•æ€»ç»“ -->
        <div class="summary">
            <h2>ğŸ“Š æµ‹è¯•æ€»ç»“</h2>
            <div id="testSummary">
                <p>ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8080/api/sales/charts';
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            tests: []
        };

        // é€šç”¨è¯·æ±‚å‡½æ•°
        async function makeRequest(url, options = {}) {
            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return {
                    success: response.ok,
                    status: response.status,
                    data: data
                };
            } catch (error) {
                return {
                    success: false,
                    status: 0,
                    error: error.message
                };
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(elementId, result, testName) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            
            if (result.success) {
                element.className = 'result success';
                element.textContent = `âœ… ${testName} æˆåŠŸ\n\n` + JSON.stringify(result.data, null, 2);
                testResults.passed++;
            } else {
                element.className = 'result error';
                element.textContent = `âŒ ${testName} å¤±è´¥\n\nçŠ¶æ€ç : ${result.status}\né”™è¯¯: ${result.error || JSON.stringify(result.data, null, 2)}`;
                testResults.failed++;
            }
            
            testResults.total++;
            testResults.tests.push({
                name: testName,
                success: result.success,
                timestamp: new Date().toLocaleString()
            });
            
            updateSummary();
        }

        // æ›´æ–°æµ‹è¯•æ€»ç»“
        function updateSummary() {
            const summaryElement = document.getElementById('testSummary');
            const passRate = testResults.total > 0 ? (testResults.passed / testResults.total * 100).toFixed(1) : 0;
            
            let summaryHtml = `
                <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <div><strong>æ€»æµ‹è¯•æ•°:</strong> ${testResults.total}</div>
                    <div><strong>é€šè¿‡:</strong> <span style="color: #27ae60;">${testResults.passed}</span></div>
                    <div><strong>å¤±è´¥:</strong> <span style="color: #e74c3c;">${testResults.failed}</span></div>
                    <div><strong>é€šè¿‡ç‡:</strong> <span style="color: ${passRate >= 80 ? '#27ae60' : '#e74c3c'};">${passRate}%</span></div>
                </div>
            `;
            
            if (testResults.tests.length > 0) {
                summaryHtml += '<h4>æµ‹è¯•è¯¦æƒ…:</h4><ul>';
                testResults.tests.forEach(test => {
                    const icon = test.success ? 'âœ…' : 'âŒ';
                    const color = test.success ? '#27ae60' : '#e74c3c';
                    summaryHtml += `<li style="color: ${color}; margin-bottom: 5px;">${icon} ${test.name} - ${test.timestamp}</li>`;
                });
                summaryHtml += '</ul>';
            }
            
            summaryElement.innerHTML = summaryHtml;
        }

        // æµ‹è¯•é”€å”®è¶‹åŠ¿å›¾è¡¨æ•°æ®
        async function testTrendChartData() {
            const startDate = document.getElementById('trendsStartDate').value;
            const endDate = document.getElementById('trendsEndDate').value;
            const groupBy = document.getElementById('trendsGroupBy').value;
            
            const url = `${BASE_URL}/trends?startDate=${startDate}&endDate=${endDate}&groupBy=${groupBy}`;
            const result = await makeRequest(url);
            
            showResult('trendsResult', result, 'é”€å”®è¶‹åŠ¿å›¾è¡¨æ•°æ®');
            
            if (result.success && result.data.data) {
                showChartPreview('trendsChartPreview', 'trendsChartData', result.data.data, 'è¶‹åŠ¿å›¾è¡¨');
            }
        }

        // æµ‹è¯•ç©ºæ•°æ®çŠ¶æ€
        async function testTrendChartDataEmpty() {
            const url = `${BASE_URL}/trends?startDate=2030-01-01&endDate=2030-01-02&groupBy=day`;
            const result = await makeRequest(url);
            showResult('trendsResult', result, 'è¶‹åŠ¿å›¾è¡¨ç©ºæ•°æ®æµ‹è¯•');
        }

        // æµ‹è¯•å‚æ•°éªŒè¯
        async function testTrendChartDataInvalidParams() {
            const url = `${BASE_URL}/trends?startDate=invalid-date&groupBy=invalid`;
            const result = await makeRequest(url);
            showResult('trendsResult', result, 'è¶‹åŠ¿å›¾è¡¨å‚æ•°éªŒè¯æµ‹è¯•');
        }

        // æµ‹è¯•åˆ†å¸ƒå›¾è¡¨æ•°æ®
        async function testDistributionChartData() {
            const type = document.getElementById('distributionType').value;
            const startDate = document.getElementById('distributionStartDate').value;
            const endDate = document.getElementById('distributionEndDate').value;
            
            const url = `${BASE_URL}/distribution?type=${type}&startDate=${startDate}&endDate=${endDate}`;
            const result = await makeRequest(url);
            
            showResult('distributionResult', result, `${type}åˆ†å¸ƒå›¾è¡¨æ•°æ®`);
            
            if (result.success && result.data.data) {
                showChartPreview('distributionChartPreview', 'distributionChartData', result.data.data, `${type}åˆ†å¸ƒå›¾è¡¨`);
            }
        }

        // æµ‹è¯•æ‰€æœ‰åˆ†å¸ƒç±»å‹
        async function testAllDistributionTypes() {
            const types = ['product', 'region', 'channel', 'staff'];
            let allResults = [];
            
            for (const type of types) {
                const url = `${BASE_URL}/distribution?type=${type}`;
                const result = await makeRequest(url);
                allResults.push({type, result});
            }
            
            const overallSuccess = allResults.every(r => r.result.success);
            showResult('distributionResult', {
                success: overallSuccess,
                data: allResults
            }, 'æ‰€æœ‰åˆ†å¸ƒç±»å‹æµ‹è¯•');
        }

        // æµ‹è¯•æ— æ•ˆåˆ†å¸ƒç±»å‹
        async function testDistributionInvalidType() {
            const url = `${BASE_URL}/distribution?type=invalid`;
            const result = await makeRequest(url);
            showResult('distributionResult', result, 'æ— æ•ˆåˆ†å¸ƒç±»å‹æµ‹è¯•');
        }

        // æµ‹è¯•äº§å“åˆ†å¸ƒ
        async function testProductDistribution() {
            const url = `${BASE_URL}/product-distribution`;
            const result = await makeRequest(url);
            showResult('specialResult', result, 'äº§å“åˆ†å¸ƒä¸“ç”¨æ¥å£');
        }

        // æµ‹è¯•åœ°åŒºåˆ†å¸ƒ
        async function testRegionDistribution() {
            const url = `${BASE_URL}/region-distribution`;
            const result = await makeRequest(url);
            showResult('specialResult', result, 'åœ°åŒºåˆ†å¸ƒä¸“ç”¨æ¥å£');
        }

        // æµ‹è¯•æ¸ é“åˆ†æ
        async function testChannelAnalysis() {
            const url = `${BASE_URL}/channel-analysis`;
            const result = await makeRequest(url);
            showResult('specialResult', result, 'æ¸ é“åˆ†æä¸“ç”¨æ¥å£');
        }

        // æµ‹è¯•äººå‘˜ä¸šç»©
        async function testStaffPerformance() {
            const url = `${BASE_URL}/staff-performance`;
            const result = await makeRequest(url);
            showResult('specialResult', result, 'äººå‘˜ä¸šç»©ä¸“ç”¨æ¥å£');
        }

        // æµ‹è¯•ç¼“å­˜çŠ¶æ€
        async function testCacheStatus() {
            const url = `${BASE_URL}/cache-status`;
            const result = await makeRequest(url);
            showResult('cacheResult', result, 'ç¼“å­˜çŠ¶æ€æŸ¥è¯¢');
        }

        // æµ‹è¯•æ¸…é™¤ç¼“å­˜
        async function testClearCache() {
            const url = `${BASE_URL}/clear-cache`;
            const result = await makeRequest(url, {method: 'POST'});
            showResult('cacheResult', result, 'æ¸…é™¤ç¼“å­˜');
        }

        // æ€§èƒ½æµ‹è¯•
        async function testPerformance() {
            const startTime = Date.now();
            const url = `${BASE_URL}/trends?groupBy=month`;
            
            const result = await makeRequest(url);
            const endTime = Date.now();
            const responseTime = endTime - startTime;
            
            const performanceResult = {
                ...result,
                data: {
                    ...result.data,
                    performance: {
                        responseTime: responseTime + 'ms',
                        status: responseTime < 1000 ? 'ä¼˜ç§€' : responseTime < 3000 ? 'è‰¯å¥½' : 'éœ€ä¼˜åŒ–'
                    }
                }
            };
            
            showResult('cacheResult', performanceResult, `æ€§èƒ½æµ‹è¯• (${responseTime}ms)`);
        }

        // æ˜¾ç¤ºå›¾è¡¨é¢„è§ˆ
        function showChartPreview(previewId, dataId, chartData, title) {
            const previewElement = document.getElementById(previewId);
            const dataElement = document.getElementById(dataId);
            
            previewElement.style.display = 'block';
            
            let previewHtml = `<h5>${title}æ•°æ®ç»“æ„éªŒè¯:</h5>`;
            
            if (chartData.categories && chartData.series) {
                previewHtml += `
                    <p><strong>âœ… Categories (${chartData.categories.length}é¡¹):</strong> ${JSON.stringify(chartData.categories.slice(0, 3))}${chartData.categories.length > 3 ? '...' : ''}</p>
                    <p><strong>âœ… Series (${chartData.series.length}ä¸ªç³»åˆ—):</strong></p>
                    <ul>
                `;
                
                chartData.series.forEach(series => {
                    previewHtml += `<li>${series.name} (${series.type || 'default'}) - ${series.data ? series.data.length : 0}ä¸ªæ•°æ®ç‚¹</li>`;
                });
                
                previewHtml += '</ul>';
                previewHtml += '<p><strong>âœ… EChartsæ ¼å¼å…¼å®¹æ€§:</strong> é€šè¿‡</p>';
            } else {
                previewHtml += '<p><strong>âŒ æ•°æ®æ ¼å¼é”™è¯¯:</strong> ç¼ºå°‘categoriesæˆ–serieså­—æ®µ</p>';
            }
            
            dataElement.innerHTML = previewHtml;
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é”€å”®å›¾è¡¨æ•°æ®æ§åˆ¶å™¨æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ä»»åŠ¡9ï¼šå®ç°å›¾è¡¨æ•°æ®æ§åˆ¶å™¨ - é€‚é…å‰ç«¯å›¾è¡¨åŠŸèƒ½');
            
            // è®¾ç½®é»˜è®¤æ—¥æœŸ
            const today = new Date();
            const lastMonth = new Date(today.getFullYear(), today.getMonth() - 1, today.getDate());
            
            document.getElementById('trendsStartDate').value = lastMonth.toISOString().split('T')[0];
            document.getElementById('trendsEndDate').value = today.toISOString().split('T')[0];
            document.getElementById('distributionStartDate').value = lastMonth.toISOString().split('T')[0];
            document.getElementById('distributionEndDate').value = today.toISOString().split('T')[0];
        });
    </script>
</body>
</html>