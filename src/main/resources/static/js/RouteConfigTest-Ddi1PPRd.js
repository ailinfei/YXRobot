var Q=Object.defineProperty;var G=(o,t,s)=>t in o?Q(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var R=(o,t,s)=>G(o,typeof t!="symbol"?t+"":t,s);var S=(o,t,s)=>new Promise((n,r)=>{var l=_=>{try{y(s.next(_))}catch(k){r(k)}},v=_=>{try{y(s.throw(_))}catch(k){r(k)}},y=_=>_.done?n(_.value):Promise.resolve(_.value).then(l,v);y((s=s.apply(o,t)).next())});import{x as X,az as Y,r as U,c as P,h as ss,al as $,y as m,z as u,A as e,K as V,Q as a,I as c,M as O,u as w,D as N,H as q,O as f,L as j,P as x,a6 as M}from"./vue-C2NPAEWw.js";import{r as ts,a6 as es,ap as is,ac as F,b as W,W as ns,ad as os}from"./element-plus-BHn0tN3r.js";import{_ as as}from"./_plugin-vue_export-helper-DlAUqK2U.js";class rs{constructor(){R(this,"errors",[]);R(this,"warnings",[]);R(this,"routeCount",0);R(this,"validRouteCount",0);R(this,"authRouteCount",0);R(this,"permissionRouteCount",0)}validateRoutes(t){this.reset();for(const s of t)this.validateRoute(s);return{isValid:this.errors.length===0,errors:[...this.errors],warnings:[...this.warnings],summary:{totalRoutes:this.routeCount,validRoutes:this.validRouteCount,invalidRoutes:this.routeCount-this.validRouteCount,routesWithAuth:this.authRouteCount,routesWithPermissions:this.permissionRouteCount}}}validateRoute(t,s=""){var l,v;this.routeCount++;let n=!0;const r=this.buildFullPath(s,t.path);if(this.validatePath(t.path,r)||(n=!1),this.validateName(t.name,r)||(n=!1),this.validateComponent(t.component,r)||(n=!1),this.validateMeta(t.meta,r)||(n=!1),t.children)for(const y of t.children)this.validateRoute(y,r);n&&this.validRouteCount++,(l=t.meta)!=null&&l.requiresAuth&&this.authRouteCount++,(v=t.meta)!=null&&v.permissions&&this.permissionRouteCount++}validatePath(t,s){return t?(t!=="/"&&!t.startsWith("/")&&!t.startsWith(":")&&this.warnings.push(`路径应该以 '/' 开头: ${s}`),t.includes("//")?(this.errors.push(`路径包含双斜杠: ${s}`),!1):(s.length>200&&this.warnings.push(`路径过长 (${s.length} 字符): ${s}`),!0)):(this.errors.push(`路由路径不能为空: ${s}`),!1)}validateName(t,s){return t?typeof t!="string"?(this.errors.push(`路由名称必须是字符串: ${s}`),!1):(/^[A-Z][a-zA-Z0-9]*$/.test(t)||this.warnings.push(`建议路由名称使用 PascalCase 格式: ${t} (${s})`),!0):(this.warnings.push(`建议为路由设置名称: ${s}`),!0)}validateComponent(t,s){return t||s.includes("children")||this.warnings.push(`路由缺少组件: ${s}`),!0}validateMeta(t,s){if(!t)return!0;let n=!0;if(t.title&&typeof t.title!="string"&&(this.errors.push(`路由标题必须是字符串: ${s}`),n=!1),t.permissions)if(!Array.isArray(t.permissions))this.errors.push(`权限配置必须是数组: ${s}`),n=!1;else for(const r of t.permissions)typeof r!="string"&&(this.errors.push(`权限项必须是字符串: ${r} (${s})`),n=!1);return t.requiresAuth&&typeof t.requiresAuth!="boolean"&&(this.errors.push(`requiresAuth 必须是布尔值: ${s}`),n=!1),n}buildFullPath(t,s){return!t||s.startsWith("/")?s:`${t}/${s}`.replace(/\/+/g,"/")}reset(){this.errors=[],this.warnings=[],this.routeCount=0,this.validRouteCount=0,this.authRouteCount=0,this.permissionRouteCount=0}}function Z(o){var s,n,r;const t=[];for(const l of o){const v={path:l.path,name:l.name||"",component:ls(l.component),title:(s=l.meta)==null?void 0:s.title,requiresAuth:(n=l.meta)==null?void 0:n.requiresAuth,permissions:(r=l.meta)==null?void 0:r.permissions};l.children&&(v.children=Z(l.children)),t.push(v)}return t}function ls(o){return o?typeof o=="function"?"LazyComponent":o.name?o.name:"UnknownComponent":"undefined"}function H(o,t){for(const s of o)if(s.path===t||s.children&&H(s.children,t))return!0;return!1}function T(o,t){for(const s of o){if(s.path===t)return s;if(s.children){const n=T(s.children,t);if(n)return n}}return null}function J(o,t=""){const s=[];for(const n of o){const r=t?`${t}/${n.path}`.replace(/\/+/g,"/"):n.path;s.push(r),n.children&&s.push(...J(n.children,r))}return s}function us(o){var v,y,_;const t=[],s=T(o,"/admin/business/orders"),n=!!s;n?(s!=null&&s.name||t.push("订单管理路由缺少名称"),(v=s==null?void 0:s.meta)!=null&&v.title||t.push("订单管理路由缺少标题"),(y=s==null?void 0:s.meta)!=null&&y.requiresAuth||t.push("订单管理路由应该需要认证"),(_=s==null?void 0:s.meta)!=null&&_.permissions||t.push("订单管理路由缺少权限配置")):t.push("缺少订单管理路由: /admin/business/orders");const l=!!T(o,"/test/order-api");return l||t.push("缺少订单API测试路由: /test/order-api"),{hasOrderManagement:n,hasOrderTest:l,orderRouteConfig:s,issues:t}}const ds=new rs,E={validator:ds,extractRouteInfo:Z,checkRouteExists:H,findRoute:T,getAllRoutePaths:J,validateOrderRoutes:us},cs={class:"route-config-test"},fs={class:"test-header"},ps={class:"test-actions"},hs={class:"validation-summary"},ms={class:"summary-icon"},vs={class:"summary-content"},_s={class:"summary-stats"},gs={class:"stat-item"},ys={class:"stat-value"},bs={class:"stat-item"},Cs={class:"stat-value"},Rs={class:"stat-item"},ws={class:"stat-value"},ks={class:"stat-item"},As={class:"stat-value"},$s={class:"test-section"},Vs={class:"order-route-check"},Os={key:0,class:"route-details"},qs={class:"config-table"},xs={class:"config-row"},Ms={class:"config-value"},Ns={class:"config-row"},Ws={class:"config-value"},Ts={class:"config-row"},zs={class:"config-value"},Bs={class:"config-row"},Is={class:"config-row"},Ls={class:"config-value"},Ds={key:0,class:"test-section"},Ss={class:"error-list"},Us={key:1,class:"test-section"},js={class:"warning-list"},Fs={key:2,class:"test-section"},Es={class:"issue-list"},Zs={class:"test-section"},Hs={key:0,class:"text-muted"},Js={class:"test-section"},Ks={class:"route-test-buttons"},Qs=X({__name:"RouteConfigTest",setup(o){const t=Y(),s=U({isValid:!0,errors:[],warnings:[],summary:{totalRoutes:0,validRoutes:0,invalidRoutes:0,routesWithAuth:0,routesWithPermissions:0}}),n=U({hasOrderManagement:!1,hasOrderTest:!1,orderRouteConfig:null,issues:[]}),r=[{path:"/admin/business/orders",label:"订单管理",type:"primary"},{path:"/admin/dashboard",label:"数据看板",type:"success"},{path:"/admin/business/customers",label:"客户管理",type:"info"},{path:"/test/order-api",label:"API测试",type:"warning"}],l=P(()=>t.getRoutes().filter(i=>i.path.includes("/admin/business")||i.path.includes("/test")||i.path==="/admin/dashboard").map(i=>{var p,g,b,A;return{path:i.path,name:i.name||"",title:((p=i.meta)==null?void 0:p.title)||"",component:v((g=i.components)==null?void 0:g.default),requiresAuth:((b=i.meta)==null?void 0:b.requiresAuth)||!1,permissions:((A=i.meta)==null?void 0:A.permissions)||[]}}));function v(h){return h?typeof h=="function"?"懒加载组件":h.name||"未知组件":"未定义"}const y=()=>{const h=t.getRoutes();s.value=E.validator.validateRoutes(h),n.value=E.validateOrderRoutes(h),W.success("路由验证完成")},_=h=>S(null,null,function*(){try{yield t.push(h),W.success(`成功跳转到 ${h}`)}catch(i){console.error("路由跳转失败:",i),W.error(`跳转失败: ${h}`)}}),k=()=>{const h={timestamp:new Date().toISOString(),validation:s.value,orderValidation:n.value,routes:l.value},i=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),p=URL.createObjectURL(i),g=document.createElement("a");g.href=p,g.download=`route-validation-report-${Date.now()}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(p),W.success("验证报告已导出")};return ss(()=>{y()}),(h,i)=>{var z,B,I,L,D;const p=$("el-icon"),g=$("el-button"),b=$("el-table-column"),A=$("el-tag"),K=$("el-table");return u(),m("div",cs,[e("div",fs,[i[2]||(i[2]=e("h2",null,"路由配置验证",-1)),i[3]||(i[3]=e("p",null,"验证订单管理相关路由配置是否正确",-1)),e("div",ps,[a(g,{type:"primary",onClick:y},{default:c(()=>[a(p,null,{default:c(()=>[a(w(ts))]),_:1}),i[0]||(i[0]=O(" 重新验证 ",-1))]),_:1,__:[0]}),a(g,{type:"success",onClick:k},{default:c(()=>[a(p,null,{default:c(()=>[a(w(es))]),_:1}),i[1]||(i[1]=O(" 导出报告 ",-1))]),_:1,__:[1]})])]),e("div",hs,[e("div",{class:N(["summary-card",{success:s.value.isValid,error:!s.value.isValid}])},[e("div",ms,[s.value.isValid?(u(),q(p,{key:0},{default:c(()=>[a(w(is))]),_:1})):(u(),q(p,{key:1},{default:c(()=>[a(w(F))]),_:1}))]),e("div",vs,[e("h3",null,f(s.value.isValid?"验证通过":"验证失败"),1),e("p",null,f(s.value.isValid?"所有路由配置正确":"发现配置问题"),1)])],2),e("div",_s,[e("div",gs,[e("span",ys,f(s.value.summary.totalRoutes),1),i[4]||(i[4]=e("span",{class:"stat-label"},"总路由数",-1))]),e("div",bs,[e("span",Cs,f(s.value.summary.validRoutes),1),i[5]||(i[5]=e("span",{class:"stat-label"},"有效路由",-1))]),e("div",Rs,[e("span",ws,f(s.value.summary.routesWithAuth),1),i[6]||(i[6]=e("span",{class:"stat-label"},"需要认证",-1))]),e("div",ks,[e("span",As,f(s.value.summary.routesWithPermissions),1),i[7]||(i[7]=e("span",{class:"stat-label"},"需要权限",-1))])])]),e("div",$s,[i[16]||(i[16]=e("h3",null,"订单管理路由检查",-1)),e("div",Vs,[e("div",{class:N(["check-item",{success:n.value.hasOrderManagement,error:!n.value.hasOrderManagement}])},[a(p,null,{default:c(()=>[(u(),q(j(n.value.hasOrderManagement?"SuccessFilled":"CloseBold")))]),_:1}),i[8]||(i[8]=e("span",null,"订单管理页面路由 (/admin/business/orders)",-1))],2),e("div",{class:N(["check-item",{success:n.value.hasOrderTest,error:!n.value.hasOrderTest}])},[a(p,null,{default:c(()=>[(u(),q(j(n.value.hasOrderTest?"SuccessFilled":"CloseBold")))]),_:1}),i[9]||(i[9]=e("span",null,"订单API测试路由 (/test/order-api)",-1))],2)]),n.value.orderRouteConfig?(u(),m("div",Os,[i[15]||(i[15]=e("h4",null,"订单管理路由配置",-1)),e("div",qs,[e("div",xs,[i[10]||(i[10]=e("span",{class:"config-label"},"路径:",-1)),e("span",Ms,f(n.value.orderRouteConfig.path),1)]),e("div",Ns,[i[11]||(i[11]=e("span",{class:"config-label"},"名称:",-1)),e("span",Ws,f(n.value.orderRouteConfig.name||"未设置"),1)]),e("div",Ts,[i[12]||(i[12]=e("span",{class:"config-label"},"标题:",-1)),e("span",zs,f(((z=n.value.orderRouteConfig.meta)==null?void 0:z.title)||"未设置"),1)]),e("div",Bs,[i[13]||(i[13]=e("span",{class:"config-label"},"需要认证:",-1)),e("span",{class:N(["config-value",{success:(B=n.value.orderRouteConfig.meta)==null?void 0:B.requiresAuth}])},f((I=n.value.orderRouteConfig.meta)!=null&&I.requiresAuth?"是":"否"),3)]),e("div",Is,[i[14]||(i[14]=e("span",{class:"config-label"},"权限要求:",-1)),e("span",Ls,f(((D=(L=n.value.orderRouteConfig.meta)==null?void 0:L.permissions)==null?void 0:D.join(", "))||"无"),1)])])])):V("",!0)]),s.value.errors.length>0?(u(),m("div",Ds,[i[17]||(i[17]=e("h3",null,"配置错误",-1)),e("div",Ss,[(u(!0),m(x,null,M(s.value.errors,(d,C)=>(u(),m("div",{key:C,class:"error-item"},[a(p,null,{default:c(()=>[a(w(F))]),_:1}),e("span",null,f(d),1)]))),128))])])):V("",!0),s.value.warnings.length>0?(u(),m("div",Us,[i[18]||(i[18]=e("h3",null,"配置警告",-1)),e("div",js,[(u(!0),m(x,null,M(s.value.warnings,(d,C)=>(u(),m("div",{key:C,class:"warning-item"},[a(p,null,{default:c(()=>[a(w(ns))]),_:1}),e("span",null,f(d),1)]))),128))])])):V("",!0),n.value.issues.length>0?(u(),m("div",Fs,[i[19]||(i[19]=e("h3",null,"订单路由问题",-1)),e("div",Es,[(u(!0),m(x,null,M(n.value.issues,(d,C)=>(u(),m("div",{key:C,class:"issue-item"},[a(p,null,{default:c(()=>[a(w(os))]),_:1}),e("span",null,f(d),1)]))),128))])])):V("",!0),e("div",Zs,[i[20]||(i[20]=e("h3",null,"路由配置详情",-1)),a(K,{data:l.value,style:{width:"100%"},"max-height":"400"},{default:c(()=>[a(b,{prop:"path",label:"路径",width:"200"}),a(b,{prop:"name",label:"名称",width:"150"}),a(b,{prop:"title",label:"标题",width:"120"}),a(b,{prop:"component",label:"组件",width:"150"}),a(b,{prop:"requiresAuth",label:"需要认证",width:"100"},{default:c(({row:d})=>[a(A,{type:d.requiresAuth?"success":"info",size:"small"},{default:c(()=>[O(f(d.requiresAuth?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),a(b,{prop:"permissions",label:"权限要求","min-width":"200"},{default:c(({row:d})=>[(u(!0),m(x,null,M(d.permissions,C=>(u(),q(A,{key:C,size:"small",style:{"margin-right":"4px"}},{default:c(()=>[O(f(C),1)]),_:2},1024))),128)),!d.permissions||d.permissions.length===0?(u(),m("span",Hs,"无")):V("",!0)]),_:1})]),_:1},8,["data"])]),e("div",Js,[i[21]||(i[21]=e("h3",null,"路由跳转测试",-1)),e("div",Ks,[(u(),m(x,null,M(r,d=>a(g,{key:d.path,type:d.type,onClick:C=>_(d.path)},{default:c(()=>[O(f(d.label),1)]),_:2},1032,["type","onClick"])),64))])])])}}}),st=as(Qs,[["__scopeId","data-v-57f8bb53"]]);export{st as default};
