var et=Object.defineProperty;var tt=(r,a,i)=>a in r?et(r,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[a]=i;var ne=(r,a,i)=>tt(r,typeof a!="symbol"?a+"":a,i);var c=(r,a,i)=>new Promise((f,d)=>{var w=R=>{try{S(i.next(R))}catch(V){d(V)}},m=R=>{try{S(i.throw(R))}catch(V){d(V)}},S=R=>R.done?f(R.value):Promise.resolve(R.value).then(w,m);S((i=i.apply(r,a)).next())});import{b as oe,o as pe,j as Me}from"./element-plus-B_LAMX2W.js";/* empty css                                                                     */import{C as he}from"./CountUp-DhNxH7hh.js";/* empty css                                                                  *//* empty css                                                                  */import{i as ce}from"./charts-4xgvsrqt.js";/* empty css                                                                       *//* empty css                                                                         */import{x as Ue,c as Z,r as _,j as at,S as ke,al as T,H as _e,z as X,I as h,y as ee,K as le,A as e,O as p,Q as o,M as A,D as st,n as de,X as K,h as nt,ar as lt,u as x,J as ot,P as it,a6 as rt}from"./vue-C2NPAEWw.js";import{_ as Le}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as z}from"./config-Da9KhdDy.js";import"./utils-T70AYnHr.js";const ct={key:0,class:"device-detail-content"},dt={class:"detail-section"},ut={class:"info-grid"},vt={class:"info-item"},pt={class:"value"},ht={class:"info-item"},mt={class:"info-item"},gt={class:"info-item"},yt={class:"value"},ft={class:"info-item"},_t={class:"value"},Dt={class:"info-item"},bt={class:"value"},wt={class:"info-item"},Rt={class:"value"},St={class:"info-item"},$t={class:"value"},zt={key:0,class:"info-item"},Ct={key:1,class:"info-item"},xt={class:"value"},Tt={key:2,class:"info-item"},At={class:"value"},Mt={key:3,class:"info-item"},Ut={class:"detail-section"},kt={class:"metrics-grid"},Lt={class:"metric-card"},Ot={class:"metric-value"},Vt={class:"metric-text"},Pt={class:"metric-card"},Et={class:"metric-value"},Nt={class:"metric-text"},Xt={class:"metric-card"},Yt={class:"metric-value"},It={class:"detail-section"},Ft={class:"detail-section"},Bt={class:"dialog-footer"},Gt=Ue({__name:"DeviceDetailDialog",props:{modelValue:{type:Boolean},deviceData:{}},emits:["update:modelValue"],setup(r,{emit:a}){const i=r,f=a,d=Z({get:()=>i.modelValue,set:n=>f("update:modelValue",n)}),w=_();let m=null;const S=_([{rentalDate:"2024-01-15",customerName:"张三",rentalDays:7,revenue:2800,status:"已完成"},{rentalDate:"2024-01-08",customerName:"李四",rentalDays:14,revenue:5600,status:"已完成"},{rentalDate:"2024-01-01",customerName:"王五",rentalDays:3,revenue:1200,status:"已完成"},{rentalDate:"2023-12-28",customerName:"赵六",rentalDays:10,revenue:4e3,status:"已完成"}]),R=n=>({"YX-Robot-Pro":"danger","YX-Robot-Standard":"primary","YX-Robot-Lite":"success","YX-Robot-Mini":"warning"})[n]||"info",V=n=>({active:"success",idle:"warning",maintenance:"info"})[n]||"info",Y=n=>({active:"运行中",idle:"空闲",maintenance:"维护中"})[n]||n,B=n=>({normal:"success",warning:"warning",urgent:"danger"})[n]||"info",te=n=>({normal:"正常",warning:"需关注",urgent:"需维护"})[n]||n,W=n=>n>=90?"#67c23a":n>=70?"#e6a23c":n>=50?"#f56c6c":"#909399",ae=n=>n>=80?"#67c23a":n>=60?"#e6a23c":n>=40?"#f56c6c":"#909399",I=n=>({"5G":"danger","4G":"primary",WiFi:"success",Ethernet:"warning"})[n]||"info",G=n=>n>=80?"risk-high":n>=50?"risk-medium":"risk-low",j=()=>c(null,null,function*(){var P;if(yield de(),!w.value)return;m=ce(w.value);const n=[],s=[],$=new Date;for(let H=29;H>=0;H--){const E=new Date($);E.setDate(E.getDate()-H),n.push(`${E.getMonth()+1}/${E.getDate()}`);const N=((P=i.deviceData)==null?void 0:P.utilizationRate)||75,U=(Math.random()-.5)*20,q=Math.max(0,Math.min(100,N+U));s.push(Math.round(q))}const L={tooltip:{trigger:"axis",formatter:"{b}: {c}%"},grid:{left:"3%",right:"4%",bottom:"3%",top:"10%",containLabel:!0},xAxis:{type:"category",data:n,axisLabel:{fontSize:11}},yAxis:{type:"value",max:100,axisLabel:{formatter:"{value}%"}},series:[{name:"利用率",type:"line",data:s,smooth:!0,itemStyle:{color:"#409eff"},lineStyle:{width:2},areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}]}}}]};m.setOption(L)});at(d,n=>{n&&i.deviceData&&de(()=>{j()})});const F=()=>{d.value=!1,m&&(m.dispose(),m=null)},M=()=>{console.log("导出设备详情:",i.deviceData)};return ke(()=>{m&&(m.dispose(),m=null)}),(n,s)=>{const $=T("el-tag"),L=T("el-progress"),P=T("el-table-column"),H=T("el-table"),E=T("el-button"),N=T("el-dialog");return X(),_e(N,{modelValue:d.value,"onUpdate:modelValue":s[0]||(s[0]=U=>d.value=U),title:"设备详情",width:"800px","before-close":F,class:"device-detail-dialog"},{footer:h(()=>[e("div",Bt,[o(E,{onClick:F},{default:h(()=>s[20]||(s[20]=[A("关闭",-1)])),_:1,__:[20]}),o(E,{type:"primary",onClick:M},{default:h(()=>s[21]||(s[21]=[A("导出详情",-1)])),_:1,__:[21]})])]),default:h(()=>[n.deviceData?(X(),ee("div",ct,[e("div",dt,[s[13]||(s[13]=e("h3",{class:"section-title"},"基本信息",-1)),e("div",ut,[e("div",vt,[s[1]||(s[1]=e("span",{class:"label"},"设备ID:",-1)),e("span",pt,p(n.deviceData.deviceId),1)]),e("div",ht,[s[2]||(s[2]=e("span",{class:"label"},"设备型号:",-1)),o($,{type:R(n.deviceData.deviceModel),size:"small"},{default:h(()=>[A(p(n.deviceData.deviceModel),1)]),_:1},8,["type"])]),e("div",mt,[s[3]||(s[3]=e("span",{class:"label"},"当前状态:",-1)),o($,{type:V(n.deviceData.currentStatus),size:"small"},{default:h(()=>[A(p(Y(n.deviceData.currentStatus)),1)]),_:1},8,["type"])]),e("div",gt,[s[4]||(s[4]=e("span",{class:"label"},"利用率:",-1)),e("span",yt,p(n.deviceData.utilizationRate)+"%",1)]),e("div",ft,[s[5]||(s[5]=e("span",{class:"label"},"租赁天数:",-1)),e("span",_t,p(n.deviceData.totalRentalDays)+"天",1)]),e("div",Dt,[s[6]||(s[6]=e("span",{class:"label"},"可用天数:",-1)),e("span",bt,p(n.deviceData.totalAvailableDays)+"天",1)]),e("div",wt,[s[7]||(s[7]=e("span",{class:"label"},"最后租赁:",-1)),e("span",Rt,p(n.deviceData.lastRentalDate||"暂无"),1)]),e("div",St,[s[8]||(s[8]=e("span",{class:"label"},"所在地区:",-1)),e("span",$t,p(n.deviceData.region||"未知"),1)]),n.deviceData.networkType?(X(),ee("div",zt,[s[9]||(s[9]=e("span",{class:"label"},"网络类型:",-1)),o($,{type:I(n.deviceData.networkType),size:"small"},{default:h(()=>[A(p(n.deviceData.networkType),1)]),_:1},8,["type"])])):le("",!0),n.deviceData.lastMaintenanceDate?(X(),ee("div",Ct,[s[10]||(s[10]=e("span",{class:"label"},"最后维护:",-1)),e("span",xt,p(n.deviceData.lastMaintenanceDate),1)])):le("",!0),n.deviceData.nextMaintenanceDate?(X(),ee("div",Tt,[s[11]||(s[11]=e("span",{class:"label"},"下次维护:",-1)),e("span",At,p(n.deviceData.nextMaintenanceDate),1)])):le("",!0),n.deviceData.predictedFailureRisk!==void 0?(X(),ee("div",Mt,[s[12]||(s[12]=e("span",{class:"label"},"故障风险:",-1)),e("span",{class:st(["value",G(n.deviceData.predictedFailureRisk)])},p(n.deviceData.predictedFailureRisk)+"% ",3)])):le("",!0)])]),e("div",Ut,[s[17]||(s[17]=e("h3",{class:"section-title"},"性能指标",-1)),e("div",kt,[e("div",Lt,[s[14]||(s[14]=e("div",{class:"metric-title"},"设备健康度",-1)),e("div",Ot,[o(L,{percentage:n.deviceData.performanceScore||85,color:W(n.deviceData.performanceScore||85),"stroke-width":8},null,8,["percentage","color"]),e("span",Vt,p(n.deviceData.performanceScore||85)+"分",1)])]),e("div",Pt,[s[15]||(s[15]=e("div",{class:"metric-title"},"信号强度",-1)),e("div",Et,[o(L,{percentage:n.deviceData.signalStrength||78,color:ae(n.deviceData.signalStrength||78),"stroke-width":8},null,8,["percentage","color"]),e("span",Nt,p(n.deviceData.signalStrength||78)+"%",1)])]),e("div",Xt,[s[16]||(s[16]=e("div",{class:"metric-title"},"维护状态",-1)),e("div",Yt,[o($,{type:B(n.deviceData.maintenanceStatus||"normal"),size:"large"},{default:h(()=>[A(p(te(n.deviceData.maintenanceStatus||"normal")),1)]),_:1},8,["type"])])])])]),e("div",It,[s[18]||(s[18]=e("h3",{class:"section-title"},"利用率趋势（最近30天）",-1)),e("div",{ref_key:"utilizationTrendChart",ref:w,class:"trend-chart"},null,512)]),e("div",Ft,[s[19]||(s[19]=e("h3",{class:"section-title"},"最近租赁记录",-1)),o(H,{data:S.value,size:"small","max-height":"200"},{default:h(()=>[o(P,{prop:"rentalDate",label:"租赁日期",width:"100"}),o(P,{prop:"customerName",label:"客户",width:"120"}),o(P,{prop:"rentalDays",label:"租赁天数",width:"80",align:"center"}),o(P,{prop:"revenue",label:"收入",width:"100",align:"right"},{default:h(({row:U})=>[A(" ¥"+p(U.revenue.toLocaleString()),1)]),_:1}),o(P,{prop:"status",label:"状态",width:"80",align:"center"},{default:h(({row:U})=>[o($,{type:U.status==="已完成"?"success":"warning",size:"small"},{default:h(()=>[A(p(U.status),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])])):le("",!0)]),_:1},8,["modelValue"])}}}),jt=Le(Gt,[["__scopeId","data-v-a0fb2222"]]),Ht=()=>z.get("/api/rental/stats"),Kt=r=>z.get("/api/rental/trend",{params:r}),Wt=r=>z.get("/api/rental/device-utilization",{params:r}),qt=r=>z.get("/api/rental/orders",{params:r}),Jt=r=>z.get("/api/rental/revenue-analysis",{params:r}),Qt=r=>z.post("/api/rental/orders",r),Zt=(r,a)=>z.put(`/api/rental/orders/${r}`,a),ea=r=>z.delete(`/api/rental/orders/${r}`),ta=()=>z.get("/api/rental/today-stats"),aa=()=>z.get("/api/rental/device-status-stats"),sa=(r=5)=>z.get("/api/rental/top-devices",{params:{limit:r}}),na=r=>z.get("/api/rental/export",{params:r,responseType:"blob"}),la=r=>z.get("/api/rental/devices",{params:r}),oa=r=>z.post("/api/rental/devices",r),ia=(r,a)=>z.put(`/api/rental/devices/${r}`,a),ra=r=>z.delete(`/api/rental/devices/${r}`),ca=r=>z.get("/api/rental/customers",{params:r}),da=r=>z.post("/api/rental/customers",r),ua=(r,a)=>z.put(`/api/rental/customers/${r}`,a),va=r=>z.delete(`/api/rental/customers/${r}`),se=class se{constructor(){ne(this,"retryCount",3);ne(this,"retryDelay",1e3);ne(this,"cache",new Map);ne(this,"defaultTTL",300*1e3)}static getInstance(){return se.instance||(se.instance=new se),se.instance}withRetry(f){return c(this,arguments,function*(a,i=this.retryCount){try{const d=yield a();if(d.code===200)return d.data;throw new Error(d.message||"API调用失败")}catch(d){if(i>0&&this.shouldRetry(d))return console.warn(`API调用失败，${this.retryDelay}ms后重试，剩余重试次数: ${i}`),yield this.delay(this.retryDelay),this.withRetry(a,i-1);throw this.formatError(d)}})}shouldRetry(a){var i;return a.code==="NETWORK_ERROR"||((i=a.response)==null?void 0:i.status)>=500||a.code==="TIMEOUT"}delay(a){return new Promise(i=>setTimeout(i,a))}formatError(a){var i,f,d,w,m;return{code:((i=a.response)==null?void 0:i.status)||a.code||500,message:((d=(f=a.response)==null?void 0:f.data)==null?void 0:d.message)||a.message||"未知错误",details:((m=(w=a.response)==null?void 0:w.data)==null?void 0:m.details)||a.stack,timestamp:Date.now()}}getRentalStats(){return c(this,null,function*(){return this.withRetry(()=>Ht())})}getTodayStats(){return c(this,null,function*(){return this.withRetry(()=>ta())})}getDeviceStatusStats(){return c(this,null,function*(){return this.withRetry(()=>aa())})}getTopDevices(a=5){return c(this,null,function*(){return this.withRetry(()=>sa(a))})}getRentalTrendData(a){return c(this,null,function*(){return this.withRetry(()=>Kt(a))})}getDeviceUtilizationData(a){return c(this,null,function*(){return this.withRetry(()=>Wt(a))})}getRentalRevenueAnalysis(a){return c(this,null,function*(){return this.withRetry(()=>Jt(a))})}getRentalOrders(a){return c(this,null,function*(){return this.withRetry(()=>qt(a))})}createRentalOrder(a){return c(this,null,function*(){return this.withRetry(()=>Qt(a))})}updateRentalOrder(a,i){return c(this,null,function*(){return this.withRetry(()=>Zt(a,i))})}deleteRentalOrder(a){return c(this,null,function*(){return this.withRetry(()=>ea(a))})}getRentalDevices(a){return c(this,null,function*(){return this.withRetry(()=>la(a))})}createRentalDevice(a){return c(this,null,function*(){return this.withRetry(()=>oa(a))})}updateRentalDevice(a,i){return c(this,null,function*(){return this.withRetry(()=>ia(a,i))})}deleteRentalDevice(a){return c(this,null,function*(){return this.withRetry(()=>ra(a))})}getRentalCustomers(a){return c(this,null,function*(){return this.withRetry(()=>ca(a))})}createRentalCustomer(a){return c(this,null,function*(){return this.withRetry(()=>da(a))})}updateRentalCustomer(a,i){return c(this,null,function*(){return this.withRetry(()=>ua(a,i))})}deleteRentalCustomer(a){return c(this,null,function*(){return this.withRetry(()=>va(a))})}exportRentalReport(a){return c(this,null,function*(){try{return yield na(a)}catch(i){throw this.formatError(i)}})}loadDashboardData(){return c(this,null,function*(){try{const[a,i,f,d]=yield Promise.all([this.getRentalStats(),this.getTodayStats(),this.getDeviceStatusStats(),this.getTopDevices(5)]);return{stats:a,todayStats:i,deviceStatusStats:f,topDevices:d}}catch(a){throw this.formatError(a)}})}loadChartData(a="monthly"){return c(this,null,function*(){try{const[i,f,d]=yield Promise.all([this.getRentalTrendData({period:a}),this.getDeviceUtilizationData(),this.getRentalRevenueAnalysis({period:"monthly"})]);return{trendData:i,deviceData:f,revenueAnalysis:d}}catch(i){throw this.formatError(i)}})}withCache(d,w){return c(this,arguments,function*(a,i,f=this.defaultTTL){const m=this.cache.get(a),S=Date.now();if(m&&S-m.timestamp<m.ttl)return console.log(`使用缓存数据: ${a}`),m.data;try{const R=yield i();return this.cache.set(a,{data:R,timestamp:S,ttl:f}),console.log(`缓存数据: ${a}`),R}catch(R){if(m)return console.warn(`API调用失败，使用过期缓存: ${a}`),m.data;throw R}})}clearCache(a){a?this.cache.delete(a):this.cache.clear()}};ne(se,"instance");let De=se;const O=De.getInstance();function pa(){const r=K({loading:!1,error:null,lastUpdated:null}),a=K({loading:!1,error:null,lastUpdated:null}),i=K({loading:!1,error:null,lastUpdated:null}),f=K({loading:!1,error:null,lastUpdated:null}),d=K({loading:!1,error:null,lastUpdated:null}),w=K({loading:!1,error:null,lastUpdated:null}),m=K({loading:!1,error:null,lastUpdated:null}),S=K({loading:!1,error:null,lastUpdated:null}),R=K({loading:!1,error:null,lastUpdated:null}),V=_(null),Y=_(null),B=_(null),te=_([]),W=_([]),ae=_([]),I=_(null),G=_(null),j=_(null),F=_(null),M=Z(()=>r.loading||a.loading||i.loading||f.loading||d.loading||w.loading||m.loading||S.loading||R.loading),n=Z(()=>r.error||a.error||i.error||f.error||d.error||w.error||m.error||S.error||R.error);function s(u,g,C,fe=!0){return c(this,null,function*(){u.loading=!0,u.error=null;try{const J=yield g();return u.lastUpdated=Date.now(),C==null||C(J),J}catch(J){return u.error=J,fe&&oe.error(J.message||"API调用失败"),console.error("API调用失败:",J),null}finally{u.loading=!1}})}function $(u=!0){return c(this,null,function*(){return s(r,()=>O.getRentalStats(),g=>{V.value=g},u)})}function L(u=!0){return c(this,null,function*(){return s(a,()=>O.getTodayStats(),g=>{Y.value=g},u)})}function P(u=!0){return c(this,null,function*(){return s(i,()=>O.getDeviceStatusStats(),g=>{B.value=g},u)})}function H(u=5,g=!0){return c(this,null,function*(){return s(i,()=>O.getTopDevices(u),C=>{te.value=C},g)})}function E(u,g=!0){return c(this,null,function*(){return s(f,()=>O.getRentalTrendData(u),C=>{W.value=C},g)})}function N(u,g=!0){return c(this,null,function*(){return s(d,()=>O.getDeviceUtilizationData(u),C=>{ae.value=C},g)})}function U(u,g=!0){return c(this,null,function*(){return s(w,()=>O.getRentalRevenueAnalysis(u),C=>{I.value=C},g)})}function q(u,g=!0){return c(this,null,function*(){return s(m,()=>O.getRentalOrders(u),C=>{G.value=C},g)})}function me(u,g=!0){return c(this,null,function*(){return s(S,()=>O.getRentalDevices(u),C=>{j.value=C},g)})}function ge(u,g=!0){return c(this,null,function*(){return s(R,()=>O.getRentalCustomers(u),C=>{F.value=C},g)})}function ue(){return c(this,null,function*(){try{const u=yield O.loadDashboardData();return V.value=u.stats,Y.value=u.todayStats,B.value=u.deviceStatusStats,te.value=u.topDevices,r.lastUpdated=Date.now(),a.lastUpdated=Date.now(),i.lastUpdated=Date.now(),u}catch(u){return oe.error("仪表板数据加载失败"),console.error("仪表板数据加载失败:",u),null}})}function ve(u="monthly"){return c(this,null,function*(){try{const g=yield O.loadChartData(u);return W.value=g.trendData,ae.value=g.deviceData,I.value=g.revenueAnalysis,f.lastUpdated=Date.now(),d.lastUpdated=Date.now(),w.lastUpdated=Date.now(),g}catch(g){return oe.error("图表数据加载失败"),console.error("图表数据加载失败:",g),null}})}function ie(){return c(this,null,function*(){O.clearCache(),yield Promise.all([ue(),ve()])})}function ye(){r.error=null,a.error=null,i.error=null,f.error=null,d.error=null,w.error=null,m.error=null,S.error=null,R.error=null}return{statsState:r,todayStatsState:a,deviceStatusStatsState:i,trendDataState:f,deviceDataState:d,revenueAnalysisState:w,ordersState:m,devicesState:S,customersState:R,isAnyLoading:M,hasAnyError:n,rentalStats:V,todayStats:Y,deviceStatusStats:B,topDevices:te,trendData:W,deviceData:ae,revenueAnalysis:I,orders:G,devices:j,customers:F,fetchRentalStats:$,fetchTodayStats:L,fetchDeviceStatusStats:P,fetchTopDevices:H,fetchTrendData:E,fetchDeviceData:N,fetchRevenueAnalysis:U,fetchOrders:q,fetchDevices:me,fetchCustomers:ge,loadDashboardData:ue,loadChartData:ve,refreshAllData:ie,clearErrors:ye}}const ha={class:"rental-analytics"},ma={class:"metrics-cards"},ga={class:"metric-card revenue-card"},ya={class:"card-content"},fa={class:"card-value"},_a={class:"card-change positive"},Da={class:"change-text"},ba={class:"metric-card devices-card"},wa={class:"card-content"},Ra={class:"card-value"},Sa={class:"card-change positive"},$a={class:"change-text"},za={class:"metric-card utilization-card"},Ca={class:"card-content"},xa={class:"card-value"},Ta={class:"card-change positive"},Aa={class:"metric-card period-card"},Ma={class:"card-content"},Ua={class:"card-value"},ka={class:"card-change positive"},La={class:"main-content"},Oa={class:"left-content"},Va={class:"charts-section"},Pa={class:"charts-row"},Ea={class:"chart-card rental-trend-card"},Na={class:"chart-header"},Xa={class:"header-right"},Ya={class:"chart-content"},Ia={class:"chart-card utilization-ranking-card"},Fa={class:"chart-content"},Ba={class:"charts-row"},Ga={class:"chart-card region-distribution-card"},ja={class:"chart-content"},Ha={class:"chart-card device-model-card"},Ka={class:"chart-content"},Wa={class:"device-utilization-section"},qa={class:"table-controls"},Ja={class:"controls-left"},Qa={class:"controls-right"},Za={class:"utilization-cell"},es={class:"rate-text"},ts={class:"empty-state"},as={class:"empty-description"},ss={class:"pagination-wrapper"},ns={class:"right-sidebar"},ls={class:"sidebar-card"},os={class:"card-content"},is={class:"overview-item"},rs={class:"value"},cs={class:"overview-item"},ds={class:"value"},us={class:"overview-item"},vs={class:"value"},ps={class:"overview-item"},hs={class:"value"},ms={class:"sidebar-card"},gs={class:"card-content"},ys={class:"status-item"},fs={class:"count"},_s={class:"status-item"},Ds={class:"count"},bs={class:"status-item"},ws={class:"count"},Rs={class:"sidebar-card"},Ss={class:"card-content"},$s={class:"rank"},zs={class:"device-info"},Cs={class:"device-id"},xs={class:"device-model"},Ts={class:"utilization"},As=Ue({__name:"RentalAnalytics",setup(r){_(["2024-01-01","2024-01-31"]),_(!1);const a=_(!1),i=_("monthly"),f=_(""),d=_(""),w=_(""),m=_(1),S=_(20),R=_(!1),V=_(null),Y=Z(()=>P.value||{revenue:45680,orders:23,activeDevices:198,avgUtilization:78.5}),B=Z(()=>H.value||{active:198,idle:67,maintenance:20}),te=Z(()=>E.value||[]),W=Z(()=>{let l=U.value;if(f.value&&(l=l.filter(t=>t.deviceModel===f.value)),d.value&&(l=l.filter(t=>t.currentStatus===d.value)),w.value){const t=w.value.toLowerCase();l=l.filter(D=>D.deviceId.toLowerCase().includes(t)||D.deviceModel.toLowerCase().includes(t))}return l}),ae=Z(()=>{const l=(m.value-1)*S.value,t=l+S.value;return W.value.slice(l,t)}),I=_(),G=_(),j=_(),F=_();let M=null,n=null,s=null,$=null;const{rentalStats:L,todayStats:P,deviceStatusStats:H,topDevices:E,trendData:N,deviceData:U,revenueAnalysis:q,loadDashboardData:me,loadChartData:ge,fetchTrendData:ue,fetchDeviceData:ve}=pa();let ie=null;const ye=()=>{ie&&clearTimeout(ie),ie=setTimeout(()=>{g()},300)},u=()=>c(null,null,function*(){try{yield ue({period:i.value}),be()}catch(l){console.error("❌ 加载趋势数据失败:",l),oe.warning("趋势数据加载失败")}}),g=()=>c(null,null,function*(){try{a.value=!0;const l={};f.value&&(l.deviceModel=f.value),d.value&&(l.status=d.value),w.value&&(l.keyword=w.value),yield ve(l),console.log("🔧 设备数据筛选加载成功"),m.value=1}catch(l){console.error("❌ 加载设备数据失败:",l),oe.error("设备数据加载失败")}finally{a.value=!1}}),C=()=>c(null,null,function*(){console.log("🔄 开始加载租赁分析数据...");try{a.value=!0,yield Promise.all([me(),ge(i.value)]),console.log("✅ 租赁分析数据加载完成")}catch(l){console.error("❌ 加载数据失败:",l),oe.error("数据加载失败，请检查网络连接或稍后重试")}finally{a.value=!1}yield de();try{We(),console.log("✅ 图表更新完成")}catch(l){console.error("❌ 图表更新失败:",l)}}),fe=l=>l>=80?"#67c23a":l>=60?"#e6a23c":l>=40?"#f56c6c":"#909399",J=l=>({active:"success",idle:"warning",maintenance:"info"})[l]||"info",Oe=l=>({active:"运行中",idle:"空闲",maintenance:"维护中"})[l]||l,Ve=l=>({"YX-Robot-Pro":"danger","YX-Robot-Standard":"primary","YX-Robot-Lite":"success","YX-Robot-Mini":"warning"})[l]||"info",Pe=l=>{S.value=l,m.value=1},Ee=l=>{m.value=l},Ne=l=>{console.log("查看设备详情:",l),V.value=l,R.value=!0},Xe=()=>{w.value="",f.value="",d.value="",g()},Ye=()=>{if(!I.value)return;M=ce(I.value);const l={tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(t){let D=`${t[0].name}<br/>`;return t.forEach(v=>{v.seriesName==="租赁收入"?D+=`${v.seriesName}: ¥${v.value.toLocaleString()}<br/>`:v.seriesName==="订单数量"?D+=`${v.seriesName}: ${v.value}个<br/>`:D+=`${v.seriesName}: ${v.value}%<br/>`}),D}},legend:{data:["租赁收入","订单数量","设备利用率"],top:10},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:[],axisLabel:{rotate:45,fontSize:11}},yAxis:[{type:"value",name:"收入(元)",position:"left",axisLabel:{formatter:function(t){return t>=1e4?(t/1e4).toFixed(1)+"w":t.toString()}}},{type:"value",name:"订单数/利用率",position:"right",max:100}],series:[{name:"租赁收入",type:"line",yAxisIndex:0,data:[],smooth:!0,itemStyle:{color:"#5470c6"},lineStyle:{width:3}},{name:"订单数量",type:"bar",yAxisIndex:1,data:[],itemStyle:{color:"#91cc75",opacity:.8}},{name:"设备利用率",type:"line",yAxisIndex:1,data:[],smooth:!0,itemStyle:{color:"#fac858"},lineStyle:{width:2,type:"dashed"}}]};M.setOption(l)},be=()=>{if(!M||!N.value.length)return;const l=N.value.map(b=>{const Q=new Date(b.date);return`${Q.getMonth()+1}/${Q.getDate()}`}),t=N.value.map(b=>b.revenue),D=N.value.map(b=>b.orderCount),v=N.value.map(b=>b.utilizationRate);M.setOption({xAxis:{data:l},series:[{data:t},{data:D},{data:v}]})},Ie=()=>{if(!G.value)return;n=ce(G.value);const l={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(t){const D=t[0];return`${D.name}<br/>利用率: ${D.value}%`}},grid:{left:"25%",right:"8%",bottom:"3%",top:"3%",containLabel:!1},xAxis:{type:"value",max:100,axisLabel:{formatter:"{value}%"}},yAxis:{type:"category",data:[],axisLabel:{fontSize:11,width:120,overflow:"truncate"}},series:[{name:"利用率",type:"bar",data:[],barWidth:"60%",itemStyle:{borderRadius:[0,4,4,0]},label:{show:!0,position:"right",formatter:"{c}%",fontSize:11}}]};n.setOption(l)},Fe=()=>{if(!j.value)return;s=ce(j.value);const l={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"地区分布",type:"pie",radius:["40%","70%"],center:["60%","50%"],data:[],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:!0,formatter:"{b}: {c}"}}],color:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272"]};s.setOption(l)},Be=()=>{if(!F.value)return;$=ce(F.value);const l={tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["租赁数量","收入贡献"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:[{type:"value",name:"数量",position:"left"},{type:"value",name:"收入(万元)",position:"right"}],series:[{name:"租赁数量",type:"bar",yAxisIndex:0,data:[],itemStyle:{color:"#5470c6"}},{name:"收入贡献",type:"line",yAxisIndex:1,data:[],smooth:!0,itemStyle:{color:"#91cc75"}}]};$.setOption(l)},Ge=()=>{if(!n||!U.value.length)return;const l=U.value.sort((v,b)=>b.utilizationRate-v.utilizationRate).slice(0,12),t=l.map(v=>`${v.deviceId} (${v.deviceModel})`),D=l.map(v=>v.utilizationRate);n.setOption({yAxis:{data:t,axisLabel:{fontSize:11,width:120,overflow:"truncate"}},series:[{data:D,itemStyle:{color:function(v){const b=v.value;return b>=85?"#52c41a":b>=70?"#1890ff":b>=50?"#faad14":"#f5222d"}}}]})},je=()=>{if(!s||!q.value)return;const l=q.value.regionDistribution.map(t=>({name:t.region,value:t.deviceCount,revenue:t.revenue,orderCount:t.orderCount}));s.setOption({tooltip:{trigger:"item",formatter:function(t){const D=t.data;return`${t.name}<br/>
                设备数量: ${D.value}台<br/>
                租赁收入: ¥${(D.revenue/1e4).toFixed(1)}万<br/>
                订单数量: ${D.orderCount}个<br/>
                占比: ${t.percent}%`}},series:[{data:l,label:{show:!0,formatter:"{b}: {c}台"}}]})},He=()=>{if(!$||!q.value)return;const l=q.value.topPerformingDevices,t=l.map(b=>b.deviceModel),D=l.map(b=>b.orderCount),v=l.map(b=>Math.round(b.revenue/1e4));$.setOption({tooltip:{trigger:"axis",axisPointer:{type:"cross"},formatter:function(b){let Q=`${b[0].name}<br/>`;return b.forEach(k=>{k.seriesName==="订单数量"?Q+=`${k.seriesName}: ${k.value}个<br/>`:Q+=`${k.seriesName}: ${k.value}万元<br/>`}),Q}},xAxis:{data:t,axisLabel:{rotate:15,fontSize:11}},series:[{name:"订单数量",data:D,itemStyle:{color:"#5470c6"}},{name:"收入贡献",data:v,itemStyle:{color:"#91cc75"}}]})},Ke=()=>c(null,null,function*(){yield de();try{console.log("📊 开始初始化图表..."),I.value?(Ye(),console.log("✅ 租赁趋势图表初始化完成")):console.warn("⚠️ 租赁趋势图表DOM元素未找到"),G.value?(Ie(),console.log("✅ 设备利用率排行图表初始化完成")):console.warn("⚠️ 设备利用率排行图表DOM元素未找到"),j.value?(Fe(),console.log("✅ 地区分布图表初始化完成")):console.warn("⚠️ 地区分布图表DOM元素未找到"),F.value?(Be(),console.log("✅ 设备型号分析图表初始化完成")):console.warn("⚠️ 设备型号分析图表DOM元素未找到"),console.log("📊 所有图表初始化完成")}catch(l){console.error("❌ 图表初始化过程中出错:",l)}}),We=()=>{try{console.log("📊 开始更新图表数据..."),be(),console.log("✅ 租赁趋势图表数据更新完成"),Ge(),console.log("✅ 设备利用率排行图表数据更新完成"),je(),console.log("✅ 地区分布图表数据更新完成"),He(),console.log("✅ 设备型号分析图表数据更新完成"),console.log("📊 所有图表数据更新完成")}catch(l){console.error("❌ 图表数据更新过程中出错:",l)}},we=()=>{M==null||M.resize(),n==null||n.resize(),s==null||s.resize(),$==null||$.resize()};return nt(()=>c(null,null,function*(){console.log("🚀 租赁分析页面开始初始化..."),yield de();try{Ke(),console.log("📊 图表初始化完成")}catch(l){console.error("❌ 图表初始化失败:",l)}yield C(),window.addEventListener("resize",we),console.log("✅ 租赁分析页面初始化完成")})),ke(()=>{M==null||M.dispose(),n==null||n.dispose(),s==null||s.dispose(),$==null||$.dispose(),window.removeEventListener("resize",we)}),(l,t)=>{var Se,$e,ze,Ce,xe,Te;const D=T("el-icon"),v=T("el-option"),b=T("el-select"),Q=T("el-input"),k=T("el-table-column"),re=T("el-tag"),qe=T("el-progress"),Re=T("el-button"),Je=T("el-table"),Qe=T("el-pagination"),Ze=lt("loading");return X(),ee("div",ha,[t[34]||(t[34]=e("div",{class:"page-header"},[e("div",{class:"header-left"},[e("h2",null,"租赁数据分析"),e("p",{class:"header-subtitle"},"租赁业务数据分析 · 练字机器人管理系统")])],-1)),e("div",ma,[e("div",ga,[e("div",ya,[t[8]||(t[8]=e("div",{class:"card-title"},"租赁总收入",-1)),e("div",fa,[t[7]||(t[7]=e("span",{class:"currency"},"¥",-1)),o(x(he),{value:((Se=x(L))==null?void 0:Se.totalRentalRevenue)||0,decimals:2,class:"value-number"},null,8,["value"])]),e("div",_a,[o(D,{class:"change-icon"},{default:h(()=>[o(x(pe))]),_:1}),e("span",Da,"+"+p((($e=x(L))==null?void 0:$e.revenueGrowthRate)||0)+"%",1)])])]),e("div",ba,[e("div",wa,[t[9]||(t[9]=e("div",{class:"card-title"},"租赁设备数",-1)),e("div",Ra,[o(x(he),{value:((ze=x(L))==null?void 0:ze.totalRentalDevices)||0,decimals:0,class:"value-number"},null,8,["value"])]),e("div",Sa,[o(D,{class:"change-icon"},{default:h(()=>[o(x(pe))]),_:1}),e("span",$a,"+"+p(((Ce=x(L))==null?void 0:Ce.deviceGrowthRate)||0)+"%",1)])])]),e("div",za,[e("div",Ca,[t[12]||(t[12]=e("div",{class:"card-title"},"设备利用率",-1)),e("div",xa,[o(x(he),{value:((xe=x(L))==null?void 0:xe.deviceUtilizationRate)||0,decimals:1,class:"value-number"},null,8,["value"]),t[10]||(t[10]=e("span",{class:"unit"},"%",-1))]),e("div",Ta,[o(D,{class:"change-icon"},{default:h(()=>[o(x(pe))]),_:1}),t[11]||(t[11]=e("span",{class:"change-text"},"+2.3%",-1))])])]),e("div",Aa,[e("div",Ma,[t[15]||(t[15]=e("div",{class:"card-title"},"平均租期",-1)),e("div",Ua,[o(x(he),{value:((Te=x(L))==null?void 0:Te.averageRentalPeriod)||0,decimals:0,class:"value-number"},null,8,["value"]),t[13]||(t[13]=e("span",{class:"unit"},"天",-1))]),e("div",ka,[o(D,{class:"change-icon"},{default:h(()=>[o(x(pe))]),_:1}),t[14]||(t[14]=e("span",{class:"change-text"},"+1.8天",-1))])])])]),e("div",La,[e("div",Oa,[e("div",Va,[e("div",Pa,[e("div",Ea,[e("div",Na,[t[16]||(t[16]=e("div",{class:"header-left"},[e("h3",{class:"chart-title"},"租赁趋势分析"),e("p",{class:"chart-subtitle"},"租赁收入和订单数量趋势")],-1)),e("div",Xa,[o(b,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=y=>i.value=y),onChange:u,size:"small"},{default:h(()=>[o(v,{label:"最近7天",value:"daily"}),o(v,{label:"最近4周",value:"weekly"}),o(v,{label:"最近12月",value:"monthly"}),o(v,{label:"最近4季度",value:"quarterly"})]),_:1},8,["modelValue"])])]),e("div",Ya,[e("div",{ref_key:"rentalTrendChart",ref:I,class:"chart-container",style:{height:"300px"}},null,512)])]),e("div",Ia,[t[17]||(t[17]=e("div",{class:"chart-header"},[e("div",{class:"header-left"},[e("h3",{class:"chart-title"},"设备利用率排行"),e("p",{class:"chart-subtitle"},"各设备利用率对比")])],-1)),e("div",Fa,[e("div",{ref_key:"utilizationRankingChart",ref:G,class:"chart-container",style:{height:"300px"}},null,512)])])]),e("div",Ba,[e("div",Ga,[t[18]||(t[18]=e("div",{class:"chart-header"},[e("div",{class:"header-left"},[e("h3",{class:"chart-title"},"地区分布"),e("p",{class:"chart-subtitle"},"各地区租赁业务分布")])],-1)),e("div",ja,[e("div",{ref_key:"regionDistributionChart",ref:j,class:"chart-container",style:{height:"300px"}},null,512)])]),e("div",Ha,[t[19]||(t[19]=e("div",{class:"chart-header"},[e("div",{class:"header-left"},[e("h3",{class:"chart-title"},"设备型号分析"),e("p",{class:"chart-subtitle"},"各型号设备租赁表现")])],-1)),e("div",Ka,[e("div",{ref_key:"deviceModelChart",ref:F,class:"chart-container",style:{height:"300px"}},null,512)])])])]),e("div",Wa,[t[23]||(t[23]=e("div",{class:"section-header"},[e("h3",null,"设备利用率详情"),e("p",null,"各设备的详细利用率数据")],-1)),e("div",qa,[e("div",Ja,[o(b,{modelValue:f.value,"onUpdate:modelValue":t[1]||(t[1]=y=>f.value=y),placeholder:"设备型号",clearable:"",onChange:g},{default:h(()=>[o(v,{label:"全部型号",value:""}),o(v,{label:"YX-Robot-Pro",value:"YX-Robot-Pro"}),o(v,{label:"YX-Robot-Standard",value:"YX-Robot-Standard"}),o(v,{label:"YX-Robot-Lite",value:"YX-Robot-Lite"}),o(v,{label:"YX-Robot-Mini",value:"YX-Robot-Mini"})]),_:1},8,["modelValue"]),o(b,{modelValue:d.value,"onUpdate:modelValue":t[2]||(t[2]=y=>d.value=y),placeholder:"设备状态",clearable:"",onChange:g},{default:h(()=>[o(v,{label:"全部状态",value:""}),o(v,{label:"运行中",value:"active"}),o(v,{label:"空闲",value:"idle"}),o(v,{label:"维护中",value:"maintenance"})]),_:1},8,["modelValue"])]),e("div",Qa,[o(Q,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=y=>w.value=y),placeholder:"搜索设备ID","prefix-icon":x(Me),clearable:"",onInput:ye,style:{width:"200px"}},null,8,["modelValue","prefix-icon"])])]),ot((X(),_e(Je,{data:ae.value,stripe:"",height:"400"},{empty:h(()=>[e("div",ts,[o(D,{size:"48",color:"#c0c4cc"},{default:h(()=>[o(x(Me))]),_:1}),t[22]||(t[22]=e("p",{class:"empty-text"},"暂无设备数据",-1)),e("p",as,p(w.value||f.value||d.value?"请尝试调整筛选条件":"系统中暂无设备数据"),1),w.value||f.value||d.value?(X(),_e(Re,{key:0,type:"primary",onClick:Xe},{default:h(()=>t[21]||(t[21]=[A(" 清除筛选条件 ",-1)])),_:1,__:[21]})):le("",!0)])]),default:h(()=>[o(k,{prop:"deviceId",label:"设备ID",width:"120"}),o(k,{prop:"deviceModel",label:"设备型号",width:"150"},{default:h(({row:y})=>[o(re,{size:"small",type:Ve(y.deviceModel)},{default:h(()=>[A(p(y.deviceModel),1)]),_:2},1032,["type"])]),_:1}),o(k,{prop:"utilizationRate",label:"利用率",width:"140"},{default:h(({row:y})=>[e("div",Za,[e("span",es,p(y.utilizationRate)+"%",1),o(qe,{percentage:y.utilizationRate,"stroke-width":6,"show-text":!1,color:fe(y.utilizationRate)},null,8,["percentage","color"])])]),_:1}),o(k,{prop:"totalRentalDays",label:"租赁天数",width:"100",align:"center"}),o(k,{prop:"totalAvailableDays",label:"可用天数",width:"100",align:"center"}),o(k,{prop:"currentStatus",label:"当前状态",width:"100",align:"center"},{default:h(({row:y})=>[o(re,{type:J(y.currentStatus),size:"small"},{default:h(()=>[A(p(Oe(y.currentStatus)),1)]),_:2},1032,["type"])]),_:1}),o(k,{prop:"lastRentalDate",label:"最后租赁日期",width:"120",align:"center"},{default:h(({row:y})=>[A(p(y.lastRentalDate||"-"),1)]),_:1}),o(k,{label:"操作",width:"120",align:"center"},{default:h(({row:y})=>[o(Re,{text:"",type:"primary",size:"small",onClick:Ae=>Ne(y)},{default:h(()=>t[20]||(t[20]=[A(" 查看详情 ",-1)])),_:2,__:[20]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ze,a.value]]),e("div",ss,[o(Qe,{"current-page":m.value,"onUpdate:currentPage":t[4]||(t[4]=y=>m.value=y),"page-size":S.value,"onUpdate:pageSize":t[5]||(t[5]=y=>S.value=y),"page-sizes":[10,20,50,100],total:W.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Pe,onCurrentChange:Ee},null,8,["current-page","page-size","total"])])])]),e("div",ns,[e("div",ls,[t[28]||(t[28]=e("div",{class:"card-header"},[e("h4",null,"今日概览")],-1)),e("div",os,[e("div",is,[t[24]||(t[24]=e("span",{class:"label"},"今日收入",-1)),e("span",rs,"¥"+p(Y.value.revenue.toLocaleString()),1)]),e("div",cs,[t[25]||(t[25]=e("span",{class:"label"},"新增订单",-1)),e("span",ds,p(Y.value.orders)+"个",1)]),e("div",us,[t[26]||(t[26]=e("span",{class:"label"},"活跃设备",-1)),e("span",vs,p(Y.value.activeDevices)+"台",1)]),e("div",ps,[t[27]||(t[27]=e("span",{class:"label"},"平均利用率",-1)),e("span",hs,p(Y.value.avgUtilization)+"%",1)])])]),e("div",ms,[t[32]||(t[32]=e("div",{class:"card-header"},[e("h4",null,"设备状态")],-1)),e("div",gs,[e("div",ys,[o(re,{type:"success",size:"small"},{default:h(()=>t[29]||(t[29]=[A("运行中",-1)])),_:1,__:[29]}),e("span",fs,p(B.value.active)+"台",1)]),e("div",_s,[o(re,{type:"warning",size:"small"},{default:h(()=>t[30]||(t[30]=[A("空闲",-1)])),_:1,__:[30]}),e("span",Ds,p(B.value.idle)+"台",1)]),e("div",bs,[o(re,{type:"info",size:"small"},{default:h(()=>t[31]||(t[31]=[A("维护中",-1)])),_:1,__:[31]}),e("span",ws,p(B.value.maintenance)+"台",1)])])]),e("div",Rs,[t[33]||(t[33]=e("div",{class:"card-header"},[e("h4",null,"利用率TOP5")],-1)),e("div",Ss,[(X(!0),ee(it,null,rt(te.value,(y,Ae)=>(X(),ee("div",{key:y.deviceId,class:"ranking-item"},[e("div",$s,p(Ae+1),1),e("div",zs,[e("div",Cs,p(y.deviceId),1),e("div",xs,p(y.deviceModel),1)]),e("div",Ts,p(y.utilizationRate)+"%",1)]))),128))])])])]),o(jt,{modelValue:R.value,"onUpdate:modelValue":t[6]||(t[6]=y=>R.value=y),"device-data":V.value},null,8,["modelValue","device-data"])])}}}),Bs=Le(As,[["__scopeId","data-v-3f80e5a0"]]);export{Bs as default};
