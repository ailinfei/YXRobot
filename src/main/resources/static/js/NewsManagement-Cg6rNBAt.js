var Me=Object.defineProperty,Ae=Object.defineProperties;var Oe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var Re=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var X=(u,r,i)=>r in u?Me(u,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):u[r]=i,ee=(u,r)=>{for(var i in r||(r={}))Re.call(r,i)&&X(u,i,r[i]);if(W)for(var i of W(r))$e.call(r,i)&&X(u,i,r[i]);return u},te=(u,r)=>Ae(u,Oe(r));var f=(u,r,i)=>new Promise((N,k)=>{var F=_=>{try{b(i.next(_))}catch(w){k(w)}},S=_=>{try{b(i.throw(_))}catch(w){k(w)}},b=_=>_.done?N(_.value):Promise.resolve(_.value).then(F,S);b((i=i.apply(u,r)).next())});import{b as c,q as ae,j as He,P as le,Y as qe,R as Ge,e as je,Z as Je,_ as Qe,w as Ye,$ as Ze,a0 as Ke,n as O}from"./element-plus-B_LAMX2W.js";import T from"./request-We90RkoG.js";import{x as We,r as m,c as Xe,h as et,al as d,ar as tt,y as U,z as I,A as n,Q as l,I as o,M as g,u as v,P as R,a6 as $,H as L,J as at,O as h}from"./vue-C2NPAEWw.js";import{_ as lt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-T70AYnHr.js";const ot=(u={})=>T.get("/api/news",u),st=u=>T.post("/api/news",u),nt=(u,r)=>T.put(`/api/news/${u}`,r),rt=u=>T.delete(`/api/news/${u}`),ut=(u,r)=>T.post(`/api/news/${u}/publish`,{publishTime:r}),it=(u,r)=>T.post(`/api/news/${u}/offline`,{reason:r}),dt=()=>T.get("/api/news/categories"),ct=()=>T.get("/api/news/tags"),pt=u=>{const r=new FormData;return r.append("file",u),T.post("/api/news/upload-image",r,{headers:{"Content-Type":"multipart/form-data"}})},mt={class:"news-management"},gt={class:"page-header"},vt={class:"header-content"},_t={class:"header-actions"},ft={class:"filter-section"},ht={class:"filter-content"},bt={class:"filter-left"},wt={class:"news-list"},yt={class:"news-info"},It={class:"news-image"},xt=["src","alt"],Vt={class:"news-content"},Tt={class:"news-title"},Nt={class:"news-excerpt"},Dt={class:"news-meta"},kt={class:"news-author"},Ct={class:"news-stats"},Ft={class:"stat-item"},St={class:"stat-item"},Ut={class:"stat-item"},Lt={class:"date-info"},Bt={class:"time-text"},Pt={class:"action-buttons"},Et={class:"pagination-wrapper"},zt={class:"editor-container"},Mt={class:"image-upload"},At=["src"],Ot={class:"dialog-footer"},Rt=We({__name:"NewsManagement",setup(u){const r=m(!1),i=m(!1),N=m(!1),k=m(""),F=m(""),S=m(""),b=m(1),_=m(10),w=m(),s=m({id:null,title:"",excerpt:"",content:"",categoryId:null,category:"",author:"",status:"DRAFT",coverImage:"",image:"",tags:[],tagIds:[],publishTime:null,isFeatured:!1,sortOrder:0}),oe={title:[{required:!0,message:"请输入新闻标题",trigger:"blur"},{min:5,max:100,message:"标题长度应在5-100个字符之间",trigger:"blur"}],excerpt:[{required:!0,message:"请输入新闻摘要",trigger:"blur"},{min:10,max:200,message:"摘要长度应在10-200个字符之间",trigger:"blur"}],content:[{required:!0,message:"请输入新闻内容",trigger:"blur"},{min:50,message:"内容长度不能少于50个字符",trigger:"blur"}],categoryId:[{required:!0,message:"请选择新闻分类",trigger:"change"}],author:[{required:!0,message:"请输入作者姓名",trigger:"blur"}]},x=()=>f(null,null,function*(){try{r.value=!0,console.log("开始加载新闻列表...");const t={page:b.value,pageSize:_.value,keyword:k.value||void 0,categoryId:F.value||void 0,status:S.value||void 0};console.log("请求参数:",t);const e=yield ot(t);console.log("API响应:",e),e.data.code===200?(B.value=e.data.data.list||[],M.value=e.data.data.total||0,console.log(`成功加载 ${B.value.length} 条新闻，总数: ${M.value}`)):(console.error("API返回错误:",e.data),c.error(e.data.message||"获取新闻列表失败"))}catch(t){console.error("获取新闻列表失败:",t),c.error(`获取新闻列表失败: ${t.message||"未知错误"}`)}finally{r.value=!1}}),se=()=>f(null,null,function*(){try{const t=yield dt();t.data.code===200&&(A.value=t.data.data||[])}catch(t){console.error("获取分类列表失败:",t)}}),ne=()=>f(null,null,function*(){try{const t=yield ct();t.data.code===200&&(H.value=t.data.data||[])}catch(t){console.error("获取标签列表失败:",t)}}),B=m([]),M=m(0),A=m([]),H=m([]),re=Xe(()=>B.value),ue=()=>{N.value=!1,q(),i.value=!0},ie=t=>{var e,p;N.value=!0,s.value={id:t.id,title:t.title,excerpt:t.excerpt,content:t.content,categoryId:t.categoryId,category:t.categoryName||t.category,author:t.author,status:t.status,coverImage:t.coverImage||t.image,image:t.coverImage||t.image,tags:((e=t.tags)==null?void 0:e.map(y=>y.name||y))||[],tagIds:((p=t.tags)==null?void 0:p.map(y=>y.id))||[],publishTime:t.publishTime?new Date(t.publishTime):null,isFeatured:t.isFeatured||!1,sortOrder:t.sortOrder||0},i.value=!0},q=()=>{var t;s.value={id:null,title:"",excerpt:"",content:"",categoryId:null,category:"",author:"新闻编辑部",status:"DRAFT",coverImage:"",image:"",tags:[],tagIds:[],publishTime:new Date,isFeatured:!1,sortOrder:0},(t=w.value)==null||t.clearValidate()},de=()=>{b.value=1,x()},G=()=>{b.value=1,x()},ce=t=>{_.value=t,b.value=1,x()},pe=t=>{b.value=t,x()},me=t=>({公司新闻:"primary",技术更新:"success",合作动态:"warning",行业资讯:"info",公益活动:"danger"})[t]||"default",ge=t=>({PUBLISHED:"success",DRAFT:"warning",OFFLINE:"info",published:"success",draft:"warning",offline:"info"})[t]||"default",ve=t=>({PUBLISHED:"已发布",DRAFT:"草稿",OFFLINE:"已下线",published:"已发布",draft:"草稿",offline:"已下线"})[t]||t,_e=t=>new Date(t).toLocaleDateString("zh-CN"),fe=t=>new Date(t).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}),he=(t,e)=>f(null,null,function*(){switch(t){case"view":window.open(`/website/news/${e.id}`,"_blank");break;case"publish":yield be(e);break;case"offline":yield we(e);break;case"duplicate":ye(e);break;case"delete":yield Ie(e);break}}),be=t=>f(null,null,function*(){try{yield O.confirm("确定要发布这篇新闻吗？","发布确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=yield ut(t.id);e.data.code===200?(c.success("新闻发布成功"),x()):c.error(e.data.message||"发布失败")}catch(e){e!=="cancel"&&(console.error("发布新闻失败:",e),c.error("发布失败"))}}),we=t=>f(null,null,function*(){try{yield O.confirm("确定要下线这篇新闻吗？","下线确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const e=yield it(t.id);e.data.code===200?(c.success("新闻已下线"),x()):c.error(e.data.message||"下线失败")}catch(e){e!=="cancel"&&(console.error("下线新闻失败:",e),c.error("下线失败"))}}),ye=t=>{const e=te(ee({},t),{id:Date.now(),title:`${t.title} - 副本`,status:"draft",date:new Date().toISOString(),views:0,comments:0,likes:0});B.value.unshift(e),c.success("新闻复制成功")},Ie=t=>f(null,null,function*(){try{yield O.confirm("确定要删除这篇新闻吗？删除后无法恢复。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"});const e=yield rt(t.id);e.data.code===200?(c.success("新闻删除成功"),x()):c.error(e.data.message||"删除失败")}catch(e){e!=="cancel"&&(console.error("删除新闻失败:",e),c.error("删除失败"))}}),xe=()=>f(null,null,function*(){if(w.value)try{yield w.value.validate(),s.value.status="DRAFT",yield j()}catch(t){c.error("请完善必填信息")}}),j=()=>f(null,null,function*(){var t;if(w.value)try{yield w.value.validate();const e={title:s.value.title,excerpt:s.value.excerpt,content:s.value.content,categoryId:s.value.categoryId,author:s.value.author,status:s.value.status,coverImage:s.value.coverImage||s.value.image,tagIds:s.value.tagIds,publishTime:(t=s.value.publishTime)==null?void 0:t.toISOString(),isFeatured:s.value.isFeatured,sortOrder:s.value.sortOrder};let p;N.value&&s.value.id?p=yield nt(s.value.id,e):p=yield st(e),p.data.code===200?(c.success(N.value?"新闻更新成功":"新闻创建成功"),i.value=!1,q(),x()):c.error(p.data.message||"保存失败")}catch(e){console.error("保存新闻失败:",e),c.error("保存失败")}}),Ve=(t,e)=>{t&&t.url?(s.value.coverImage=t.url,s.value.image=t.url):(s.value.coverImage=URL.createObjectURL(e.raw),s.value.image=s.value.coverImage)},Te=t=>{const e=t.type==="image/jpeg"||t.type==="image/png",p=t.size/1024/1024<2;return e||c.error("上传图片只能是 JPG/PNG 格式!"),p||c.error("上传图片大小不能超过 2MB!"),e&&p},Ne=t=>f(null,null,function*(){try{const e=yield pt(t.file);e.data.code===200?(s.value.coverImage=e.data.data.url,s.value.image=e.data.data.url,t.onSuccess(e.data.data)):t.onError(new Error(e.data.message||"上传失败"))}catch(e){console.error("上传图片失败:",e),t.onError(e)}});return et(()=>f(null,null,function*(){console.log("NewsManagement组件已挂载，开始加载数据...");try{yield Promise.all([x(),se(),ne()]),console.log("所有数据加载完成")}catch(t){console.error("数据加载失败:",t),c.error("页面数据加载失败，请刷新重试")}})),(t,e)=>{const p=d("el-button"),y=d("el-input"),D=d("el-option"),P=d("el-select"),J=d("el-card"),C=d("el-table-column"),Q=d("el-tag"),E=d("el-icon"),z=d("el-dropdown-item"),De=d("el-dropdown-menu"),ke=d("el-dropdown"),Ce=d("el-table"),Fe=d("el-pagination"),V=d("el-form-item"),Y=d("el-col"),Z=d("el-radio"),Se=d("el-radio-group"),Ue=d("el-upload"),Le=d("el-date-picker"),Be=d("el-row"),Pe=d("el-form"),Ee=d("el-dialog"),ze=tt("loading");return I(),U("div",mt,[n("div",gt,[n("div",vt,[e[16]||(e[16]=n("div",{class:"header-left"},[n("h1",{class:"page-title"},"新闻管理"),n("p",{class:"page-description"},"333管理官网新闻内容，包括发布、编辑和删除新闻文章")],-1)),n("div",_t,[l(p,{type:"primary",onClick:ue,icon:v(ae)},{default:o(()=>e[15]||(e[15]=[g(" 发布新闻 ",-1)])),_:1,__:[15]},8,["icon"])])])]),n("div",ft,[l(J,null,{default:o(()=>[n("div",ht,[n("div",bt,[l(y,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=a=>k.value=a),placeholder:"搜索新闻标题或内容","prefix-icon":v(He),clearable:"",class:"search-input",onInput:de},null,8,["modelValue","prefix-icon"]),l(P,{modelValue:F.value,"onUpdate:modelValue":e[1]||(e[1]=a=>F.value=a),placeholder:"选择分类",clearable:"",class:"category-select",onChange:G},{default:o(()=>[l(D,{label:"全部分类",value:""}),(I(!0),U(R,null,$(A.value,a=>(I(),L(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(P,{modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=a=>S.value=a),placeholder:"选择状态",clearable:"",class:"status-select",onChange:G},{default:o(()=>[l(D,{label:"全部状态",value:""}),l(D,{label:"已发布",value:"PUBLISHED"}),l(D,{label:"草稿",value:"DRAFT"}),l(D,{label:"已下线",value:"OFFLINE"})]),_:1},8,["modelValue"])])])]),_:1})]),n("div",wt,[l(J,null,{default:o(()=>[at((I(),L(Ce,{data:re.value,stripe:"",class:"news-table"},{default:o(()=>[l(C,{type:"selection",width:"55"}),l(C,{label:"新闻信息","min-width":"300"},{default:o(({row:a})=>[n("div",yt,[n("div",It,[n("img",{src:a.coverImage||a.image,alt:a.title},null,8,xt)]),n("div",Vt,[n("h4",Tt,h(a.title),1),n("p",Nt,h(a.excerpt),1),n("div",Dt,[l(Q,{type:me(a.categoryName||a.category),size:"small"},{default:o(()=>[g(h(a.categoryName||a.category),1)]),_:2},1032,["type"]),n("span",kt,"作者："+h(a.author),1)])])])]),_:1}),l(C,{label:"状态",width:"100",align:"center"},{default:o(({row:a})=>[l(Q,{type:ge(a.status)},{default:o(()=>[g(h(ve(a.status)),1)]),_:2},1032,["type"])]),_:1}),l(C,{label:"数据统计",width:"120",align:"center"},{default:o(({row:a})=>[n("div",Ct,[n("div",Ft,[l(E,null,{default:o(()=>[l(v(le))]),_:1}),n("span",null,h(a.views),1)]),n("div",St,[l(E,null,{default:o(()=>[l(v(qe))]),_:1}),n("span",null,h(a.comments),1)]),n("div",Ut,[l(E,null,{default:o(()=>[l(v(Ge))]),_:1}),n("span",null,h(a.likes),1)])])]),_:1}),l(C,{label:"发布时间",width:"120",align:"center"},{default:o(({row:a})=>[n("div",Lt,[n("div",null,h(_e(a.publishTime||a.createdAt)),1),n("div",Bt,h(fe(a.publishTime||a.createdAt)),1)])]),_:1}),l(C,{label:"操作",width:"200",align:"center",fixed:"right"},{default:o(({row:a})=>[n("div",Pt,[l(p,{type:"primary",size:"small",onClick:K=>ie(a),icon:v(je)},{default:o(()=>e[17]||(e[17]=[g(" 编辑 ",-1)])),_:2,__:[17]},1032,["onClick","icon"]),l(ke,{onCommand:K=>he(K,a)},{dropdown:o(()=>[l(De,null,{default:o(()=>[l(z,{command:"view",icon:v(le)},{default:o(()=>e[18]||(e[18]=[g(" 预览 ",-1)])),_:1,__:[18]},8,["icon"]),l(z,{command:a.status==="PUBLISHED"||a.status==="published"?"offline":"publish",icon:a.status==="PUBLISHED"||a.status==="published"?v(Qe):v(Ye)},{default:o(()=>[g(h(a.status==="PUBLISHED"||a.status==="published"?"下线":"发布"),1)]),_:2},1032,["command","icon"]),l(z,{command:"duplicate",icon:v(Ze)},{default:o(()=>e[19]||(e[19]=[g(" 复制 ",-1)])),_:1,__:[19]},8,["icon"]),l(z,{command:"delete",icon:v(Ke),divided:""},{default:o(()=>e[20]||(e[20]=[g(" 删除 ",-1)])),_:1,__:[20]},8,["icon"])]),_:2},1024)]),default:o(()=>[l(p,{size:"small",icon:v(Je)},null,8,["icon"])]),_:2},1032,["onCommand"])])]),_:1})]),_:1},8,["data"])),[[ze,r.value]]),n("div",Et,[l(Fe,{"current-page":b.value,"onUpdate:currentPage":e[3]||(e[3]=a=>b.value=a),"page-size":_.value,"onUpdate:pageSize":e[4]||(e[4]=a=>_.value=a),"page-sizes":[10,20,50,100],total:M.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ce,onCurrentChange:pe},null,8,["current-page","page-size","total"])])]),_:1})]),l(Ee,{modelValue:i.value,"onUpdate:modelValue":e[14]||(e[14]=a=>i.value=a),title:N.value?"编辑新闻":"发布新闻",width:"80%","close-on-click-modal":!1},{footer:o(()=>[n("div",Ot,[l(p,{onClick:e[13]||(e[13]=a=>i.value=!1)},{default:o(()=>e[24]||(e[24]=[g("取消",-1)])),_:1,__:[24]}),l(p,{onClick:xe},{default:o(()=>e[25]||(e[25]=[g("保存草稿",-1)])),_:1,__:[25]}),l(p,{type:"primary",onClick:j},{default:o(()=>[g(h(N.value?"更新":"发布"),1)]),_:1})])]),default:o(()=>[l(Pe,{ref_key:"newsFormRef",ref:w,model:s.value,rules:oe,"label-width":"100px",class:"news-form"},{default:o(()=>[l(Be,{gutter:20},{default:o(()=>[l(Y,{span:16},{default:o(()=>[l(V,{label:"新闻标题",prop:"title"},{default:o(()=>[l(y,{modelValue:s.value.title,"onUpdate:modelValue":e[5]||(e[5]=a=>s.value.title=a),placeholder:"请输入新闻标题",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(V,{label:"新闻摘要",prop:"excerpt"},{default:o(()=>[l(y,{modelValue:s.value.excerpt,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.excerpt=a),type:"textarea",rows:3,placeholder:"请输入新闻摘要",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(V,{label:"新闻内容",prop:"content"},{default:o(()=>[n("div",zt,[l(y,{modelValue:s.value.content,"onUpdate:modelValue":e[7]||(e[7]=a=>s.value.content=a),type:"textarea",rows:15,placeholder:"请输入新闻内容（支持HTML格式）"},null,8,["modelValue"])])]),_:1})]),_:1}),l(Y,{span:8},{default:o(()=>[l(V,{label:"新闻分类",prop:"categoryId"},{default:o(()=>[l(P,{modelValue:s.value.categoryId,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.categoryId=a),placeholder:"选择分类",class:"full-width"},{default:o(()=>[(I(!0),U(R,null,$(A.value,a=>(I(),L(D,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"作者",prop:"author"},{default:o(()=>[l(y,{modelValue:s.value.author,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.author=a),placeholder:"请输入作者姓名"},null,8,["modelValue"])]),_:1}),l(V,{label:"发布状态",prop:"status"},{default:o(()=>[l(Se,{modelValue:s.value.status,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.status=a)},{default:o(()=>[l(Z,{label:"DRAFT"},{default:o(()=>e[21]||(e[21]=[g("草稿",-1)])),_:1,__:[21]}),l(Z,{label:"PUBLISHED"},{default:o(()=>e[22]||(e[22]=[g("发布",-1)])),_:1,__:[22]})]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"封面图片",prop:"coverImage"},{default:o(()=>[n("div",Mt,[l(Ue,{class:"image-uploader","show-file-list":!1,"on-success":Ve,"before-upload":Te,action:"#","http-request":Ne},{default:o(()=>[s.value.coverImage||s.value.image?(I(),U("img",{key:0,src:s.value.coverImage||s.value.image,class:"uploaded-image"},null,8,At)):(I(),L(E,{key:1,class:"image-uploader-icon"},{default:o(()=>[l(v(ae))]),_:1}))]),_:1}),e[23]||(e[23]=n("div",{class:"upload-tip"}," 建议尺寸：800x500px，支持JPG、PNG格式 ",-1))])]),_:1}),l(V,{label:"标签",prop:"tags"},{default:o(()=>[l(P,{modelValue:s.value.tags,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.tags=a),multiple:"",filterable:"","allow-create":"",placeholder:"选择或输入标签",class:"full-width"},{default:o(()=>[(I(!0),U(R,null,$(H.value,a=>(I(),L(D,{key:a.id,label:a.name,value:a.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(V,{label:"发布时间"},{default:o(()=>[l(Le,{modelValue:s.value.publishTime,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.publishTime=a),type:"datetime",placeholder:"选择发布时间",class:"full-width"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),Qt=lt(Rt,[["__scopeId","data-v-737789e8"]]);export{Qt as default};
