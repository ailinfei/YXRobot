var be=Object.defineProperty,he=Object.defineProperties;var Ve=Object.getOwnPropertyDescriptors;var pe=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var me=($,V,c)=>V in $?be($,V,{enumerable:!0,configurable:!0,writable:!0,value:c}):$[V]=c,ce=($,V)=>{for(var c in V||(V={}))De.call(V,c)&&me($,c,V[c]);if(pe)for(var c of pe(V))we.call(V,c)&&me($,c,V[c]);return $},_e=($,V)=>he($,Ve(V));var j=($,V,c)=>new Promise((T,N)=>{var M=C=>{try{h(c.next(C))}catch(o){N(o)}},E=C=>{try{h(c.throw(C))}catch(o){N(o)}},h=C=>C.done?T(C.value):Promise.resolve(C.value).then(M,E);h((c=c.apply($,V)).next())});import{q as fe,a0 as ke,b as z,e as Pe,k as $e,aH as Ne,n as Ce,r as Se}from"./element-plus-BHn0tN3r.js";import{m as oe}from"./order-C4knK3sJ.js";import{o as de}from"./order-DJqFsAWm.js";import{c as Te}from"./customer-CaCup1_C.js";import{p as Oe}from"./product-z-F88vWI.js";import{x as re,r as A,c as te,j as ne,al as f,H as O,z as _,I as t,Q as e,A as l,y as D,K as k,P as Z,a6 as ee,M as y,u as G,O as i,n as Ae,h as Ee}from"./vue-C2NPAEWw.js";import{_ as ie}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-DpZIA5Wt.js";import"./utils-T70AYnHr.js";const ve={pending:"待确认",confirmed:"已确认",processing:"处理中",shipped:"已发货",delivered:"已送达",completed:"已完成",cancelled:"已取消"},Ue={pending:"待支付",paid:"已支付",failed:"支付失败",refunded:"已退款"},Ie={class:"form-section"},Ye={class:"form-section"},Fe={class:"form-section"},Me={class:"section-title"},qe={class:"order-items"},ze={key:0,class:"form-section"},Re={class:"form-section"},Be={class:"amount-summary"},Le={class:"amount-item"},je={class:"value"},He={class:"amount-item"},Xe={class:"amount-item"},xe={class:"amount-item total"},Je={class:"value"},Ke={class:"form-section"},Qe={class:"dialog-footer"},Ge=re({__name:"OrderFormDialog",props:{modelValue:{type:Boolean},order:{}},emits:["update:modelValue","success"],setup($,{emit:V}){const c=$,T=V,N=A(),M=A(!1),E=A(!1),h=A([]),C=A([]),o=A({type:"sales",orderNumber:"",customerId:"",customerName:"",customerPhone:"",customerEmail:"",deliveryAddress:"",items:[{productId:"",productName:"",quantity:1,unitPrice:0,totalPrice:0,notes:""}],shippingFee:0,discount:0,totalAmount:0,expectedDeliveryDate:"",salesPerson:"",notes:"",rentalStartDate:"",rentalEndDate:"",rentalDays:0,rentalNotes:""}),J={type:[{required:!0,message:"请选择订单类型",trigger:"change"}],customerName:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],customerPhone:[{required:!0,message:"请输入联系电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],customerEmail:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],deliveryAddress:[{required:!0,message:"请输入收货地址",trigger:"blur"}],rentalStartDate:[{required:!0,message:"请选择租赁开始日期",trigger:"change"}],rentalEndDate:[{required:!0,message:"请选择租赁结束日期",trigger:"change"}]},R=te({get:()=>c.modelValue,set:d=>T("update:modelValue",d)}),H=te(()=>!!c.order),W=te(()=>o.value.items.reduce((d,a)=>d+(a.totalPrice||0),0)),U=()=>{o.value={type:"sales",orderNumber:"",customerId:"",customerName:"",customerPhone:"",customerEmail:"",deliveryAddress:"",items:[{productId:"",productName:"",quantity:1,unitPrice:0,totalPrice:0,notes:""}],shippingFee:0,discount:0,totalAmount:0,expectedDeliveryDate:"",salesPerson:"",notes:"",rentalStartDate:"",rentalEndDate:"",rentalDays:0,rentalNotes:""}},n=()=>{const a=new Date().getTime().toString().slice(-8),g=Math.floor(Math.random()*1e3).toString().padStart(3,"0");o.value.orderNumber=`ORD${a}${g}`};ne(()=>c.order,d=>{d?Object.assign(o.value,_e(ce({},d),{items:d.items||[{productId:"",productName:"",quantity:1,unitPrice:0,totalPrice:0,notes:""}]})):(U(),n())},{immediate:!0}),ne(()=>o.value.type,d=>{d==="rental"&&(J.rentalStartDate=[{required:!0,message:"请选择租赁开始日期",trigger:"change"}],J.rentalEndDate=[{required:!0,message:"请选择租赁结束日期",trigger:"change"}])});const s=()=>j(null,null,function*(){try{const d=yield Oe.getProducts({pageSize:100});C.value=d.data.list}catch(d){console.error("加载产品列表失败:",d)}}),B=d=>j(null,null,function*(){if(!d){h.value=[];return}E.value=!0;try{const a=yield Te.getCustomers({keyword:d,pageSize:20});h.value=a.data.list}catch(a){console.error("搜索客户失败:",a)}finally{E.value=!1}}),u=d=>{const a=h.value.find(g=>g.id===d);a&&(o.value.customerName=a.name,o.value.customerPhone=a.phone,o.value.customerEmail=a.email,o.value.deliveryAddress=a.address)},m=(d,a)=>{const g=C.value.find(Q=>Q.id===d);g&&(o.value.items[a].productName=g.name,o.value.items[a].unitPrice=g.price,p(a))},X=()=>{o.value.items.push({productId:"",productName:"",quantity:1,unitPrice:0,totalPrice:0,notes:""})},I=d=>{o.value.items.length>1&&(o.value.items.splice(d,1),Y())},p=d=>{const a=o.value.items[d];a.totalPrice=(a.quantity||0)*(a.unitPrice||0),Y()},Y=()=>{const d=W.value,a=o.value.shippingFee||0,g=o.value.discount||0;o.value.totalAmount=Math.max(0,d+a-g)},S=()=>{if(o.value.rentalStartDate&&o.value.rentalEndDate){const d=new Date(o.value.rentalStartDate),g=new Date(o.value.rentalEndDate).getTime()-d.getTime(),Q=Math.ceil(g/(1e3*60*60*24));o.value.rentalDays=Math.max(0,Q)}},L=()=>j(null,null,function*(){try{yield N.value.validate(),M.value=!0,H.value?(yield de.updateOrder(c.order.id,o.value),z.success("订单更新成功")):(yield de.createOrder(o.value),z.success("订单创建成功")),T("success"),K()}catch(d){console.error("提交失败:",d),d!==!1&&z.error("操作失败，请重试")}finally{M.value=!1}}),K=()=>{R.value=!1,Ae(()=>{var d;(d=N.value)==null||d.resetFields()})},v=()=>j(null,null,function*(){yield s(),H.value||n()});return ne(R,d=>{d&&v()}),(d,a)=>{const g=f("el-option"),Q=f("el-select"),w=f("el-form-item"),b=f("el-col"),F=f("el-input"),q=f("el-row"),ue=f("el-icon"),le=f("el-button"),se=f("el-input-number"),ae=f("el-date-picker"),ge=f("el-form"),ye=f("el-dialog");return _(),O(ye,{modelValue:R.value,"onUpdate:modelValue":a[15]||(a[15]=r=>R.value=r),title:H.value?"编辑订单":"创建销售订单",width:"900px","close-on-click-modal":!1,onClose:K},{footer:t(()=>[l("div",Qe,[e(le,{onClick:K},{default:t(()=>a[27]||(a[27]=[y("取消",-1)])),_:1,__:[27]}),e(le,{type:"primary",onClick:L,loading:M.value},{default:t(()=>[y(i(H.value?"更新订单":"创建订单"),1)]),_:1},8,["loading"])])]),default:t(()=>[e(ge,{ref_key:"formRef",ref:N,model:o.value,rules:J,"label-width":"120px","label-position":"left"},{default:t(()=>[l("div",Ie,[a[16]||(a[16]=l("h4",{class:"section-title"},"基本信息",-1)),e(q,{gutter:24},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(w,{label:"订单类型",prop:"type"},{default:t(()=>[e(Q,{modelValue:o.value.type,"onUpdate:modelValue":a[0]||(a[0]=r=>o.value.type=r),placeholder:"请选择订单类型",style:{width:"100%"}},{default:t(()=>[e(g,{label:"销售订单",value:"sales"}),e(g,{label:"租赁订单",value:"rental"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(w,{label:"订单号",prop:"orderNumber"},{default:t(()=>[e(F,{modelValue:o.value.orderNumber,"onUpdate:modelValue":a[1]||(a[1]=r=>o.value.orderNumber=r),placeholder:"系统自动生成",disabled:!0},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),l("div",Ye,[a[17]||(a[17]=l("h4",{class:"section-title"},"客户信息",-1)),e(q,{gutter:24},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(w,{label:"客户选择",prop:"customerId"},{default:t(()=>[e(Q,{modelValue:o.value.customerId,"onUpdate:modelValue":a[2]||(a[2]=r=>o.value.customerId=r),placeholder:"请选择客户",filterable:"",remote:"","remote-method":B,loading:E.value,style:{width:"100%"},onChange:u},{default:t(()=>[(_(!0),D(Z,null,ee(h.value,r=>(_(),O(g,{key:r.id,label:`${r.name} (${r.phone})`,value:r.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(w,{label:"客户姓名",prop:"customerName"},{default:t(()=>[e(F,{modelValue:o.value.customerName,"onUpdate:modelValue":a[3]||(a[3]=r=>o.value.customerName=r),placeholder:"请输入客户姓名",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:24},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(w,{label:"联系电话",prop:"customerPhone"},{default:t(()=>[e(F,{modelValue:o.value.customerPhone,"onUpdate:modelValue":a[4]||(a[4]=r=>o.value.customerPhone=r),placeholder:"请输入联系电话",maxlength:"20"},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(w,{label:"客户邮箱",prop:"customerEmail"},{default:t(()=>[e(F,{modelValue:o.value.customerEmail,"onUpdate:modelValue":a[5]||(a[5]=r=>o.value.customerEmail=r),placeholder:"请输入客户邮箱",maxlength:"100"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:24},{default:t(()=>[e(b,{span:24},{default:t(()=>[e(w,{label:"收货地址",prop:"deliveryAddress"},{default:t(()=>[e(F,{modelValue:o.value.deliveryAddress,"onUpdate:modelValue":a[6]||(a[6]=r=>o.value.deliveryAddress=r),type:"textarea",rows:2,placeholder:"请输入详细的收货地址",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),l("div",Fe,[l("h4",Me,[a[19]||(a[19]=y(" 商品信息 ",-1)),e(le,{type:"primary",size:"small",onClick:X},{default:t(()=>[e(ue,null,{default:t(()=>[e(G(fe))]),_:1}),a[18]||(a[18]=y(" 添加商品 ",-1))]),_:1,__:[18]})]),l("div",qe,[(_(!0),D(Z,null,ee(o.value.items,(r,x)=>(_(),D("div",{key:x,class:"order-item"},[e(q,{gutter:16,align:"middle"},{default:t(()=>[e(b,{span:6},{default:t(()=>[e(w,{prop:`items.${x}.productId`,rules:[{required:!0,message:"请选择产品",trigger:"change"}],label:"产品型号"},{default:t(()=>[e(Q,{modelValue:r.productId,"onUpdate:modelValue":P=>r.productId=P,placeholder:"请选择产品",filterable:"",style:{width:"100%"},onChange:P=>m(P,x)},{default:t(()=>[(_(!0),D(Z,null,ee(C.value,P=>(_(),O(g,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop"])]),_:2},1024),e(b,{span:3},{default:t(()=>[e(w,{prop:`items.${x}.quantity`,rules:[{required:!0,message:"请输入数量",trigger:"blur"}],label:"数量"},{default:t(()=>[e(se,{modelValue:r.quantity,"onUpdate:modelValue":P=>r.quantity=P,min:1,max:999,style:{width:"100%"},onChange:()=>p(x)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop"])]),_:2},1024),e(b,{span:4},{default:t(()=>[e(w,{prop:`items.${x}.unitPrice`,rules:[{required:!0,message:"请输入单价",trigger:"blur"}],label:"单价"},{default:t(()=>[e(se,{modelValue:r.unitPrice,"onUpdate:modelValue":P=>r.unitPrice=P,min:0,precision:2,style:{width:"100%"},onChange:()=>p(x)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:2},1032,["prop"])]),_:2},1024),e(b,{span:4},{default:t(()=>[e(w,{label:"小计"},{default:t(()=>{var P;return[e(F,{value:`¥${((P=r.totalPrice)==null?void 0:P.toFixed(2))||"0.00"}`,disabled:"",style:{width:"100%"}},null,8,["value"])]}),_:2},1024)]),_:2},1024),e(b,{span:5},{default:t(()=>[e(w,{label:"备注"},{default:t(()=>[e(F,{modelValue:r.notes,"onUpdate:modelValue":P=>r.notes=P,placeholder:"商品备注",maxlength:"100",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(b,{span:2},{default:t(()=>[e(w,{label:" "},{default:t(()=>[e(le,{type:"danger",size:"small",text:"",onClick:P=>I(x),disabled:o.value.items.length<=1},{default:t(()=>[e(ue,null,{default:t(()=>[e(G(ke))]),_:1})]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))])]),o.value.type==="rental"?(_(),D("div",ze,[a[20]||(a[20]=l("h4",{class:"section-title"},"租赁信息",-1)),e(q,{gutter:24},{default:t(()=>[e(b,{span:8},{default:t(()=>[e(w,{label:"租赁开始日期",prop:"rentalStartDate"},{default:t(()=>[e(ae,{modelValue:o.value.rentalStartDate,"onUpdate:modelValue":a[7]||(a[7]=r=>o.value.rentalStartDate=r),type:"date",placeholder:"选择开始日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:S},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:8},{default:t(()=>[e(w,{label:"租赁结束日期",prop:"rentalEndDate"},{default:t(()=>[e(ae,{modelValue:o.value.rentalEndDate,"onUpdate:modelValue":a[8]||(a[8]=r=>o.value.rentalEndDate=r),type:"date",placeholder:"选择结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},onChange:S},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:8},{default:t(()=>[e(w,{label:"租赁天数"},{default:t(()=>[e(F,{value:`${o.value.rentalDays||0} 天`,disabled:"",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:24},{default:t(()=>[e(b,{span:24},{default:t(()=>[e(w,{label:"租赁备注"},{default:t(()=>[e(F,{modelValue:o.value.rentalNotes,"onUpdate:modelValue":a[9]||(a[9]=r=>o.value.rentalNotes=r),type:"textarea",rows:2,placeholder:"租赁相关备注信息",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])):k("",!0),l("div",Re,[a[25]||(a[25]=l("h4",{class:"section-title"},"订单金额",-1)),l("div",Be,[e(q,{gutter:24},{default:t(()=>[e(b,{span:6},{default:t(()=>[l("div",Le,[a[21]||(a[21]=l("span",{class:"label"},"商品小计:",-1)),l("span",je,"¥"+i(W.value.toFixed(2)),1)])]),_:1}),e(b,{span:6},{default:t(()=>[l("div",He,[a[22]||(a[22]=l("span",{class:"label"},"运费:",-1)),e(se,{modelValue:o.value.shippingFee,"onUpdate:modelValue":a[10]||(a[10]=r=>o.value.shippingFee=r),min:0,precision:2,size:"small",onChange:Y},null,8,["modelValue"])])]),_:1}),e(b,{span:6},{default:t(()=>[l("div",Xe,[a[23]||(a[23]=l("span",{class:"label"},"折扣:",-1)),e(se,{modelValue:o.value.discount,"onUpdate:modelValue":a[11]||(a[11]=r=>o.value.discount=r),min:0,precision:2,size:"small",onChange:Y},null,8,["modelValue"])])]),_:1}),e(b,{span:6},{default:t(()=>[l("div",xe,[a[24]||(a[24]=l("span",{class:"label"},"订单总额:",-1)),l("span",Je,"¥"+i(o.value.totalAmount.toFixed(2)),1)])]),_:1})]),_:1})])]),l("div",Ke,[a[26]||(a[26]=l("h4",{class:"section-title"},"其他信息",-1)),e(q,{gutter:24},{default:t(()=>[e(b,{span:12},{default:t(()=>[e(w,{label:"预计交付日期",prop:"expectedDeliveryDate"},{default:t(()=>[e(ae,{modelValue:o.value.expectedDeliveryDate,"onUpdate:modelValue":a[12]||(a[12]=r=>o.value.expectedDeliveryDate=r),type:"date",placeholder:"选择预计交付日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(b,{span:12},{default:t(()=>[e(w,{label:"销售人员",prop:"salesPerson"},{default:t(()=>[e(F,{modelValue:o.value.salesPerson,"onUpdate:modelValue":a[13]||(a[13]=r=>o.value.salesPerson=r),placeholder:"请输入销售人员姓名",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(q,{gutter:24},{default:t(()=>[e(b,{span:24},{default:t(()=>[e(w,{label:"订单备注"},{default:t(()=>[e(F,{modelValue:o.value.notes,"onUpdate:modelValue":a[14]||(a[14]=r=>o.value.notes=r),type:"textarea",rows:3,placeholder:"订单相关备注信息",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}}),We=ie(Ge,[["__scopeId","data-v-6542afdf"]]),Ze={key:0,class:"order-detail"},et={class:"detail-section"},tt={class:"section-header"},lt={class:"order-actions"},st={class:"info-item"},at={class:"value"},ot={class:"info-item"},nt={class:"info-item"},dt={class:"info-item"},rt={class:"value"},it={class:"info-item"},ut={class:"value"},pt={class:"info-item"},mt={class:"value"},ct={class:"detail-section"},_t={class:"info-item"},ft={class:"value"},vt={class:"info-item"},gt={class:"value"},yt={class:"info-item"},bt={class:"value"},ht={class:"info-item"},Vt={class:"value"},Dt={class:"detail-section"},wt={key:0,class:"detail-section"},kt={class:"info-item"},Pt={class:"value"},$t={class:"info-item"},Nt={class:"value"},Ct={class:"info-item"},St={class:"value"},Tt={class:"info-item"},Ot={class:"value"},At={class:"detail-section"},Et={class:"amount-summary"},Ut={class:"amount-item"},It={class:"value"},Yt={class:"amount-item"},Ft={class:"value"},Mt={class:"amount-item"},qt={class:"value"},zt={class:"amount-item total"},Rt={class:"value"},Bt={key:1,class:"detail-section"},Lt={class:"info-item"},jt={class:"info-item"},Ht={class:"value"},Xt={class:"info-item"},xt={class:"value"},Jt={key:2,class:"detail-section"},Kt={class:"info-item"},Qt={class:"value"},Gt={class:"info-item"},Wt={class:"value"},Zt={class:"info-item"},el={class:"value"},tl={key:3,class:"detail-section"},ll={class:"notes-content"},sl={key:4,class:"detail-section"},al={class:"log-content"},ol={class:"log-action"},nl={class:"log-operator"},dl={key:0,class:"log-notes"},rl={class:"dialog-footer"},il=re({__name:"OrderDetailDialog",props:{modelValue:{type:Boolean},order:{}},emits:["update:modelValue","edit","status-change"],setup($,{emit:V}){const c=$,T=V,N=te({get:()=>c.modelValue,set:n=>T("update:modelValue",n)}),M=te(()=>{var n;return(n=c.order)!=null&&n.items?c.order.items.reduce((s,B)=>s+(B.totalPrice||0),0):0}),E=()=>{c.order&&T("edit",c.order)},h=n=>j(null,null,function*(){if(c.order)try{let s="";switch(n){case"confirm":s="确定要确认这个订单吗？";break;case"ship":s="确定要标记为已发货吗？";break;case"deliver":s="确定要标记为已送达吗？";break;case"complete":s="确定要完成这个订单吗？";break;case"cancel":s="确定要取消这个订单吗？";break}yield Ce.confirm(s,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield de.updateOrderStatus(c.order.id,n),z.success("操作成功"),T("status-change")}catch(s){s!=="cancel"&&(console.error("状态更新失败:",s),z.error("操作失败"))}}),C=()=>{z.info("打印功能开发中...")},o=n=>({pending:"warning",confirmed:"primary",processing:"primary",shipped:"info",delivered:"success",completed:"success",cancelled:"danger"})[n]||"info",J=n=>ve[n]||n,R=n=>({pending:"warning",paid:"success",failed:"danger",refunded:"info"})[n||""]||"info",H=n=>Ue[n]||n||"未知",W=n=>({创建订单:"primary",确认订单:"success",发货:"info",送达:"success",完成:"success",取消:"danger"})[n]||"primary",U=n=>n?new Date(n).toLocaleString("zh-CN"):"-";return(n,s)=>{const B=f("el-icon"),u=f("el-button"),m=f("el-dropdown-item"),X=f("el-dropdown-menu"),I=f("el-dropdown"),p=f("el-col"),Y=f("el-tag"),S=f("el-row"),L=f("el-table-column"),K=f("el-table"),v=f("el-timeline-item"),d=f("el-timeline"),a=f("el-dialog");return _(),O(a,{modelValue:N.value,"onUpdate:modelValue":s[1]||(s[1]=g=>N.value=g),title:"订单详情",width:"1000px","close-on-click-modal":!1},{footer:t(()=>[l("div",rl,[e(u,{onClick:s[0]||(s[0]=g=>N.value=!1)},{default:t(()=>s[42]||(s[42]=[y("关闭",-1)])),_:1,__:[42]}),e(u,{type:"primary",onClick:C},{default:t(()=>[e(B,null,{default:t(()=>[e(G(Ne))]),_:1}),s[43]||(s[43]=y(" 打印订单 ",-1))]),_:1,__:[43]})])]),default:t(()=>[n.order?(_(),D("div",Ze,[l("div",et,[l("div",tt,[s[9]||(s[9]=l("h3",null,"订单信息",-1)),l("div",lt,[e(u,{type:"primary",size:"small",onClick:E},{default:t(()=>[e(B,null,{default:t(()=>[e(G(Pe))]),_:1}),s[2]||(s[2]=y(" 编辑订单 ",-1))]),_:1,__:[2]}),e(I,{onCommand:h,trigger:"click"},{dropdown:t(()=>[e(X,null,{default:t(()=>[n.order.status==="pending"?(_(),O(m,{key:0,command:"confirm"},{default:t(()=>s[4]||(s[4]=[y(" 确认订单 ",-1)])),_:1,__:[4]})):k("",!0),n.order.status==="confirmed"?(_(),O(m,{key:1,command:"ship"},{default:t(()=>s[5]||(s[5]=[y(" 发货 ",-1)])),_:1,__:[5]})):k("",!0),n.order.status==="shipped"?(_(),O(m,{key:2,command:"deliver"},{default:t(()=>s[6]||(s[6]=[y(" 确认送达 ",-1)])),_:1,__:[6]})):k("",!0),n.order.status==="delivered"?(_(),O(m,{key:3,command:"complete"},{default:t(()=>s[7]||(s[7]=[y(" 完成订单 ",-1)])),_:1,__:[7]})):k("",!0),["pending","confirmed"].includes(n.order.status)?(_(),O(m,{key:4,command:"cancel"},{default:t(()=>s[8]||(s[8]=[y(" 取消订单 ",-1)])),_:1,__:[8]})):k("",!0)]),_:1})]),default:t(()=>[e(u,{size:"small"},{default:t(()=>[s[3]||(s[3]=y(" 状态操作",-1)),e(B,{class:"el-icon--right"},{default:t(()=>[e(G($e))]),_:1})]),_:1,__:[3]})]),_:1})])]),e(S,{gutter:24},{default:t(()=>[e(p,{span:8},{default:t(()=>[l("div",st,[s[10]||(s[10]=l("span",{class:"label"},"订单号:",-1)),l("span",at,i(n.order.orderNumber),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",ot,[s[11]||(s[11]=l("span",{class:"label"},"订单类型:",-1)),e(Y,{type:n.order.type==="sales"?"success":"primary",size:"small"},{default:t(()=>[y(i(n.order.type==="sales"?"销售订单":"租赁订单"),1)]),_:1},8,["type"])])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",nt,[s[12]||(s[12]=l("span",{class:"label"},"订单状态:",-1)),e(Y,{type:o(n.order.status),size:"small"},{default:t(()=>[y(i(J(n.order.status)),1)]),_:1},8,["type"])])]),_:1})]),_:1}),e(S,{gutter:24},{default:t(()=>[e(p,{span:8},{default:t(()=>[l("div",dt,[s[13]||(s[13]=l("span",{class:"label"},"创建时间:",-1)),l("span",rt,i(U(n.order.createdAt)),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",it,[s[14]||(s[14]=l("span",{class:"label"},"预计交付:",-1)),l("span",ut,i(U(n.order.expectedDeliveryDate)||"-"),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",pt,[s[15]||(s[15]=l("span",{class:"label"},"销售人员:",-1)),l("span",mt,i(n.order.salesPerson||"-"),1)])]),_:1})]),_:1})]),l("div",ct,[s[20]||(s[20]=l("h3",null,"客户信息",-1)),e(S,{gutter:24},{default:t(()=>[e(p,{span:12},{default:t(()=>[l("div",_t,[s[16]||(s[16]=l("span",{class:"label"},"客户姓名:",-1)),l("span",ft,i(n.order.customerName),1)])]),_:1}),e(p,{span:12},{default:t(()=>[l("div",vt,[s[17]||(s[17]=l("span",{class:"label"},"联系电话:",-1)),l("span",gt,i(n.order.customerPhone),1)])]),_:1})]),_:1}),e(S,{gutter:24},{default:t(()=>[e(p,{span:12},{default:t(()=>[l("div",yt,[s[18]||(s[18]=l("span",{class:"label"},"客户邮箱:",-1)),l("span",bt,i(n.order.customerEmail||"-"),1)])]),_:1}),e(p,{span:12},{default:t(()=>[l("div",ht,[s[19]||(s[19]=l("span",{class:"label"},"收货地址:",-1)),l("span",Vt,i(n.order.deliveryAddress),1)])]),_:1})]),_:1})]),l("div",Dt,[s[21]||(s[21]=l("h3",null,"商品信息",-1)),e(K,{data:n.order.items,border:""},{default:t(()=>[e(L,{prop:"productName",label:"产品名称"}),e(L,{prop:"quantity",label:"数量",width:"100",align:"center"}),e(L,{prop:"unitPrice",label:"单价",width:"120",align:"right"},{default:t(({row:g})=>[y(" ¥"+i(g.unitPrice.toFixed(2)),1)]),_:1}),e(L,{prop:"totalPrice",label:"小计",width:"120",align:"right"},{default:t(({row:g})=>[y(" ¥"+i(g.totalPrice.toFixed(2)),1)]),_:1}),e(L,{prop:"notes",label:"备注"})]),_:1},8,["data"])]),n.order.type==="rental"?(_(),D("div",wt,[s[26]||(s[26]=l("h3",null,"租赁信息",-1)),e(S,{gutter:24},{default:t(()=>[e(p,{span:8},{default:t(()=>[l("div",kt,[s[22]||(s[22]=l("span",{class:"label"},"租赁开始日期:",-1)),l("span",Pt,i(U(n.order.rentalStartDate)),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",$t,[s[23]||(s[23]=l("span",{class:"label"},"租赁结束日期:",-1)),l("span",Nt,i(U(n.order.rentalEndDate)),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",Ct,[s[24]||(s[24]=l("span",{class:"label"},"租赁天数:",-1)),l("span",St,i(n.order.rentalDays)+" 天",1)])]),_:1})]),_:1}),n.order.rentalNotes?(_(),O(S,{key:0,gutter:24},{default:t(()=>[e(p,{span:24},{default:t(()=>[l("div",Tt,[s[25]||(s[25]=l("span",{class:"label"},"租赁备注:",-1)),l("span",Ot,i(n.order.rentalNotes),1)])]),_:1})]),_:1})):k("",!0)])):k("",!0),l("div",At,[s[31]||(s[31]=l("h3",null,"金额信息",-1)),l("div",Et,[e(S,{gutter:24},{default:t(()=>[e(p,{span:6},{default:t(()=>[l("div",Ut,[s[27]||(s[27]=l("span",{class:"label"},"商品小计:",-1)),l("span",It,"¥"+i(M.value.toFixed(2)),1)])]),_:1}),e(p,{span:6},{default:t(()=>[l("div",Yt,[s[28]||(s[28]=l("span",{class:"label"},"运费:",-1)),l("span",Ft,"¥"+i((n.order.shippingFee||0).toFixed(2)),1)])]),_:1}),e(p,{span:6},{default:t(()=>[l("div",Mt,[s[29]||(s[29]=l("span",{class:"label"},"折扣:",-1)),l("span",qt,"-¥"+i((n.order.discount||0).toFixed(2)),1)])]),_:1}),e(p,{span:6},{default:t(()=>[l("div",zt,[s[30]||(s[30]=l("span",{class:"label"},"订单总额:",-1)),l("span",Rt,"¥"+i(n.order.totalAmount.toFixed(2)),1)])]),_:1})]),_:1})])]),n.order.paymentStatus?(_(),D("div",Bt,[s[35]||(s[35]=l("h3",null,"支付信息",-1)),e(S,{gutter:24},{default:t(()=>[e(p,{span:8},{default:t(()=>[l("div",Lt,[s[32]||(s[32]=l("span",{class:"label"},"支付状态:",-1)),e(Y,{type:R(n.order.paymentStatus),size:"small"},{default:t(()=>[y(i(H(n.order.paymentStatus)),1)]),_:1},8,["type"])])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",jt,[s[33]||(s[33]=l("span",{class:"label"},"支付方式:",-1)),l("span",Ht,i(n.order.paymentMethod||"-"),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",Xt,[s[34]||(s[34]=l("span",{class:"label"},"支付时间:",-1)),l("span",xt,i(U(n.order.paymentTime)||"-"),1)])]),_:1})]),_:1})])):k("",!0),n.order.shippingInfo?(_(),D("div",Jt,[s[39]||(s[39]=l("h3",null,"物流信息",-1)),e(S,{gutter:24},{default:t(()=>[e(p,{span:8},{default:t(()=>[l("div",Kt,[s[36]||(s[36]=l("span",{class:"label"},"物流公司:",-1)),l("span",Qt,i(n.order.shippingInfo.company||"-"),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",Gt,[s[37]||(s[37]=l("span",{class:"label"},"运单号:",-1)),l("span",Wt,i(n.order.shippingInfo.trackingNumber||"-"),1)])]),_:1}),e(p,{span:8},{default:t(()=>[l("div",Zt,[s[38]||(s[38]=l("span",{class:"label"},"发货时间:",-1)),l("span",el,i(U(n.order.shippingInfo.shippedAt)||"-"),1)])]),_:1})]),_:1})])):k("",!0),n.order.notes?(_(),D("div",tl,[s[40]||(s[40]=l("h3",null,"订单备注",-1)),l("div",ll,[l("p",null,i(n.order.notes),1)])])):k("",!0),n.order.logs&&n.order.logs.length>0?(_(),D("div",sl,[s[41]||(s[41]=l("h3",null,"操作日志",-1)),e(d,null,{default:t(()=>[(_(!0),D(Z,null,ee(n.order.logs,g=>(_(),O(v,{key:g.id,timestamp:U(g.createdAt),type:W(g.action)},{default:t(()=>[l("div",al,[l("div",ol,i(g.action),1),l("div",nl,"操作人: "+i(g.operator),1),g.notes?(_(),D("div",dl,i(g.notes),1)):k("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):k("",!0)])):k("",!0)]),_:1},8,["modelValue"])}}}),ul=ie(il,[["__scopeId","data-v-9183e5fd"]]),pl={class:"order-test-page"},ml={class:"test-actions"},cl={key:0,class:"orders-list"},_l={key:0},fl={key:1,class:"test-results"},vl={class:"test-result"},gl={class:"result-title"},yl={class:"result-message"},bl={key:0,class:"result-data"},hl=re({__name:"OrderTest",setup($){const V=A([]),c=A(!1),T=A(!1),N=A(null),M=A(null),E=A([]),h=(u,m,X,I)=>{E.value.unshift({id:Date.now().toString(),action:u,message:m,success:X,timestamp:new Date().toLocaleString(),data:I})},C=()=>{N.value=null,c.value=!0,h("打开创建对话框","销售订单创建对话框已打开",!0)},o=()=>j(null,null,function*(){try{const u=yield oe.getOrders({pageSize:10});V.value=u.data.list,h("加载订单列表",`成功加载 ${u.data.list.length} 个订单`,!0,{total:u.data.total,stats:u.data.stats}),z.success("订单列表加载成功")}catch(u){h("加载订单列表","加载失败: "+u,!1),z.error("加载订单列表失败")}}),J=u=>{M.value=u,T.value=!0,h("查看订单详情",`查看订单: ${u.orderNumber}`,!0,u)},R=u=>{N.value=u,c.value=!0,h("编辑订单",`编辑订单: ${u.orderNumber}`,!0)},H=u=>j(null,null,function*(){try{yield oe.deleteOrder(u.id),yield o(),h("删除订单",`订单 ${u.orderNumber} 删除成功`,!0),z.success("订单删除成功")}catch(m){h("删除订单","删除失败: "+m,!1),z.error("删除订单失败")}}),W=()=>{o();const u=N.value?"更新订单":"创建订单";h(u,`${u}成功`,!0)},U=u=>{T.value=!1,R(u)},n=u=>({pending:"warning",confirmed:"primary",processing:"primary",shipped:"info",delivered:"success",completed:"success",cancelled:"danger"})[u]||"info",s=u=>ve[u]||u,B=()=>j(null,null,function*(){h("开始自动测试","销售订单功能自动测试开始",!0),yield o();try{const u={type:"sales",customerName:"测试客户",customerPhone:"13800138000",customerEmail:"test@example.com",deliveryAddress:"北京市朝阳区测试地址123号",items:[{productId:"prod_001",productName:"练字机器人 - 基础版",quantity:1,unitPrice:2999,totalPrice:2999,notes:"测试商品"}],shippingFee:50,discount:0,totalAmount:3049,expectedDeliveryDate:new Date(Date.now()+6048e5).toISOString().split("T")[0],salesPerson:"测试销售员",notes:"这是一个自动测试创建的订单"},m=yield oe.createOrder(u);h("创建测试订单","测试订单创建成功",!0,m.data),yield o()}catch(u){h("创建测试订单","创建失败: "+u,!1)}h("自动测试完成","销售订单功能自动测试完成",!0)});return Ee(()=>{setTimeout(()=>{B()},1e3)}),(u,m)=>{const X=f("el-icon"),I=f("el-button"),p=f("el-table-column"),Y=f("el-tag"),S=f("el-table"),L=f("el-timeline-item"),K=f("el-timeline");return _(),D("div",pl,[m[9]||(m[9]=l("div",{class:"page-header"},[l("h2",null,"销售订单创建功能测试"),l("p",null,"测试销售订单创建、编辑、查看等功能")],-1)),l("div",ml,[e(I,{type:"primary",onClick:C},{default:t(()=>[e(X,null,{default:t(()=>[e(G(fe))]),_:1}),m[2]||(m[2]=y(" 创建销售订单 ",-1))]),_:1,__:[2]}),e(I,{onClick:o},{default:t(()=>[e(X,null,{default:t(()=>[e(G(Se))]),_:1}),m[3]||(m[3]=y(" 加载测试订单 ",-1))]),_:1,__:[3]})]),V.value.length>0?(_(),D("div",cl,[m[7]||(m[7]=l("h3",null,"测试订单列表",-1)),e(S,{data:V.value,border:""},{default:t(()=>[e(p,{prop:"orderNumber",label:"订单号",width:"150"}),e(p,{prop:"type",label:"类型",width:"100"},{default:t(({row:v})=>[e(Y,{type:v.type==="sales"?"success":"primary"},{default:t(()=>[y(i(v.type==="sales"?"销售":"租赁"),1)]),_:2},1032,["type"])]),_:1}),e(p,{prop:"customerName",label:"客户",width:"120"}),e(p,{prop:"customerPhone",label:"电话",width:"130"}),e(p,{label:"商品",width:"200"},{default:t(({row:v})=>[(_(!0),D(Z,null,ee(v.items.slice(0,2),d=>(_(),D("div",{key:d.id},i(d.productName)+" x"+i(d.quantity),1))),128)),v.items.length>2?(_(),D("div",_l," +"+i(v.items.length-2)+"个商品 ",1)):k("",!0)]),_:1}),e(p,{prop:"totalAmount",label:"总金额",width:"120"},{default:t(({row:v})=>[y(" ¥"+i(v.totalAmount.toFixed(2)),1)]),_:1}),e(p,{prop:"status",label:"状态",width:"100"},{default:t(({row:v})=>[e(Y,{type:n(v.status)},{default:t(()=>[y(i(s(v.status)),1)]),_:2},1032,["type"])]),_:1}),e(p,{label:"操作",width:"200"},{default:t(({row:v})=>[e(I,{size:"small",onClick:d=>J(v)},{default:t(()=>m[4]||(m[4]=[y("查看",-1)])),_:2,__:[4]},1032,["onClick"]),e(I,{size:"small",type:"primary",onClick:d=>R(v)},{default:t(()=>m[5]||(m[5]=[y("编辑",-1)])),_:2,__:[5]},1032,["onClick"]),e(I,{size:"small",type:"danger",onClick:d=>H(v)},{default:t(()=>m[6]||(m[6]=[y("删除",-1)])),_:2,__:[6]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):k("",!0),E.value.length>0?(_(),D("div",fl,[m[8]||(m[8]=l("h3",null,"测试结果",-1)),e(K,null,{default:t(()=>[(_(!0),D(Z,null,ee(E.value,v=>(_(),O(L,{key:v.id,timestamp:v.timestamp,type:v.success?"success":"danger"},{default:t(()=>[l("div",vl,[l("div",gl,i(v.action),1),l("div",yl,i(v.message),1),v.data?(_(),D("div",bl,[l("pre",null,i(JSON.stringify(v.data,null,2)),1)])):k("",!0)])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):k("",!0),e(We,{modelValue:c.value,"onUpdate:modelValue":m[0]||(m[0]=v=>c.value=v),order:N.value,onSuccess:W},null,8,["modelValue","order"]),e(ul,{modelValue:T.value,"onUpdate:modelValue":m[1]||(m[1]=v=>T.value=v),order:M.value,onEdit:U},null,8,["modelValue","order"])])}}}),Ol=ie(hl,[["__scopeId","data-v-dd699e09"]]);export{Ol as default};
