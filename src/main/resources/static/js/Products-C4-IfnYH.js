const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/request-mSVS5ma3.js","js/utils-T70AYnHr.js","js/element-plus-B_LfhBgj.js","js/vue-C2NPAEWw.js"])))=>i.map(i=>d[i]);
var C=(x,r,d)=>new Promise((f,_)=>{var y=p=>{try{w(d.next(p))}catch(v){_(v)}},g=p=>{try{w(d.throw(p))}catch(v){_(v)}},w=p=>p.done?f(p.value):Promise.resolve(p.value).then(y,g);w((d=d.apply(x,r)).next())});import{_ as Z}from"./index-l6li0wFN.js";import{b as m,q as Be,v as Ae,c as Ue,w as De,n as Y,x as Se}from"./element-plus-B_LfhBgj.js";/* empty css                                                                     *//* empty css                                                                         */import{C as ge}from"./CommonDialog-DmvKEX1O.js";import{D as Pe}from"./DataTable-BfvT2meh.js";import{S as Re}from"./StatusTag-C08vtP-K.js";import{x as we,r as E,c as N,j as Le,h as ke,al as k,H as K,z as V,I as s,B as Ie,y as D,K as G,D as Te,M as z,O as U,Q as l,a5 as Oe,u as A,A as c,P as he,a6 as ye,X as Ne}from"./vue-C2NPAEWw.js";import{_ as be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./charts-4xgvsrqt.js";/* empty css                                                                       */import{p as j}from"./product-B8ZysK1P.js";/* empty css                                                                  *//* empty css                                                                  */import"./request-mSVS5ma3.js";import"./utils-T70AYnHr.js";const qe=we({__name:"FormValidator",props:{modelValue:{default:()=>({})},rules:{default:()=>({})},labelWidth:{default:"120px"},labelPosition:{default:"right"},inline:{type:Boolean,default:!1},size:{default:"default"},disabled:{type:Boolean,default:!1},validateOnRuleChange:{type:Boolean,default:!0},hideRequiredAsterisk:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!0},inlineMessage:{type:Boolean,default:!1},statusIcon:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},showSubmit:{type:Boolean,default:!0},showReset:{type:Boolean,default:!0},submitText:{default:"æäº¤"},resetText:{default:"é‡ç½®"},loading:{type:Boolean,default:!1},formClass:{default:""},actionsClass:{default:""},autoValidate:{type:Boolean,default:!1},validateOnMount:{type:Boolean,default:!1}},emits:["update:modelValue","submit","reset","validate","field-change"],setup(x,{expose:r,emit:d}){const f=x,_=d,y=E(),g=N({get:()=>f.modelValue,set:i=>_("update:modelValue",i)}),w=N(()=>f.rules),p=()=>C(null,null,function*(){if(!y.value)return!1;try{return yield y.value.validate(),!0}catch(i){return console.warn("è¡¨å•éªŒè¯å¤±è´¥:",i),!1}}),v=i=>C(null,null,function*(){if(!y.value)return!1;try{return yield y.value.validateField(i),!0}catch(n){return console.warn(`å­—æ®µ ${i} éªŒè¯å¤±è´¥:`,n),!1}}),P=()=>{y.value&&y.value.resetFields(),_("reset")},M=i=>{y.value&&y.value.clearValidate(i)},S=i=>{y.value&&y.value.scrollToField(i)},R=()=>C(null,null,function*(){(yield p())?_("submit",g.value):m.warning("è¯·æ£€æŸ¥è¡¨å•å¡«å†™æ˜¯å¦æ­£ç¡®")}),q=(i,n,F)=>{_("validate",{prop:i,isValid:n,message:F})};return Le(()=>f.modelValue,(i,n)=>{n&&Object.keys(i).forEach(F=>{i[F]!==n[F]&&(_("field-change",{field:F,value:i[F],oldValue:n[F]}),f.autoValidate&&v(F))})},{deep:!0}),ke(()=>{f.validateOnMount&&p()}),r({validate:p,validateField:v,resetFields:P,clearValidate:M,scrollToField:S,getFormRef:()=>y.value}),(i,n)=>{const F=k("el-button"),L=k("el-form");return V(),K(L,{ref_key:"formRef",ref:y,model:g.value,rules:w.value,"label-width":i.labelWidth,"label-position":i.labelPosition,inline:i.inline,size:i.size,disabled:i.disabled,"validate-on-rule-change":i.validateOnRuleChange,"hide-required-asterisk":i.hideRequiredAsterisk,"show-message":i.showMessage,"inline-message":i.inlineMessage,"status-icon":i.statusIcon,onValidate:q,class:Te(["form-validator",i.formClass])},{default:s(()=>[Ie(i.$slots,"default",{form:g.value,rules:w.value},void 0,!0),i.showActions?(V(),D("div",{key:0,class:Te(["form-actions",i.actionsClass])},[Ie(i.$slots,"actions",{form:g.value,validate:p,reset:P},()=>[i.showReset?(V(),K(F,{key:0,size:i.size,onClick:P,disabled:i.disabled||i.loading},{default:s(()=>[z(U(i.resetText),1)]),_:1},8,["size","disabled"])):G("",!0),i.showSubmit?(V(),K(F,{key:1,type:"primary",size:i.size,loading:i.loading,onClick:R,disabled:i.disabled},{default:s(()=>[z(U(i.submitText),1)]),_:1},8,["size","loading","disabled"])):G("",!0)],!0)],2)):G("",!0)]),_:3},8,["model","rules","label-width","label-position","inline","size","disabled","validate-on-rule-change","hide-required-asterisk","show-message","inline-message","status-icon","class"])}}}),je=be(qe,[["__scopeId","data-v-956005f3"]]);var $=(x=>(x.DEVICE_IMAGE="device_image",x.DEVICE_DOCUMENT="device_document",x.FIRMWARE_FILE="firmware_file",x.DEVICE_MANUAL="device_manual",x.DEVICE_CERTIFICATE="device_certificate",x))($||{});const Fe={device_image:{type:"device_image",maxSize:5,allowedTypes:["image/jpeg","image/png","image/gif","image/webp"],uploadUrl:"/api/admin/devices/upload/image"},device_document:{type:"device_document",maxSize:10,allowedTypes:["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],uploadUrl:"/api/admin/devices/upload/document"},firmware_file:{type:"firmware_file",maxSize:50,allowedTypes:["application/octet-stream","application/zip","application/x-tar"],uploadUrl:"/api/admin/devices/upload/firmware"},device_manual:{type:"device_manual",maxSize:20,allowedTypes:["application/pdf"],uploadUrl:"/api/admin/devices/upload/manual"},device_certificate:{type:"device_certificate",maxSize:5,allowedTypes:["application/pdf","image/jpeg","image/png"],uploadUrl:"/api/admin/devices/upload/certificate"}};class H{static validateFile(r,d){const f=Fe[d];return f.allowedTypes.includes(r.type)?r.size/1024/1024>f.maxSize?(m.error(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${f.maxSize}MB`),!1):!0:(m.error(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹ï¼š${r.type}`),!1)}static uploadFile(r,d,f,_){return C(this,null,function*(){const y=Fe[d];if(!this.validateFile(r,d))throw new Error("æ–‡ä»¶éªŒè¯å¤±è´¥");const g=new FormData;return g.append("file",r),g.append("type",d),f&&g.append("deviceId",f),new Promise((w,p)=>{const v=new XMLHttpRequest;v.upload.addEventListener("progress",M=>{if(M.lengthComputable&&_){const S={percent:Math.round(M.loaded/M.total*100),loaded:M.loaded,total:M.total};_(S)}}),v.addEventListener("load",()=>{if(v.status===200)try{const M=JSON.parse(v.responseText);M.code===200?w(M):p(new Error(M.message||"ä¸Šä¼ å¤±è´¥"))}catch(M){p(new Error("å“åº”è§£æå¤±è´¥"))}else p(new Error(`ä¸Šä¼ å¤±è´¥ï¼šHTTP ${v.status}`))}),v.addEventListener("error",()=>{p(new Error("ç½‘ç»œé”™è¯¯"))}),v.open("POST",y.uploadUrl);const P=localStorage.getItem("token");P&&v.setRequestHeader("Authorization",`Bearer ${P}`),v.send(g)})})}static uploadFiles(r,d,f,_){return C(this,null,function*(){const y=[];for(let g=0;g<r.length;g++){const w=r[g];try{const p=yield this.uploadFile(w,d,f,v=>_==null?void 0:_(g,v));y.push(p)}catch(p){throw console.error(`æ–‡ä»¶ ${w.name} ä¸Šä¼ å¤±è´¥:`,p),p}}return y})}static deleteFile(r){return C(this,null,function*(){try{const d=yield fetch(`/api/admin/files/${r}`,{method:"DELETE",headers:{Authorization:`Bearer ${localStorage.getItem("token")}`,"Content-Type":"application/json"}});if(!d.ok)throw new Error(`åˆ é™¤å¤±è´¥ï¼šHTTP ${d.status}`);const f=yield d.json();if(f.code!==200)throw new Error(f.message||"åˆ é™¤å¤±è´¥")}catch(d){throw console.error("åˆ é™¤æ–‡ä»¶å¤±è´¥:",d),d}})}static getFileUrl(r){return`/api/admin/files/${r}/download`}static getPreviewUrl(r){return`/api/admin/files/${r}/preview`}static isImageFile(r){const d=["image/jpeg","image/png","image/gif","image/webp"];return"type"in r?d.includes(r.type||""):r.raw?d.includes(r.raw.type||""):!1}static formatFileSize(r){if(r===0)return"0 B";const d=1024,f=["B","KB","MB","GB"],_=Math.floor(Math.log(r)/Math.log(d));return parseFloat((r/Math.pow(d,_)).toFixed(2))+" "+f[_]}static getFileExtension(r){return r.slice((r.lastIndexOf(".")-1>>>0)+2)}static generateSafeFileName(r){const d=Date.now(),f=this.getFileExtension(r);return`${r.replace(/\.[^/.]+$/,"").replace(/[^a-zA-Z0-9]/g,"_")}_${d}.${f}`}}const We={class:"file-upload"},He={class:"drag-upload-area"},Ge={class:"upload-text"},Ke={class:"upload-hint"},Xe={class:"upload-tip"},Je={key:0},Qe={key:0,class:"upload-progress"},Ze={class:"progress-text"},Ye={key:1,class:"uploaded-files"},ea={class:"file-list"},aa={class:"file-info"},ta={class:"file-details"},la={class:"file-name"},oa={class:"file-size"},sa={class:"file-actions"},ia=we({__name:"FileUpload",props:{uploadType:{},deviceId:{},multiple:{type:Boolean,default:!1},limit:{default:1},drag:{type:Boolean,default:!1},listType:{default:"text"},disabled:{type:Boolean,default:!1},autoUpload:{type:Boolean,default:!0},showProgress:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!0},showTip:{type:Boolean,default:!0},triggerText:{default:"é€‰æ‹©æ–‡ä»¶"},dragText:{default:"å°†æ–‡ä»¶æ‹–åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ "},tipText:{default:"è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶"}},emits:["upload-success","upload-error","file-remove"],setup(x,{expose:r,emit:d}){const f=x,_=d,y=E(),g=E(!1),w=E(0),p=E([]),v=E([]),P=N(()=>({[$.DEVICE_IMAGE]:"/api/admin/devices/upload/image",[$.DEVICE_DOCUMENT]:"/api/admin/devices/upload/document",[$.FIRMWARE_FILE]:"/api/admin/devices/upload/firmware",[$.DEVICE_MANUAL]:"/api/admin/devices/upload/manual",[$.DEVICE_CERTIFICATE]:"/api/admin/devices/upload/certificate"})[f.uploadType]),M=N(()=>{const a=localStorage.getItem("token");return a?{Authorization:`Bearer ${a}`}:{}}),S=N(()=>({type:f.uploadType,deviceId:f.deviceId})),R=N(()=>({[$.DEVICE_IMAGE]:"image/*",[$.DEVICE_DOCUMENT]:".pdf,.doc,.docx",[$.FIRMWARE_FILE]:".zip,.tar,.bin",[$.DEVICE_MANUAL]:".pdf",[$.DEVICE_CERTIFICATE]:".pdf,image/*"})[f.uploadType]),q=N(()=>({[$.DEVICE_IMAGE]:5,[$.DEVICE_DOCUMENT]:10,[$.FIRMWARE_FILE]:50,[$.DEVICE_MANUAL]:20,[$.DEVICE_CERTIFICATE]:5})[f.uploadType]),i=N(()=>`æ”¯æŒ ${R.value} æ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡ ${q.value}MB`),n=N(()=>{if(w.value===100)return"success";if(!g.value)return"exception"}),F=N(()=>w.value===100?"ä¸Šä¼ å®Œæˆ":g.value?`ä¸Šä¼ ä¸­... ${w.value}%`:"å‡†å¤‡ä¸Šä¼ "),L=a=>H.validateFile(a,f.uploadType),se=a=>{w.value=Math.round(a.percent||0),g.value=!0},ie=(a,h)=>{g.value=!1,w.value=100,a.code===200?(p.value.push(a),_("upload-success",a),m.success("æ–‡ä»¶ä¸Šä¼ æˆåŠŸ")):ee(new Error(a.message||"ä¸Šä¼ å¤±è´¥"))},ee=(a,h)=>{g.value=!1,w.value=0,_("upload-error",a),m.error(`æ–‡ä»¶ä¸Šä¼ å¤±è´¥: ${a.message}`)},W=()=>{m.warning(`æœ€å¤šåªèƒ½ä¸Šä¼  ${f.limit} ä¸ªæ–‡ä»¶`)},re=a=>{const h=v.value.findIndex(I=>I.uid===a.uid);h>-1&&v.value.splice(h,1)},ne=a=>C(null,null,function*(){try{yield Y.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ","ç¡®è®¤åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),yield H.deleteFile(a.data.fileId);const h=p.value.findIndex(I=>I.data.fileId===a.data.fileId);h>-1&&p.value.splice(h,1),_("file-remove",a.data.fileId),m.success("æ–‡ä»¶åˆ é™¤æˆåŠŸ")}catch(h){h!=="cancel"&&m.error("æ–‡ä»¶åˆ é™¤å¤±è´¥")}}),de=a=>{const h=H.getPreviewUrl(a.data.fileId);window.open(h,"_blank")},ue=a=>{const h=H.getFileUrl(a.data.fileId),I=document.createElement("a");I.href=h,I.download=a.data.fileName,document.body.appendChild(I),I.click(),document.body.removeChild(I)},ce=a=>{const h=["pdf","jpg","jpeg","png","gif","webp"],I=H.getFileExtension(a.data.fileName).toLowerCase();return h.includes(I)},X=a=>{const h=["jpg","jpeg","png","gif","webp"],I=H.getFileExtension(a).toLowerCase();return h.includes(I)},ae=a=>H.formatFileSize(a);return r({clearFiles:()=>{var a;(a=y.value)==null||a.clearFiles(),p.value=[],v.value=[]},submit:()=>{var a;(a=y.value)==null||a.submit()}}),(a,h)=>{const I=k("el-icon"),J=k("el-button"),te=k("el-upload"),fe=k("el-progress");return V(),D("div",We,[l(te,{ref_key:"uploadRef",ref:y,action:P.value,headers:M.value,data:S.value,multiple:a.multiple,limit:a.limit,accept:R.value,"before-upload":L,"on-progress":se,"on-success":ie,"on-error":ee,"on-exceed":W,"on-remove":re,"file-list":v.value,"list-type":a.listType,drag:a.drag,disabled:a.disabled,"auto-upload":a.autoUpload,class:"upload-component"},Oe({_:2},[a.drag?void 0:{name:"trigger",fn:s(()=>[l(J,{type:"primary",loading:g.value,disabled:a.disabled},{default:s(()=>[l(I,null,{default:s(()=>[l(A(Be))]),_:1}),z(" "+U(a.triggerText),1)]),_:1},8,["loading","disabled"])]),key:"0"},a.drag?{name:"default",fn:s(()=>[c("div",He,[l(I,{class:"upload-icon"},{default:s(()=>[l(A(Ae))]),_:1}),c("div",Ge,[c("p",null,U(a.dragText),1),c("p",Ke,U(i.value),1)])])]),key:"1"}:void 0,a.showTip?{name:"tip",fn:s(()=>[c("div",Xe,[c("p",null,U(a.tipText),1),q.value?(V(),D("p",Je,"æ–‡ä»¶å¤§å°ä¸è¶…è¿‡ "+U(q.value)+"MB",1)):G("",!0)])]),key:"2"}:void 0]),1032,["action","headers","data","multiple","limit","accept","file-list","list-type","drag","disabled","auto-upload"]),g.value&&a.showProgress?(V(),D("div",Qe,[l(fe,{percentage:w.value,status:n.value,"stroke-width":6},null,8,["percentage","status"]),c("p",Ze,U(F.value),1)])):G("",!0),a.showFileList&&p.value.length>0?(V(),D("div",Ye,[h[3]||(h[3]=c("h4",null,"å·²ä¸Šä¼ æ–‡ä»¶",-1)),c("div",ea,[(V(!0),D(he,null,ye(p.value,O=>(V(),D("div",{key:O.data.fileId,class:"file-item"},[c("div",aa,[l(I,{class:"file-icon"},{default:s(()=>[X(O.data.fileName)?(V(),K(A(De),{key:1})):(V(),K(A(Ue),{key:0}))]),_:2},1024),c("div",ta,[c("p",la,U(O.data.fileName),1),c("p",oa,U(ae(O.data.fileSize)),1)])]),c("div",sa,[ce(O)?(V(),K(J,{key:0,text:"",type:"primary",size:"small",onClick:le=>de(O)},{default:s(()=>h[0]||(h[0]=[z(" é¢„è§ˆ ",-1)])),_:2,__:[0]},1032,["onClick"])):G("",!0),l(J,{text:"",type:"primary",size:"small",onClick:le=>ue(O)},{default:s(()=>h[1]||(h[1]=[z(" ä¸‹è½½ ",-1)])),_:2,__:[1]},1032,["onClick"]),l(J,{text:"",type:"danger",size:"small",onClick:le=>ne(O),disabled:a.disabled},{default:s(()=>h[2]||(h[2]=[z(" åˆ é™¤ ",-1)])),_:2,__:[2]},1032,["onClick","disabled"])])]))),128))])])):G("",!0)])}}}),Me=be(ia,[["__scopeId","data-v-0cffc807"]]),ra={class:"products-management"},na={class:"page-header"},da={class:"header-right"},ua={key:1,class:"no-image"},ca={class:"price-text"},pa={class:"media-management"},ma={class:"media-tabs"},fa={class:"media-section"},va={class:"section-header"},_a={class:"media-grid"},ga={class:"media-actions"},ha={class:"media-sort"},ya={class:"media-section"},wa={class:"section-header"},ba={class:"media-grid"},Ea=["src"],Ca={class:"media-actions"},Va={class:"media-sort"},Ia={class:"media-upload-form"},Ta=we({__name:"Products",setup(x){const r=E(!1),d=E(!1),f=E(!1),_=E(!1),y=E(!1),g=E(!1),w=E("add"),p=E(null),v=E("image"),P=E("images"),M=E(),S=E([]),R=E({page:1,size:20,total:0}),q=E([{id:1,product_id:1,media_type:"image",media_url:"https://via.placeholder.com/300x200",sort_order:1},{id:2,product_id:1,media_type:"image",media_url:"https://via.placeholder.com/300x200",sort_order:2}]),i=E([{id:3,product_id:1,media_type:"video",media_url:"https://www.w3schools.com/html/mov_bbb.mp4",sort_order:1}]),n=E({name:"",model:"",description:"",price:0,status:"draft",cover_files:[]}),F=Ne({sort_order:1}),L=E([]),se={name:[{required:!0,message:"è¯·è¾“å…¥äº§å“åç§°",trigger:"blur"}],model:[{required:!0,message:"è¯·è¾“å…¥äº§å“å‹å·",trigger:"blur"}],price:[{required:!0,message:"è¯·è¾“å…¥äº§å“ä»·æ ¼",trigger:"blur"}],status:[{required:!0,message:"è¯·é€‰æ‹©äº§å“çŠ¶æ€",trigger:"change"}]},ie=[{prop:"id",label:"ID",width:80},{prop:"cover_image_url",label:"å°é¢å›¾ç‰‡",width:100},{prop:"name",label:"äº§å“åç§°",minWidth:150},{prop:"model",label:"äº§å“å‹å·",width:120},{prop:"price",label:"ä»·æ ¼",width:100},{prop:"status",label:"çŠ¶æ€",width:100},{prop:"createdAt",label:"åˆ›å»ºæ—¶é—´",width:160,type:"date"},{prop:"updatedAt",label:"æ›´æ–°æ—¶é—´",width:160,type:"date"}],ee=t=>t.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),W=()=>C(null,null,function*(){console.log("ğŸš€ å¼€å§‹åŠ è½½äº§å“åˆ—è¡¨..."),r.value=!0;try{console.log("ğŸ“¡ è°ƒç”¨API:",{page:R.value.page,size:R.value.size});const t=yield j.getProducts({page:R.value.page,size:R.value.size});console.log("ğŸ“¥ APIå“åº”:",t),t.code===200?(S.value=t.data.list||[],R.value.total=t.data.total||0,console.log("âœ… äº§å“åˆ—è¡¨åŠ è½½æˆåŠŸ:",{count:S.value.length,total:R.value.total,firstProduct:S.value[0],timeFields:S.value.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,created_at:e.created_at,updated_at:e.updated_at}))})):(console.error("âŒ APIè¿”å›é”™è¯¯:",t),m.error(t.message||"è·å–äº§å“åˆ—è¡¨å¤±è´¥"))}catch(t){console.error("ğŸ’¥ è·å–äº§å“åˆ—è¡¨å¤±è´¥:",t),m.error("è·å–äº§å“åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"),S.value=[]}finally{r.value=!1}}),re=()=>{w.value="add",te(),d.value=!0},ne=t=>{w.value="edit",p.value=t,Object.assign(n.value,{name:t.name,model:t.model,description:t.description,price:t.price,status:t.status,cover_files:[]}),d.value=!0},de=t=>C(null,null,function*(){try{yield Y.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªäº§å“å—ï¼Ÿ","åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),console.log("ğŸ—‘ï¸ å¼€å§‹åˆ é™¤äº§å“:",t.id,t.name);const e=yield j.deleteProduct(t.id.toString());if(console.log("ğŸ—‘ï¸ åˆ é™¤APIå“åº”:",e),e.code===200){m.success("äº§å“åˆ é™¤æˆåŠŸ"),console.log("ğŸ”„ åˆ é™¤æˆåŠŸï¼Œæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½äº§å“åˆ—è¡¨...");const{clearCache:u}=yield Z(()=>C(null,null,function*(){const{clearCache:T}=yield import("./request-mSVS5ma3.js");return{clearCache:T}}),__vite__mapDeps([0,1,2,3]));u("/admin/products"),W()}else m.error(e.message||"åˆ é™¤å¤±è´¥")}catch(e){e!=="cancel"&&(console.error("åˆ é™¤äº§å“å¤±è´¥:",e),m.error("åˆ é™¤äº§å“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"))}}),ue=t=>C(null,null,function*(){try{yield Y.confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${t.length} ä¸ªäº§å“å—ï¼Ÿ`,"æ‰¹é‡åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),m.success("äº§å“æ‰¹é‡åˆ é™¤æˆåŠŸ");const{clearCache:e}=yield Z(()=>C(null,null,function*(){const{clearCache:u}=yield import("./request-mSVS5ma3.js");return{clearCache:u}}),__vite__mapDeps([0,1,2,3]));e("/admin/products"),W()}catch(e){}}),ce=t=>{p.value=t,f.value=!0,X(t.id)},X=t=>C(null,null,function*(){console.log("åŠ è½½äº§å“åª’ä½“:",t);try{const e=yield j.getProductMedia(t.toString());if(e.code===200){const u=e.data.filter(b=>b.media_type==="image"),T=e.data.filter(b=>b.media_type==="video");q.value=u,i.value=T,console.log("æˆåŠŸåŠ è½½äº§å“åª’ä½“ - å›¾ç‰‡:",u.length,"è§†é¢‘:",T.length)}else m.error(e.message||"è·å–äº§å“åª’ä½“å¤±è´¥")}catch(e){console.error("è·å–äº§å“åª’ä½“å¤±è´¥:",e),m.error("è·å–äº§å“åª’ä½“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}),ae=t=>{v.value=t,F.sort_order=1,L.value=[],_.value=!0},pe=t=>C(null,null,function*(){var e;try{const{value:u}=yield Y.prompt("è¯·è¾“å…¥æ–°çš„æ’åºå€¼","ç¼–è¾‘åª’ä½“",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",inputValue:t.sort_order.toString(),inputPattern:/^\d+$/,inputErrorMessage:"è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"}),T=parseInt(u),b=yield j.updateProductMedia(t.id.toString(),T);if(b.code===200){m.success("åª’ä½“ä¿¡æ¯æ›´æ–°æˆåŠŸ");const{clearCache:B}=yield Z(()=>C(null,null,function*(){const{clearCache:Q}=yield import("./request-mSVS5ma3.js");return{clearCache:Q}}),__vite__mapDeps([0,1,2,3]));B("/admin/products"),X((e=p.value)==null?void 0:e.id)}else m.error(b.message||"æ›´æ–°å¤±è´¥")}catch(u){u!=="cancel"&&(console.error("æ›´æ–°åª’ä½“ä¿¡æ¯å¤±è´¥:",u),m.error("æ›´æ–°åª’ä½“ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"))}}),me=t=>C(null,null,function*(){var e;try{yield Y.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåª’ä½“æ–‡ä»¶å—ï¼Ÿ","åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const u=yield j.deleteProductMedia(t.id.toString());if(u.code===200){m.success("åª’ä½“æ–‡ä»¶åˆ é™¤æˆåŠŸ");const{clearCache:T}=yield Z(()=>C(null,null,function*(){const{clearCache:b}=yield import("./request-mSVS5ma3.js");return{clearCache:b}}),__vite__mapDeps([0,1,2,3]));T("/admin/products"),X((e=p.value)==null?void 0:e.id)}else m.error(u.message||"åˆ é™¤å¤±è´¥")}catch(u){u!=="cancel"&&(console.error("åˆ é™¤åª’ä½“æ–‡ä»¶å¤±è´¥:",u),m.error("åˆ é™¤åª’ä½“æ–‡ä»¶å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"))}}),a=()=>C(null,null,function*(){var e;if(yield(e=M.value)==null?void 0:e.validate()){y.value=!0;try{let u,T=null;if(n.value.cover_files&&n.value.cover_files.length>0){const b=n.value.cover_files[0];b.response&&b.response.code===200?T=b.response.data.url:b.url&&(T=b.url)}if(w.value==="add"){const b={name:n.value.name,model:n.value.model,description:n.value.description,price:n.value.price,status:n.value.status,cover_image_url:T};u=yield j.createProductWithUrls(b)}else{const b={name:n.value.name,model:n.value.model,description:n.value.description,price:n.value.price,status:n.value.status,cover_image_url:T};u=yield j.updateProductWithUrls(p.value.id.toString(),b)}if(u.code===200){m.success(`äº§å“${w.value==="add"?"åˆ›å»º":"æ›´æ–°"}æˆåŠŸ`),d.value=!1;const{clearCache:b}=yield Z(()=>C(null,null,function*(){const{clearCache:B}=yield import("./request-mSVS5ma3.js");return{clearCache:B}}),__vite__mapDeps([0,1,2,3]));b("/admin/products"),W()}else m.error(u.message||`${w.value==="add"?"åˆ›å»º":"æ›´æ–°"}å¤±è´¥`)}catch(u){console.error("ä¿å­˜äº§å“å¤±è´¥:",u),m.error(`äº§å“${w.value==="add"?"åˆ›å»º":"æ›´æ–°"}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`)}finally{y.value=!1}}}),h=()=>{d.value=!1,te()},I=()=>C(null,null,function*(){var t;if(L.value.length===0){m.warning("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶");return}g.value=!0;try{const e=L.value[0];let u=null;if(e.response&&e.response.code===200)u=e.response.data.url;else if(e.url)u=e.url;else{m.error("æ–‡ä»¶ä¸Šä¼ æœªå®Œæˆï¼Œè¯·ç­‰å¾…ä¸Šä¼ å®Œæˆåå†ä¿å­˜");return}const T=yield j.uploadProductMedia(p.value.id.toString(),v.value,F.sort_order,e.raw);if(T.code===200){m.success("åª’ä½“æ–‡ä»¶ä¿å­˜æˆåŠŸ"),_.value=!1;const{clearCache:b}=yield Z(()=>C(null,null,function*(){const{clearCache:B}=yield import("./request-mSVS5ma3.js");return{clearCache:B}}),__vite__mapDeps([0,1,2,3]));b("/admin/products"),X((t=p.value)==null?void 0:t.id)}else m.error(T.message||"ä¿å­˜å¤±è´¥")}catch(e){console.error("ä¿å­˜åª’ä½“æ–‡ä»¶å¤±è´¥:",e),m.error("ä¿å­˜åª’ä½“æ–‡ä»¶å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{g.value=!1}}),J=()=>{_.value=!1,L.value=[]},te=()=>{Object.assign(n.value,{name:"",model:"",description:"",price:0,status:"draft",cover_files:[]})},fe=(t,e)=>{console.log("å°é¢ä¸Šä¼ æˆåŠŸ:",t),t.code===200?(m.success("å°é¢ä¸Šä¼ æˆåŠŸ"),e.url=t.data.url,e.response=t):m.error(t.message||"å°é¢ä¸Šä¼ å¤±è´¥")},O=(t,e)=>{console.error("å°é¢ä¸Šä¼ å¤±è´¥:",t),m.error("å°é¢ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")},le=(t,e)=>{console.log("åª’ä½“ä¸Šä¼ æˆåŠŸ:",t),t.code===200?(m.success("åª’ä½“æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"),e.url=t.data.url,e.response=t):m.error(t.message||"åª’ä½“ä¸Šä¼ å¤±è´¥")},$e=(t,e)=>{console.error("åª’ä½“ä¸Šä¼ å¤±è´¥:",t),m.error("åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")};return ke(()=>{W()}),(t,e)=>{const u=k("el-button"),T=k("el-image"),b=k("el-input"),B=k("el-form-item"),Q=k("el-col"),Ee=k("el-row"),Ce=k("el-input-number"),ve=k("el-option"),ze=k("el-select"),Ve=k("el-tab-pane"),xe=k("el-tabs");return V(),D("div",ra,[c("div",na,[e[16]||(e[16]=c("div",{class:"header-left"},[c("h2",null,"äº§å“ç®¡ç†"),c("p",{class:"header-subtitle"},"333ç®¡ç†å®˜ç½‘å±•ç¤ºçš„äº§å“ä¿¡æ¯ã€åª’ä½“æ–‡ä»¶å’ŒçŠ¶æ€")],-1)),c("div",da,[l(u,{type:"primary",icon:A(Se),onClick:re},{default:s(()=>e[15]||(e[15]=[z(" æ–°å¢äº§å“ ",-1)])),_:1,__:[15]},8,["icon"])])]),l(A(Pe),{data:S.value,columns:ie,loading:r.value,"show-selection":"","show-edit":!1,"show-delete":!1,onBatchDelete:ue,onRefresh:W},{cover_image_url:s(({row:o})=>[o.cover_image_url?(V(),K(T,{key:0,src:o.cover_image_url,"preview-src-list":[o.cover_image_url],fit:"cover",class:"product-cover"},null,8,["src","preview-src-list"])):(V(),D("span",ua,"æš‚æ— å›¾ç‰‡"))]),status:s(({row:o})=>[l(A(Re),{status:o.status},null,8,["status"])]),price:s(({row:o})=>[c("span",ca,"Â¥"+U(ee(o.price)),1)]),actions:s(({row:o})=>[l(u,{type:"primary",size:"small",text:"",onClick:oe=>ne(o)},{default:s(()=>e[17]||(e[17]=[z(" ç¼–è¾‘ ",-1)])),_:2,__:[17]},1032,["onClick"]),l(u,{type:"info",size:"small",text:"",onClick:oe=>ce(o)},{default:s(()=>e[18]||(e[18]=[z(" åª’ä½“ç®¡ç† ",-1)])),_:2,__:[18]},1032,["onClick"]),l(u,{type:"danger",size:"small",text:"",onClick:oe=>de(o)},{default:s(()=>e[19]||(e[19]=[z(" åˆ é™¤ ",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1},8,["data","loading"]),l(A(ge),{modelValue:d.value,"onUpdate:modelValue":e[7]||(e[7]=o=>d.value=o),title:w.value==="add"?"æ–°å¢äº§å“":"ç¼–è¾‘äº§å“",width:"800px",onConfirm:a,onCancel:h,"confirm-loading":y.value},{default:s(()=>[l(A(je),{ref_key:"productFormRef",ref:M,modelValue:n.value,"onUpdate:modelValue":e[6]||(e[6]=o=>n.value=o),rules:se,"label-width":"100px","show-actions":!1},{default:s(()=>[l(Ee,{gutter:20},{default:s(()=>[l(Q,{span:12},{default:s(()=>[l(B,{label:"äº§å“åç§°",prop:"name"},{default:s(()=>[l(b,{modelValue:n.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>n.value.name=o),placeholder:"è¯·è¾“å…¥äº§å“åç§°"},null,8,["modelValue"])]),_:1})]),_:1}),l(Q,{span:12},{default:s(()=>[l(B,{label:"äº§å“å‹å·",prop:"model"},{default:s(()=>[l(b,{modelValue:n.value.model,"onUpdate:modelValue":e[1]||(e[1]=o=>n.value.model=o),placeholder:"è¯·è¾“å…¥äº§å“å‹å·"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Ee,{gutter:20},{default:s(()=>[l(Q,{span:12},{default:s(()=>[l(B,{label:"äº§å“ä»·æ ¼",prop:"price"},{default:s(()=>[l(Ce,{modelValue:n.value.price,"onUpdate:modelValue":e[2]||(e[2]=o=>n.value.price=o),min:0,precision:2,placeholder:"è¯·è¾“å…¥äº§å“ä»·æ ¼",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(Q,{span:12},{default:s(()=>[l(B,{label:"äº§å“çŠ¶æ€",prop:"status"},{default:s(()=>[l(ze,{modelValue:n.value.status,"onUpdate:modelValue":e[3]||(e[3]=o=>n.value.status=o),placeholder:"è¯·é€‰æ‹©äº§å“çŠ¶æ€"},{default:s(()=>[l(ve,{label:"è‰ç¨¿",value:"draft"}),l(ve,{label:"å·²å‘å¸ƒ",value:"published"}),l(ve,{label:"å·²å½’æ¡£",value:"archived"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(B,{label:"äº§å“æè¿°",prop:"description"},{default:s(()=>[l(b,{modelValue:n.value.description,"onUpdate:modelValue":e[4]||(e[4]=o=>n.value.description=o),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥äº§å“æè¿°"},null,8,["modelValue"])]),_:1}),l(B,{label:"äº§å“å°é¢"},{default:s(()=>[l(A(Me),{modelValue:n.value.cover_files,"onUpdate:modelValue":e[5]||(e[5]=o=>n.value.cover_files=o),limit:1,accept:"image/*","list-type":"picture-card","max-size":5,"upload-text":"ä¸Šä¼ å°é¢",action:"/api/v1/upload/product/cover","auto-upload":!0,onSuccess:fe,onError:O},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title","confirm-loading"]),l(A(ge),{modelValue:f.value,"onUpdate:modelValue":e[11]||(e[11]=o=>f.value=o),title:"äº§å“åª’ä½“ç®¡ç†",width:"1000px","show-footer":!1},{default:s(()=>[c("div",pa,[c("div",ma,[l(xe,{modelValue:P.value,"onUpdate:modelValue":e[10]||(e[10]=o=>P.value=o)},{default:s(()=>[l(Ve,{label:"äº§å“å›¾ç‰‡",name:"images"},{default:s(()=>[c("div",fa,[c("div",va,[e[21]||(e[21]=c("h4",null,"äº§å“å›¾ç‰‡",-1)),l(u,{type:"primary",size:"small",onClick:e[8]||(e[8]=o=>ae("image"))},{default:s(()=>e[20]||(e[20]=[z(" æ·»åŠ å›¾ç‰‡ ",-1)])),_:1,__:[20]})]),c("div",_a,[(V(!0),D(he,null,ye(q.value,(o,oe)=>(V(),D("div",{key:o.id,class:"media-item"},[l(T,{src:o.media_url,fit:"cover",class:"media-preview","preview-src-list":[o.media_url]},null,8,["src","preview-src-list"]),c("div",ga,[l(u,{size:"small",type:"primary",text:"",onClick:_e=>pe(o)},{default:s(()=>e[22]||(e[22]=[z(" ç¼–è¾‘ ",-1)])),_:2,__:[22]},1032,["onClick"]),l(u,{size:"small",type:"danger",text:"",onClick:_e=>me(o)},{default:s(()=>e[23]||(e[23]=[z(" åˆ é™¤ ",-1)])),_:2,__:[23]},1032,["onClick"])]),c("div",ha,[c("span",null,"æ’åº: "+U(o.sort_order),1)])]))),128))])])]),_:1}),l(Ve,{label:"äº§å“è§†é¢‘",name:"videos"},{default:s(()=>[c("div",ya,[c("div",wa,[e[25]||(e[25]=c("h4",null,"äº§å“è§†é¢‘",-1)),l(u,{type:"primary",size:"small",onClick:e[9]||(e[9]=o=>ae("video"))},{default:s(()=>e[24]||(e[24]=[z(" æ·»åŠ è§†é¢‘ ",-1)])),_:1,__:[24]})]),c("div",ba,[(V(!0),D(he,null,ye(i.value,(o,oe)=>(V(),D("div",{key:o.id,class:"media-item video-item"},[c("video",{src:o.media_url,controls:"",class:"media-preview"},null,8,Ea),c("div",Ca,[l(u,{size:"small",type:"primary",text:"",onClick:_e=>pe(o)},{default:s(()=>e[26]||(e[26]=[z(" ç¼–è¾‘ ",-1)])),_:2,__:[26]},1032,["onClick"]),l(u,{size:"small",type:"danger",text:"",onClick:_e=>me(o)},{default:s(()=>e[27]||(e[27]=[z(" åˆ é™¤ ",-1)])),_:2,__:[27]},1032,["onClick"])]),c("div",Va,[c("span",null,"æ’åº: "+U(o.sort_order),1)])]))),128))])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"]),l(A(ge),{modelValue:_.value,"onUpdate:modelValue":e[14]||(e[14]=o=>_.value=o),title:`ä¸Šä¼ ${v.value==="image"?"å›¾ç‰‡":"è§†é¢‘"}`,width:"600px",onConfirm:I,onCancel:J,"confirm-loading":g.value},{default:s(()=>[c("div",Ia,[l(B,{label:"åª’ä½“æ–‡ä»¶"},{default:s(()=>[l(A(Me),{modelValue:L.value,"onUpdate:modelValue":e[12]||(e[12]=o=>L.value=o),limit:1,accept:v.value==="image"?"image/*":"video/*","list-type":v.value==="image"?"picture-card":"text","max-size":v.value==="image"?10:100,"upload-text":`é€‰æ‹©${v.value==="image"?"å›¾ç‰‡":"è§†é¢‘"}`,action:"/api/v1/upload/product",data:{mediaType:v.value},"auto-upload":!0,onSuccess:le,onError:$e},null,8,["modelValue","accept","list-type","max-size","upload-text","data"])]),_:1}),l(B,{label:"æ’åº"},{default:s(()=>[l(Ce,{modelValue:F.sort_order,"onUpdate:modelValue":e[13]||(e[13]=o=>F.sort_order=o),min:0,placeholder:"è¯·è¾“å…¥æ’åºå€¼",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),_:1},8,["modelValue","title","confirm-loading"])])}}}),ja=be(Ta,[["__scopeId","data-v-7049c48e"]]);export{ja as default};
