var b=(D,T,m)=>new Promise((w,h)=>{var C=n=>{try{V(m.next(n))}catch(N){h(N)}},d=n=>{try{V(m.throw(n))}catch(N){h(N)}},V=n=>n.done?w(n.value):Promise.resolve(n.value).then(C,d);V((m=m.apply(D,T)).next())});import{x as de,a7 as re,a8 as ie,C as ce,a9 as ue,j as pe,k as _e,b as r,n as M}from"./element-plus-B_LfhBgj.js";import{o as x}from"./order-DqRMPNN_.js";import{x as me,r as y,c as ve,h as fe,al as _,ar as he,y as z,z as S,A as l,K as U,Q as t,I as s,M as i,u as k,O as c,J as ge,H as be,P as ye,a6 as we}from"./vue-C2NPAEWw.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-mSVS5ma3.js";import"./utils-T70AYnHr.js";const Oe={class:"order-management"},ke={class:"page-header"},Ve={class:"header-right"},xe={class:"order-stats"},Se={class:"stat-card"},Te={class:"stat-icon sales"},Ne={class:"stat-content"},Me={class:"stat-value"},ze={class:"stat-amount"},Ae={class:"stat-card rental"},Be={class:"stat-icon"},De={class:"stat-content"},Le={class:"stat-value"},Re={class:"stat-amount"},Ue={class:"stat-card pending"},$e={class:"stat-icon"},Ee={class:"stat-content"},Fe={class:"stat-value"},Ie={class:"stat-card completed"},Ke={class:"stat-icon"},Pe={class:"stat-content"},je={class:"stat-value"},qe={class:"filter-section"},He={class:"filter-controls"},Je={class:"orders-table"},Qe={class:"products-cell"},Ge={key:0,class:"more-products"},We={key:0,class:"batch-actions"},Xe={class:"selected-info"},Ye={class:"batch-buttons"},Ze=me({__name:"OrderManagement",setup(D){const T=y(!1),m=y(""),w=y(""),h=y(null),C=y(""),d=y([]),V=y([]),n=y({total:0,pending:0,processing:0,completed:0,cancelled:0,totalRevenue:0,averageOrderValue:0,salesOrders:0,rentalOrders:0}),N=ve(()=>{let a=[...V.value];if(m.value&&(a=a.filter(e=>e.type===m.value)),w.value&&(a=a.filter(e=>e.status===w.value)),h.value){const[e,u]=h.value;a=a.filter(v=>{const p=new Date(v.createdAt).getTime();return p>=new Date(e).getTime()&&p<=new Date(u).getTime()})}if(C.value){const e=C.value.toLowerCase();a=a.filter(u=>u.orderNumber.toLowerCase().includes(e)||u.customerName.toLowerCase().includes(e)||u.customerPhone.includes(e))}return a}),g=()=>b(null,null,function*(){T.value=!0;try{const a=yield x.getOrders({keyword:C.value,type:m.value,status:w.value,dateRange:h.value||void 0});V.value=a.data.list||[],n.value=a.data.stats||{total:0,pending:0,processing:0,completed:0,cancelled:0,totalRevenue:0,averageOrderValue:0,salesOrders:0,rentalOrders:0}}catch(a){console.error("加载订单列表失败:",a),r.error("加载订单列表失败")}finally{T.value=!1}}),A=()=>{g()},$=()=>{g()},E=a=>{d.value=a.map(e=>e.id)},F=()=>{d.value=[]},I=()=>{r.info("创建订单功能开发中...")},K=a=>{r.info(`查看订单: ${a.orderNumber}`)},P=a=>{r.info(`编辑订单: ${a.orderNumber}`)},j=(a,e)=>b(null,null,function*(){switch(a){case"ship":yield q(e);break;case"complete":yield H(e);break;case"cancel":yield J(e);break}}),q=a=>b(null,null,function*(){try{yield M.confirm("确定要发货这个订单吗？","确认发货"),yield x.updateOrderStatus(a.id,"shipped"),r.success("订单已发货"),g()}catch(e){e!=="cancel"&&(console.error("发货失败:",e),r.error("发货失败"))}}),H=a=>b(null,null,function*(){try{yield M.confirm("确定要完成这个订单吗？","确认完成"),yield x.updateOrderStatus(a.id,"completed"),r.success("订单已完成"),g()}catch(e){e!=="cancel"&&(console.error("完成订单失败:",e),r.error("完成订单失败"))}}),J=a=>b(null,null,function*(){try{yield M.confirm("确定要取消这个订单吗？","确认取消",{type:"warning"}),yield x.updateOrderStatus(a.id,"cancelled"),r.success("订单已取消"),g()}catch(e){e!=="cancel"&&(console.error("取消订单失败:",e),r.error("取消订单失败"))}}),Q=()=>b(null,null,function*(){if(d.value.length!==0)try{yield M.confirm(`确定要批量发货 ${d.value.length} 个订单吗？`,"确认批量发货"),yield x.batchUpdateOrderStatus(d.value,"shipped"),r.success("批量发货成功"),d.value=[],g()}catch(a){a!=="cancel"&&(console.error("批量发货失败:",a),r.error("批量发货失败"))}}),G=()=>b(null,null,function*(){if(d.value.length!==0)try{yield M.confirm(`确定要批量取消 ${d.value.length} 个订单吗？`,"确认批量取消",{type:"warning"}),yield x.batchUpdateOrderStatus(d.value,"cancelled"),r.success("批量取消成功"),d.value=[],g()}catch(a){a!=="cancel"&&(console.error("批量取消失败:",a),r.error("批量取消失败"))}}),W=a=>a==="sales"?"success":"warning",X=a=>a==="sales"?"销售":"租赁",Y=a=>({pending:"info",paid:"warning",shipped:"primary",completed:"success",cancelled:"danger"})[a]||"info",Z=a=>({pending:"待付款",paid:"已付款",shipped:"已发货",completed:"已完成",cancelled:"已取消"})[a]||a,ee=a=>["pending","paid"].includes(a.status);return fe(()=>{g()}),(a,e)=>{const u=_("el-icon"),v=_("el-button"),p=_("el-option"),L=_("el-select"),te=_("el-date-picker"),ae=_("el-input"),f=_("el-table-column"),R=_("el-tag"),B=_("el-dropdown-item"),le=_("el-dropdown-menu"),se=_("el-dropdown"),oe=_("el-table"),ne=he("loading");return S(),z("div",Oe,[l("div",ke,[e[5]||(e[5]=l("div",{class:"header-left"},[l("h2",null,"订单管理"),l("p",{class:"header-subtitle"},"销售订单和租赁订单统一管理")],-1)),l("div",Ve,[t(v,{type:"primary",onClick:I},{default:s(()=>[t(u,null,{default:s(()=>[t(k(de))]),_:1}),e[4]||(e[4]=i(" 创建订单 ",-1))]),_:1,__:[4]})])]),l("div",xe,[l("div",Se,[l("div",Te,[t(u,null,{default:s(()=>[t(k(re))]),_:1})]),l("div",Ne,[l("div",Me,c(n.value.salesOrders),1),e[6]||(e[6]=l("div",{class:"stat-label"},"销售订单",-1)),l("div",ze,"¥"+c((n.value.totalRevenue*.7).toLocaleString()),1)])]),l("div",Ae,[l("div",Be,[t(u,null,{default:s(()=>[t(k(ie))]),_:1})]),l("div",De,[l("div",Le,c(n.value.rentalOrders),1),e[7]||(e[7]=l("div",{class:"stat-label"},"租赁订单",-1)),l("div",Re,"¥"+c((n.value.totalRevenue*.3).toLocaleString()),1)])]),l("div",Ue,[l("div",$e,[t(u,null,{default:s(()=>[t(k(ce))]),_:1})]),l("div",Ee,[l("div",Fe,c(n.value.pending),1),e[8]||(e[8]=l("div",{class:"stat-label"},"待处理",-1))])]),l("div",Ie,[l("div",Ke,[t(u,null,{default:s(()=>[t(k(ue))]),_:1})]),l("div",Pe,[l("div",je,c(n.value.completed),1),e[9]||(e[9]=l("div",{class:"stat-label"},"已完成",-1))])])]),l("div",qe,[l("div",He,[t(L,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),placeholder:"订单类型",onChange:A},{default:s(()=>[t(p,{label:"全部类型",value:""}),t(p,{label:"销售订单",value:"sales"}),t(p,{label:"租赁订单",value:"rental"})]),_:1},8,["modelValue"]),t(L,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),placeholder:"订单状态",onChange:A},{default:s(()=>[t(p,{label:"全部状态",value:""}),t(p,{label:"待付款",value:"pending"}),t(p,{label:"已付款",value:"paid"}),t(p,{label:"已发货",value:"shipped"}),t(p,{label:"已完成",value:"completed"}),t(p,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),t(te,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=o=>h.value=o),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",onChange:A},null,8,["modelValue"]),t(ae,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=o=>C.value=o),placeholder:"搜索订单号或客户","prefix-icon":k(pe),clearable:"",onInput:$},null,8,["modelValue","prefix-icon"])])]),l("div",Je,[ge((S(),be(oe,{data:N.value,onSelectionChange:E,"row-key":"id"},{default:s(()=>[t(f,{type:"selection",width:"55"}),t(f,{prop:"orderNumber",label:"订单号",width:"150",sortable:""}),t(f,{prop:"type",label:"类型",width:"100"},{default:s(({row:o})=>[t(R,{type:W(o.type),size:"small"},{default:s(()=>[i(c(X(o.type)),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"customerName",label:"客户",width:"120"}),t(f,{prop:"items",label:"产品","min-width":"200"},{default:s(({row:o})=>[l("div",Qe,[(S(!0),z(ye,null,we(o.items.slice(0,2),O=>(S(),z("div",{key:O.id,class:"product-item"},c(O.productName)+" ×"+c(O.quantity),1))),128)),o.items.length>2?(S(),z("div",Ge," +"+c(o.items.length-2)+"个商品 ",1)):U("",!0)])]),_:1}),t(f,{prop:"totalAmount",label:"订单金额",width:"120",sortable:""},{default:s(({row:o})=>[i(" ¥"+c(o.totalAmount.toLocaleString()),1)]),_:1}),t(f,{prop:"status",label:"状态",width:"100"},{default:s(({row:o})=>[t(R,{type:Y(o.status),size:"small"},{default:s(()=>[i(c(Z(o.status)),1)]),_:2},1032,["type"])]),_:1}),t(f,{prop:"createdAt",label:"创建时间",width:"150",sortable:""}),t(f,{label:"操作",width:"150",fixed:"right"},{default:s(({row:o})=>[t(v,{size:"small",text:"",onClick:O=>K(o)},{default:s(()=>e[10]||(e[10]=[i(" 查看 ",-1)])),_:2,__:[10]},1032,["onClick"]),t(v,{size:"small",text:"",onClick:O=>P(o)},{default:s(()=>e[11]||(e[11]=[i(" 编辑 ",-1)])),_:2,__:[11]},1032,["onClick"]),t(se,{onCommand:O=>j(O,o)},{dropdown:s(()=>[t(le,null,{default:s(()=>[t(B,{command:"ship",disabled:o.status!=="paid"},{default:s(()=>e[13]||(e[13]=[i(" 发货 ",-1)])),_:2,__:[13]},1032,["disabled"]),t(B,{command:"complete",disabled:o.status!=="shipped"},{default:s(()=>e[14]||(e[14]=[i(" 完成 ",-1)])),_:2,__:[14]},1032,["disabled"]),t(B,{command:"cancel",disabled:!ee(o)},{default:s(()=>e[15]||(e[15]=[i(" 取消 ",-1)])),_:2,__:[15]},1032,["disabled"])]),_:2},1024)]),default:s(()=>[t(v,{size:"small",text:""},{default:s(()=>[e[12]||(e[12]=i(" 更多",-1)),t(u,null,{default:s(()=>[t(k(_e))]),_:1})]),_:1,__:[12]})]),_:2},1032,["onCommand"])]),_:1})]),_:1},8,["data"])),[[ne,T.value]])]),d.value.length>0?(S(),z("div",We,[l("div",Xe," 已选择 "+c(d.value.length)+" 个订单 ",1),l("div",Ye,[t(v,{size:"small",onClick:Q},{default:s(()=>e[16]||(e[16]=[i("批量发货",-1)])),_:1,__:[16]}),t(v,{size:"small",onClick:G,type:"danger"},{default:s(()=>e[17]||(e[17]=[i("批量取消",-1)])),_:1,__:[17]}),t(v,{size:"small",onClick:F},{default:s(()=>e[18]||(e[18]=[i("取消选择",-1)])),_:1,__:[18]})])])):U("",!0)])}}}),dt=Ce(Ze,[["__scopeId","data-v-8846191b"]]);export{dt as default};
