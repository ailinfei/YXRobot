var E=Object.defineProperty;var u=Object.getOwnPropertySymbols;var h=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var m=(s,e,t)=>e in s?E(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,c=(s,e)=>{for(var t in e||(e={}))h.call(e,t)&&m(s,t,e[t]);if(u)for(var t of u(e))S.call(e,t)&&m(s,t,e[t]);return s};var n=(s,e,t)=>m(s,typeof e!="symbol"?e+"":e,t);var g=(s,e,t)=>new Promise((o,l)=>{var f=r=>{try{a(t.next(r))}catch(i){l(i)}},I=r=>{try{a(t.throw(r))}catch(i){l(i)}},a=r=>r.done?o(r.value):Promise.resolve(r.value).then(f,I);a((t=t.apply(s,e)).next())});class U{constructor(){n(this,"TOKEN_KEY","token");n(this,"USER_INFO_KEY","userInfo");n(this,"REMEMBER_KEY","remember_login")}login(e){return g(this,null,function*(){try{if(yield new Promise(t=>setTimeout(t,1e3)),e.username==="admin"&&e.password==="123456"){const t={id:"1",username:e.username,name:"系统管理员",email:"admin@yxrobot.com",role:"超级管理员",avatar:"https://ui-avatars.com/api/?name=Admin&background=6366f1&color=ffffff&size=100",permissions:["admin:all","dashboard:view","content:manage","business:manage","system:manage"],loginTime:new Date().toISOString(),lastActiveTime:new Date().toISOString()},o="mock-jwt-token";return this.setToken(o),this.setUserInfo(t),e.remember&&localStorage.setItem(this.REMEMBER_KEY,"true"),{success:!0,message:"登录成功",data:{token:o,userInfo:t}}}else return{success:!1,message:"用户名或密码错误"}}catch(t){return console.error("登录失败:",t),{success:!1,message:"登录失败，请稍后重试"}}})}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.USER_INFO_KEY),localStorage.removeItem(this.REMEMBER_KEY),console.log("用户已登出")}isAuthenticated(){const e=this.getToken(),t=this.getUserInfo();return!!(e&&t)}hasPermission(e){const t=this.getUserInfo();return!t||!t.permissions?!1:t.permissions.includes("admin:all")?!0:t.permissions.includes(e)}hasRole(e){const t=this.getUserInfo();return(t==null?void 0:t.role)===e}getCurrentUser(){return this.getUserInfo()}updateUserInfo(e){const t=this.getUserInfo();if(t){const o=c(c({},t),e);this.setUserInfo(o)}}refreshLastActiveTime(){const e=this.getUserInfo();e&&(e.lastActiveTime=new Date().toISOString(),this.setUserInfo(e))}validateToken(){const e=this.getToken();return e?e==="mock-jwt-token":!1}getToken(){return localStorage.getItem(this.TOKEN_KEY)}setToken(e){localStorage.setItem(this.TOKEN_KEY,e)}getUserInfo(){const e=localStorage.getItem(this.USER_INFO_KEY);if(!e)return null;try{return JSON.parse(e)}catch(t){return console.error("解析用户信息失败:",t),localStorage.removeItem(this.USER_INFO_KEY),null}}setUserInfo(e){localStorage.setItem(this.USER_INFO_KEY,JSON.stringify(e))}isRememberLogin(){return localStorage.getItem(this.REMEMBER_KEY)==="true"}}const K=new U;export{K as a};
