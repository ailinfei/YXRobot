const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/request-DpZIA5Wt.js","js/utils-T70AYnHr.js","js/element-plus-BHn0tN3r.js","js/vue-C2NPAEWw.js"])))=>i.map(i=>d[i]);
var C=(H,L,U)=>new Promise((g,y)=>{var h=_=>{try{v(U.next(_))}catch(V){y(V)}},x=_=>{try{v(U.throw(_))}catch(V){y(V)}},v=_=>_.done?g(_.value):Promise.resolve(_.value).then(h,x);v((U=U.apply(H,L)).next())});import{_ as G}from"./index-DXInKnb6.js";import{b as c,q as Te,v as Ue,w as xe,n as Q,x as Fe,y as Ee,c as Ae,z as De}from"./element-plus-BHn0tN3r.js";/* empty css                                                                     *//* empty css                                                                         */import{C as ve}from"./CommonDialog-Wwzleg2C.js";import{D as Re}from"./DataTable-D7dcJYrF.js";import{S as Ie}from"./StatusTag-DWcgo9dI.js";import{x as ye,r as w,c as fe,j as $e,h as Be,al as T,H as E,z as m,I as o,B as Ce,y as M,K as A,D as X,M as z,O as P,Q as l,a5 as Le,A as n,u as S,P as _e,a6 as ge,X as Oe}from"./vue-C2NPAEWw.js";import{_ as he}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./charts-4xgvsrqt.js";/* empty css                                                                       */import{p as q}from"./product-z-F88vWI.js";/* empty css                                                                  *//* empty css                                                                  */import"./request-DpZIA5Wt.js";import"./utils-T70AYnHr.js";const je=ye({__name:"FormValidator",props:{modelValue:{default:()=>({})},rules:{default:()=>({})},labelWidth:{default:"120px"},labelPosition:{default:"right"},inline:{type:Boolean,default:!1},size:{default:"default"},disabled:{type:Boolean,default:!1},validateOnRuleChange:{type:Boolean,default:!0},hideRequiredAsterisk:{type:Boolean,default:!1},showMessage:{type:Boolean,default:!0},inlineMessage:{type:Boolean,default:!1},statusIcon:{type:Boolean,default:!1},showActions:{type:Boolean,default:!0},showSubmit:{type:Boolean,default:!0},showReset:{type:Boolean,default:!0},submitText:{default:"æäº¤"},resetText:{default:"é‡ç½®"},loading:{type:Boolean,default:!1},formClass:{default:""},actionsClass:{default:""},autoValidate:{type:Boolean,default:!1},validateOnMount:{type:Boolean,default:!1}},emits:["update:modelValue","submit","reset","validate","field-change"],setup(H,{expose:L,emit:U}){const g=H,y=U,h=w(),x=fe({get:()=>g.modelValue,set:i=>y("update:modelValue",i)}),v=fe(()=>g.rules),_=()=>C(null,null,function*(){if(!h.value)return!1;try{return yield h.value.validate(),!0}catch(i){return console.warn("è¡¨å•éªŒè¯å¤±è´¥:",i),!1}}),V=i=>C(null,null,function*(){if(!h.value)return!1;try{return yield h.value.validateField(i),!0}catch(r){return console.warn(`å­—æ®µ ${i} éªŒè¯å¤±è´¥:`,r),!1}}),O=()=>{h.value&&h.value.resetFields(),y("reset")},W=i=>{h.value&&h.value.clearValidate(i)},D=i=>{h.value&&h.value.scrollToField(i)},R=()=>C(null,null,function*(){(yield _())?y("submit",x.value):c.warning("è¯·æ£€æŸ¥è¡¨å•å¡«å†™æ˜¯å¦æ­£ç¡®")}),N=(i,r,$)=>{y("validate",{prop:i,isValid:r,message:$})};return $e(()=>g.modelValue,(i,r)=>{r&&Object.keys(i).forEach($=>{i[$]!==r[$]&&(y("field-change",{field:$,value:i[$],oldValue:r[$]}),g.autoValidate&&V($))})},{deep:!0}),Be(()=>{g.validateOnMount&&_()}),L({validate:_,validateField:V,resetFields:O,clearValidate:W,scrollToField:D,getFormRef:()=>h.value}),(i,r)=>{const $=T("el-button"),I=T("el-form");return m(),E(I,{ref_key:"formRef",ref:h,model:x.value,rules:v.value,"label-width":i.labelWidth,"label-position":i.labelPosition,inline:i.inline,size:i.size,disabled:i.disabled,"validate-on-rule-change":i.validateOnRuleChange,"hide-required-asterisk":i.hideRequiredAsterisk,"show-message":i.showMessage,"inline-message":i.inlineMessage,"status-icon":i.statusIcon,onValidate:N,class:X(["form-validator",i.formClass])},{default:o(()=>[Ce(i.$slots,"default",{form:x.value,rules:v.value},void 0,!0),i.showActions?(m(),M("div",{key:0,class:X(["form-actions",i.actionsClass])},[Ce(i.$slots,"actions",{form:x.value,validate:_,reset:O},()=>[i.showReset?(m(),E($,{key:0,size:i.size,onClick:O,disabled:i.disabled||i.loading},{default:o(()=>[z(P(i.resetText),1)]),_:1},8,["size","disabled"])):A("",!0),i.showSubmit?(m(),E($,{key:1,type:"primary",size:i.size,loading:i.loading,onClick:R,disabled:i.disabled},{default:o(()=>[z(P(i.submitText),1)]),_:1},8,["size","loading","disabled"])):A("",!0)],!0)],2)):A("",!0)]),_:3},8,["model","rules","label-width","label-position","inline","size","disabled","validate-on-rule-change","hide-required-asterisk","show-message","inline-message","status-icon","class"])}}}),qe=he(je,[["__scopeId","data-v-956005f3"]]),We={class:"file-upload"},Ne={key:0,class:"upload-card-trigger"},He={class:"upload-text"},Ke={key:1,class:"upload-drag-area"},Ge={class:"upload-text"},Qe={class:"upload-hint"},Xe={class:"upload-tip"},Je={class:"tip-content"},Ye={key:0},Ze={key:1},ea={key:2},aa={key:0,class:"custom-file-list"},ta={class:"file-list-header"},la={class:"file-list-content"},oa={class:"file-icon"},sa={class:"file-info"},ia=["title"],ra={class:"file-meta"},da={class:"file-size"},na={class:"file-actions"},ua={class:"preview-container"},ca=ye({__name:"FileUpload",props:{modelValue:{default:()=>[]},action:{default:"/api/v1/upload/temp"},headers:{default:()=>({})},data:{default:()=>({})},name:{default:"file"},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!1},accept:{default:""},limit:{default:0},maxSize:{default:10},autoUpload:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},showFileList:{type:Boolean,default:!0},showCustomList:{type:Boolean,default:!1},showTip:{type:Boolean,default:!0},listType:{default:"text"},buttonType:{default:"primary"},uploadText:{default:"é€‰æ‹©æ–‡ä»¶"},uploadHint:{default:"å°†æ–‡ä»¶æ‹–åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»ä¸Šä¼ "}},emits:["update:modelValue","success","error","progress","remove","exceed","preview"],setup(H,{expose:L,emit:U}){const g=H,y=U,h=w(),x=w(!1),v=w([...g.modelValue]),_=w(!1),V=w(""),O=fe(()=>({"upload-disabled":g.disabled,"upload-drag":g.drag,"upload-picture-card":g.listType==="picture-card"})),W=a=>{var p;return["image/jpeg","image/jpg","image/png","image/gif","image/webp"].includes(((p=a.raw)==null?void 0:p.type)||"")||/\.(jpg|jpeg|png|gif|webp)$/i.test(a.name||"")},D=a=>{var p;return["video/mp4","video/avi","video/mov","video/wmv"].includes(((p=a.raw)==null?void 0:p.type)||"")||/\.(mp4|avi|mov|wmv)$/i.test(a.name||"")},R=a=>{var p;return["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(((p=a.raw)==null?void 0:p.type)||"")||/\.(pdf|doc|docx)$/i.test(a.name||"")},N=a=>a.split(",").map(d=>d.trim()).join(", "),i=a=>`${a}MB`,r=a=>{if(!a)return"0B";const d=["B","KB","MB","GB"];let p=0,B=a;for(;B>=1024&&p<d.length-1;)B/=1024,p++;return`${B.toFixed(1)}${d[p]}`},$=a=>({ready:"å‡†å¤‡ä¸Šä¼ ",uploading:"ä¸Šä¼ ä¸­",success:"ä¸Šä¼ æˆåŠŸ",fail:"ä¸Šä¼ å¤±è´¥"})[a||""]||"æœªçŸ¥çŠ¶æ€",I=a=>g.maxSize&&a.size/1024/1024>g.maxSize?(c.error(`æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡ ${g.maxSize}MB`),!1):g.accept&&!g.accept.split(",").map(B=>B.trim()).some(B=>B.startsWith(".")?a.name.toLowerCase().endsWith(B.toLowerCase()):a.type.includes(B.replace("*","")))?(c.error(`æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¯·é€‰æ‹© ${N(g.accept)} æ ¼å¼çš„æ–‡ä»¶`),!1):(x.value=!0,!0),ee=(a,d)=>{y("progress",a,d)},ae=(a,d,p)=>{x.value=!1,v.value=[...p],y("update:modelValue",v.value),y("success",a,d,p),c.success("æ–‡ä»¶ä¸Šä¼ æˆåŠŸ")},te=(a,d,p)=>{x.value=!1,y("error",a,d,p),c.error("æ–‡ä»¶ä¸Šä¼ å¤±è´¥")},j=a=>C(null,null,function*(){try{yield Q.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ–‡ä»¶å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const d=v.value.findIndex(p=>p.uid===a.uid);d>-1&&(v.value.splice(d,1),y("update:modelValue",v.value),y("remove",a))}catch(d){}}),le=(a,d)=>{c.warning(`æœ€å¤šåªèƒ½ä¸Šä¼  ${g.limit} ä¸ªæ–‡ä»¶`),y("exceed",a,d)},J=a=>{W(a)&&a.url?(V.value=a.url,_.value=!0):a.url&&window.open(a.url,"_blank"),y("preview",a)},oe=a=>{if(a.url){const d=document.createElement("a");d.href=a.url,d.download=a.name||"download",d.click()}},se=()=>C(null,null,function*(){var a;try{yield Q.confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ–‡ä»¶å—ï¼Ÿ","æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),v.value=[],y("update:modelValue",v.value),(a=h.value)==null||a.clearFiles()}catch(d){}}),ie=()=>{_.value=!1,V.value=""};return $e(()=>g.modelValue,a=>{v.value=[...a]},{deep:!0}),L({clearFiles:()=>{var a;return(a=h.value)==null?void 0:a.clearFiles()},abort:()=>{var a;return(a=h.value)==null?void 0:a.abort()},submit:()=>{var a;return(a=h.value)==null?void 0:a.submit()}}),(a,d)=>{const p=T("el-icon"),B=T("el-button"),re=T("el-upload"),de=T("el-progress"),ne=T("el-image"),ue=T("el-dialog");return m(),M("div",We,[l(re,{ref_key:"uploadRef",ref:h,class:X(O.value),action:a.action,headers:a.headers,data:a.data,name:a.name,multiple:a.multiple,drag:a.drag,accept:a.accept,"file-list":v.value,"auto-upload":a.autoUpload,disabled:a.disabled,limit:a.limit,"show-file-list":a.showFileList,"list-type":a.listType,"before-upload":I,"on-progress":ee,"on-success":ae,"on-error":te,"on-remove":j,"on-exceed":le,"on-preview":J},Le({default:o(()=>[a.listType==="picture-card"?(m(),M("div",Ne,[l(p,null,{default:o(()=>[l(S(Te))]),_:1}),n("div",He,P(a.uploadText),1)])):a.drag?(m(),M("div",Ke,[l(p,{class:"upload-icon"},{default:o(()=>[l(S(Ue))]),_:1}),n("div",Ge,P(a.uploadText),1),n("div",Qe,P(a.uploadHint),1)])):(m(),E(B,{key:2,type:a.buttonType,icon:S(xe),loading:x.value},{default:o(()=>[z(P(a.uploadText),1)]),_:1},8,["type","icon","loading"]))]),_:2},[a.showTip?{name:"tip",fn:o(()=>[n("div",Xe,[n("div",Je,[a.accept?(m(),M("span",Ye,"æ”¯æŒæ ¼å¼: "+P(N(a.accept)),1)):A("",!0),a.maxSize?(m(),M("span",Ze,"å•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ "+P(i(a.maxSize)),1)):A("",!0),a.limit?(m(),M("span",ea,"æœ€å¤šä¸Šä¼  "+P(a.limit)+" ä¸ªæ–‡ä»¶",1)):A("",!0)])])]),key:"0"}:void 0]),1032,["class","action","headers","data","name","multiple","drag","accept","file-list","auto-upload","disabled","limit","show-file-list","list-type"]),a.showCustomList&&v.value.length>0?(m(),M("div",aa,[n("div",ta,[n("span",null,"å·²ä¸Šä¼ æ–‡ä»¶ ("+P(v.value.length)+")",1),a.multiple?(m(),E(B,{key:0,type:"danger",size:"small",text:"",onClick:se},{default:o(()=>d[1]||(d[1]=[z(" æ¸…ç©ºå…¨éƒ¨ ",-1)])),_:1,__:[1]})):A("",!0)]),n("div",la,[(m(!0),M(_e,null,ge(v.value,(b,ce)=>(m(),M("div",{key:b.uid||ce,class:X(["file-item",{"is-uploading":b.status==="uploading"}])},[n("div",oa,[W(b)?(m(),E(p,{key:0},{default:o(()=>[l(S(Fe))]),_:1})):D(b)?(m(),E(p,{key:1},{default:o(()=>[l(S(Ee))]),_:1})):R(b)?(m(),E(p,{key:2},{default:o(()=>[l(S(Ae))]),_:1})):(m(),E(p,{key:3},{default:o(()=>[l(S(De))]),_:1}))]),n("div",sa,[n("div",{class:"file-name",title:b.name},P(b.name),9,ia),n("div",ra,[n("span",da,P(r(b.size)),1),n("span",{class:X(["file-status",b.status])},P($(b.status)),3)]),b.status==="uploading"?(m(),E(de,{key:0,percentage:b.percentage||0,"stroke-width":2,"show-text":!1},null,8,["percentage"])):A("",!0)]),n("div",na,[b.status==="success"?(m(),E(B,{key:0,type:"primary",size:"small",text:"",onClick:Y=>J(b)},{default:o(()=>d[2]||(d[2]=[z(" é¢„è§ˆ ",-1)])),_:2,__:[2]},1032,["onClick"])):A("",!0),b.url?(m(),E(B,{key:1,type:"primary",size:"small",text:"",onClick:Y=>oe(b)},{default:o(()=>d[3]||(d[3]=[z(" ä¸‹è½½ ",-1)])),_:2,__:[3]},1032,["onClick"])):A("",!0),l(B,{type:"danger",size:"small",text:"",onClick:Y=>j(b)},{default:o(()=>d[4]||(d[4]=[z(" åˆ é™¤ ",-1)])),_:2,__:[4]},1032,["onClick"])])],2))),128))])])):A("",!0),l(ue,{modelValue:_.value,"onUpdate:modelValue":d[0]||(d[0]=b=>_.value=b),title:"å›¾ç‰‡é¢„è§ˆ",width:"60%","before-close":ie},{default:o(()=>[n("div",ua,[l(ne,{src:V.value,fit:"contain",class:"preview-image","preview-src-list":[V.value]},null,8,["src","preview-src-list"])])]),_:1},8,["modelValue"])])}}}),ke=he(ca,[["__scopeId","data-v-65019d6d"]]),pa={class:"products-management"},ma={class:"page-header"},va={class:"header-right"},fa={key:1,class:"no-image"},_a={class:"price-text"},ga={class:"media-management"},ya={class:"media-tabs"},ha={class:"media-section"},wa={class:"section-header"},ba={class:"media-grid"},Va={class:"media-actions"},Ca={class:"media-sort"},ka={class:"media-section"},Ta={class:"section-header"},$a={class:"media-grid"},Ba=["src"],za={class:"media-actions"},Pa={class:"media-sort"},Ma={class:"media-upload-form"},Sa=ye({__name:"Products",setup(H){const L=w(!1),U=w(!1),g=w(!1),y=w(!1),h=w(!1),x=w(!1),v=w("add"),_=w(null),V=w("image"),O=w("images"),W=w(),D=w([]),R=w({page:1,size:20,total:0}),N=w([{id:1,product_id:1,media_type:"image",media_url:"https://via.placeholder.com/300x200",sort_order:1},{id:2,product_id:1,media_type:"image",media_url:"https://via.placeholder.com/300x200",sort_order:2}]),i=w([{id:3,product_id:1,media_type:"video",media_url:"https://www.w3schools.com/html/mov_bbb.mp4",sort_order:1}]),r=w({name:"",model:"",description:"",price:0,status:"draft",cover_files:[]}),$=Oe({sort_order:1}),I=w([]),ee={name:[{required:!0,message:"è¯·è¾“å…¥äº§å“åç§°",trigger:"blur"}],model:[{required:!0,message:"è¯·è¾“å…¥äº§å“å‹å·",trigger:"blur"}],price:[{required:!0,message:"è¯·è¾“å…¥äº§å“ä»·æ ¼",trigger:"blur"}],status:[{required:!0,message:"è¯·é€‰æ‹©äº§å“çŠ¶æ€",trigger:"change"}]},ae=[{prop:"id",label:"ID",width:80},{prop:"cover_image_url",label:"å°é¢å›¾ç‰‡",width:100},{prop:"name",label:"äº§å“åç§°",minWidth:150},{prop:"model",label:"äº§å“å‹å·",width:120},{prop:"price",label:"ä»·æ ¼",width:100},{prop:"status",label:"çŠ¶æ€",width:100},{prop:"createdAt",label:"åˆ›å»ºæ—¶é—´",width:160,type:"date"},{prop:"updatedAt",label:"æ›´æ–°æ—¶é—´",width:160,type:"date"}],te=t=>t.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),j=()=>C(null,null,function*(){console.log("ğŸš€ å¼€å§‹åŠ è½½äº§å“åˆ—è¡¨..."),L.value=!0;try{console.log("ğŸ“¡ è°ƒç”¨API:",{page:R.value.page,size:R.value.size});const t=yield q.getProducts({page:R.value.page,size:R.value.size});console.log("ğŸ“¥ APIå“åº”:",t),t.code===200?(D.value=t.data.list||[],R.value.total=t.data.total||0,console.log("âœ… äº§å“åˆ—è¡¨åŠ è½½æˆåŠŸ:",{count:D.value.length,total:R.value.total,firstProduct:D.value[0],timeFields:D.value.map(e=>({id:e.id,name:e.name,createdAt:e.createdAt,updatedAt:e.updatedAt,created_at:e.created_at,updated_at:e.updated_at}))})):(console.error("âŒ APIè¿”å›é”™è¯¯:",t),c.error(t.message||"è·å–äº§å“åˆ—è¡¨å¤±è´¥"))}catch(t){console.error("ğŸ’¥ è·å–äº§å“åˆ—è¡¨å¤±è´¥:",t),c.error("è·å–äº§å“åˆ—è¡¨å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"),D.value=[]}finally{L.value=!1}}),le=()=>{v.value="add",b(),U.value=!0},J=t=>{v.value="edit",_.value=t,Object.assign(r.value,{name:t.name,model:t.model,description:t.description,price:t.price,status:t.status,cover_files:[]}),U.value=!0},oe=t=>C(null,null,function*(){try{yield Q.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªäº§å“å—ï¼Ÿ","åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),console.log("ğŸ—‘ï¸ å¼€å§‹åˆ é™¤äº§å“:",t.id,t.name);const e=yield q.deleteProduct(t.id.toString());if(console.log("ğŸ—‘ï¸ åˆ é™¤APIå“åº”:",e),e.code===200){c.success("äº§å“åˆ é™¤æˆåŠŸ"),console.log("ğŸ”„ åˆ é™¤æˆåŠŸï¼Œæ¸…é™¤ç¼“å­˜å¹¶é‡æ–°åŠ è½½äº§å“åˆ—è¡¨...");const{clearCache:u}=yield G(()=>C(null,null,function*(){const{clearCache:k}=yield import("./request-DpZIA5Wt.js");return{clearCache:k}}),__vite__mapDeps([0,1,2,3]));u("/admin/products"),j()}else c.error(e.message||"åˆ é™¤å¤±è´¥")}catch(e){e!=="cancel"&&(console.error("åˆ é™¤äº§å“å¤±è´¥:",e),c.error("åˆ é™¤äº§å“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"))}}),se=t=>C(null,null,function*(){try{yield Q.confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${t.length} ä¸ªäº§å“å—ï¼Ÿ`,"æ‰¹é‡åˆ é™¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),c.success("äº§å“æ‰¹é‡åˆ é™¤æˆåŠŸ");const{clearCache:e}=yield G(()=>C(null,null,function*(){const{clearCache:u}=yield import("./request-DpZIA5Wt.js");return{clearCache:u}}),__vite__mapDeps([0,1,2,3]));e("/admin/products"),j()}catch(e){}}),ie=t=>{_.value=t,g.value=!0,a(t.id)},a=t=>C(null,null,function*(){console.log("åŠ è½½äº§å“åª’ä½“:",t);try{const e=yield q.getProductMedia(t.toString());if(e.code===200){const u=e.data.filter(f=>f.media_type==="image"),k=e.data.filter(f=>f.media_type==="video");N.value=u,i.value=k,console.log("æˆåŠŸåŠ è½½äº§å“åª’ä½“ - å›¾ç‰‡:",u.length,"è§†é¢‘:",k.length)}else c.error(e.message||"è·å–äº§å“åª’ä½“å¤±è´¥")}catch(e){console.error("è·å–äº§å“åª’ä½“å¤±è´¥:",e),c.error("è·å–äº§å“åª’ä½“å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}}),d=t=>{V.value=t,$.sort_order=1,I.value=[],y.value=!0},p=t=>C(null,null,function*(){var e;try{const{value:u}=yield Q.prompt("è¯·è¾“å…¥æ–°çš„æ’åºå€¼","ç¼–è¾‘åª’ä½“",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",inputValue:t.sort_order.toString(),inputPattern:/^\d+$/,inputErrorMessage:"è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å­—"}),k=parseInt(u),f=yield q.updateProductMedia(t.id.toString(),k);if(f.code===200){c.success("åª’ä½“ä¿¡æ¯æ›´æ–°æˆåŠŸ");const{clearCache:F}=yield G(()=>C(null,null,function*(){const{clearCache:K}=yield import("./request-DpZIA5Wt.js");return{clearCache:K}}),__vite__mapDeps([0,1,2,3]));F("/admin/products"),a((e=_.value)==null?void 0:e.id)}else c.error(f.message||"æ›´æ–°å¤±è´¥")}catch(u){u!=="cancel"&&(console.error("æ›´æ–°åª’ä½“ä¿¡æ¯å¤±è´¥:",u),c.error("æ›´æ–°åª’ä½“ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"))}}),B=t=>C(null,null,function*(){var e;try{yield Q.confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªåª’ä½“æ–‡ä»¶å—ï¼Ÿ","åˆ é™¤ç¡®è®¤",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const u=yield q.deleteProductMedia(t.id.toString());if(u.code===200){c.success("åª’ä½“æ–‡ä»¶åˆ é™¤æˆåŠŸ");const{clearCache:k}=yield G(()=>C(null,null,function*(){const{clearCache:f}=yield import("./request-DpZIA5Wt.js");return{clearCache:f}}),__vite__mapDeps([0,1,2,3]));k("/admin/products"),a((e=_.value)==null?void 0:e.id)}else c.error(u.message||"åˆ é™¤å¤±è´¥")}catch(u){u!=="cancel"&&(console.error("åˆ é™¤åª’ä½“æ–‡ä»¶å¤±è´¥:",u),c.error("åˆ é™¤åª’ä½“æ–‡ä»¶å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•"))}}),re=()=>C(null,null,function*(){var e;if(yield(e=W.value)==null?void 0:e.validate()){h.value=!0;try{let u,k=null;if(r.value.cover_files&&r.value.cover_files.length>0){const f=r.value.cover_files[0];f.response&&f.response.code===200?k=f.response.data.url:f.url&&(k=f.url)}if(v.value==="add"){const f={name:r.value.name,model:r.value.model,description:r.value.description,price:r.value.price,status:r.value.status,cover_image_url:k};u=yield q.createProductWithUrls(f)}else{const f={name:r.value.name,model:r.value.model,description:r.value.description,price:r.value.price,status:r.value.status,cover_image_url:k};u=yield q.updateProductWithUrls(_.value.id.toString(),f)}if(u.code===200){c.success(`äº§å“${v.value==="add"?"åˆ›å»º":"æ›´æ–°"}æˆåŠŸ`),U.value=!1;const{clearCache:f}=yield G(()=>C(null,null,function*(){const{clearCache:F}=yield import("./request-DpZIA5Wt.js");return{clearCache:F}}),__vite__mapDeps([0,1,2,3]));f("/admin/products"),j()}else c.error(u.message||`${v.value==="add"?"åˆ›å»º":"æ›´æ–°"}å¤±è´¥`)}catch(u){console.error("ä¿å­˜äº§å“å¤±è´¥:",u),c.error(`äº§å“${v.value==="add"?"åˆ›å»º":"æ›´æ–°"}å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•`)}finally{h.value=!1}}}),de=()=>{U.value=!1,b()},ne=()=>C(null,null,function*(){var t;if(I.value.length===0){c.warning("è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶");return}x.value=!0;try{const e=I.value[0];let u=null;if(e.response&&e.response.code===200)u=e.response.data.url;else if(e.url)u=e.url;else{c.error("æ–‡ä»¶ä¸Šä¼ æœªå®Œæˆï¼Œè¯·ç­‰å¾…ä¸Šä¼ å®Œæˆåå†ä¿å­˜");return}const k=yield q.uploadProductMedia(_.value.id.toString(),V.value,$.sort_order,e.raw);if(k.code===200){c.success("åª’ä½“æ–‡ä»¶ä¿å­˜æˆåŠŸ"),y.value=!1;const{clearCache:f}=yield G(()=>C(null,null,function*(){const{clearCache:F}=yield import("./request-DpZIA5Wt.js");return{clearCache:F}}),__vite__mapDeps([0,1,2,3]));f("/admin/products"),a((t=_.value)==null?void 0:t.id)}else c.error(k.message||"ä¿å­˜å¤±è´¥")}catch(e){console.error("ä¿å­˜åª’ä½“æ–‡ä»¶å¤±è´¥:",e),c.error("ä¿å­˜åª’ä½“æ–‡ä»¶å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")}finally{x.value=!1}}),ue=()=>{y.value=!1,I.value=[]},b=()=>{Object.assign(r.value,{name:"",model:"",description:"",price:0,status:"draft",cover_files:[]})},ce=(t,e)=>{console.log("å°é¢ä¸Šä¼ æˆåŠŸ:",t),t.code===200?(c.success("å°é¢ä¸Šä¼ æˆåŠŸ"),e.url=t.data.url,e.response=t):c.error(t.message||"å°é¢ä¸Šä¼ å¤±è´¥")},Y=(t,e)=>{console.error("å°é¢ä¸Šä¼ å¤±è´¥:",t),c.error("å°é¢ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")},ze=(t,e)=>{console.log("åª’ä½“ä¸Šä¼ æˆåŠŸ:",t),t.code===200?(c.success("åª’ä½“æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"),e.url=t.data.url,e.response=t):c.error(t.message||"åª’ä½“ä¸Šä¼ å¤±è´¥")},Pe=(t,e)=>{console.error("åª’ä½“ä¸Šä¼ å¤±è´¥:",t),c.error("åª’ä½“æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•")};return Be(()=>{j()}),(t,e)=>{const u=T("el-button"),k=T("el-image"),f=T("el-input"),F=T("el-form-item"),K=T("el-col"),we=T("el-row"),be=T("el-input-number"),pe=T("el-option"),Me=T("el-select"),Ve=T("el-tab-pane"),Se=T("el-tabs");return m(),M("div",pa,[n("div",ma,[e[16]||(e[16]=n("div",{class:"header-left"},[n("h2",null,"äº§å“ç®¡ç†"),n("p",{class:"header-subtitle"},"333ç®¡ç†å®˜ç½‘å±•ç¤ºçš„äº§å“ä¿¡æ¯ã€åª’ä½“æ–‡ä»¶å’ŒçŠ¶æ€")],-1)),n("div",va,[l(u,{type:"primary",icon:S(Te),onClick:le},{default:o(()=>e[15]||(e[15]=[z(" æ–°å¢äº§å“ ",-1)])),_:1,__:[15]},8,["icon"])])]),l(S(Re),{data:D.value,columns:ae,loading:L.value,"show-selection":"","show-edit":!1,"show-delete":!1,onBatchDelete:se,onRefresh:j},{cover_image_url:o(({row:s})=>[s.cover_image_url?(m(),E(k,{key:0,src:s.cover_image_url,"preview-src-list":[s.cover_image_url],fit:"cover",class:"product-cover"},null,8,["src","preview-src-list"])):(m(),M("span",fa,"æš‚æ— å›¾ç‰‡"))]),status:o(({row:s})=>[l(S(Ie),{status:s.status},null,8,["status"])]),price:o(({row:s})=>[n("span",_a,"Â¥"+P(te(s.price)),1)]),actions:o(({row:s})=>[l(u,{type:"primary",size:"small",text:"",onClick:Z=>J(s)},{default:o(()=>e[17]||(e[17]=[z(" ç¼–è¾‘ ",-1)])),_:2,__:[17]},1032,["onClick"]),l(u,{type:"info",size:"small",text:"",onClick:Z=>ie(s)},{default:o(()=>e[18]||(e[18]=[z(" åª’ä½“ç®¡ç† ",-1)])),_:2,__:[18]},1032,["onClick"]),l(u,{type:"danger",size:"small",text:"",onClick:Z=>oe(s)},{default:o(()=>e[19]||(e[19]=[z(" åˆ é™¤ ",-1)])),_:2,__:[19]},1032,["onClick"])]),_:1},8,["data","loading"]),l(S(ve),{modelValue:U.value,"onUpdate:modelValue":e[7]||(e[7]=s=>U.value=s),title:v.value==="add"?"æ–°å¢äº§å“":"ç¼–è¾‘äº§å“",width:"800px",onConfirm:re,onCancel:de,"confirm-loading":h.value},{default:o(()=>[l(S(qe),{ref_key:"productFormRef",ref:W,modelValue:r.value,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value=s),rules:ee,"label-width":"100px","show-actions":!1},{default:o(()=>[l(we,{gutter:20},{default:o(()=>[l(K,{span:12},{default:o(()=>[l(F,{label:"äº§å“åç§°",prop:"name"},{default:o(()=>[l(f,{modelValue:r.value.name,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value.name=s),placeholder:"è¯·è¾“å…¥äº§å“åç§°"},null,8,["modelValue"])]),_:1})]),_:1}),l(K,{span:12},{default:o(()=>[l(F,{label:"äº§å“å‹å·",prop:"model"},{default:o(()=>[l(f,{modelValue:r.value.model,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value.model=s),placeholder:"è¯·è¾“å…¥äº§å“å‹å·"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(we,{gutter:20},{default:o(()=>[l(K,{span:12},{default:o(()=>[l(F,{label:"äº§å“ä»·æ ¼",prop:"price"},{default:o(()=>[l(be,{modelValue:r.value.price,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.price=s),min:0,precision:2,placeholder:"è¯·è¾“å…¥äº§å“ä»·æ ¼",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),l(K,{span:12},{default:o(()=>[l(F,{label:"äº§å“çŠ¶æ€",prop:"status"},{default:o(()=>[l(Me,{modelValue:r.value.status,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value.status=s),placeholder:"è¯·é€‰æ‹©äº§å“çŠ¶æ€"},{default:o(()=>[l(pe,{label:"è‰ç¨¿",value:"draft"}),l(pe,{label:"å·²å‘å¸ƒ",value:"published"}),l(pe,{label:"å·²å½’æ¡£",value:"archived"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(F,{label:"äº§å“æè¿°",prop:"description"},{default:o(()=>[l(f,{modelValue:r.value.description,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.description=s),type:"textarea",rows:4,placeholder:"è¯·è¾“å…¥äº§å“æè¿°"},null,8,["modelValue"])]),_:1}),l(F,{label:"äº§å“å°é¢"},{default:o(()=>[l(S(ke),{modelValue:r.value.cover_files,"onUpdate:modelValue":e[5]||(e[5]=s=>r.value.cover_files=s),limit:1,accept:"image/*","list-type":"picture-card","max-size":5,"upload-text":"ä¸Šä¼ å°é¢",action:"/api/v1/upload/product/cover","auto-upload":!0,onSuccess:ce,onError:Y},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["modelValue","title","confirm-loading"]),l(S(ve),{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=s=>g.value=s),title:"äº§å“åª’ä½“ç®¡ç†",width:"1000px","show-footer":!1},{default:o(()=>[n("div",ga,[n("div",ya,[l(Se,{modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=s=>O.value=s)},{default:o(()=>[l(Ve,{label:"äº§å“å›¾ç‰‡",name:"images"},{default:o(()=>[n("div",ha,[n("div",wa,[e[21]||(e[21]=n("h4",null,"äº§å“å›¾ç‰‡",-1)),l(u,{type:"primary",size:"small",onClick:e[8]||(e[8]=s=>d("image"))},{default:o(()=>e[20]||(e[20]=[z(" æ·»åŠ å›¾ç‰‡ ",-1)])),_:1,__:[20]})]),n("div",ba,[(m(!0),M(_e,null,ge(N.value,(s,Z)=>(m(),M("div",{key:s.id,class:"media-item"},[l(k,{src:s.media_url,fit:"cover",class:"media-preview","preview-src-list":[s.media_url]},null,8,["src","preview-src-list"]),n("div",Va,[l(u,{size:"small",type:"primary",text:"",onClick:me=>p(s)},{default:o(()=>e[22]||(e[22]=[z(" ç¼–è¾‘ ",-1)])),_:2,__:[22]},1032,["onClick"]),l(u,{size:"small",type:"danger",text:"",onClick:me=>B(s)},{default:o(()=>e[23]||(e[23]=[z(" åˆ é™¤ ",-1)])),_:2,__:[23]},1032,["onClick"])]),n("div",Ca,[n("span",null,"æ’åº: "+P(s.sort_order),1)])]))),128))])])]),_:1}),l(Ve,{label:"äº§å“è§†é¢‘",name:"videos"},{default:o(()=>[n("div",ka,[n("div",Ta,[e[25]||(e[25]=n("h4",null,"äº§å“è§†é¢‘",-1)),l(u,{type:"primary",size:"small",onClick:e[9]||(e[9]=s=>d("video"))},{default:o(()=>e[24]||(e[24]=[z(" æ·»åŠ è§†é¢‘ ",-1)])),_:1,__:[24]})]),n("div",$a,[(m(!0),M(_e,null,ge(i.value,(s,Z)=>(m(),M("div",{key:s.id,class:"media-item video-item"},[n("video",{src:s.media_url,controls:"",class:"media-preview"},null,8,Ba),n("div",za,[l(u,{size:"small",type:"primary",text:"",onClick:me=>p(s)},{default:o(()=>e[26]||(e[26]=[z(" ç¼–è¾‘ ",-1)])),_:2,__:[26]},1032,["onClick"]),l(u,{size:"small",type:"danger",text:"",onClick:me=>B(s)},{default:o(()=>e[27]||(e[27]=[z(" åˆ é™¤ ",-1)])),_:2,__:[27]},1032,["onClick"])]),n("div",Pa,[n("span",null,"æ’åº: "+P(s.sort_order),1)])]))),128))])])]),_:1})]),_:1},8,["modelValue"])])])]),_:1},8,["modelValue"]),l(S(ve),{modelValue:y.value,"onUpdate:modelValue":e[14]||(e[14]=s=>y.value=s),title:`ä¸Šä¼ ${V.value==="image"?"å›¾ç‰‡":"è§†é¢‘"}`,width:"600px",onConfirm:ne,onCancel:ue,"confirm-loading":x.value},{default:o(()=>[n("div",Ma,[l(F,{label:"åª’ä½“æ–‡ä»¶"},{default:o(()=>[l(S(ke),{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=s=>I.value=s),limit:1,accept:V.value==="image"?"image/*":"video/*","list-type":V.value==="image"?"picture-card":"text","max-size":V.value==="image"?10:100,"upload-text":`é€‰æ‹©${V.value==="image"?"å›¾ç‰‡":"è§†é¢‘"}`,action:"/api/v1/upload/product",data:{mediaType:V.value},"auto-upload":!0,onSuccess:ze,onError:Pe},null,8,["modelValue","accept","list-type","max-size","upload-text","data"])]),_:1}),l(F,{label:"æ’åº"},{default:o(()=>[l(be,{modelValue:$.sort_order,"onUpdate:modelValue":e[13]||(e[13]=s=>$.sort_order=s),min:0,placeholder:"è¯·è¾“å…¥æ’åºå€¼",style:{width:"100%"}},null,8,["modelValue"])]),_:1})])]),_:1},8,["modelValue","title","confirm-loading"])])}}}),Qa=he(Sa,[["__scopeId","data-v-7049c48e"]]);export{Qa as default};
