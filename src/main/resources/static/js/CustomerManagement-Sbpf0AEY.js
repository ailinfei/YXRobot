var F=(A,V,g)=>new Promise((S,y)=>{var x=v=>{try{m(g.next(v))}catch(C){y(C)}},w=v=>{try{m(g.throw(v))}catch(C){y(C)}},m=v=>v.done?S(v.value):Promise.resolve(v.value).then(x,w);m((g=g.apply(A,V)).next())});import{q as _e,j as ge,a2 as fe,m as be,b as M,n as he}from"./element-plus-BHn0tN3r.js";import{c as G,a as ye}from"./customer-CaCup1_C.js";import{C as Ce}from"./CustomerFormDialog-TKD8j06k.js";import{x as Ve,r as d,h as xe,al as p,ar as we,y as N,z as h,A as l,Q as t,I as o,M as c,u as P,J as ze,H as E,O as n,P as Se,a6 as De,K as $}from"./vue-C2NPAEWw.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-DpZIA5Wt.js";import"./utils-T70AYnHr.js";const Te={class:"customer-management"},Ue={class:"page-header"},Le={class:"header-right"},Ie={class:"search-filters"},Be={class:"filters-left"},Fe={class:"table-section"},Me={class:"customer-info"},Pe={class:"customer-avatar"},Ee={class:"customer-details"},Ne={class:"customer-name"},$e={class:"customer-tags"},Ae={class:"device-stats"},Re={class:"device-count"},je={class:"device-breakdown"},Ke={class:"amount-display"},Oe={class:"amount"},qe={class:"value-indicator"},He={class:"pagination-wrapper"},Je={key:0,class:"customer-detail"},Qe={class:"detail-section"},Ge={class:"info-grid"},We={class:"info-item"},Xe={class:"info-item"},Ye={class:"info-item"},Ze={class:"info-item"},et={class:"info-item"},tt={class:"info-item"},lt={class:"detail-section"},at={class:"stats-grid"},st={class:"stat-card"},ot={class:"stat-value"},nt={class:"stat-card"},it={class:"stat-value"},ut={class:"stat-card"},dt={class:"stat-value"},rt={class:"stat-card"},ct={class:"stat-value"},vt={class:"detail-section"},pt=Ve({__name:"CustomerManagement",setup(A){const V=d(!1),g=d(""),S=d(""),y=d(""),x=d(""),w=d(""),m=d(1),v=d(10),C=d(0),R=d([]),W=d([]),r=d(null),D=d([]),k=d(!1),T=d(!1),U=d(null),X=()=>{m.value=1,b()},L=()=>{m.value=1,b()},Y=s=>{v.value=s,m.value=1,b()},Z=s=>{m.value=s,b()},ee=s=>{W.value=s},b=()=>F(null,null,function*(){V.value=!0;try{const s=yield G.getCustomers({page:m.value,pageSize:v.value,keyword:g.value,level:y.value,deviceType:x.value,region:w.value});R.value=s.data.list,C.value=s.data.total}catch(s){console.error("加载客户数据失败:",s),M.error("加载客户数据失败")}finally{V.value=!1}}),te=s=>F(null,null,function*(){r.value=s;try{const e=yield ye.getCustomerDevices(s.id);D.value=e.data.list,k.value=!0}catch(e){console.error("加载客户设备失败:",e),M.error("加载客户设备失败")}}),le=s=>{U.value=s,T.value=!0},ae=s=>F(null,null,function*(){try{yield he.confirm(`确定要删除客户 "${s.name}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),yield G.deleteCustomer(s.id),M.success("删除成功"),b()}catch(e){e!=="cancel"&&(console.error("删除客户失败:",e),M.error("删除失败"))}}),se=()=>{U.value=null,T.value=!0},oe=()=>{b(),U.value=null},ne=()=>{k.value=!1,r.value=null,D.value=[]},j=s=>({regular:"",vip:"warning",premium:"success"})[s]||"",K=s=>({regular:"普通",vip:"VIP",premium:"高级"})[s]||s,O=s=>({active:"success",inactive:"warning",suspended:"danger"})[s]||"info",q=s=>({active:"活跃",inactive:"非活跃",suspended:"已暂停"})[s]||s,ie=s=>({active:"success",expired:"warning",returned:"info"})[s]||"info",ue=s=>({active:"使用中",expired:"已过期",returned:"已归还"})[s]||s;return xe(()=>{b()}),(s,e)=>{const H=p("el-icon"),I=p("el-button"),de=p("el-input"),i=p("el-option"),B=p("el-select"),u=p("el-table-column"),re=p("el-avatar"),f=p("el-tag"),ce=p("el-rate"),J=p("el-table"),ve=p("el-pagination"),pe=p("el-dialog"),me=we("loading");return h(),N("div",Te,[l("div",Ue,[e[10]||(e[10]=l("div",{class:"header-left"},[l("h2",null,"客户管理"),l("p",{class:"header-subtitle"},"客户信息管理 · 练字机器人管理系统")],-1)),l("div",Le,[t(I,{type:"primary",onClick:se},{default:o(()=>[t(H,null,{default:o(()=>[t(P(_e))]),_:1}),e[9]||(e[9]=c(" 新增客户 ",-1))]),_:1,__:[9]})])]),l("div",Ie,[l("div",Be,[t(de,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=a=>g.value=a),placeholder:"搜索客户姓名、电话、邮箱","prefix-icon":P(ge),clearable:"",onInput:X,style:{width:"300px"}},null,8,["modelValue","prefix-icon"]),t(B,{modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=a=>S.value=a),placeholder:"客户状态",clearable:"",onChange:L},{default:o(()=>[t(i,{label:"全部状态",value:""}),t(i,{label:"活跃",value:"active"}),t(i,{label:"非活跃",value:"inactive"}),t(i,{label:"已暂停",value:"suspended"})]),_:1},8,["modelValue"]),t(B,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=a=>y.value=a),placeholder:"客户等级",clearable:"",onChange:L},{default:o(()=>[t(i,{label:"全部等级",value:""}),t(i,{label:"普通客户",value:"regular"}),t(i,{label:"VIP客户",value:"vip"}),t(i,{label:"高级客户",value:"premium"})]),_:1},8,["modelValue"]),t(B,{modelValue:x.value,"onUpdate:modelValue":e[3]||(e[3]=a=>x.value=a),placeholder:"设备类型",clearable:"",onChange:L},{default:o(()=>[t(i,{label:"全部类型",value:""}),t(i,{label:"仅购买",value:"purchased"}),t(i,{label:"仅租赁",value:"rental"}),t(i,{label:"混合",value:"mixed"})]),_:1},8,["modelValue"]),t(B,{modelValue:w.value,"onUpdate:modelValue":e[4]||(e[4]=a=>w.value=a),placeholder:"地区筛选",clearable:"",onChange:L},{default:o(()=>[t(i,{label:"全部地区",value:""}),t(i,{label:"北京市",value:"北京市"}),t(i,{label:"上海市",value:"上海市"}),t(i,{label:"广东省",value:"广东省"}),t(i,{label:"浙江省",value:"浙江省"}),t(i,{label:"江苏省",value:"江苏省"})]),_:1},8,["modelValue"])])]),l("div",Fe,[ze((h(),E(J,{data:R.value,stripe:"",onSelectionChange:ee},{default:o(()=>[t(u,{type:"selection",width:"55"}),t(u,{prop:"id",label:"ID",width:"80"}),t(u,{prop:"name",label:"客户信息",width:"180"},{default:o(({row:a})=>{var _;return[l("div",Me,[l("div",Pe,[t(re,{src:a.avatar,size:32,icon:P(fe)},null,8,["src","icon"])]),l("div",Ee,[l("div",Ne,[l("span",null,n(a.name),1),t(f,{type:j(a.level),size:"small",class:"level-tag"},{default:o(()=>[c(n(K(a.level)),1)]),_:2},1032,["type"])]),l("div",$e,[(h(!0),N(Se,null,De((_=a.tags)==null?void 0:_.slice(0,2),z=>(h(),E(f,{key:z,size:"small",type:"info",class:"customer-tag"},{default:o(()=>[c(n(z),1)]),_:2},1024))),128))])])])]}),_:1}),t(u,{prop:"phone",label:"联系电话",width:"130"}),t(u,{prop:"email",label:"邮箱",width:"180","show-overflow-tooltip":""}),t(u,{prop:"company",label:"公司",width:"150","show-overflow-tooltip":""}),t(u,{prop:"address",label:"地址",width:"200","show-overflow-tooltip":""}),t(u,{label:"设备统计",width:"120"},{default:o(({row:a})=>{var _,z,Q;return[l("div",Ae,[l("div",Re,[t(H,null,{default:o(()=>[t(P(be))]),_:1}),l("span",null,n(((_=a.deviceCount)==null?void 0:_.total)||0),1)]),l("div",je,[((z=a.deviceCount)==null?void 0:z.purchased)>0?(h(),E(f,{key:0,type:"success",size:"small"},{default:o(()=>[c(" 购买"+n(a.deviceCount.purchased),1)]),_:2},1024)):$("",!0),((Q=a.deviceCount)==null?void 0:Q.rental)>0?(h(),E(f,{key:1,type:"warning",size:"small"},{default:o(()=>[c(" 租赁"+n(a.deviceCount.rental),1)]),_:2},1024)):$("",!0)])])]}),_:1}),t(u,{prop:"totalSpent",label:"消费金额",width:"100"},{default:o(({row:a})=>[l("div",Ke,[l("span",Oe,"¥"+n(a.totalSpent.toLocaleString()),1),l("div",qe,[t(ce,{modelValue:a.customerValue,"onUpdate:modelValue":_=>a.customerValue=_,max:10,size:"small",disabled:"","show-score":"","text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])])])]),_:1}),t(u,{prop:"status",label:"状态",width:"80"},{default:o(({row:a})=>[t(f,{type:O(a.status)},{default:o(()=>[c(n(q(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"registrationDate",label:"注册日期",width:"110"}),t(u,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[t(I,{text:"",type:"primary",size:"small",onClick:_=>te(a)},{default:o(()=>e[11]||(e[11]=[c(" 查看详情 ",-1)])),_:2,__:[11]},1032,["onClick"]),t(I,{text:"",type:"primary",size:"small",onClick:_=>le(a)},{default:o(()=>e[12]||(e[12]=[c(" 编辑 ",-1)])),_:2,__:[12]},1032,["onClick"]),t(I,{text:"",type:"danger",size:"small",onClick:_=>ae(a)},{default:o(()=>e[13]||(e[13]=[c(" 删除 ",-1)])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[me,V.value]]),l("div",He,[t(ve,{"current-page":m.value,"onUpdate:currentPage":e[5]||(e[5]=a=>m.value=a),"page-size":v.value,"onUpdate:pageSize":e[6]||(e[6]=a=>v.value=a),"page-sizes":[10,20,50,100],total:C.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:Z},null,8,["current-page","page-size","total"])])]),t(Ce,{modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=a=>T.value=a),customer:U.value,onSuccess:oe},null,8,["modelValue","customer"]),t(pe,{modelValue:k.value,"onUpdate:modelValue":e[8]||(e[8]=a=>k.value=a),title:"客户详情",width:"800px","before-close":ne},{default:o(()=>[r.value?(h(),N("div",Je,[l("div",Qe,[e[20]||(e[20]=l("h4",null,"基本信息",-1)),l("div",Ge,[l("div",We,[e[14]||(e[14]=l("label",null,"客户姓名：",-1)),l("span",null,n(r.value.name),1)]),l("div",Xe,[e[15]||(e[15]=l("label",null,"联系电话：",-1)),l("span",null,n(r.value.phone),1)]),l("div",Ye,[e[16]||(e[16]=l("label",null,"邮箱地址：",-1)),l("span",null,n(r.value.email),1)]),l("div",Ze,[e[17]||(e[17]=l("label",null,"公司名称：",-1)),l("span",null,n(r.value.company),1)]),l("div",et,[e[18]||(e[18]=l("label",null,"客户等级：",-1)),t(f,{type:j(r.value.customerLevel)},{default:o(()=>[c(n(K(r.value.customerLevel)),1)]),_:1},8,["type"])]),l("div",tt,[e[19]||(e[19]=l("label",null,"客户状态：",-1)),t(f,{type:O(r.value.status)},{default:o(()=>[c(n(q(r.value.status)),1)]),_:1},8,["type"])])])]),l("div",lt,[e[25]||(e[25]=l("h4",null,"统计信息",-1)),l("div",at,[l("div",st,[l("div",ot,n(r.value.totalOrders),1),e[21]||(e[21]=l("div",{class:"stat-label"},"总订单数",-1))]),l("div",nt,[l("div",it,"¥"+n(r.value.totalSpent.toLocaleString()),1),e[22]||(e[22]=l("div",{class:"stat-label"},"总消费金额",-1))]),l("div",ut,[l("div",dt,n(D.value.length),1),e[23]||(e[23]=l("div",{class:"stat-label"},"关联设备数",-1))]),l("div",rt,[l("div",ct,n(r.value.registrationDate),1),e[24]||(e[24]=l("div",{class:"stat-label"},"注册日期",-1))])])]),l("div",vt,[e[26]||(e[26]=l("h4",null,"关联设备",-1)),t(J,{data:D.value,size:"small"},{default:o(()=>[t(u,{prop:"deviceId",label:"设备ID",width:"120"}),t(u,{prop:"deviceModel",label:"设备型号",width:"150"}),t(u,{prop:"status",label:"状态",width:"100"},{default:o(({row:a})=>[t(f,{type:ie(a.status),size:"small"},{default:o(()=>[c(n(ue(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"rentalStartDate",label:"开始日期",width:"110"}),t(u,{prop:"rentalEndDate",label:"结束日期",width:"110"}),t(u,{prop:"dailyRate",label:"日租金",width:"80"},{default:o(({row:a})=>[c(" ¥"+n(a.dailyRate),1)]),_:1})]),_:1},8,["data"])])])):$("",!0)]),_:1},8,["modelValue"])])}}}),Vt=ke(pt,[["__scopeId","data-v-aedce3e6"]]);export{Vt as default};
